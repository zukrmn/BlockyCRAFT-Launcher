var qt=Object.create;var Le=Object.defineProperty;var Kt=Object.getOwnPropertyDescriptor;var Yt=Object.getOwnPropertyNames;var Qt=Object.getPrototypeOf,er=Object.prototype.hasOwnProperty;var K=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports),tr=(i,e)=>{for(var t in e)Le(i,t,{get:e[t],enumerable:!0})},Xe=(i,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Yt(e))!er.call(i,s)&&s!==t&&Le(i,s,{get:()=>e[s],enumerable:!(r=Kt(e,s))||r.enumerable});return i};var G=(i,e,t)=>(t=i!=null?qt(Qt(i)):{},Xe(e||!i||!i.__esModule?Le(t,"default",{value:i,enumerable:!0}):t,i)),rr=i=>Xe(Le({},"__esModule",{value:!0}),i);var ke=K((Mr,Ke)=>{Ke.exports={LOCHDR:30,LOCSIG:67324752,LOCVER:4,LOCFLG:6,LOCHOW:8,LOCTIM:10,LOCCRC:14,LOCSIZ:18,LOCLEN:22,LOCNAM:26,LOCEXT:28,EXTSIG:134695760,EXTHDR:16,EXTCRC:4,EXTSIZ:8,EXTLEN:12,CENHDR:46,CENSIG:33639248,CENVEM:4,CENVER:6,CENFLG:8,CENHOW:10,CENTIM:12,CENCRC:16,CENSIZ:20,CENLEN:24,CENNAM:28,CENEXT:30,CENCOM:32,CENDSK:34,CENATT:36,CENATX:38,CENOFF:42,ENDHDR:22,ENDSIG:101010256,ENDSUB:8,ENDTOT:10,ENDSIZ:12,ENDOFF:16,ENDCOM:20,END64HDR:20,END64SIG:117853008,END64START:4,END64OFF:8,END64NUMDISKS:16,ZIP64SIG:101075792,ZIP64HDR:56,ZIP64LEAD:12,ZIP64SIZE:4,ZIP64VEM:12,ZIP64VER:14,ZIP64DSK:16,ZIP64DSKDIR:20,ZIP64SUB:24,ZIP64TOT:32,ZIP64SIZB:40,ZIP64OFF:48,ZIP64EXTRA:56,STORED:0,SHRUNK:1,REDUCED1:2,REDUCED2:3,REDUCED3:4,REDUCED4:5,IMPLODED:6,DEFLATED:8,ENHANCED_DEFLATED:9,PKWARE:10,BZIP2:12,LZMA:14,IBM_TERSE:18,IBM_LZ77:19,AES_ENCRYPT:99,FLG_ENC:1,FLG_COMP1:2,FLG_COMP2:4,FLG_DESC:8,FLG_ENH:16,FLG_PATCH:32,FLG_STR:64,FLG_EFS:2048,FLG_MSK:4096,FILE:2,BUFFER:1,NONE:0,EF_ID:0,EF_SIZE:2,ID_ZIP64:1,ID_AVINFO:7,ID_PFS:8,ID_OS2:9,ID_NTFS:10,ID_OPENVMS:12,ID_UNIX:13,ID_FORK:14,ID_PATCH:15,ID_X509_PKCS7:20,ID_X509_CERTID_F:21,ID_X509_CERTID_C:22,ID_STRONGENC:23,ID_RECORD_MGT:24,ID_X509_PKCS7_RL:25,ID_IBM1:101,ID_IBM2:102,ID_POSZIP:18064,EF_ZIP64_OR_32:4294967295,EF_ZIP64_OR_16:65535,EF_ZIP64_SUNCOMP:0,EF_ZIP64_SCOMP:8,EF_ZIP64_RHO:16,EF_ZIP64_DSN:24}});var Ie=K(Qe=>{var Ye={INVALID_LOC:"Invalid LOC header (bad signature)",INVALID_CEN:"Invalid CEN header (bad signature)",INVALID_END:"Invalid END header (bad signature)",DESCRIPTOR_NOT_EXIST:"No descriptor present",DESCRIPTOR_UNKNOWN:"Unknown descriptor format",DESCRIPTOR_FAULTY:"Descriptor data is malformed",NO_DATA:"Nothing to decompress",BAD_CRC:"CRC32 checksum failed {0}",FILE_IN_THE_WAY:"There is a file in the way: {0}",UNKNOWN_METHOD:"Invalid/unsupported compression method",AVAIL_DATA:"inflate::Available inflate data did not terminate",INVALID_DISTANCE:"inflate::Invalid literal/length or distance code in fixed or dynamic block",TO_MANY_CODES:"inflate::Dynamic block code description: too many length or distance codes",INVALID_REPEAT_LEN:"inflate::Dynamic block code description: repeat more than specified lengths",INVALID_REPEAT_FIRST:"inflate::Dynamic block code description: repeat lengths with no first length",INCOMPLETE_CODES:"inflate::Dynamic block code description: code lengths codes incomplete",INVALID_DYN_DISTANCE:"inflate::Dynamic block code description: invalid distance code lengths",INVALID_CODES_LEN:"inflate::Dynamic block code description: invalid literal/length code lengths",INVALID_STORE_BLOCK:"inflate::Stored block length did not match one's complement",INVALID_BLOCK_TYPE:"inflate::Invalid block type (type == 3)",CANT_EXTRACT_FILE:"Could not extract the file",CANT_OVERRIDE:"Target file already exists",DISK_ENTRY_TOO_LARGE:"Number of disk entries is too large",NO_ZIP:"No zip file was loaded",NO_ENTRY:"Entry doesn't exist",DIRECTORY_CONTENT_ERROR:"A directory cannot have content",FILE_NOT_FOUND:'File not found: "{0}"',NOT_IMPLEMENTED:"Not implemented",INVALID_FILENAME:"Invalid filename",INVALID_FORMAT:"Invalid or unsupported zip format. No END header found",INVALID_PASS_PARAM:"Incompatible password parameter",WRONG_PASSWORD:"Wrong Password",COMMENT_TOO_LONG:"Comment is too long",EXTRA_FIELD_PARSE_ERROR:"Extra field parsing error"};function nr(i){return function(...e){return e.length&&(i=i.replace(/\{(\d)\}/g,(t,r)=>e[r]||"")),new Error("ADM-ZIP: "+i)}}for(let i of Object.keys(Ye))Qe[i]=nr(Ye[i])});var ot=K((kr,nt)=>{var or=require("fs"),Z=require("path"),et=ke(),ir=Ie(),sr=typeof process=="object"&&process.platform==="win32",tt=i=>typeof i=="object"&&i!==null,rt=new Uint32Array(256).map((i,e)=>{for(let t=0;t<8;t++)(e&1)!==0?e=3988292384^e>>>1:e>>>=1;return e>>>0});function H(i){this.sep=Z.sep,this.fs=or,tt(i)&&tt(i.fs)&&typeof i.fs.statSync=="function"&&(this.fs=i.fs)}nt.exports=H;H.prototype.makeDir=function(i){let e=this;function t(r){let s=r.split(e.sep)[0];r.split(e.sep).forEach(function(n){if(!(!n||n.substr(-1,1)===":")){s+=e.sep+n;var c;try{c=e.fs.statSync(s)}catch{e.fs.mkdirSync(s)}if(c&&c.isFile())throw ir.FILE_IN_THE_WAY(`"${s}"`)}})}t(i)};H.prototype.writeFileTo=function(i,e,t,r){let s=this;if(s.fs.existsSync(i)){if(!t)return!1;var n=s.fs.statSync(i);if(n.isDirectory())return!1}var c=Z.dirname(i);s.fs.existsSync(c)||s.makeDir(c);var d;try{d=s.fs.openSync(i,"w",438)}catch{s.fs.chmodSync(i,438),d=s.fs.openSync(i,"w",438)}if(d)try{s.fs.writeSync(d,e,0,e.length,0)}finally{s.fs.closeSync(d)}return s.fs.chmodSync(i,r||438),!0};H.prototype.writeFileToAsync=function(i,e,t,r,s){typeof r=="function"&&(s=r,r=void 0);let n=this;n.fs.exists(i,function(c){if(c&&!t)return s(!1);n.fs.stat(i,function(d,v){if(c&&v.isDirectory())return s(!1);var y=Z.dirname(i);n.fs.exists(y,function(S){S||n.makeDir(y),n.fs.open(i,"w",438,function(b,N){b?n.fs.chmod(i,438,function(){n.fs.open(i,"w",438,function(a,f){n.fs.write(f,e,0,e.length,0,function(){n.fs.close(f,function(){n.fs.chmod(i,r||438,function(){s(!0)})})})})}):N?n.fs.write(N,e,0,e.length,0,function(){n.fs.close(N,function(){n.fs.chmod(i,r||438,function(){s(!0)})})}):n.fs.chmod(i,r||438,function(){s(!0)})})})})})};H.prototype.findFiles=function(i){let e=this;function t(r,s,n){typeof s=="boolean"&&(n=s,s=void 0);let c=[];return e.fs.readdirSync(r).forEach(function(d){let v=Z.join(r,d),y=e.fs.statSync(v);(!s||s.test(v))&&c.push(Z.normalize(v)+(y.isDirectory()?e.sep:"")),y.isDirectory()&&n&&(c=c.concat(t(v,s,n)))}),c}return t(i,void 0,!0)};H.prototype.findFilesAsync=function(i,e){let t=this,r=[];t.fs.readdir(i,function(s,n){if(s)return e(s);let c=n.length;if(!c)return e(null,r);n.forEach(function(d){d=Z.join(i,d),t.fs.stat(d,function(v,y){if(v)return e(v);y&&(r.push(Z.normalize(d)+(y.isDirectory()?t.sep:"")),y.isDirectory()?t.findFilesAsync(d,function(S,b){if(S)return e(S);r=r.concat(b),--c||e(null,r)}):--c||e(null,r))})})})};H.prototype.getAttributes=function(){};H.prototype.setAttributes=function(){};H.crc32update=function(i,e){return rt[(i^e)&255]^i>>>8};H.crc32=function(i){typeof i=="string"&&(i=Buffer.from(i,"utf8"));let e=i.length,t=-1;for(let r=0;r<e;)t=H.crc32update(t,i[r++]);return~t>>>0};H.methodToString=function(i){switch(i){case et.STORED:return"STORED ("+i+")";case et.DEFLATED:return"DEFLATED ("+i+")";default:return"UNSUPPORTED ("+i+")"}};H.canonical=function(i){if(!i)return"";let e=Z.posix.normalize("/"+i.split("\\").join("/"));return Z.join(".",e)};H.zipnamefix=function(i){if(!i)return"";let e=Z.posix.normalize("/"+i.split("\\").join("/"));return Z.posix.join(".",e)};H.findLast=function(i,e){if(!Array.isArray(i))throw new TypeError("arr is not array");let t=i.length>>>0;for(let r=t-1;r>=0;r--)if(e(i[r],r,i))return i[r]};H.sanitize=function(i,e){i=Z.resolve(Z.normalize(i));for(var t=e.split("/"),r=0,s=t.length;r<s;r++){var n=Z.normalize(Z.join(i,t.slice(r,s).join(Z.sep)));if(n.indexOf(i)===0)return n}return Z.normalize(Z.join(i,Z.basename(e)))};H.toBuffer=function(e,t){return Buffer.isBuffer(e)?e:e instanceof Uint8Array?Buffer.from(e):typeof e=="string"?t(e):Buffer.alloc(0)};H.readBigUInt64LE=function(i,e){var t=Buffer.from(i.slice(e,e+8));return t.swap64(),parseInt(`0x${t.toString("hex")}`)};H.fromDOS2Date=function(i){return new Date((i>>25&127)+1980,Math.max((i>>21&15)-1,0),Math.max(i>>16&31,1),i>>11&31,i>>5&63,(i&31)<<1)};H.fromDate2DOS=function(i){let e=0,t=0;return i.getFullYear()>1979&&(e=(i.getFullYear()-1980&127)<<9|i.getMonth()+1<<5|i.getDate(),t=i.getHours()<<11|i.getMinutes()<<5|i.getSeconds()>>1),e<<16|t};H.isWin=sr;H.crcTable=rt});var st=K((Br,it)=>{var ar=require("path");it.exports=function(i,{fs:e}){var t=i||"",r=n(),s=null;function n(){return{directory:!1,readonly:!1,hidden:!1,executable:!1,mtime:0,atime:0}}return t&&e.existsSync(t)?(s=e.statSync(t),r.directory=s.isDirectory(),r.mtime=s.mtime,r.atime=s.atime,r.executable=(73&s.mode)!==0,r.readonly=(128&s.mode)===0,r.hidden=ar.basename(t)[0]==="."):console.warn("Invalid path: "+t),{get directory(){return r.directory},get readOnly(){return r.readonly},get hidden(){return r.hidden},get mtime(){return r.mtime},get atime(){return r.atime},get executable(){return r.executable},decodeAttributes:function(){},encodeAttributes:function(){},toJSON:function(){return{path:t,isDirectory:r.directory,isReadOnly:r.readonly,isHidden:r.hidden,isExecutable:r.executable,mTime:r.mtime,aTime:r.atime}},toString:function(){return JSON.stringify(this.toJSON(),null,"	")}}}});var ct=K(($r,at)=>{at.exports={efs:!0,encode:i=>Buffer.from(i,"utf8"),decode:i=>i.toString("utf8")}});var me=K((Vr,he)=>{he.exports=ot();he.exports.Constants=ke();he.exports.Errors=Ie();he.exports.FileAttr=st();he.exports.decoder=ct()});var ft=K((zr,lt)=>{var se=me(),E=se.Constants;lt.exports=function(){var i=20,e=10,t=0,r=0,s=0,n=0,c=0,d=0,v=0,y=0,S=0,b=0,N=0,a=0,f=0;i|=se.isWin?2560:768,t|=E.FLG_EFS;let g={extraLen:0},l=o=>Math.max(0,o)>>>0,m=o=>Math.max(0,o)&65535,p=o=>Math.max(0,o)&255;return s=se.fromDate2DOS(new Date),{get made(){return i},set made(o){i=o},get version(){return e},set version(o){e=o},get flags(){return t},set flags(o){t=o},get flags_efs(){return(t&E.FLG_EFS)>0},set flags_efs(o){o?t|=E.FLG_EFS:t&=~E.FLG_EFS},get flags_desc(){return(t&E.FLG_DESC)>0},set flags_desc(o){o?t|=E.FLG_DESC:t&=~E.FLG_DESC},get method(){return r},set method(o){switch(o){case E.STORED:this.version=10;case E.DEFLATED:default:this.version=20}r=o},get time(){return se.fromDOS2Date(this.timeval)},set time(o){this.timeval=se.fromDate2DOS(o)},get timeval(){return s},set timeval(o){s=l(o)},get timeHighByte(){return p(s>>>8)},get crc(){return n},set crc(o){n=l(o)},get compressedSize(){return c},set compressedSize(o){c=l(o)},get size(){return d},set size(o){d=l(o)},get fileNameLength(){return v},set fileNameLength(o){v=o},get extraLength(){return y},set extraLength(o){y=o},get extraLocalLength(){return g.extraLen},set extraLocalLength(o){g.extraLen=o},get commentLength(){return S},set commentLength(o){S=o},get diskNumStart(){return b},set diskNumStart(o){b=l(o)},get inAttr(){return N},set inAttr(o){N=l(o)},get attr(){return a},set attr(o){a=l(o)},get fileAttr(){return(a||0)>>16&4095},get offset(){return f},set offset(o){f=l(o)},get encrypted(){return(t&E.FLG_ENC)===E.FLG_ENC},get centralHeaderSize(){return E.CENHDR+v+y+S},get realDataOffset(){return f+E.LOCHDR+g.fnameLen+g.extraLen},get localHeader(){return g},loadLocalHeaderFromBinary:function(o){var u=o.slice(f,f+E.LOCHDR);if(u.readUInt32LE(0)!==E.LOCSIG)throw se.Errors.INVALID_LOC();g.version=u.readUInt16LE(E.LOCVER),g.flags=u.readUInt16LE(E.LOCFLG),g.method=u.readUInt16LE(E.LOCHOW),g.time=u.readUInt32LE(E.LOCTIM),g.crc=u.readUInt32LE(E.LOCCRC),g.compressedSize=u.readUInt32LE(E.LOCSIZ),g.size=u.readUInt32LE(E.LOCLEN),g.fnameLen=u.readUInt16LE(E.LOCNAM),g.extraLen=u.readUInt16LE(E.LOCEXT);let h=f+E.LOCHDR+g.fnameLen,D=h+g.extraLen;return o.slice(h,D)},loadFromBinary:function(o){if(o.length!==E.CENHDR||o.readUInt32LE(0)!==E.CENSIG)throw se.Errors.INVALID_CEN();i=o.readUInt16LE(E.CENVEM),e=o.readUInt16LE(E.CENVER),t=o.readUInt16LE(E.CENFLG),r=o.readUInt16LE(E.CENHOW),s=o.readUInt32LE(E.CENTIM),n=o.readUInt32LE(E.CENCRC),c=o.readUInt32LE(E.CENSIZ),d=o.readUInt32LE(E.CENLEN),v=o.readUInt16LE(E.CENNAM),y=o.readUInt16LE(E.CENEXT),S=o.readUInt16LE(E.CENCOM),b=o.readUInt16LE(E.CENDSK),N=o.readUInt16LE(E.CENATT),a=o.readUInt32LE(E.CENATX),f=o.readUInt32LE(E.CENOFF)},localHeaderToBinary:function(){var o=Buffer.alloc(E.LOCHDR);return o.writeUInt32LE(E.LOCSIG,0),o.writeUInt16LE(e,E.LOCVER),o.writeUInt16LE(t,E.LOCFLG),o.writeUInt16LE(r,E.LOCHOW),o.writeUInt32LE(s,E.LOCTIM),o.writeUInt32LE(n,E.LOCCRC),o.writeUInt32LE(c,E.LOCSIZ),o.writeUInt32LE(d,E.LOCLEN),o.writeUInt16LE(v,E.LOCNAM),o.writeUInt16LE(g.extraLen,E.LOCEXT),o},centralHeaderToBinary:function(){var o=Buffer.alloc(E.CENHDR+v+y+S);return o.writeUInt32LE(E.CENSIG,0),o.writeUInt16LE(i,E.CENVEM),o.writeUInt16LE(e,E.CENVER),o.writeUInt16LE(t,E.CENFLG),o.writeUInt16LE(r,E.CENHOW),o.writeUInt32LE(s,E.CENTIM),o.writeUInt32LE(n,E.CENCRC),o.writeUInt32LE(c,E.CENSIZ),o.writeUInt32LE(d,E.CENLEN),o.writeUInt16LE(v,E.CENNAM),o.writeUInt16LE(y,E.CENEXT),o.writeUInt16LE(S,E.CENCOM),o.writeUInt16LE(b,E.CENDSK),o.writeUInt16LE(N,E.CENATT),o.writeUInt32LE(a,E.CENATX),o.writeUInt32LE(f,E.CENOFF),o},toJSON:function(){let o=function(u){return u+" bytes"};return{made:i,version:e,flags:t,method:se.methodToString(r),time:this.time,crc:"0x"+n.toString(16).toUpperCase(),compressedSize:o(c),size:o(d),fileNameLength:o(v),extraLength:o(y),commentLength:o(S),diskNumStart:b,inAttr:N,attr:a,offset:f,centralHeaderSize:o(E.CENHDR+v+y+S)}},toString:function(){return JSON.stringify(this.toJSON(),null,"	")}}}});var ut=K((Gr,dt)=>{var pe=me(),P=pe.Constants;dt.exports=function(){var i=0,e=0,t=0,r=0,s=0;return{get diskEntries(){return i},set diskEntries(n){i=e=n},get totalEntries(){return e},set totalEntries(n){e=i=n},get size(){return t},set size(n){t=n},get offset(){return r},set offset(n){r=n},get commentLength(){return s},set commentLength(n){s=n},get mainHeaderSize(){return P.ENDHDR+s},loadFromBinary:function(n){if((n.length!==P.ENDHDR||n.readUInt32LE(0)!==P.ENDSIG)&&(n.length<P.ZIP64HDR||n.readUInt32LE(0)!==P.ZIP64SIG))throw pe.Errors.INVALID_END();n.readUInt32LE(0)===P.ENDSIG?(i=n.readUInt16LE(P.ENDSUB),e=n.readUInt16LE(P.ENDTOT),t=n.readUInt32LE(P.ENDSIZ),r=n.readUInt32LE(P.ENDOFF),s=n.readUInt16LE(P.ENDCOM)):(i=pe.readBigUInt64LE(n,P.ZIP64SUB),e=pe.readBigUInt64LE(n,P.ZIP64TOT),t=pe.readBigUInt64LE(n,P.ZIP64SIZE),r=pe.readBigUInt64LE(n,P.ZIP64OFF),s=0)},toBinary:function(){var n=Buffer.alloc(P.ENDHDR+s);return n.writeUInt32LE(P.ENDSIG,0),n.writeUInt32LE(0,4),n.writeUInt16LE(i,P.ENDSUB),n.writeUInt16LE(e,P.ENDTOT),n.writeUInt32LE(t,P.ENDSIZ),n.writeUInt32LE(r,P.ENDOFF),n.writeUInt16LE(s,P.ENDCOM),n.fill(" ",P.ENDHDR),n},toJSON:function(){let n=function(c,d){let v=c.toString(16).toUpperCase();for(;v.length<d;)v="0"+v;return"0x"+v};return{diskEntries:i,totalEntries:e,size:t+" bytes",offset:n(r,4),commentLength:s}},toString:function(){return JSON.stringify(this.toJSON(),null,"	")}}}});var $e=K(Be=>{Be.EntryHeader=ft();Be.MainHeader=ut()});var ht=K((Wr,gt)=>{gt.exports=function(i){var e=require("zlib"),t={chunkSize:(parseInt(i.length/1024)+1)*1024};return{deflate:function(){return e.deflateRawSync(i,t)},deflateAsync:function(r){var s=e.createDeflateRaw(t),n=[],c=0;s.on("data",function(d){n.push(d),c+=d.length}),s.on("end",function(){var d=Buffer.alloc(c),v=0;d.fill(0);for(var y=0;y<n.length;y++){var S=n[y];S.copy(d,v),v+=S.length}r&&r(d)}),s.end(i)}}}});var pt=K((Jr,mt)=>{var cr=+(process.versions?process.versions.node:"").split(".")[0]||0;mt.exports=function(i,e){var t=require("zlib");let r=cr>=15&&e>0?{maxOutputLength:e}:{};return{inflate:function(){return t.inflateRawSync(i,r)},inflateAsync:function(s){var n=t.createInflateRaw(r),c=[],d=0;n.on("data",function(v){c.push(v),d+=v.length}),n.on("end",function(){var v=Buffer.alloc(d),y=0;v.fill(0);for(var S=0;S<c.length;S++){var b=c[S];b.copy(v,y),y+=b.length}s&&s(v)}),n.end(i)}}}});var bt=K((Xr,wt)=>{"use strict";var{randomFillSync:yt}=require("crypto"),lr=Ie(),fr=new Uint32Array(256).map((i,e)=>{for(let t=0;t<8;t++)(e&1)!==0?e=e>>>1^3988292384:e>>>=1;return e>>>0}),Et=(i,e)=>Math.imul(i,e)>>>0,vt=(i,e)=>fr[(i^e)&255]^i>>>8,ve=()=>typeof yt=="function"?yt(Buffer.alloc(12)):ve.node();ve.node=()=>{let i=Buffer.alloc(12),e=i.length;for(let t=0;t<e;t++)i[t]=Math.random()*256&255;return i};var xe={genSalt:ve};function Ce(i){let e=Buffer.isBuffer(i)?i:Buffer.from(i);this.keys=new Uint32Array([305419896,591751049,878082192]);for(let t=0;t<e.length;t++)this.updateKeys(e[t])}Ce.prototype.updateKeys=function(i){let e=this.keys;return e[0]=vt(e[0],i),e[1]+=e[0]&255,e[1]=Et(e[1],134775813)+1,e[2]=vt(e[2],e[1]>>>24),i};Ce.prototype.next=function(){let i=(this.keys[2]|2)>>>0;return Et(i,i^1)>>8&255};function dr(i){let e=new Ce(i);return function(t){let r=Buffer.alloc(t.length),s=0;for(let n of t)r[s++]=e.updateKeys(n^e.next());return r}}function ur(i){let e=new Ce(i);return function(t,r,s=0){r||(r=Buffer.alloc(t.length));for(let n of t){let c=e.next();r[s++]=n^c,e.updateKeys(n)}return r}}function gr(i,e,t){if(!i||!Buffer.isBuffer(i)||i.length<12)return Buffer.alloc(0);let r=dr(t),s=r(i.slice(0,12)),n=(e.flags&8)===8?e.timeHighByte:e.crc>>>24;if(s[11]!==n)throw lr.WRONG_PASSWORD();return r(i.slice(12))}function hr(i){Buffer.isBuffer(i)&&i.length>=12?xe.genSalt=function(){return i.slice(0,12)}:i==="node"?xe.genSalt=ve.node:xe.genSalt=ve}function mr(i,e,t,r=!1){i==null&&(i=Buffer.alloc(0)),Buffer.isBuffer(i)||(i=Buffer.from(i.toString()));let s=ur(t),n=xe.genSalt();n[11]=e.crc>>>24&255,r&&(n[10]=e.crc>>>16&255);let c=Buffer.alloc(i.length+12);return s(n,c),s(i,c,12)}wt.exports={decrypt:gr,encrypt:mr,_salter:hr}});var Dt=K(Ne=>{Ne.Deflater=ht();Ne.Inflater=pt();Ne.ZipCrypto=bt()});var ze=K((Kr,St)=>{var A=me(),pr=$e(),k=A.Constants,Ve=Dt();St.exports=function(i,e){var t=new pr.EntryHeader,r=Buffer.alloc(0),s=Buffer.alloc(0),n=!1,c=null,d=Buffer.alloc(0),v=Buffer.alloc(0),y=!0;let S=i,b=typeof S.decoder=="object"?S.decoder:A.decoder;y=b.hasOwnProperty("efs")?b.efs:!1;function N(){return!e||!(e instanceof Uint8Array)?Buffer.alloc(0):(v=t.loadLocalHeaderFromBinary(e),e.slice(t.realDataOffset,t.realDataOffset+t.compressedSize))}function a(o){if(t.flags_desc){let u={},h=t.realDataOffset+t.compressedSize;if(e.readUInt32LE(h)==k.LOCSIG||e.readUInt32LE(h)==k.CENSIG)throw A.Errors.DESCRIPTOR_NOT_EXIST();if(e.readUInt32LE(h)==k.EXTSIG)u.crc=e.readUInt32LE(h+k.EXTCRC),u.compressedSize=e.readUInt32LE(h+k.EXTSIZ),u.size=e.readUInt32LE(h+k.EXTLEN);else if(e.readUInt16LE(h+12)===19280)u.crc=e.readUInt32LE(h+k.EXTCRC-4),u.compressedSize=e.readUInt32LE(h+k.EXTSIZ-4),u.size=e.readUInt32LE(h+k.EXTLEN-4);else throw A.Errors.DESCRIPTOR_UNKNOWN();if(u.compressedSize!==t.compressedSize||u.size!==t.size||u.crc!==t.crc)throw A.Errors.DESCRIPTOR_FAULTY();if(A.crc32(o)!==u.crc)return!1}else if(A.crc32(o)!==t.localHeader.crc)return!1;return!0}function f(o,u,h){if(typeof u>"u"&&typeof o=="string"&&(h=o,o=void 0),n)return o&&u&&u(Buffer.alloc(0),A.Errors.DIRECTORY_CONTENT_ERROR()),Buffer.alloc(0);var D=N();if(D.length===0)return o&&u&&u(D),D;if(t.encrypted){if(typeof h!="string"&&!Buffer.isBuffer(h))throw A.Errors.INVALID_PASS_PARAM();D=Ve.ZipCrypto.decrypt(D,t,h)}var w=Buffer.alloc(t.size);switch(t.method){case A.Constants.STORED:if(D.copy(w),a(w))return o&&u&&u(w),w;throw o&&u&&u(w,A.Errors.BAD_CRC()),A.Errors.BAD_CRC();case A.Constants.DEFLATED:var x=new Ve.Inflater(D,t.size);if(o)x.inflateAsync(function(_){_.copy(_,0),u&&(a(_)?u(_):u(_,A.Errors.BAD_CRC()))});else{if(x.inflate(w).copy(w,0),!a(w))throw A.Errors.BAD_CRC(`"${b.decode(r)}"`);return w}break;default:throw o&&u&&u(Buffer.alloc(0),A.Errors.UNKNOWN_METHOD()),A.Errors.UNKNOWN_METHOD()}}function g(o,u){if((!c||!c.length)&&Buffer.isBuffer(e))return o&&u&&u(N()),N();if(c.length&&!n){var h;switch(t.method){case A.Constants.STORED:return t.compressedSize=t.size,h=Buffer.alloc(c.length),c.copy(h),o&&u&&u(h),h;default:case A.Constants.DEFLATED:var D=new Ve.Deflater(c);if(o)D.deflateAsync(function(x){h=Buffer.alloc(x.length),t.compressedSize=x.length,x.copy(h),u&&u(h)});else{var w=D.deflate();return t.compressedSize=w.length,w}D=null;break}}else if(o&&u)u(Buffer.alloc(0));else return Buffer.alloc(0)}function l(o,u){return(o.readUInt32LE(u+4)<<4)+o.readUInt32LE(u)}function m(o){try{for(var u=0,h,D,w;u+4<o.length;)h=o.readUInt16LE(u),u+=2,D=o.readUInt16LE(u),u+=2,w=o.slice(u,u+D),u+=D,k.ID_ZIP64===h&&p(w)}catch{throw A.Errors.EXTRA_FIELD_PARSE_ERROR()}}function p(o){var u,h,D,w;o.length>=k.EF_ZIP64_SCOMP&&(u=l(o,k.EF_ZIP64_SUNCOMP),t.size===k.EF_ZIP64_OR_32&&(t.size=u)),o.length>=k.EF_ZIP64_RHO&&(h=l(o,k.EF_ZIP64_SCOMP),t.compressedSize===k.EF_ZIP64_OR_32&&(t.compressedSize=h)),o.length>=k.EF_ZIP64_DSN&&(D=l(o,k.EF_ZIP64_RHO),t.offset===k.EF_ZIP64_OR_32&&(t.offset=D)),o.length>=k.EF_ZIP64_DSN+4&&(w=o.readUInt32LE(k.EF_ZIP64_DSN),t.diskNumStart===k.EF_ZIP64_OR_16&&(t.diskNumStart=w))}return{get entryName(){return b.decode(r)},get rawEntryName(){return r},set entryName(o){r=A.toBuffer(o,b.encode);var u=r[r.length-1];n=u===47||u===92,t.fileNameLength=r.length},get efs(){return typeof y=="function"?y(this.entryName):y},get extra(){return d},set extra(o){d=o,t.extraLength=o.length,m(o)},get comment(){return b.decode(s)},set comment(o){if(s=A.toBuffer(o,b.encode),t.commentLength=s.length,s.length>65535)throw A.Errors.COMMENT_TOO_LONG()},get name(){var o=b.decode(r);return n?o.substr(o.length-1).split("/").pop():o.split("/").pop()},get isDirectory(){return n},getCompressedData:function(){return g(!1,null)},getCompressedDataAsync:function(o){g(!0,o)},setData:function(o){c=A.toBuffer(o,A.decoder.encode),!n&&c.length?(t.size=c.length,t.method=A.Constants.DEFLATED,t.crc=A.crc32(o),t.changed=!0):t.method=A.Constants.STORED},getData:function(o){return t.changed?c:f(!1,null,o)},getDataAsync:function(o,u){t.changed?o(c):f(!0,o,u)},set attr(o){t.attr=o},get attr(){return t.attr},set header(o){t.loadFromBinary(o)},get header(){return t},packCentralHeader:function(){t.flags_efs=this.efs,t.extraLength=d.length;var o=t.centralHeaderToBinary(),u=A.Constants.CENHDR;return r.copy(o,u),u+=r.length,d.copy(o,u),u+=t.extraLength,s.copy(o,u),o},packLocalHeader:function(){let o=0;t.flags_efs=this.efs,t.extraLocalLength=v.length;let u=t.localHeaderToBinary(),h=Buffer.alloc(u.length+r.length+t.extraLocalLength);return u.copy(h,o),o+=u.length,r.copy(h,o),o+=r.length,v.copy(h,o),o+=v.length,h},toJSON:function(){let o=function(u){return"<"+(u&&u.length+" bytes buffer"||"null")+">"};return{entryName:this.entryName,name:this.name,comment:this.comment,isDirectory:this.isDirectory,header:t.toJSON(),compressedData:o(e),data:o(c)}},toString:function(){return JSON.stringify(this.toJSON(),null,"	")}}}});var xt=K((Yr,It)=>{var Lt=ze(),yr=$e(),J=me();It.exports=function(i,e){var t=[],r={},s=Buffer.alloc(0),n=new yr.MainHeader,c=!1,d=null;let v=new Set,y=e,{noSort:S,decoder:b}=y;i?f(y.readEntries):c=!0;function N(){let l=new Set;for(let m of Object.keys(r)){let p=m.split("/");if(p.pop(),!!p.length)for(let o=0;o<p.length;o++){let u=p.slice(0,o+1).join("/")+"/";l.add(u)}}for(let m of l)if(!(m in r)){let p=new Lt(y);p.entryName=m,p.attr=16,p.temporary=!0,t.push(p),r[p.entryName]=p,v.add(p)}}function a(){if(c=!0,r={},n.diskEntries>(i.length-n.offset)/J.Constants.CENHDR)throw J.Errors.DISK_ENTRY_TOO_LARGE();t=new Array(n.diskEntries);for(var l=n.offset,m=0;m<t.length;m++){var p=l,o=new Lt(y,i);o.header=i.slice(p,p+=J.Constants.CENHDR),o.entryName=i.slice(p,p+=o.header.fileNameLength),o.header.extraLength&&(o.extra=i.slice(p,p+=o.header.extraLength)),o.header.commentLength&&(o.comment=i.slice(p,p+o.header.commentLength)),l+=o.header.centralHeaderSize,t[m]=o,r[o.entryName]=o}v.clear(),N()}function f(l){var m=i.length-J.Constants.ENDHDR,p=Math.max(0,m-65535),o=p,u=i.length,h=-1,D=0;for((typeof y.trailingSpace=="boolean"?y.trailingSpace:!1)&&(p=0),m;m>=o;m--)if(i[m]===80){if(i.readUInt32LE(m)===J.Constants.ENDSIG){h=m,D=m,u=m+J.Constants.ENDHDR,o=m-J.Constants.END64HDR;continue}if(i.readUInt32LE(m)===J.Constants.END64SIG){o=p;continue}if(i.readUInt32LE(m)===J.Constants.ZIP64SIG){h=m,u=m+J.readBigUInt64LE(i,m+J.Constants.ZIP64SIZE)+J.Constants.ZIP64LEAD;break}}if(h==-1)throw J.Errors.INVALID_FORMAT();n.loadFromBinary(i.slice(h,u)),n.commentLength&&(s=i.slice(D+J.Constants.ENDHDR)),l&&a()}function g(){t.length>1&&!S&&t.sort((l,m)=>l.entryName.toLowerCase().localeCompare(m.entryName.toLowerCase()))}return{get entries(){return c||a(),t.filter(l=>!v.has(l))},get comment(){return b.decode(s)},set comment(l){s=J.toBuffer(l,b.encode),n.commentLength=s.length},getEntryCount:function(){return c?t.length:n.diskEntries},forEach:function(l){this.entries.forEach(l)},getEntry:function(l){return c||a(),r[l]||null},setEntry:function(l){c||a(),t.push(l),r[l.entryName]=l,n.totalEntries=t.length},deleteFile:function(l,m=!0){c||a();let p=r[l];this.getEntryChildren(p,m).map(u=>u.entryName).forEach(this.deleteEntry)},deleteEntry:function(l){c||a();let m=r[l],p=t.indexOf(m);p>=0&&(t.splice(p,1),delete r[l],n.totalEntries=t.length)},getEntryChildren:function(l,m=!0){if(c||a(),typeof l=="object")if(l.isDirectory&&m){let p=[],o=l.entryName;for(let u of t)u.entryName.startsWith(o)&&p.push(u);return p}else return[l];return[]},getChildCount:function(l){if(l&&l.isDirectory){let m=this.getEntryChildren(l);return m.includes(l)?m.length-1:m.length}return 0},compressToBuffer:function(){c||a(),g();let l=[],m=[],p=0,o=0;n.size=0,n.offset=0;let u=0;for(let w of this.entries){let x=w.getCompressedData();w.header.offset=o;let _=w.packLocalHeader(),$=_.length+x.length;o+=$,l.push(_),l.push(x);let R=w.packCentralHeader();m.push(R),n.size+=R.length,p+=$+R.length,u++}p+=n.mainHeaderSize,n.offset=o,n.totalEntries=u,o=0;let h=Buffer.alloc(p);for(let w of l)w.copy(h,o),o+=w.length;for(let w of m)w.copy(h,o),o+=w.length;let D=n.toBinary();return s&&s.copy(D,J.Constants.ENDHDR),D.copy(h,o),i=h,c=!1,h},toAsyncBuffer:function(l,m,p,o){try{c||a(),g();let u=[],h=[],D=0,w=0,x=0;n.size=0,n.offset=0;let _=function($){if($.length>0){let R=$.shift(),C=R.entryName+R.extra.toString();p&&p(C),R.getCompressedDataAsync(function(O){o&&o(C),R.header.offset=w;let U=R.packLocalHeader(),q=U.length+O.length;w+=q,u.push(U),u.push(O);let ee=R.packCentralHeader();h.push(ee),n.size+=ee.length,D+=q+ee.length,x++,_($)})}else{D+=n.mainHeaderSize,n.offset=w,n.totalEntries=x,w=0;let R=Buffer.alloc(D);u.forEach(function(O){O.copy(R,w),w+=O.length}),h.forEach(function(O){O.copy(R,w),w+=O.length});let C=n.toBinary();s&&s.copy(C,J.Constants.ENDHDR),C.copy(R,w),i=R,c=!1,l(R)}};_(Array.from(this.entries))}catch(u){m(u)}}}}});var Ee=K((Qr,Nt)=>{var M=me(),B=require("path"),vr=ze(),Er=xt(),le=(...i)=>M.findLast(i,e=>typeof e=="boolean"),Ct=(...i)=>M.findLast(i,e=>typeof e=="string"),wr=(...i)=>M.findLast(i,e=>typeof e=="function"),br={noSort:!1,readEntries:!1,method:M.Constants.NONE,fs:null};Nt.exports=function(i,e){let t=null,r=Object.assign(Object.create(null),br);i&&typeof i=="object"&&(i instanceof Uint8Array||(Object.assign(r,i),i=r.input?r.input:void 0,r.input&&delete r.input),Buffer.isBuffer(i)&&(t=i,r.method=M.Constants.BUFFER,i=void 0)),Object.assign(r,e);let s=new M(r);if((typeof r.decoder!="object"||typeof r.decoder.encode!="function"||typeof r.decoder.decode!="function")&&(r.decoder=M.decoder),i&&typeof i=="string")if(s.fs.existsSync(i))r.method=M.Constants.FILE,r.filename=i,t=s.fs.readFileSync(i);else throw M.Errors.INVALID_FILENAME();let n=new Er(t,r),{canonical:c,sanitize:d,zipnamefix:v}=M;function y(a){if(a&&n){var f;if(typeof a=="string"&&(f=n.getEntry(B.posix.normalize(a))),typeof a=="object"&&typeof a.entryName<"u"&&typeof a.header<"u"&&(f=n.getEntry(a.entryName)),f)return f}return null}function S(a){let{join:f,normalize:g,sep:l}=B.posix;return f(".",g(l+a.split("\\").join(l)+l))}function b(a){return a instanceof RegExp?(function(f){return function(g){return f.test(g)}})(a):typeof a!="function"?()=>!0:a}let N=(a,f)=>{let g=f.slice(-1);return g=g===s.sep?s.sep:"",B.relative(a,f)+g};return{readFile:function(a,f){var g=y(a);return g&&g.getData(f)||null},childCount:function(a){let f=y(a);if(f)return n.getChildCount(f)},readFileAsync:function(a,f){var g=y(a);g?g.getDataAsync(f):f(null,"getEntry failed for:"+a)},readAsText:function(a,f){var g=y(a);if(g){var l=g.getData();if(l&&l.length)return l.toString(f||"utf8")}return""},readAsTextAsync:function(a,f,g){var l=y(a);l?l.getDataAsync(function(m,p){if(p){f(m,p);return}m&&m.length?f(m.toString(g||"utf8")):f("")}):f("")},deleteFile:function(a,f=!0){var g=y(a);g&&n.deleteFile(g.entryName,f)},deleteEntry:function(a){var f=y(a);f&&n.deleteEntry(f.entryName)},addZipComment:function(a){n.comment=a},getZipComment:function(){return n.comment||""},addZipEntryComment:function(a,f){var g=y(a);g&&(g.comment=f)},getZipEntryComment:function(a){var f=y(a);return f&&f.comment||""},updateFile:function(a,f){var g=y(a);g&&g.setData(f)},addLocalFile:function(a,f,g,l){if(s.fs.existsSync(a)){f=f?S(f):"";let m=B.win32.basename(B.win32.normalize(a));f+=g||m;let p=s.fs.statSync(a),o=p.isFile()?s.fs.readFileSync(a):Buffer.alloc(0);p.isDirectory()&&(f+=s.sep),this.addFile(f,o,l,p)}else throw M.Errors.FILE_NOT_FOUND(a)},addLocalFileAsync:function(a,f){a=typeof a=="object"?a:{localPath:a};let g=B.resolve(a.localPath),{comment:l}=a,{zipPath:m,zipName:p}=a,o=this;s.fs.stat(g,function(u,h){if(u)return f(u,!1);m=m?S(m):"";let D=B.win32.basename(B.win32.normalize(g));if(m+=p||D,h.isFile())s.fs.readFile(g,function(w,x){return w?f(w,!1):(o.addFile(m,x,l,h),setImmediate(f,void 0,!0))});else if(h.isDirectory())return m+=s.sep,o.addFile(m,Buffer.alloc(0),l,h),setImmediate(f,void 0,!0)})},addLocalFolder:function(a,f,g){if(g=b(g),f=f?S(f):"",a=B.normalize(a),s.fs.existsSync(a)){let l=s.findFiles(a),m=this;if(l.length)for(let p of l){let o=B.join(f,N(a,p));g(o)&&m.addLocalFile(p,B.dirname(o))}}else throw M.Errors.FILE_NOT_FOUND(a)},addLocalFolderAsync:function(a,f,g,l){l=b(l),g=g?S(g):"",a=B.normalize(a);var m=this;s.fs.open(a,"r",function(p){if(p&&p.code==="ENOENT")f(void 0,M.Errors.FILE_NOT_FOUND(a));else if(p)f(void 0,p);else{var o=s.findFiles(a),u=-1,h=function(){if(u+=1,u<o.length){var D=o[u],w=N(a,D).split("\\").join("/");w=w.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\x20-\x7E]/g,""),l(w)?s.fs.stat(D,function(x,_){x&&f(void 0,x),_.isFile()?s.fs.readFile(D,function($,R){$?f(void 0,$):(m.addFile(g+w,R,"",_),h())}):(m.addFile(g+w+"/",Buffer.alloc(0),"",_),h())}):process.nextTick(()=>{h()})}else f(!0,void 0)};h()}})},addLocalFolderAsync2:function(a,f){let g=this;a=typeof a=="object"?a:{localPath:a},localPath=B.resolve(S(a.localPath));let{zipPath:l,filter:m,namefix:p}=a;m instanceof RegExp?m=(function(h){return function(D){return h.test(D)}})(m):typeof m!="function"&&(m=function(){return!0}),l=l?S(l):"",p=="latin1"&&(p=h=>h.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\x20-\x7E]/g,"")),typeof p!="function"&&(p=h=>h);let o=h=>B.join(l,p(N(localPath,h))),u=h=>B.win32.basename(B.win32.normalize(p(h)));s.fs.open(localPath,"r",function(h){h&&h.code==="ENOENT"?f(void 0,M.Errors.FILE_NOT_FOUND(localPath)):h?f(void 0,h):s.findFilesAsync(localPath,function(D,w){if(D)return f(D);w=w.filter(x=>m(o(x))),w.length||f(void 0,!1),setImmediate(w.reverse().reduce(function(x,_){return function($,R){if($||R===!1)return setImmediate(x,$,!1);g.addLocalFileAsync({localPath:_,zipPath:B.dirname(o(_)),zipName:u(_)},x)}},f))})})},addLocalFolderPromise:function(a,f){return new Promise((g,l)=>{this.addLocalFolderAsync2(Object.assign({localPath:a},f),(m,p)=>{m&&l(m),p&&g(this)})})},addFile:function(a,f,g,l){a=v(a);let m=y(a),p=m!=null;p||(m=new vr(r),m.entryName=a),m.comment=g||"";let o=typeof l=="object"&&l instanceof s.fs.Stats;o&&(m.header.time=l.mtime);var u=m.isDirectory?16:0;let h=m.isDirectory?16384:32768;return o?h|=4095&l.mode:typeof l=="number"?h|=4095&l:h|=m.isDirectory?493:420,u=(u|h<<16)>>>0,m.attr=u,m.setData(f),p||n.setEntry(m),m},getEntries:function(a){return n.password=a,n?n.entries:[]},getEntry:function(a){return y(a)},getEntryCount:function(){return n.getEntryCount()},forEach:function(a){return n.forEach(a)},extractEntryTo:function(a,f,g,l,m,p){l=le(!1,l),m=le(!1,m),g=le(!0,g),p=Ct(m,p);var o=y(a);if(!o)throw M.Errors.NO_ENTRY();var u=c(o.entryName),h=d(f,p&&!o.isDirectory?p:g?u:B.basename(u));if(o.isDirectory){var D=n.getEntryChildren(o);return D.forEach(function(_){if(_.isDirectory)return;var $=_.getData();if(!$)throw M.Errors.CANT_EXTRACT_FILE();var R=c(_.entryName),C=d(f,g?R:B.basename(R));let O=m?_.header.fileAttr:void 0;s.writeFileTo(C,$,l,O)}),!0}var w=o.getData(n.password);if(!w)throw M.Errors.CANT_EXTRACT_FILE();if(s.fs.existsSync(h)&&!l)throw M.Errors.CANT_OVERRIDE();let x=m?a.header.fileAttr:void 0;return s.writeFileTo(h,w,l,x),!0},test:function(a){if(!n)return!1;for(var f in n.entries)try{if(f.isDirectory)continue;var g=n.entries[f].getData(a);if(!g)return!1}catch{return!1}return!0},extractAllTo:function(a,f,g,l){if(g=le(!1,g),l=Ct(g,l),f=le(!1,f),!n)throw M.Errors.NO_ZIP();n.entries.forEach(function(m){var p=d(a,c(m.entryName));if(m.isDirectory){s.makeDir(p);return}var o=m.getData(l);if(!o)throw M.Errors.CANT_EXTRACT_FILE();let u=g?m.header.fileAttr:void 0;s.writeFileTo(p,o,f,u);try{s.fs.utimesSync(p,m.header.time,m.header.time)}catch{throw M.Errors.CANT_EXTRACT_FILE()}})},extractAllToAsync:function(a,f,g,l){if(l=wr(f,g,l),g=le(!1,g),f=le(!1,f),!l)return new Promise((h,D)=>{this.extractAllToAsync(a,f,g,function(w){w?D(w):h(this)})});if(!n){l(M.Errors.NO_ZIP());return}a=B.resolve(a);let m=h=>d(a,B.normalize(c(h.entryName))),p=(h,D)=>new Error(h+': "'+D+'"'),o=[],u=[];n.entries.forEach(h=>{h.isDirectory?o.push(h):u.push(h)});for(let h of o){let D=m(h),w=g?h.header.fileAttr:void 0;try{s.makeDir(D),w&&s.fs.chmodSync(D,w),s.fs.utimesSync(D,h.header.time,h.header.time)}catch{l(p("Unable to create folder",D))}}u.reverse().reduce(function(h,D){return function(w){if(w)h(w);else{let x=B.normalize(c(D.entryName)),_=d(a,x);D.getDataAsync(function($,R){if(R)h(R);else if(!$)h(M.Errors.CANT_EXTRACT_FILE());else{let C=g?D.header.fileAttr:void 0;s.writeFileToAsync(_,$,f,C,function(O){O||h(p("Unable to write file",_)),s.fs.utimes(_,D.header.time,D.header.time,function(U){U?h(p("Unable to set times",_)):h()})})}})}}},l)()},writeZip:function(a,f){if(arguments.length===1&&typeof a=="function"&&(f=a,a=""),!a&&r.filename&&(a=r.filename),!!a){var g=n.compressToBuffer();if(g){var l=s.writeFileTo(a,g,!0);typeof f=="function"&&f(l?null:new Error("failed"),"")}}},writeZipPromise:function(a,f){let{overwrite:g,perm:l}=Object.assign({overwrite:!0},f);return new Promise((m,p)=>{!a&&r.filename&&(a=r.filename),a||p("ADM-ZIP: ZIP File Name Missing"),this.toBufferPromise().then(o=>{let u=h=>h?m(h):p("ADM-ZIP: Wasn't able to write zip file");s.writeFileToAsync(a,o,g,l,u)},p)})},toBufferPromise:function(){return new Promise((a,f)=>{n.toAsyncBuffer(a,f)})},toBuffer:function(a,f,g,l){return typeof a=="function"?(n.toAsyncBuffer(a,f,g,l),null):n.compressToBuffer()}}}});var Fr={};tr(Fr,{getOverlayHandler:()=>Ue});module.exports=rr(Fr);var X=require("electron"),We=G(require("node:path"),1);var qe=require("electron"),ye=G(require("path"),1),ce=G(require("fs"),1),He=class{logsDir;launcherLogPath;gameLogPath;initialized=!1;MAX_LOG_DAYS=7;constructor(){this.logsDir="",this.launcherLogPath="",this.gameLogPath=""}init(){if(this.initialized)return;this.logsDir=ye.default.join(qe.app.getPath("userData"),"logs"),ce.default.mkdirSync(this.logsDir,{recursive:!0});let e=this.getDateString();this.launcherLogPath=ye.default.join(this.logsDir,`launcher-${e}.log`),this.gameLogPath=ye.default.join(this.logsDir,`game-${e}.log`),this.rotateOldLogs(),this.interceptConsole(),this.initialized=!0,this.info("Logger","=== BlockyCRAFT Launcher Log Started ==="),this.info("Logger",`Log file: ${this.launcherLogPath}`)}getDateString(){return new Date().toISOString().split("T")[0]}getTimestamp(){return new Date().toISOString()}formatMessage(e,t,r){return`[${this.getTimestamp()}] [${e}] [${t}] ${r}`}writeToLauncherLog(e){if(this.initialized)try{ce.default.appendFileSync(this.launcherLogPath,e+`
`)}catch(t){process.stdout.write(`[LOG WRITE ERROR] ${t}
`)}}writeToGameLog(e){if(this.initialized)try{ce.default.appendFileSync(this.gameLogPath,`[${this.getTimestamp()}] ${e}
`)}catch(t){process.stdout.write(`[GAME LOG WRITE ERROR] ${t}
`)}}rotateOldLogs(){try{let e=ce.default.readdirSync(this.logsDir),t=Date.now(),r=this.MAX_LOG_DAYS*24*60*60*1e3;for(let s of e){if(!s.endsWith(".log"))continue;let n=ye.default.join(this.logsDir,s),c=ce.default.statSync(n);t-c.mtimeMs>r&&(ce.default.unlinkSync(n),process.stdout.write(`[Logger] Deleted old log: ${s}
`))}}catch(e){process.stdout.write(`[Logger] Error rotating logs: ${e}
`)}}interceptConsole(){let e=console.log,t=console.error,r=console.warn,s=this;console.log=function(...n){let c=n.map(d=>typeof d=="object"?JSON.stringify(d):String(d)).join(" ");s.writeToLauncherLog(s.formatMessage("INFO","Console",c)),e.apply(console,n)},console.error=function(...n){let c=n.map(d=>typeof d=="object"?JSON.stringify(d):String(d)).join(" ");s.writeToLauncherLog(s.formatMessage("ERROR","Console",c)),t.apply(console,n)},console.warn=function(...n){let c=n.map(d=>typeof d=="object"?JSON.stringify(d):String(d)).join(" ");s.writeToLauncherLog(s.formatMessage("WARN","Console",c)),r.apply(console,n)}}info(e,t){let r=this.formatMessage("INFO",e,t);this.writeToLauncherLog(r),process.stdout.write(r+`
`)}error(e,t){let r=this.formatMessage("ERROR",e,t);this.writeToLauncherLog(r),process.stderr.write(r+`
`)}warn(e,t){let r=this.formatMessage("WARN",e,t);this.writeToLauncherLog(r),process.stdout.write(r+`
`)}debug(e,t){let r=this.formatMessage("DEBUG",e,t);this.writeToLauncherLog(r)}game(e,t){let r=e==="stderr"?"[ERR]":"[OUT]";this.writeToGameLog(`${r} ${t}`)}getLogsDir(){return this.logsDir}},L=new He;var Q=require("electron"),F=G(require("path"),1),I=G(require("fs"),1),Re=require("child_process"),Ht=require("util"),je=G(Ee(),1),kt=require("fs");var Ot=require("electron"),oe=G(require("path"),1),ne=G(require("fs"),1),_t=require("fs"),jt=require("child_process"),Ft=require("util"),Ut=G(Ee(),1),Ge=(0,Ft.promisify)(jt.exec),Dr="https://api.adoptium.net/v3/binary/latest",Sr="17",Lr="hotspot",Ir="eclipse",Oe=class{javaDir;markerFile;constructor(){this.javaDir=oe.default.join(Ot.app.getPath("userData"),"java"),this.markerFile=oe.default.join(this.javaDir,".java17_installed")}async ensureJava(e){let t=this.getLocalJavaPath();if(t&&ne.default.existsSync(t))return console.log("[JavaManager] Using locally installed Java:",t),t;let r=await this.detectSystemJava();return r?(console.log("[JavaManager] Using system Java:",r),r):(console.log("[JavaManager] No Java found, downloading..."),this.downloadAndInstallJava(e))}async detectSystemJava(){let e=this.getCommonJavaPaths();for(let t of e)if(await this.isValidJava17(t))return t;return null}getCommonJavaPaths(){let e=["java"],t=process.platform;if(t==="win32"){let r=process.env.ProgramFiles||"C:\\Program Files",s=process.env["ProgramFiles(x86)"]||"C:\\Program Files (x86)";e.push(oe.default.join(r,"Eclipse Adoptium","jdk-17*","bin","java.exe"),oe.default.join(r,"Java","jdk-17*","bin","java.exe"),oe.default.join(r,"Java","jre-17*","bin","java.exe"),oe.default.join(r,"Temurin","jdk-17*","bin","java.exe"),oe.default.join(s,"Java","jdk-17*","bin","java.exe"))}else t==="darwin"?e.push("/Library/Java/JavaVirtualMachines/temurin-17.jdk/Contents/Home/bin/java","/Library/Java/JavaVirtualMachines/adoptopenjdk-17.jdk/Contents/Home/bin/java","/usr/local/opt/openjdk@17/bin/java","/opt/homebrew/opt/openjdk@17/bin/java"):e.push("/usr/lib/jvm/temurin-17-jdk/bin/java","/usr/lib/jvm/java-17-openjdk/bin/java","/usr/lib/jvm/java-17-openjdk-amd64/bin/java","/usr/lib/jvm/java-17-temurin/bin/java","/opt/java/openjdk/bin/java");return e}async isValidJava17(e){try{let{stdout:t,stderr:r}=await Ge(`"${e}" -version`),n=(t+r).match(/version "(\d+)/);return n?parseInt(n[1],10)>=17:!1}catch{return!1}}getPlatformInfo(){let e=process.platform,t=process.arch,r,s,n;switch(e){case"win32":r="windows",s="zip",n="bin/java.exe";break;case"darwin":r="mac",s="tar.gz",n="Contents/Home/bin/java";break;default:r="linux",s="tar.gz",n="bin/java"}let c;switch(t){case"arm64":c="aarch64";break;case"x64":default:c="x64"}return{os:r,arch:c,extension:s,executablePath:n}}getDownloadUrl(){let e=this.getPlatformInfo(),t=`${Dr}/${Sr}/ga/${e.os}/${e.arch}/jre/${Lr}/normal/${Ir}`,r=`temurin-17-jre.${e.extension}`;return{url:t,filename:r}}getLocalJavaPath(){if(!ne.default.existsSync(this.markerFile))return null;let e=this.getPlatformInfo();if(!ne.default.existsSync(this.javaDir))return null;let r=ne.default.readdirSync(this.javaDir).find(n=>n.startsWith("jdk-17")&&ne.default.statSync(oe.default.join(this.javaDir,n)).isDirectory());if(!r)return null;let s=oe.default.join(this.javaDir,r,e.executablePath);return ne.default.existsSync(s)?s:null}async downloadAndInstallJava(e){let{url:t,filename:r}=this.getDownloadUrl(),s=this.getPlatformInfo();ne.default.mkdirSync(this.javaDir,{recursive:!0});let n=oe.default.join(this.javaDir,r);this.sendProgress(e,"Baixando Java 17...",0),console.log("[JavaManager] Downloading from:",t);try{let d=await fetch(t,{redirect:"follow"});if(!d.ok)throw new Error(`Failed to download Java: ${d.status} ${d.statusText}`);let v=Number(d.headers.get("content-length"))||0,y=(0,_t.createWriteStream)(n);if(!d.body)throw new Error("No response body");let S=d.body.getReader(),b=0;for(;;){let{done:N,value:a}=await S.read();if(N)break;if(y.write(Buffer.from(a)),b+=a.length,v>0){let f=Math.round(b/v*50);this.sendProgress(e,`Baixando Java 17... (${this.formatSize(b)}/${this.formatSize(v)})`,f)}}y.end(),await new Promise((N,a)=>{y.on("finish",N),y.on("error",a)}),console.log("[JavaManager] Download complete:",n)}catch(d){throw ne.default.existsSync(n)&&ne.default.unlinkSync(n),new Error(`Failed to download Java: ${d.message}`)}this.sendProgress(e,"Extraindo Java 17...",55),console.log("[JavaManager] Extracting...");try{s.extension==="zip"?new Ut.default(n).extractAllTo(this.javaDir,!0):await Ge(`tar -xzf "${n}" -C "${this.javaDir}"`),ne.default.writeFileSync(this.markerFile,new Date().toISOString()),ne.default.unlinkSync(n)}catch(d){throw new Error(`Failed to extract Java: ${d.message}`)}let c=this.getLocalJavaPath();if(!c)throw new Error("Java extraction failed: executable not found");return process.platform!=="win32"&&await Ge(`chmod +x "${c}"`),this.sendProgress(e,"Java 17 instalado!",60),console.log("[JavaManager] Java installed at:",c),c}sendProgress(e,t,r){e&&e.send("launch-progress",{status:t,progress:r})}formatSize(e){return e<1024?e+" B":e<1024*1024?(e/1024).toFixed(1)+" KB":(e/(1024*1024)).toFixed(1)+" MB"}};var Rt=require("electron"),V=G(require("path"),1),j=G(require("fs"),1),At=require("fs"),Tt=G(Ee(),1),xr=["https://craft.blocky.com.br/launcher-assets/version.json"],_e=class{dataPath;localVersionsPath;instanceDir;librariesDir;constructor(){this.dataPath=Rt.app.getPath("userData"),this.localVersionsPath=V.default.join(this.dataPath,"versions.json"),this.instanceDir=V.default.join(this.dataPath,"instances","default"),this.librariesDir=V.default.join(this.instanceDir,"libraries")}normalizeUrls(e){return Array.isArray(e)?e:[e]}getLocalVersions(){try{if(j.default.existsSync(this.localVersionsPath)){let e=j.default.readFileSync(this.localVersionsPath,"utf-8");return JSON.parse(e)}}catch(e){console.error("[UpdateManager] Failed to read local versions:",e)}return{instance:"0.0.0",libraries:"0.0.0",mods:"0.0.0"}}saveLocalVersions(e){try{j.default.writeFileSync(this.localVersionsPath,JSON.stringify(e,null,2)),console.log("[UpdateManager] Saved local versions:",e)}catch(t){console.error("[UpdateManager] Failed to save local versions:",t)}}async fetchRemoteVersions(){for(let e of xr)try{console.log("[UpdateManager] Trying to fetch versions from:",e);let t=await fetch(e,{signal:AbortSignal.timeout(1e4)});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);let r=await t.json();return console.log("[UpdateManager] Successfully fetched from:",e),console.log("[UpdateManager] Remote versions:",r),r}catch(t){console.warn(`[UpdateManager] Failed to fetch from ${e}:`,t)}return console.error("[UpdateManager] All version URLs failed"),null}async checkForUpdates(){let e=this.getLocalVersions(),t=await this.fetchRemoteVersions();if(!t)return{instanceUpdate:!1,librariesUpdate:!1,modsUpdate:!1,remoteVersions:null,error:"Failed to fetch remote version info"};let r=t.instance.version!==e.instance,s=!1,n=t.mods?t.mods.version!==e.mods:!1;return console.log("[UpdateManager] Update check result:",{instanceUpdate:r,librariesUpdate:"DISABLED (Maven-based)",modsUpdate:n,local:e,remote:{instance:t.instance.version,libraries:t.libraries?.version??"N/A (Maven-based)",mods:t.mods?.version}}),{instanceUpdate:r,librariesUpdate:s,modsUpdate:n,remoteVersions:t}}async downloadFile(e,t,r){let s=V.default.basename(t);r?.(`Baixando ${s}...`,0);let n=this.normalizeUrls(e),c=null;for(let d=0;d<n.length;d++){let v=n[d];try{console.log(`[UpdateManager] Downloading from URL ${d+1}/${n.length}: ${v}`);let y=await fetch(v,{signal:AbortSignal.timeout(6e4)});if(!y.ok)throw new Error(`HTTP ${y.status}: ${y.statusText}`);let S=Number(y.headers.get("content-length"))||0;j.default.mkdirSync(V.default.dirname(t),{recursive:!0});let b=(0,At.createWriteStream)(t);if(!y.body)throw new Error("No response body");let N=y.body.getReader(),a=0;for(;;){let{done:f,value:g}=await N.read();if(f)break;if(b.write(Buffer.from(g)),a+=g.length,S>0){let l=Math.round(a/S*100);r?.(`Baixando ${s}...`,l)}}b.end(),await new Promise((f,g)=>{b.on("finish",f),b.on("error",g)}),console.log(`[UpdateManager] Downloaded ${s} (${this.formatSize(a)}) from ${v}`);return}catch(y){console.warn(`[UpdateManager] Failed to download from ${v}:`,y.message),c=y}}throw c||new Error(`Failed to download ${s} from all ${n.length} sources`)}extractZip(e,t){if(console.log(`[UpdateManager] Extracting ${e} to ${t}`),!j.default.existsSync(e))throw new Error(`ZIP file not found: ${e}`);let r=j.default.readFileSync(e);if(r.length<4||r[0]!==80||r[1]!==75)throw console.error(`[UpdateManager] Invalid ZIP file. First bytes: ${r.slice(0,20).toString("hex")}`),new Error(`Invalid ZIP file: ${e}. The download may have failed or returned an error page.`);j.default.mkdirSync(t,{recursive:!0}),new Tt.default(e).extractAllTo(t,!0),console.log("[UpdateManager] Extraction complete")}backupUserData(){let e=V.default.join(this.dataPath,"update_backup"),t=V.default.join(this.instanceDir,".minecraft");j.default.existsSync(e)&&j.default.rmSync(e,{recursive:!0,force:!0}),j.default.mkdirSync(e,{recursive:!0});let r=["options.txt","servers.dat","screenshots","stats","lastlogin","config"];console.log("[UpdateManager] Backing up user data...");for(let s of r){let n=V.default.join(t,s),c=V.default.join(e,s);if(j.default.existsSync(n))try{console.log(`[UpdateManager] Backing up: ${s}`),j.default.cpSync(n,c,{recursive:!0})}catch(d){console.warn(`[UpdateManager] Failed to backup ${s}:`,d)}}}restoreUserData(){let e=V.default.join(this.dataPath,"update_backup"),t=V.default.join(this.instanceDir,".minecraft");if(!j.default.existsSync(e))return;console.log("[UpdateManager] Restoring user data...");let r=j.default.readdirSync(e);for(let s of r){let n=V.default.join(e,s),c=V.default.join(t,s);try{console.log(`[UpdateManager] Restoring: ${s}`),j.default.existsSync(c)&&j.default.rmSync(c,{recursive:!0,force:!0}),j.default.cpSync(n,c,{recursive:!0})}catch(d){console.warn(`[UpdateManager] Failed to restore ${s}:`,d)}}try{j.default.rmSync(e,{recursive:!0,force:!0})}catch(s){console.warn("[UpdateManager] Failed to cleanup backup:",s)}}async updateInstance(e,t){let r=V.default.join(this.dataPath,"temp_instance.zip");try{await this.downloadFile(e.instance.url,r,t),t?.("Preparando atualiza\xE7\xE3o da inst\xE2ncia...",0),this.backupUserData(),j.default.existsSync(this.instanceDir),t?.("Extraindo inst\xE2ncia...",50),this.extractZip(r,this.instanceDir),this.restoreUserData();let s=this.getLocalVersions();s.instance=e.instance.version,this.saveLocalVersions(s),t?.("Inst\xE2ncia atualizada!",100)}finally{j.default.existsSync(r)&&j.default.unlinkSync(r)}}async updateLibraries(e,t){if(!e.libraries){console.log("[UpdateManager] Libraries update skipped - using Maven repos");return}let r=V.default.join(this.dataPath,"temp_libraries.zip");try{await this.downloadFile(e.libraries.url,r,t),t?.("Preparando atualiza\xE7\xE3o das bibliotecas...",0);let s=V.default.join(this.librariesDir,".bundled_extracted_v1");j.default.existsSync(s)&&j.default.unlinkSync(s),j.default.existsSync(this.librariesDir)&&j.default.rmSync(this.librariesDir,{recursive:!0,force:!0}),t?.("Extraindo bibliotecas...",50),this.extractZip(r,this.librariesDir),j.default.writeFileSync(V.default.join(this.librariesDir,".bundled_extracted_v2"),"extracted");let n=this.getLocalVersions();n.libraries=e.libraries.version,this.saveLocalVersions(n),t?.("Bibliotecas atualizadas!",100)}finally{j.default.existsSync(r)&&j.default.unlinkSync(r)}}async updateMods(e,t){if(!e.mods){console.log("[UpdateManager] No mods update available");return}let r=V.default.join(this.dataPath,"temp_mods.zip"),s=V.default.join(this.instanceDir,".minecraft","mods");try{await this.downloadFile(e.mods.url,r,t),t?.("Removendo mods antigos...",0),j.default.existsSync(s)&&j.default.rmSync(s,{recursive:!0,force:!0}),t?.("Instalando novos mods...",50),this.extractZip(r,V.default.join(this.instanceDir,".minecraft"));let n=this.getLocalVersions();n.mods=e.mods.version,this.saveLocalVersions(n),t?.("Mods atualizados!",100)}finally{j.default.existsSync(r)&&j.default.unlinkSync(r)}}async performAllUpdates(e){try{e?.("Verificando atualiza\xE7\xF5es...",0);let t=await this.checkForUpdates();if(!t.remoteVersions)return console.log("[UpdateManager] Could not fetch remote versions, skipping updates"),{success:!0};let r=[t.instanceUpdate,t.librariesUpdate,t.modsUpdate].filter(Boolean).length;if(r===0)return console.log("[UpdateManager] All components are up to date"),e?.("Tudo atualizado!",100),{success:!0};let s=0;if(t.instanceUpdate){s++;let n=(s-1)/r*100,c=100/r;await this.updateInstance(t.remoteVersions,(d,v)=>{let y=n+v/100*c;e?.(d,Math.round(y))})}if(t.librariesUpdate){s++;let n=(s-1)/r*100,c=100/r;await this.updateLibraries(t.remoteVersions,(d,v)=>{let y=n+v/100*c;e?.(d,Math.round(y))})}if(t.modsUpdate){s++;let n=(s-1)/r*100,c=100/r;await this.updateMods(t.remoteVersions,(d,v)=>{let y=n+v/100*c;e?.(d,Math.round(y))})}return e?.("Todas as atualiza\xE7\xF5es conclu\xEDdas!",100),{success:!0}}catch(t){return console.error("[UpdateManager] Update failed:",t),{success:!1,error:t.message}}}formatSize(e){return e<1024?e+" B":e<1024*1024?(e/1024).toFixed(1)+" KB":(e/(1024*1024)).toFixed(1)+" MB"}};var Cr=(0,Ht.promisify)(Re.exec);function we(i){if(!I.default.existsSync(i))return!1;let e=I.default.readFileSync(i);return e.length>=4&&e[0]===80&&e[1]===75}function Bt(i,e){if(!we(i)){let r=I.default.existsSync(i)?I.default.readFileSync(i):Buffer.alloc(0);throw console.error(`[GameHandler] Invalid ZIP file: ${i}. First bytes: ${r.slice(0,20).toString("hex")}`),new Error("Invalid ZIP file. The download may have failed.")}I.default.mkdirSync(e,{recursive:!0}),new je.default(i).extractAllTo(e,!0)}function Nr(i){return new Promise(e=>setTimeout(e,i))}async function Pt(i,e,t=3){let r=[500,1e3,2e3],s=null;for(let n=0;n<=t;n++)try{Bt(i,e);return}catch(c){if(s=c,n<t){let d=r[n]||2e3;console.warn(`[GameHandler] Extraction failed (attempt ${n+1}/${t+1}), retrying in ${d}ms...`),await Nr(d)}}throw s||new Error(`Failed to extract ${i} after ${t+1} attempts`)}var Or="https://piston-meta.mojang.com/mc/game/version_manifest_v2.json",Mt="b1.7.3",Fe=class{gamePath;javaPath;javaManager;updateManager;gameProcess=null;lastUpdateCheck=null;UPDATE_CACHE_TTL=6e4;MANIFEST_CACHE_TTL=1440*60*1e3;lastInstanceVersion=null;constructor(){this.gamePath=F.default.join(Q.app.getPath("userData"),"gamedata"),this.javaPath="java",this.javaManager=new Oe,this.updateManager=new _e,this.loadLastInstanceVersion()}loadLastInstanceVersion(){try{let e=F.default.join(Q.app.getPath("userData"),"versions.json");if(I.default.existsSync(e)){let t=JSON.parse(I.default.readFileSync(e,"utf-8"));this.lastInstanceVersion=t.instance||null}}catch{}}init(){Q.ipcMain.handle("launch-game",async(e,t)=>this.handleLaunch(e,t)),Q.ipcMain.handle("kill-game",async()=>this.gameProcess?(console.log("Killing game process..."),this.gameProcess.kill(),this.gameProcess=null,{success:!0}):{success:!1,error:"No game running"}),Q.ipcMain.handle("check-custom-instance",async()=>{let e=F.default.resolve("instance.zip"),t=F.default.join(Q.app.getPath("userData"),"instances","default","instance.cfg");return I.default.existsSync(e)||I.default.existsSync(t)}),Q.ipcMain.handle("check-update-status",async()=>this.handleUpdateCheck()),Q.ipcMain.handle("perform-update",async e=>this.handlePerformUpdate(e))}sendProgress(e,t,r){e.send("launch-progress",{status:t,progress:r})}async getCachedVersionDetails(){let e=F.default.join(Q.app.getPath("userData"),"mojang_version_cache.json");if(I.default.existsSync(e))try{let d=JSON.parse(I.default.readFileSync(e,"utf-8"));if(Date.now()-d.timestamp<this.MANIFEST_CACHE_TTL)return console.log("[GameHandler] Using cached Mojang version details (TTL: 24h)"),d.data}catch(d){console.warn("[GameHandler] Failed to read version cache:",d)}console.log("[GameHandler] Fetching fresh Mojang version manifest...");let s=(await(await fetch(Or)).json()).versions.find(d=>d.id===Mt);if(!s)throw new Error(`Version ${Mt} not found`);let c=await(await fetch(s.url)).json();try{I.default.writeFileSync(e,JSON.stringify({timestamp:Date.now(),data:c})),console.log("[GameHandler] Saved version details to cache")}catch(d){console.warn("[GameHandler] Failed to save version cache:",d)}return c}async checkJava(e){try{return await Cr(`"${e}" -version`),!0}catch{return!1}}async checkAndExtractInstance(){let e=F.default.join(Q.app.getPath("userData"),"instances","default"),t=Q.app.getPath("userData");if(I.default.existsSync(F.default.join(e,"instance.cfg")))return console.log("Instance already exists, skipping extraction."),e;let r=F.default.join(t,"instance.zip");if(!I.default.existsSync(r)){console.log("instance.zip not found. Attempting to download from VPS...");let s=["https://craft.blocky.com.br/launcher-assets/instance.zip"];for(let n of s)try{console.log(`Trying to download instance.zip from ${n}...`);let c=await fetch(n,{signal:AbortSignal.timeout(6e4)});if(c.ok){let d=await c.arrayBuffer(),v=Buffer.from(d);if(v.length>=4&&v[0]===80&&v[1]===75){I.default.writeFileSync(r,v),console.log("instance.zip downloaded successfully from",n);break}else console.warn(`Downloaded content from ${n} is not a valid ZIP (got ${v.length} bytes, first bytes: ${v.slice(0,20).toString("hex")})`)}}catch(c){console.warn(`Failed to download instance.zip from ${n}:`,c)}}return I.default.existsSync(r)&&we(r)?(console.log("Extracting instance.zip..."),Bt(r,e),e):null}async downloadFile(e,t,r,s){this.sendProgress(s,`Baixando ${r}...`,0),I.default.mkdirSync(t,{recursive:!0});let n=F.default.join(t,r);try{if(I.default.existsSync(n))return n;let c=await fetch(e);if(!c.ok)throw new Error(`Failed to download ${e}: ${c.statusText}`);let d=Number(c.headers.get("content-length"))||0,v=(0,kt.createWriteStream)(n);if(!c.body)throw new Error("No body");let y=c.body.getReader(),S=0;for(;;){let{done:N,value:a}=await y.read();if(N)break;v.write(Buffer.from(a)),S+=a.length,d>0&&this.sendProgress(s,`Baixando ${r}`,Math.round(S/d*100))}await new Promise((N,a)=>{v.on("finish",N),v.on("error",a),v.end()});let b=I.default.statSync(n);if(r.endsWith(".jar")&&b.size<100)throw I.default.unlinkSync(n),new Error(`Downloaded file ${r} is too small (${b.size} bytes). Likely invalid.`);if(r.endsWith(".zip")&&!we(n)){let a=I.default.readFileSync(n).slice(0,20).toString("hex");throw I.default.unlinkSync(n),new Error(`Downloaded file ${r} is not a valid ZIP (first bytes: ${a}). Server may have returned an error page.`)}return n}catch(c){if(I.default.existsSync(n))try{I.default.unlinkSync(n)}catch{}throw new Error(`Download failed: ${c}`)}}async handleLaunch(e,t){console.log("Requesting game launch...",t),this.sendProgress(e.sender,"Verificando atualiza\xE7\xF5es...",2);let r=Date.now();if(this.lastUpdateCheck&&r-this.lastUpdateCheck.timestamp<this.UPDATE_CACHE_TTL)console.log("[GameHandler] Using cached update check result (TTL: 60s)");else try{let a=await this.updateManager.performAllUpdates((f,g)=>{let l=2+g/100*13;this.sendProgress(e.sender,f,Math.round(l))});this.lastUpdateCheck={result:a,timestamp:r},a.success||console.warn("Update check failed, continuing anyway:",a.error)}catch(a){console.warn("Update check failed, continuing anyway:",a)}let s=await this.checkAndExtractInstance(),n=!!s,c=s||this.gamePath,d=n?F.default.join(c,".minecraft"):c;I.default.existsSync(d)||I.default.mkdirSync(d,{recursive:!0});let v=this.lastUpdateCheck?.result?.remoteVersions?.instance?.version,y=F.default.join(d,".fabric","remappedJars");v&&v!==this.lastInstanceVersion?(I.default.existsSync(y)&&(console.log("[GameHandler] Instance version changed, clearing remappedJars cache..."),I.default.rmSync(y,{recursive:!0,force:!0})),this.lastInstanceVersion=v):console.log("[GameHandler] Preserving remappedJars cache (same instance version)");let S=F.default.join(d,"bin"),b=F.default.join(c,"natives"),N=F.default.join(c,"libraries");try{if(!t.username)throw new Error("Username required");this.sendProgress(e.sender,"Verificando Java...",5);try{this.javaPath=t.javaPath||await this.javaManager.ensureJava(e.sender)}catch(C){throw new Error("Falha ao configurar Java: "+C.message)}this.sendProgress(e.sender,"Verificando vers\xE3o...",65);let a=await this.getCachedVersionDetails(),f=a.downloads.client.url,g=await this.downloadFile(f,S,"minecraft.jar",e.sender);if(!n){this.sendProgress(e.sender,"Baixando bibliotecas...",70);let C="natives-linux";process.platform==="win32"?C="natives-windows":process.platform==="darwin"&&(C="natives-osx");for(let U of a.libraries)if(U.downloads&&U.downloads.classifiers&&U.downloads.classifiers[C]){let q=U.downloads.classifiers[C],ee=await this.downloadFile(q.url,F.default.join(c,"temp_natives"),F.default.basename(q.path),e.sender);we(ee)?new je.default(ee).extractAllTo(b,!0):console.warn(`[GameHandler] Skipping invalid native file: ${ee}`)}let O=F.default.join(b,process.platform==="win32"?"OpenAL-amd64.dll":"libopenal.so");if(!I.default.existsSync(O)){console.log("[GameHandler] OpenAL not found, downloading from Legacy Fabric..."),this.sendProgress(e.sender,"Baixando OpenAL...",72);let U="natives-linux";process.platform==="win32"?U="natives-windows":process.platform==="darwin"&&(U="natives-osx");let q=`https://repo.legacyfabric.net/repository/legacyfabric/org/lwjgl/lwjgl/lwjgl-platform/2.9.4+legacyfabric.9/lwjgl-platform-2.9.4+legacyfabric.9-${U}.jar`;try{let ee=await this.downloadFile(q,F.default.join(c,"temp_natives"),`lwjgl-platform-${U}.jar`,e.sender);we(ee)&&(new je.default(ee).extractAllTo(b,!0),console.log("[GameHandler] OpenAL natives extracted successfully"))}catch(ee){console.warn("[GameHandler] Failed to download OpenAL natives:",ee)}}}let l=[g],m="net.minecraft.client.Minecraft",p="";if(n){let C=F.default.join(s,"mmc-pack.json");if(I.default.existsSync(C)&&JSON.parse(I.default.readFileSync(C,"utf-8")).components.find(q=>q.uid==="net.fabricmc.fabric-loader")){this.sendProgress(e.sender,"Configurando Fabric/StationAPI...",75);let q=[{name:"asm:9.7.1",group:"org.ow2.asm",artifact:"asm",version:"9.7.1"},{name:"asm-analysis:9.7.1",group:"org.ow2.asm",artifact:"asm-analysis",version:"9.7.1"},{name:"asm-commons:9.7.1",group:"org.ow2.asm",artifact:"asm-commons",version:"9.7.1"},{name:"asm-tree:9.7.1",group:"org.ow2.asm",artifact:"asm-tree",version:"9.7.1"},{name:"asm-util:9.7.1",group:"org.ow2.asm",artifact:"asm-util",version:"9.7.1"},{name:"sponge-mixin:0.15.3+mixin.0.8.7",group:"net.fabricmc",artifact:"sponge-mixin",version:"0.15.3+mixin.0.8.7"},{name:"mixinextras-fabric:0.4.1",group:"io.github.llamalad7",artifact:"mixinextras-fabric",version:"0.4.1"},{name:"commons-lang3:3.12.0",group:"org.apache.commons",artifact:"commons-lang3",version:"3.12.0"},{name:"commons-io:2.11.0",group:"commons-io",artifact:"commons-io",version:"2.11.0"},{name:"commons-codec:1.15",group:"commons-codec",artifact:"commons-codec",version:"1.15"},{name:"jutils:1.0.0",group:"net.java.jutils",artifact:"jutils",version:"1.0.0"},{name:"jinput:2.0.5",group:"net.java.jinput",artifact:"jinput",version:"2.0.5"},{name:"lwjgl:2.9.4+legacyfabric.9",group:"org.lwjgl.lwjgl",artifact:"lwjgl",version:"2.9.4+legacyfabric.9"},{name:"lwjgl_util:2.9.4+legacyfabric.9",group:"org.lwjgl.lwjgl",artifact:"lwjgl_util",version:"2.9.4+legacyfabric.9"},{name:"log4j-api:2.16.0",group:"org.apache.logging.log4j",artifact:"log4j-api",version:"2.16.0"},{name:"log4j-core:2.16.0",group:"org.apache.logging.log4j",artifact:"log4j-core",version:"2.16.0"},{name:"log4j-slf4j18-impl:2.16.0",group:"org.apache.logging.log4j",artifact:"log4j-slf4j18-impl",version:"2.16.0"},{name:"terminalconsoleappender:1.2.0",group:"net.minecrell",artifact:"terminalconsoleappender",version:"1.2.0"},{name:"slf4j-api:1.8.0-beta4",group:"org.slf4j",artifact:"slf4j-api",version:"1.8.0-beta4"},{name:"guava:31.0.1-jre",group:"com.google.guava",artifact:"guava",version:"31.0.1-jre"},{name:"failureaccess:1.0.1",group:"com.google.guava",artifact:"failureaccess",version:"1.0.1"},{name:"gson:2.8.9",group:"com.google.code.gson",artifact:"gson",version:"2.8.9"},{name:"log4j-config:1.0.0",group:"babric",artifact:"log4j-config",version:"1.0.0"}],ee="https://maven.fabricmc.net/",De="https://repo1.maven.org/maven2/",Je="https://repo.legacyfabric.net/repository/legacyfabric/",Zt="https://maven.glass-launcher.net/babric/";console.log("[GameHandler] Using Maven-based library downloads"),I.default.existsSync(N)||I.default.mkdirSync(N,{recursive:!0});for(let T of q){let de=`${T.group.replace(/\./g,"/")}/${T.artifact}/${T.version}/${T.artifact}-${T.version}.jar`,W=F.default.join(N,`${T.artifact}-${T.version}.jar`);if(I.default.existsSync(W)){l.push(W);continue}let Y=ee+de;["org.apache","commons-io","commons-codec","net.java.jutils","net.java.jinput","org.ow2.asm","com.google.guava","com.google.code.gson","org.slf4j","io.github.llamalad7","net.minecrell"].some(Se=>T.group.startsWith(Se)||T.group===Se)?Y=De+de:T.group.startsWith("org.lwjgl")?Y=Je+de:T.group==="babric"&&(Y=Zt+de);let ge=await this.downloadFile(Y,N,`${T.artifact}-${T.version}.jar`,e.sender);l.push(ge)}this.sendProgress(e.sender,"Baixando nativos...",78);let Wt=process.platform==="linux"?["liblwjgl-linux-amd64.so","libopenal-amd64.so","libjinput-linux64.so"]:process.platform==="win32"?["lwjgl64.dll","OpenAL64.dll"]:["liblwjgl.dylib","libopenal.dylib"];if(I.default.existsSync(b)&&Wt.every(T=>I.default.existsSync(F.default.join(b,T))))console.log("[GameHandler] Natives already present, skipping extraction");else{I.default.existsSync(b)&&(console.log("[GameHandler] Natives incomplete, clearing for fresh extraction..."),I.default.rmSync(b,{recursive:!0,force:!0})),I.default.mkdirSync(b,{recursive:!0});let T="natives-linux";process.platform==="win32"?T="natives-windows":process.platform==="darwin"&&(T="natives-osx");let de=[{group:"org.lwjgl.lwjgl",artifact:"lwjgl-platform",version:"2.9.4+legacyfabric.9",classifier:T},{group:"net.java.jinput",artifact:"jinput-platform",version:"2.0.5",classifier:T}];for(let W of de){let Y=`${W.artifact}-${W.version}-${W.classifier}.jar`,ue=`${W.group.replace(/\./g,"/")}/${W.artifact}/${W.version}/${Y}`,ae=F.default.join(N,Y);if(I.default.existsSync(ae)){console.log(`[Cache] Found native library locally: ${Y}`),await Pt(ae,b);continue}let ge=Je+ue;W.group==="net.java.jinput"&&(ge=De+ue);let Se=await this.downloadFile(ge,F.default.join(c,"temp_natives"),Y,e.sender);await Pt(Se,b)}if(process.platform==="darwin")try{let W=I.default.readdirSync(b);for(let Y of W)if(Y.endsWith(".jnilib")){let ue=F.default.join(b,Y),ae=F.default.join(b,Y.replace(".jnilib",".dylib"));if(I.default.existsSync(ue)){console.log(`[GameHandler] Renaming ${Y} to .dylib`);try{I.default.existsSync(ae)&&I.default.unlinkSync(ae),I.default.renameSync(ue,ae)}catch(ge){console.warn(`[GameHandler] Failed to rename ${Y}:`,ge)}}}}catch(W){console.warn("[GameHandler] Failed to process macOS natives:",W)}try{let W=I.default.readdirSync(b);console.log(`[GameHandler] Natives folder contents (${b}):`,W)}catch(W){console.error("[GameHandler] Failed to read natives folder:",W)}}let Jt=await this.downloadFile("https://maven.fabricmc.net/net/fabricmc/fabric-loader/0.16.7/fabric-loader-0.16.7.jar",N,"fabric-loader-0.16.7.jar",e.sender),Xt=await this.downloadFile("https://maven.glass-launcher.net/babric/babric/intermediary-upstream/b1.7.3/intermediary-upstream-b1.7.3.jar",N,"intermediary-upstream-b1.7.3.jar",e.sender);l.push(Jt),l.push(Xt),m="net.fabricmc.loader.impl.launch.knot.KnotClient";let Me=[];for(let T of l)T!==g&&Me.push(T);Me.push(g),l=Me}}if(!n){for(let C of a.libraries)if(C.downloads&&C.downloads.artifact){let O=C.downloads.artifact;if(O.path.includes("lwjgl")||O.path.includes("jinput")){let U=await this.downloadFile(O.url,S,F.default.basename(O.path),e.sender);l.push(U)}}}this.sendProgress(e.sender,"Iniciando Jogo...",95);let o=t.settings?.minMemory||"512",u=t.settings?.maxMemory||"2048",h=t.settings?.javaArgs||"",D="";try{if(I.default.existsSync(b)){let C=I.default.readdirSync(b),O=process.platform==="win32"?["OpenAL64.dll","OpenAL32.dll","OpenAL-amd64.dll","OpenAL-i386.dll","OpenAL.dll"]:process.platform==="darwin"?["libopenal.dylib","openal.dylib"]:["libopenal.so","libopenal-amd64.so","libopenal-i386.so"];for(let U of O)if(C.includes(U)){D=F.default.join(b,U),console.log(`[GameHandler] Found OpenAL library: ${D}`);break}if(!D){let U=C.find(q=>q.toLowerCase().includes("openal")&&(q.endsWith(".dll")||q.endsWith(".so")||q.endsWith(".dylib")));U&&(D=F.default.join(b,U),console.log(`[GameHandler] Found OpenAL library (fallback): ${D}`))}}}catch(C){console.warn("[GameHandler] Failed to scan for OpenAL lib:",C)}let w=F.default.join(d,"resources"),x=[`-Xms${o}M`,`-Xmx${u}M`,"-Djava.library.path="+b,"-Dfabric.gameJarPath="+g,"-Dfabric.gameVersion=b1.7.3","-Dfabric.envType=client","-Dslf4j.internal.verbosity=ERROR","-Dminecraft.resources.index="+w,"-Dminecraft.applet.TargetDirectory="+d,"-Dminecraft.applet.BaseURL=file:///"];if(h.trim()){let C=h.trim().split(/\s+/).filter(O=>O.length>0);x.push(...C)}if(t.settings?.borderlessMode&&(console.log("[GameHandler] Borderless mode enabled - adding LWJGL undecorated flag"),x.push("-Dorg.lwjgl.opengl.Window.undecorated=true")),x.push("-cp",l.join(F.default.delimiter)),x.push(m),x.push("--username",t.username),x.push("--gameDir",d),x.push("--assetsDir",F.default.join(d,"resources")),n&&m.includes("KnotClient")&&x.push("--assetIndex","truly_legacy"),t.settings?.borderlessMode)try{let C=Q.screen.getPrimaryDisplay(),{width:O,height:U}=C.size;console.log(`[GameHandler] Borderless mode: setting window size to ${O}x${U}`),x.push("--width",O.toString()),x.push("--height",U.toString())}catch(C){console.warn("[GameHandler] Failed to get screen size for borderless mode:",C),x.push("--width","1920"),x.push("--height","1080")}x.push("--server","185.100.215.195"),x.push("--port","25565"),console.log("Spawning java:",this.javaPath),console.log("Args:",x);let _={...process.env};if(process.platform==="linux"&&(_.ALSOFT_CONF="period_size=2048",_.ALSOFT_DRIVERS="pulse,alsa,oss"),process.platform==="win32"){let C=Object.keys(_).find(O=>O.toLowerCase()==="path")||"Path";_[C]=b+F.default.delimiter+(_[C]||""),console.log("[GameHandler] Updated PATH with natives:",b)}this.gameProcess=(0,Re.spawn)(this.javaPath,x,{cwd:d,env:_});let $=Ue();$&&$.setGameRunning(!0);let R=["s3.amazonaws.com/MinecraftResources","Failed to add pack.mcmeta","Failed to add READ_ME_I_AM_VERY_IMPORTANT"];return this.gameProcess.stdout.on("data",C=>{let O=C.toString().trim();O&&(L.game("stdout",O),!R.some(U=>O.includes(U))&&(console.log(`[MC]: ${O}`),O.includes("Connecting to")&&e.sender.send("game-connected")))}),this.gameProcess.stderr.on("data",C=>{let O=C.toString().trim();O&&(L.game("stderr",O),!R.some(U=>O.includes(U))&&console.error(`[MC-Err]: ${O}`))}),this.gameProcess.on("close",C=>{L.info("GameHandler",`Minecraft exited with code ${C}`),console.log(`Minecraft exited with code ${C}`),this.sendProgress(e.sender,"Jogo fechado",100),this.gameProcess=null,e.sender.send("game-closed",C);let O=Ue();O&&O.setGameRunning(!1)}),{success:!0}}catch(a){return console.error("Launch failed:",a),this.sendProgress(e.sender,`Erro: ${a.message}`,0),{success:!1,error:a.message,stack:a.stack}}}async handleUpdateCheck(){try{let e=await this.updateManager.checkForUpdates();return e.remoteVersions?e.instanceUpdate||e.librariesUpdate||e.modsUpdate?{available:!0,instanceUpdate:e.instanceUpdate,librariesUpdate:e.librariesUpdate,modsUpdate:e.modsUpdate,notes:e.remoteVersions.mods?.notes||"Atualiza\xE7\xF5es dispon\xEDveis"}:{available:!1}:{available:!1,error:"Failed to fetch version info"}}catch(e){return console.error("Update check failed:",e),{available:!1,error:String(e)}}}async handlePerformUpdate(e){try{return await this.updateManager.performAllUpdates((r,s)=>{this.sendProgress(e.sender,r,s)})}catch(t){return console.error("Update failed:",t),this.sendProgress(e.sender,`Erro na atualiza\xE7\xE3o: ${t}`,0),{success:!1,error:String(t)}}}};var be=require("electron"),te=G(require("fs"),1),re=G(require("path"),1),$t=G(Ee(),1);var Ae=class{userDataPath;activeModsDir="";constructor(){this.userDataPath=be.app.getPath("userData")}init(){be.ipcMain.handle("get-mods",async()=>(L.info("ModHandler","Fetching mods list..."),this.getMods())),be.ipcMain.handle("toggle-mod",async(e,{fileName:t,enable:r})=>(L.info("ModHandler",`Toggling mod ${t} to ${r}`),this.toggleMod(t,r)))}async toggleMod(e,t){if(!this.activeModsDir){let s="Cannot toggle mod: No active mods directory found.";return L.error("ModHandler",s),{success:!1,error:s}}let r=re.default.join(this.activeModsDir,"disabled");if(!te.default.existsSync(r))try{await te.default.promises.mkdir(r,{recursive:!0})}catch(s){let n=`Failed to create disabled directory: ${s.message}`;return L.error("ModHandler",n),{success:!1,error:n}}try{if(t){let s=re.default.join(r,e),n=re.default.join(this.activeModsDir,e);if(te.default.existsSync(s)){if(te.default.existsSync(n)){let d=`Destination file already exists: ${n}`;return L.warn("ModHandler",d),{success:!1,error:d}}return await this.moveFile(s,n)?(L.info("ModHandler",`Enabled mod: Moved ${e} to active folder`),{success:!0}):{success:!1,error:"Move operation failed (check logs)"}}else{let c=`Cannot enable: File not found in disabled folder: ${s}`;return L.warn("ModHandler",c),{success:!1,error:c}}}else{let s=re.default.join(this.activeModsDir,e),n=re.default.join(r,e);if(te.default.existsSync(s))return await this.moveFile(s,n)?(L.info("ModHandler",`Disabled mod: Moved ${e} to disabled folder`),{success:!0}):{success:!1,error:"Move operation failed (check logs)"};{let c=`Cannot disable: File not found in active folder: ${s}`;return L.warn("ModHandler",c),{success:!1,error:c}}}}catch(s){return L.error("ModHandler",`Failed to toggle mod ${e}: ${s.message}`),{success:!1,error:s.message}}}async moveFile(e,t){try{return await te.default.promises.rename(e,t),!0}catch(r){L.warn("ModHandler",`Rename failed for ${re.default.basename(e)}, trying copy+unlink: ${r}`);try{return await te.default.promises.copyFile(e,t),await te.default.promises.unlink(e),!0}catch(s){return L.error("ModHandler",`Move failed completely for ${re.default.basename(e)}: ${s}`),!1}}}async getMods(){let e=[re.default.join(this.userDataPath,"instances","default",".minecraft","mods"),re.default.join(this.userDataPath,"instances","default","mods"),re.default.join(this.userDataPath,"gamedata","mods")],t="";for(let c of e)if(te.default.existsSync(c)){t=c,L.info("ModHandler",`Found mods directory at: ${t}`);break}if(!t)return L.warn("ModHandler","No valid mods directory found in standard locations."),[];this.activeModsDir=t;let r=re.default.join(t,"disabled"),s=[],n=async(c,d)=>{if(te.default.existsSync(c))try{let v=await te.default.promises.readdir(c);for(let y of v){if(!y.endsWith(".jar"))continue;let S=re.default.join(c,y);if((await te.default.promises.stat(S)).isDirectory())continue;let N={fileName:y,enabled:d,name:y,description:"",version:""};try{let f=new $t.default(S).getEntries(),g=f.find(p=>p.entryName==="fabric.mod.json"),l=f.find(p=>p.entryName==="mod.json"),m=g||l;if(m){let p=m.getData().toString("utf8"),o=JSON.parse(p);o.name&&(N.name=o.name),o.description&&(N.description=o.description),o.version&&(N.version=o.version)}}catch(a){L.warn("ModHandler",`Could not read metadata for ${y}: ${a}`)}s.push(N)}}catch(v){L.error("ModHandler",`Error scanning directory ${c}: ${v}`)}};return await n(t,!0),await n(r,!1),s.sort((c,d)=>c.enabled===d.enabled?c.name.localeCompare(d.name):c.enabled?-1:1)}};var z=require("electron");var Vt=G(require("path"),1),Te=G(require("fs"),1),Ze=["F6","Shift+Tab","CommandOrControl+Tab"],Pe=class{overlayWindow=null;browserView=null;isVisible=!1;isGameRunning=!1;hotkeyRegistered=!1;configPath="";OVERLAY_URL="https://craft.blocky.com.br";HEADER_HEIGHT=48;init(){L.info("OverlayHandler","Initializing overlay handler"),this.configPath=Vt.default.join(z.app.getPath("userData"),"overlay-config.json"),this.registerHotkey(),this.setupIPC()}setupIPC(){z.ipcMain.on("overlay-go-back",()=>{this.browserView&&!this.browserView.webContents.isDestroyed()&&this.browserView.webContents.canGoBack()&&(this.browserView.webContents.goBack(),L.info("OverlayHandler","Navigated back"))}),z.ipcMain.on("overlay-go-home",()=>{this.browserView&&!this.browserView.webContents.isDestroyed()&&(this.browserView.webContents.loadURL(this.OVERLAY_URL),L.info("OverlayHandler","Navigated to home"))}),z.ipcMain.on("overlay-close",()=>{this.hideOverlay(),L.info("OverlayHandler","Closed via IPC")}),z.ipcMain.handle("get-overlay-hotkey",()=>this.getHotkey()),z.ipcMain.handle("set-overlay-hotkey",(e,t)=>this.setHotkey(t)),z.ipcMain.handle("get-available-hotkeys",()=>this.getAvailableHotkeys())}registeredHotkey=null;getDefaultHotkey(){return process.platform==="linux"?"F6":"Shift+Tab"}loadSavedHotkey(){try{if(Te.default.existsSync(this.configPath)){let e=JSON.parse(Te.default.readFileSync(this.configPath,"utf-8"));if(e.hotkey&&Ze.includes(e.hotkey))return e.hotkey}}catch{L.warn("OverlayHandler","Failed to load hotkey config, using default")}return this.getDefaultHotkey()}saveHotkeyConfig(e){try{Te.default.writeFileSync(this.configPath,JSON.stringify({hotkey:e},null,2)),L.info("OverlayHandler",`Saved hotkey config: ${e}`)}catch{L.error("OverlayHandler","Failed to save hotkey config")}}registerHotkey(){let e=this.loadSavedHotkey();this.tryRegisterHotkey(e)}tryRegisterHotkey(e){try{return z.globalShortcut.isRegistered(e)?(L.warn("OverlayHandler",`Hotkey ${e} is already registered by another application`),!1):z.globalShortcut.register(e,()=>{L.info("OverlayHandler",`${e} pressed`),this.toggleOverlay()})?(this.registeredHotkey=e,this.hotkeyRegistered=!0,L.info("OverlayHandler",`Overlay hotkey registered: ${e}`),!0):(L.warn("OverlayHandler",`Failed to register hotkey: ${e}`),!1)}catch(t){return L.error("OverlayHandler",`Exception registering ${e}: ${t.message}`),!1}}getHotkey(){return this.registeredHotkey||this.getDefaultHotkey()}setHotkey(e){if(!Ze.includes(e))return{success:!1,error:`Invalid hotkey: ${e}`};if(this.registeredHotkey&&this.hotkeyRegistered&&(z.globalShortcut.unregister(this.registeredHotkey),this.hotkeyRegistered=!1,this.registeredHotkey=null),this.tryRegisterHotkey(e))return this.saveHotkeyConfig(e),{success:!0};{let t=this.getDefaultHotkey();return t!==e&&this.tryRegisterHotkey(t),{success:!1,error:`Failed to register hotkey: ${e}. It may be in use by another application.`}}}getAvailableHotkeys(){return[...Ze]}cleanup(){this.hotkeyRegistered&&this.registeredHotkey&&(z.globalShortcut.unregister(this.registeredHotkey),this.hotkeyRegistered=!1,this.registeredHotkey=null,L.info("OverlayHandler","Hotkey unregistered")),this.overlayWindow&&!this.overlayWindow.isDestroyed()&&(this.overlayWindow.setBrowserView(null),this.browserView&&!this.browserView.webContents.isDestroyed()&&this.browserView.webContents.destroy(),this.overlayWindow.destroy(),this.overlayWindow=null,this.browserView=null)}createOverlayWindow(){if(this.overlayWindow&&!this.overlayWindow.isDestroyed()){L.info("OverlayHandler","Overlay window already exists");return}let e=z.screen.getPrimaryDisplay(),{width:t,height:r}=e.size,s=Math.min(Math.floor(t*.85),1400),n=Math.min(Math.floor(r*.85),900),c=Math.floor((t-s)/2),d=Math.floor((r-n)/2);L.info("OverlayHandler",`Creating overlay: ${s}x${n} at (${c}, ${d})`),this.overlayWindow=new z.BrowserWindow({width:s,height:n,x:c,y:d,frame:!1,transparent:!1,alwaysOnTop:!0,skipTaskbar:!0,show:!1,resizable:!1,movable:!1,focusable:!0,hasShadow:!0,backgroundColor:"#1e1e1e",webPreferences:{nodeIntegration:!0,contextIsolation:!1,sandbox:!1}});let v=`
<!DOCTYPE html>
<html>
<head>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { margin: 0; overflow: hidden; background: #1e1e1e; font-family: 'Inter', system-ui, -apple-system, sans-serif; }
        #blockycraft-nav-bar {
            height: ${this.HEADER_HEIGHT}px;
            background: #1e1e1e;
            border-bottom: 1px solid #333333;
            display: flex;
            align-items: center;
            padding: 0 16px;
            gap: 8px;
            color: white;
            user-select: none;
        }
        #blockycraft-nav-bar button {
            background: #2a2a2a;
            border: 1px solid #333333;
            color: #ffffff;
            width: 36px;
            height: 36px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        #blockycraft-nav-bar button:hover {
            background: #333333;
            border-color: #444444;
        }
        #blockycraft-nav-bar button svg {
            width: 20px;
            height: 20px;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
            fill: none;
        }
        #blockycraft-nav-bar .nav-title {
            color: #a1a1aa;
            font-size: 13px;
            margin-left: auto;
            font-weight: 500;
        }
        #blockycraft-nav-bar .close-btn {
            background: transparent;
            border-color: transparent;
            color: #ffffff;
            margin-left: 8px;
        }
        #blockycraft-nav-bar .close-btn:hover {
            background: #ef4444;
            border-color: #ef4444;
            color: #ffffff;
        }
    </style>
</head>
<body>
    <div id="blockycraft-nav-bar">
        <button id="bc-back-btn" title="Voltar" onclick="window.overlayAPI.goBack()">
            <svg viewBox="0 0 24 24"><path d="m15 18-6-6 6-6"/></svg>
        </button>
        <button id="bc-home-btn" title="In\xEDcio" onclick="window.overlayAPI.goHome()">
            <svg viewBox="0 0 24 24"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        </button>
        <span class="nav-title">BlockyCRAFT Overlay</span>
        <button class="close-btn" id="bc-close-btn" title="Fechar (Shift+Tab)" onclick="window.overlayAPI.close()">
            <svg viewBox="0 0 24 24"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
        </button>
    </div>
    <script>
        const { ipcRenderer } = require('electron');
        window.overlayAPI = {
            goBack: () => ipcRenderer.send('overlay-go-back'),
            goHome: () => ipcRenderer.send('overlay-go-home'),
            close: () => ipcRenderer.send('overlay-close')
        };
    </script>
</body>
</html>`;this.overlayWindow.loadURL(`data:text/html;charset=utf-8,${encodeURIComponent(v)}`),this.browserView=new z.BrowserView({webPreferences:{nodeIntegration:!1,contextIsolation:!0,sandbox:process.platform!=="linux"}}),this.overlayWindow.setBrowserView(this.browserView),this.browserView.setBounds({x:0,y:this.HEADER_HEIGHT,width:s,height:n-this.HEADER_HEIGHT}),this.browserView.setAutoResize({width:!0,height:!0}),this.browserView.webContents.on("did-start-loading",()=>{L.info("OverlayHandler","Browser started loading")}),this.browserView.webContents.on("did-fail-load",(y,S,b)=>{L.error("OverlayHandler",`Failed to load: ${S} - ${b}`)}),this.browserView.webContents.setWindowOpenHandler(({url:y})=>(L.info("OverlayHandler",`Intercepted new window request: ${y}`),this.browserView&&!this.browserView.webContents.isDestroyed()&&this.browserView.webContents.loadURL(y),{action:"deny"})),this.browserView.webContents.on("before-input-event",(y,S)=>{S.key==="Escape"&&S.type==="keyDown"&&this.hideOverlay()}),this.overlayWindow.webContents.on("before-input-event",(y,S)=>{S.key==="Escape"&&S.type==="keyDown"&&this.hideOverlay()}),L.info("OverlayHandler",`Loading URL: ${this.OVERLAY_URL}`),this.browserView.webContents.loadURL(this.OVERLAY_URL),this.overlayWindow.on("close",y=>{this.overlayWindow&&!this.overlayWindow.isDestroyed()&&(y.preventDefault(),this.hideOverlay())}),L.info("OverlayHandler","Overlay window created with BrowserView")}toggleOverlay(){if(!this.isGameRunning){L.info("OverlayHandler","Game not running - overlay disabled");return}this.isVisible?this.hideOverlay():this.showOverlay()}showOverlay(){(!this.overlayWindow||this.overlayWindow.isDestroyed())&&(L.info("OverlayHandler","Creating overlay window on first use..."),this.createOverlayWindow()),this.overlayWindow&&(this.overlayWindow.show(),this.overlayWindow.focus(),this.overlayWindow.setAlwaysOnTop(!0,"screen-saver"),this.isVisible=!0,L.info("OverlayHandler","Overlay shown"))}hideOverlay(){this.overlayWindow&&!this.overlayWindow.isDestroyed()&&(this.overlayWindow.hide(),this.isVisible=!1,L.info("OverlayHandler","Overlay hidden"))}setGameRunning(e){this.isGameRunning=e,L.info("OverlayHandler",`Game running state: ${e}`),!e&&this.isVisible&&this.hideOverlay()}isGameActive(){return this.isGameRunning}isOverlayVisible(){return this.isVisible}};X.app.commandLine.appendSwitch("no-sandbox");X.app.commandLine.appendSwitch("ozone-platform-hint","auto");var _r=new Fe;_r.init();var jr=new Ae;jr.init();var fe=null;function Ue(){return fe}console.log("=== BlockyCRAFT Launcher Starting ===");console.log("Electron version:",process.versions.electron);var ie=null,zt=process.env.VITE_DEV_SERVER_URL;function Gt(){if(console.log("Creating main window..."),ie=new X.BrowserWindow({width:900,height:600,minWidth:800,minHeight:500,frame:!0,resizable:!0,webPreferences:{nodeIntegration:!1,contextIsolation:!0,preload:We.default.join(__dirname,"preload.cjs"),sandbox:!1},backgroundColor:"#0f0f0f",show:!0,autoHideMenuBar:!0}),ie.setMenu(null),X.ipcMain.handle("open-external",async(i,e)=>{console.log("Opening external URL:",e);try{let{shell:t}=await import("electron");await t.openExternal(e)}catch(t){console.error("Failed to open external URL:",t)}}),X.ipcMain.handle("fetch-url",async(i,e)=>{L.info("Main",`Proxying fetch request to: ${e}`);let{net:t}=await import("electron");try{let r=await t.fetch(e);if(!r.ok)throw new Error(`HTTP ${r.status} ${r.statusText}`);return{success:!0,data:await r.text()}}catch(r){return L.error("Main",`Fetch failed for ${e}: ${r.message}`),{success:!1,error:r.message}}}),console.log("Window created, loading content..."),zt)ie.loadURL(zt);else{let i=We.default.join(__dirname,"../dist/index.html");ie.loadFile(i)}ie.webContents.on("did-finish-load",()=>{console.log("Create Window: did-finish-load")}),ie.webContents.on("did-fail-load",(i,e,t,r)=>{console.error("Create Window: did-fail-load",e,t,r)}),ie.webContents.on("render-process-gone",(i,e)=>{console.error("Create Window: render-process-gone",e)}),ie.webContents.on("unresponsive",()=>{console.error("Create Window: unresponsive")}),ie.on("closed",()=>{fe&&fe.cleanup(),ie=null,X.app.quit()})}X.app.whenReady().then(()=>{L.init(),L.info("Main",`Electron version: ${process.versions.electron}`),L.info("Main",`Node version: ${process.versions.node}`),L.info("Main",`Platform: ${process.platform} ${process.arch}`),fe=new Pe,fe.init(),Gt()});X.app.on("will-quit",()=>{fe&&fe.cleanup(),X.globalShortcut.unregisterAll()});X.app.on("window-all-closed",()=>{process.platform!=="darwin"&&X.app.quit()});X.app.on("activate",()=>{X.BrowserWindow.getAllWindows().length===0&&Gt()});0&&(module.exports={getOverlayHandler});
