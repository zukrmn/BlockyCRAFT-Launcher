var Kt=Object.create;var Le=Object.defineProperty;var Yt=Object.getOwnPropertyDescriptor;var Qt=Object.getOwnPropertyNames;var er=Object.getPrototypeOf,tr=Object.prototype.hasOwnProperty;var K=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports),rr=(s,e)=>{for(var t in e)Le(s,t,{get:e[t],enumerable:!0})},Ke=(s,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Qt(e))!tr.call(s,i)&&i!==t&&Le(s,i,{get:()=>e[i],enumerable:!(r=Yt(e,i))||r.enumerable});return s};var G=(s,e,t)=>(t=s!=null?Kt(er(s)):{},Ke(e||!s||!s.__esModule?Le(t,"default",{value:s,enumerable:!0}):t,s)),nr=s=>Ke(Le({},"__esModule",{value:!0}),s);var $e=K((Mr,Qe)=>{Qe.exports={LOCHDR:30,LOCSIG:67324752,LOCVER:4,LOCFLG:6,LOCHOW:8,LOCTIM:10,LOCCRC:14,LOCSIZ:18,LOCLEN:22,LOCNAM:26,LOCEXT:28,EXTSIG:134695760,EXTHDR:16,EXTCRC:4,EXTSIZ:8,EXTLEN:12,CENHDR:46,CENSIG:33639248,CENVEM:4,CENVER:6,CENFLG:8,CENHOW:10,CENTIM:12,CENCRC:16,CENSIZ:20,CENLEN:24,CENNAM:28,CENEXT:30,CENCOM:32,CENDSK:34,CENATT:36,CENATX:38,CENOFF:42,ENDHDR:22,ENDSIG:101010256,ENDSUB:8,ENDTOT:10,ENDSIZ:12,ENDOFF:16,ENDCOM:20,END64HDR:20,END64SIG:117853008,END64START:4,END64OFF:8,END64NUMDISKS:16,ZIP64SIG:101075792,ZIP64HDR:56,ZIP64LEAD:12,ZIP64SIZE:4,ZIP64VEM:12,ZIP64VER:14,ZIP64DSK:16,ZIP64DSKDIR:20,ZIP64SUB:24,ZIP64TOT:32,ZIP64SIZB:40,ZIP64OFF:48,ZIP64EXTRA:56,STORED:0,SHRUNK:1,REDUCED1:2,REDUCED2:3,REDUCED3:4,REDUCED4:5,IMPLODED:6,DEFLATED:8,ENHANCED_DEFLATED:9,PKWARE:10,BZIP2:12,LZMA:14,IBM_TERSE:18,IBM_LZ77:19,AES_ENCRYPT:99,FLG_ENC:1,FLG_COMP1:2,FLG_COMP2:4,FLG_DESC:8,FLG_ENH:16,FLG_PATCH:32,FLG_STR:64,FLG_EFS:2048,FLG_MSK:4096,FILE:2,BUFFER:1,NONE:0,EF_ID:0,EF_SIZE:2,ID_ZIP64:1,ID_AVINFO:7,ID_PFS:8,ID_OS2:9,ID_NTFS:10,ID_OPENVMS:12,ID_UNIX:13,ID_FORK:14,ID_PATCH:15,ID_X509_PKCS7:20,ID_X509_CERTID_F:21,ID_X509_CERTID_C:22,ID_STRONGENC:23,ID_RECORD_MGT:24,ID_X509_PKCS7_RL:25,ID_IBM1:101,ID_IBM2:102,ID_POSZIP:18064,EF_ZIP64_OR_32:4294967295,EF_ZIP64_OR_16:65535,EF_ZIP64_SUNCOMP:0,EF_ZIP64_SCOMP:8,EF_ZIP64_RHO:16,EF_ZIP64_DSN:24}});var xe=K(tt=>{var et={INVALID_LOC:"Invalid LOC header (bad signature)",INVALID_CEN:"Invalid CEN header (bad signature)",INVALID_END:"Invalid END header (bad signature)",DESCRIPTOR_NOT_EXIST:"No descriptor present",DESCRIPTOR_UNKNOWN:"Unknown descriptor format",DESCRIPTOR_FAULTY:"Descriptor data is malformed",NO_DATA:"Nothing to decompress",BAD_CRC:"CRC32 checksum failed {0}",FILE_IN_THE_WAY:"There is a file in the way: {0}",UNKNOWN_METHOD:"Invalid/unsupported compression method",AVAIL_DATA:"inflate::Available inflate data did not terminate",INVALID_DISTANCE:"inflate::Invalid literal/length or distance code in fixed or dynamic block",TO_MANY_CODES:"inflate::Dynamic block code description: too many length or distance codes",INVALID_REPEAT_LEN:"inflate::Dynamic block code description: repeat more than specified lengths",INVALID_REPEAT_FIRST:"inflate::Dynamic block code description: repeat lengths with no first length",INCOMPLETE_CODES:"inflate::Dynamic block code description: code lengths codes incomplete",INVALID_DYN_DISTANCE:"inflate::Dynamic block code description: invalid distance code lengths",INVALID_CODES_LEN:"inflate::Dynamic block code description: invalid literal/length code lengths",INVALID_STORE_BLOCK:"inflate::Stored block length did not match one's complement",INVALID_BLOCK_TYPE:"inflate::Invalid block type (type == 3)",CANT_EXTRACT_FILE:"Could not extract the file",CANT_OVERRIDE:"Target file already exists",DISK_ENTRY_TOO_LARGE:"Number of disk entries is too large",NO_ZIP:"No zip file was loaded",NO_ENTRY:"Entry doesn't exist",DIRECTORY_CONTENT_ERROR:"A directory cannot have content",FILE_NOT_FOUND:'File not found: "{0}"',NOT_IMPLEMENTED:"Not implemented",INVALID_FILENAME:"Invalid filename",INVALID_FORMAT:"Invalid or unsupported zip format. No END header found",INVALID_PASS_PARAM:"Incompatible password parameter",WRONG_PASSWORD:"Wrong Password",COMMENT_TOO_LONG:"Comment is too long",EXTRA_FIELD_PARSE_ERROR:"Extra field parsing error"};function or(s){return function(...e){return e.length&&(s=s.replace(/\{(\d)\}/g,(t,r)=>e[r]||"")),new Error("ADM-ZIP: "+s)}}for(let s of Object.keys(et))tt[s]=or(et[s])});var st=K((kr,it)=>{var ir=require("fs"),W=require("path"),rt=$e(),sr=xe(),ar=typeof process=="object"&&process.platform==="win32",nt=s=>typeof s=="object"&&s!==null,ot=new Uint32Array(256).map((s,e)=>{for(let t=0;t<8;t++)(e&1)!==0?e=3988292384^e>>>1:e>>>=1;return e>>>0});function k(s){this.sep=W.sep,this.fs=ir,nt(s)&&nt(s.fs)&&typeof s.fs.statSync=="function"&&(this.fs=s.fs)}it.exports=k;k.prototype.makeDir=function(s){let e=this;function t(r){let i=r.split(e.sep)[0];r.split(e.sep).forEach(function(n){if(!(!n||n.substr(-1,1)===":")){i+=e.sep+n;var c;try{c=e.fs.statSync(i)}catch{e.fs.mkdirSync(i)}if(c&&c.isFile())throw sr.FILE_IN_THE_WAY(`"${i}"`)}})}t(s)};k.prototype.writeFileTo=function(s,e,t,r){let i=this;if(i.fs.existsSync(s)){if(!t)return!1;var n=i.fs.statSync(s);if(n.isDirectory())return!1}var c=W.dirname(s);i.fs.existsSync(c)||i.makeDir(c);var l;try{l=i.fs.openSync(s,"w",438)}catch{i.fs.chmodSync(s,438),l=i.fs.openSync(s,"w",438)}if(l)try{i.fs.writeSync(l,e,0,e.length,0)}finally{i.fs.closeSync(l)}return i.fs.chmodSync(s,r||438),!0};k.prototype.writeFileToAsync=function(s,e,t,r,i){typeof r=="function"&&(i=r,r=void 0);let n=this;n.fs.exists(s,function(c){if(c&&!t)return i(!1);n.fs.stat(s,function(l,v){if(c&&v.isDirectory())return i(!1);var y=W.dirname(s);n.fs.exists(y,function(I){I||n.makeDir(y),n.fs.open(s,"w",438,function(b,N){b?n.fs.chmod(s,438,function(){n.fs.open(s,"w",438,function(a,d){n.fs.write(d,e,0,e.length,0,function(){n.fs.close(d,function(){n.fs.chmod(s,r||438,function(){i(!0)})})})})}):N?n.fs.write(N,e,0,e.length,0,function(){n.fs.close(N,function(){n.fs.chmod(s,r||438,function(){i(!0)})})}):n.fs.chmod(s,r||438,function(){i(!0)})})})})})};k.prototype.findFiles=function(s){let e=this;function t(r,i,n){typeof i=="boolean"&&(n=i,i=void 0);let c=[];return e.fs.readdirSync(r).forEach(function(l){let v=W.join(r,l),y=e.fs.statSync(v);(!i||i.test(v))&&c.push(W.normalize(v)+(y.isDirectory()?e.sep:"")),y.isDirectory()&&n&&(c=c.concat(t(v,i,n)))}),c}return t(s,void 0,!0)};k.prototype.findFilesAsync=function(s,e){let t=this,r=[];t.fs.readdir(s,function(i,n){if(i)return e(i);let c=n.length;if(!c)return e(null,r);n.forEach(function(l){l=W.join(s,l),t.fs.stat(l,function(v,y){if(v)return e(v);y&&(r.push(W.normalize(l)+(y.isDirectory()?t.sep:"")),y.isDirectory()?t.findFilesAsync(l,function(I,b){if(I)return e(I);r=r.concat(b),--c||e(null,r)}):--c||e(null,r))})})})};k.prototype.getAttributes=function(){};k.prototype.setAttributes=function(){};k.crc32update=function(s,e){return ot[(s^e)&255]^s>>>8};k.crc32=function(s){typeof s=="string"&&(s=Buffer.from(s,"utf8"));let e=s.length,t=-1;for(let r=0;r<e;)t=k.crc32update(t,s[r++]);return~t>>>0};k.methodToString=function(s){switch(s){case rt.STORED:return"STORED ("+s+")";case rt.DEFLATED:return"DEFLATED ("+s+")";default:return"UNSUPPORTED ("+s+")"}};k.canonical=function(s){if(!s)return"";let e=W.posix.normalize("/"+s.split("\\").join("/"));return W.join(".",e)};k.zipnamefix=function(s){if(!s)return"";let e=W.posix.normalize("/"+s.split("\\").join("/"));return W.posix.join(".",e)};k.findLast=function(s,e){if(!Array.isArray(s))throw new TypeError("arr is not array");let t=s.length>>>0;for(let r=t-1;r>=0;r--)if(e(s[r],r,s))return s[r]};k.sanitize=function(s,e){s=W.resolve(W.normalize(s));for(var t=e.split("/"),r=0,i=t.length;r<i;r++){var n=W.normalize(W.join(s,t.slice(r,i).join(W.sep)));if(n.indexOf(s)===0)return n}return W.normalize(W.join(s,W.basename(e)))};k.toBuffer=function(e,t){return Buffer.isBuffer(e)?e:e instanceof Uint8Array?Buffer.from(e):typeof e=="string"?t(e):Buffer.alloc(0)};k.readBigUInt64LE=function(s,e){var t=Buffer.from(s.slice(e,e+8));return t.swap64(),parseInt(`0x${t.toString("hex")}`)};k.fromDOS2Date=function(s){return new Date((s>>25&127)+1980,Math.max((s>>21&15)-1,0),Math.max(s>>16&31,1),s>>11&31,s>>5&63,(s&31)<<1)};k.fromDate2DOS=function(s){let e=0,t=0;return s.getFullYear()>1979&&(e=(s.getFullYear()-1980&127)<<9|s.getMonth()+1<<5|s.getDate(),t=s.getHours()<<11|s.getMinutes()<<5|s.getSeconds()>>1),e<<16|t};k.isWin=ar;k.crcTable=ot});var ct=K(($r,at)=>{var cr=require("path");at.exports=function(s,{fs:e}){var t=s||"",r=n(),i=null;function n(){return{directory:!1,readonly:!1,hidden:!1,executable:!1,mtime:0,atime:0}}return t&&e.existsSync(t)?(i=e.statSync(t),r.directory=i.isDirectory(),r.mtime=i.mtime,r.atime=i.atime,r.executable=(73&i.mode)!==0,r.readonly=(128&i.mode)===0,r.hidden=cr.basename(t)[0]==="."):console.warn("Invalid path: "+t),{get directory(){return r.directory},get readOnly(){return r.readonly},get hidden(){return r.hidden},get mtime(){return r.mtime},get atime(){return r.atime},get executable(){return r.executable},decodeAttributes:function(){},encodeAttributes:function(){},toJSON:function(){return{path:t,isDirectory:r.directory,isReadOnly:r.readonly,isHidden:r.hidden,isExecutable:r.executable,mTime:r.mtime,aTime:r.atime}},toString:function(){return JSON.stringify(this.toJSON(),null,"	")}}}});var ft=K((Br,lt)=>{lt.exports={efs:!0,encode:s=>Buffer.from(s,"utf8"),decode:s=>s.toString("utf8")}});var me=K((Vr,ge)=>{ge.exports=st();ge.exports.Constants=$e();ge.exports.Errors=xe();ge.exports.FileAttr=ct();ge.exports.decoder=ft()});var ut=K((zr,dt)=>{var se=me(),w=se.Constants;dt.exports=function(){var s=20,e=10,t=0,r=0,i=0,n=0,c=0,l=0,v=0,y=0,I=0,b=0,N=0,a=0,d=0;s|=se.isWin?2560:768,t|=w.FLG_EFS;let h={extraLen:0},f=o=>Math.max(0,o)>>>0,m=o=>Math.max(0,o)&65535,p=o=>Math.max(0,o)&255;return i=se.fromDate2DOS(new Date),{get made(){return s},set made(o){s=o},get version(){return e},set version(o){e=o},get flags(){return t},set flags(o){t=o},get flags_efs(){return(t&w.FLG_EFS)>0},set flags_efs(o){o?t|=w.FLG_EFS:t&=~w.FLG_EFS},get flags_desc(){return(t&w.FLG_DESC)>0},set flags_desc(o){o?t|=w.FLG_DESC:t&=~w.FLG_DESC},get method(){return r},set method(o){switch(o){case w.STORED:this.version=10;case w.DEFLATED:default:this.version=20}r=o},get time(){return se.fromDOS2Date(this.timeval)},set time(o){this.timeval=se.fromDate2DOS(o)},get timeval(){return i},set timeval(o){i=f(o)},get timeHighByte(){return p(i>>>8)},get crc(){return n},set crc(o){n=f(o)},get compressedSize(){return c},set compressedSize(o){c=f(o)},get size(){return l},set size(o){l=f(o)},get fileNameLength(){return v},set fileNameLength(o){v=o},get extraLength(){return y},set extraLength(o){y=o},get extraLocalLength(){return h.extraLen},set extraLocalLength(o){h.extraLen=o},get commentLength(){return I},set commentLength(o){I=o},get diskNumStart(){return b},set diskNumStart(o){b=f(o)},get inAttr(){return N},set inAttr(o){N=f(o)},get attr(){return a},set attr(o){a=f(o)},get fileAttr(){return(a||0)>>16&4095},get offset(){return d},set offset(o){d=f(o)},get encrypted(){return(t&w.FLG_ENC)===w.FLG_ENC},get centralHeaderSize(){return w.CENHDR+v+y+I},get realDataOffset(){return d+w.LOCHDR+h.fnameLen+h.extraLen},get localHeader(){return h},loadLocalHeaderFromBinary:function(o){var u=o.slice(d,d+w.LOCHDR);if(u.readUInt32LE(0)!==w.LOCSIG)throw se.Errors.INVALID_LOC();h.version=u.readUInt16LE(w.LOCVER),h.flags=u.readUInt16LE(w.LOCFLG),h.method=u.readUInt16LE(w.LOCHOW),h.time=u.readUInt32LE(w.LOCTIM),h.crc=u.readUInt32LE(w.LOCCRC),h.compressedSize=u.readUInt32LE(w.LOCSIZ),h.size=u.readUInt32LE(w.LOCLEN),h.fnameLen=u.readUInt16LE(w.LOCNAM),h.extraLen=u.readUInt16LE(w.LOCEXT);let g=d+w.LOCHDR+h.fnameLen,S=g+h.extraLen;return o.slice(g,S)},loadFromBinary:function(o){if(o.length!==w.CENHDR||o.readUInt32LE(0)!==w.CENSIG)throw se.Errors.INVALID_CEN();s=o.readUInt16LE(w.CENVEM),e=o.readUInt16LE(w.CENVER),t=o.readUInt16LE(w.CENFLG),r=o.readUInt16LE(w.CENHOW),i=o.readUInt32LE(w.CENTIM),n=o.readUInt32LE(w.CENCRC),c=o.readUInt32LE(w.CENSIZ),l=o.readUInt32LE(w.CENLEN),v=o.readUInt16LE(w.CENNAM),y=o.readUInt16LE(w.CENEXT),I=o.readUInt16LE(w.CENCOM),b=o.readUInt16LE(w.CENDSK),N=o.readUInt16LE(w.CENATT),a=o.readUInt32LE(w.CENATX),d=o.readUInt32LE(w.CENOFF)},localHeaderToBinary:function(){var o=Buffer.alloc(w.LOCHDR);return o.writeUInt32LE(w.LOCSIG,0),o.writeUInt16LE(e,w.LOCVER),o.writeUInt16LE(t,w.LOCFLG),o.writeUInt16LE(r,w.LOCHOW),o.writeUInt32LE(i,w.LOCTIM),o.writeUInt32LE(n,w.LOCCRC),o.writeUInt32LE(c,w.LOCSIZ),o.writeUInt32LE(l,w.LOCLEN),o.writeUInt16LE(v,w.LOCNAM),o.writeUInt16LE(h.extraLen,w.LOCEXT),o},centralHeaderToBinary:function(){var o=Buffer.alloc(w.CENHDR+v+y+I);return o.writeUInt32LE(w.CENSIG,0),o.writeUInt16LE(s,w.CENVEM),o.writeUInt16LE(e,w.CENVER),o.writeUInt16LE(t,w.CENFLG),o.writeUInt16LE(r,w.CENHOW),o.writeUInt32LE(i,w.CENTIM),o.writeUInt32LE(n,w.CENCRC),o.writeUInt32LE(c,w.CENSIZ),o.writeUInt32LE(l,w.CENLEN),o.writeUInt16LE(v,w.CENNAM),o.writeUInt16LE(y,w.CENEXT),o.writeUInt16LE(I,w.CENCOM),o.writeUInt16LE(b,w.CENDSK),o.writeUInt16LE(N,w.CENATT),o.writeUInt32LE(a,w.CENATX),o.writeUInt32LE(d,w.CENOFF),o},toJSON:function(){let o=function(u){return u+" bytes"};return{made:s,version:e,flags:t,method:se.methodToString(r),time:this.time,crc:"0x"+n.toString(16).toUpperCase(),compressedSize:o(c),size:o(l),fileNameLength:o(v),extraLength:o(y),commentLength:o(I),diskNumStart:b,inAttr:N,attr:a,offset:d,centralHeaderSize:o(w.CENHDR+v+y+I)}},toString:function(){return JSON.stringify(this.toJSON(),null,"	")}}}});var gt=K((Gr,ht)=>{var pe=me(),M=pe.Constants;ht.exports=function(){var s=0,e=0,t=0,r=0,i=0;return{get diskEntries(){return s},set diskEntries(n){s=e=n},get totalEntries(){return e},set totalEntries(n){e=s=n},get size(){return t},set size(n){t=n},get offset(){return r},set offset(n){r=n},get commentLength(){return i},set commentLength(n){i=n},get mainHeaderSize(){return M.ENDHDR+i},loadFromBinary:function(n){if((n.length!==M.ENDHDR||n.readUInt32LE(0)!==M.ENDSIG)&&(n.length<M.ZIP64HDR||n.readUInt32LE(0)!==M.ZIP64SIG))throw pe.Errors.INVALID_END();n.readUInt32LE(0)===M.ENDSIG?(s=n.readUInt16LE(M.ENDSUB),e=n.readUInt16LE(M.ENDTOT),t=n.readUInt32LE(M.ENDSIZ),r=n.readUInt32LE(M.ENDOFF),i=n.readUInt16LE(M.ENDCOM)):(s=pe.readBigUInt64LE(n,M.ZIP64SUB),e=pe.readBigUInt64LE(n,M.ZIP64TOT),t=pe.readBigUInt64LE(n,M.ZIP64SIZE),r=pe.readBigUInt64LE(n,M.ZIP64OFF),i=0)},toBinary:function(){var n=Buffer.alloc(M.ENDHDR+i);return n.writeUInt32LE(M.ENDSIG,0),n.writeUInt32LE(0,4),n.writeUInt16LE(s,M.ENDSUB),n.writeUInt16LE(e,M.ENDTOT),n.writeUInt32LE(t,M.ENDSIZ),n.writeUInt32LE(r,M.ENDOFF),n.writeUInt16LE(i,M.ENDCOM),n.fill(" ",M.ENDHDR),n},toJSON:function(){let n=function(c,l){let v=c.toString(16).toUpperCase();for(;v.length<l;)v="0"+v;return"0x"+v};return{diskEntries:s,totalEntries:e,size:t+" bytes",offset:n(r,4),commentLength:i}},toString:function(){return JSON.stringify(this.toJSON(),null,"	")}}}});var Ve=K(Be=>{Be.EntryHeader=ut();Be.MainHeader=gt()});var pt=K((Zr,mt)=>{mt.exports=function(s){var e=require("zlib"),t={chunkSize:(parseInt(s.length/1024)+1)*1024};return{deflate:function(){return e.deflateRawSync(s,t)},deflateAsync:function(r){var i=e.createDeflateRaw(t),n=[],c=0;i.on("data",function(l){n.push(l),c+=l.length}),i.on("end",function(){var l=Buffer.alloc(c),v=0;l.fill(0);for(var y=0;y<n.length;y++){var I=n[y];I.copy(l,v),v+=I.length}r&&r(l)}),i.end(s)}}}});var vt=K((Jr,yt)=>{var lr=+(process.versions?process.versions.node:"").split(".")[0]||0;yt.exports=function(s,e){var t=require("zlib");let r=lr>=15&&e>0?{maxOutputLength:e}:{};return{inflate:function(){return t.inflateRawSync(s,r)},inflateAsync:function(i){var n=t.createInflateRaw(r),c=[],l=0;n.on("data",function(v){c.push(v),l+=v.length}),n.on("end",function(){var v=Buffer.alloc(l),y=0;v.fill(0);for(var I=0;I<c.length;I++){var b=c[I];b.copy(v,y),y+=b.length}i&&i(v)}),n.end(s)}}}});var Dt=K((Xr,St)=>{"use strict";var{randomFillSync:wt}=require("crypto"),fr=xe(),dr=new Uint32Array(256).map((s,e)=>{for(let t=0;t<8;t++)(e&1)!==0?e=e>>>1^3988292384:e>>>=1;return e>>>0}),bt=(s,e)=>Math.imul(s,e)>>>0,Et=(s,e)=>dr[(s^e)&255]^s>>>8,ve=()=>typeof wt=="function"?wt(Buffer.alloc(12)):ve.node();ve.node=()=>{let s=Buffer.alloc(12),e=s.length;for(let t=0;t<e;t++)s[t]=Math.random()*256&255;return s};var Ce={genSalt:ve};function Ne(s){let e=Buffer.isBuffer(s)?s:Buffer.from(s);this.keys=new Uint32Array([305419896,591751049,878082192]);for(let t=0;t<e.length;t++)this.updateKeys(e[t])}Ne.prototype.updateKeys=function(s){let e=this.keys;return e[0]=Et(e[0],s),e[1]+=e[0]&255,e[1]=bt(e[1],134775813)+1,e[2]=Et(e[2],e[1]>>>24),s};Ne.prototype.next=function(){let s=(this.keys[2]|2)>>>0;return bt(s,s^1)>>8&255};function ur(s){let e=new Ne(s);return function(t){let r=Buffer.alloc(t.length),i=0;for(let n of t)r[i++]=e.updateKeys(n^e.next());return r}}function hr(s){let e=new Ne(s);return function(t,r,i=0){r||(r=Buffer.alloc(t.length));for(let n of t){let c=e.next();r[i++]=n^c,e.updateKeys(n)}return r}}function gr(s,e,t){if(!s||!Buffer.isBuffer(s)||s.length<12)return Buffer.alloc(0);let r=ur(t),i=r(s.slice(0,12)),n=(e.flags&8)===8?e.timeHighByte:e.crc>>>24;if(i[11]!==n)throw fr.WRONG_PASSWORD();return r(s.slice(12))}function mr(s){Buffer.isBuffer(s)&&s.length>=12?Ce.genSalt=function(){return s.slice(0,12)}:s==="node"?Ce.genSalt=ve.node:Ce.genSalt=ve}function pr(s,e,t,r=!1){s==null&&(s=Buffer.alloc(0)),Buffer.isBuffer(s)||(s=Buffer.from(s.toString()));let i=hr(t),n=Ce.genSalt();n[11]=e.crc>>>24&255,r&&(n[10]=e.crc>>>16&255);let c=Buffer.alloc(s.length+12);return i(n,c),i(s,c,12)}St.exports={decrypt:gr,encrypt:pr,_salter:mr}});var It=K(_e=>{_e.Deflater=pt();_e.Inflater=vt();_e.ZipCrypto=Dt()});var Ge=K((Kr,Lt)=>{var A=me(),yr=Ve(),$=A.Constants,ze=It();Lt.exports=function(s,e){var t=new yr.EntryHeader,r=Buffer.alloc(0),i=Buffer.alloc(0),n=!1,c=null,l=Buffer.alloc(0),v=Buffer.alloc(0),y=!0;let I=s,b=typeof I.decoder=="object"?I.decoder:A.decoder;y=b.hasOwnProperty("efs")?b.efs:!1;function N(){return!e||!(e instanceof Uint8Array)?Buffer.alloc(0):(v=t.loadLocalHeaderFromBinary(e),e.slice(t.realDataOffset,t.realDataOffset+t.compressedSize))}function a(o){if(t.flags_desc){let u={},g=t.realDataOffset+t.compressedSize;if(e.readUInt32LE(g)==$.LOCSIG||e.readUInt32LE(g)==$.CENSIG)throw A.Errors.DESCRIPTOR_NOT_EXIST();if(e.readUInt32LE(g)==$.EXTSIG)u.crc=e.readUInt32LE(g+$.EXTCRC),u.compressedSize=e.readUInt32LE(g+$.EXTSIZ),u.size=e.readUInt32LE(g+$.EXTLEN);else if(e.readUInt16LE(g+12)===19280)u.crc=e.readUInt32LE(g+$.EXTCRC-4),u.compressedSize=e.readUInt32LE(g+$.EXTSIZ-4),u.size=e.readUInt32LE(g+$.EXTLEN-4);else throw A.Errors.DESCRIPTOR_UNKNOWN();if(u.compressedSize!==t.compressedSize||u.size!==t.size||u.crc!==t.crc)throw A.Errors.DESCRIPTOR_FAULTY();if(A.crc32(o)!==u.crc)return!1}else if(A.crc32(o)!==t.localHeader.crc)return!1;return!0}function d(o,u,g){if(typeof u>"u"&&typeof o=="string"&&(g=o,o=void 0),n)return o&&u&&u(Buffer.alloc(0),A.Errors.DIRECTORY_CONTENT_ERROR()),Buffer.alloc(0);var S=N();if(S.length===0)return o&&u&&u(S),S;if(t.encrypted){if(typeof g!="string"&&!Buffer.isBuffer(g))throw A.Errors.INVALID_PASS_PARAM();S=ze.ZipCrypto.decrypt(S,t,g)}var E=Buffer.alloc(t.size);switch(t.method){case A.Constants.STORED:if(S.copy(E),a(E))return o&&u&&u(E),E;throw o&&u&&u(E,A.Errors.BAD_CRC()),A.Errors.BAD_CRC();case A.Constants.DEFLATED:var C=new ze.Inflater(S,t.size);if(o)C.inflateAsync(function(U){U.copy(U,0),u&&(a(U)?u(U):u(U,A.Errors.BAD_CRC()))});else{if(C.inflate(E).copy(E,0),!a(E))throw A.Errors.BAD_CRC(`"${b.decode(r)}"`);return E}break;default:throw o&&u&&u(Buffer.alloc(0),A.Errors.UNKNOWN_METHOD()),A.Errors.UNKNOWN_METHOD()}}function h(o,u){if((!c||!c.length)&&Buffer.isBuffer(e))return o&&u&&u(N()),N();if(c.length&&!n){var g;switch(t.method){case A.Constants.STORED:return t.compressedSize=t.size,g=Buffer.alloc(c.length),c.copy(g),o&&u&&u(g),g;default:case A.Constants.DEFLATED:var S=new ze.Deflater(c);if(o)S.deflateAsync(function(C){g=Buffer.alloc(C.length),t.compressedSize=C.length,C.copy(g),u&&u(g)});else{var E=S.deflate();return t.compressedSize=E.length,E}S=null;break}}else if(o&&u)u(Buffer.alloc(0));else return Buffer.alloc(0)}function f(o,u){return(o.readUInt32LE(u+4)<<4)+o.readUInt32LE(u)}function m(o){try{for(var u=0,g,S,E;u+4<o.length;)g=o.readUInt16LE(u),u+=2,S=o.readUInt16LE(u),u+=2,E=o.slice(u,u+S),u+=S,$.ID_ZIP64===g&&p(E)}catch{throw A.Errors.EXTRA_FIELD_PARSE_ERROR()}}function p(o){var u,g,S,E;o.length>=$.EF_ZIP64_SCOMP&&(u=f(o,$.EF_ZIP64_SUNCOMP),t.size===$.EF_ZIP64_OR_32&&(t.size=u)),o.length>=$.EF_ZIP64_RHO&&(g=f(o,$.EF_ZIP64_SCOMP),t.compressedSize===$.EF_ZIP64_OR_32&&(t.compressedSize=g)),o.length>=$.EF_ZIP64_DSN&&(S=f(o,$.EF_ZIP64_RHO),t.offset===$.EF_ZIP64_OR_32&&(t.offset=S)),o.length>=$.EF_ZIP64_DSN+4&&(E=o.readUInt32LE($.EF_ZIP64_DSN),t.diskNumStart===$.EF_ZIP64_OR_16&&(t.diskNumStart=E))}return{get entryName(){return b.decode(r)},get rawEntryName(){return r},set entryName(o){r=A.toBuffer(o,b.encode);var u=r[r.length-1];n=u===47||u===92,t.fileNameLength=r.length},get efs(){return typeof y=="function"?y(this.entryName):y},get extra(){return l},set extra(o){l=o,t.extraLength=o.length,m(o)},get comment(){return b.decode(i)},set comment(o){if(i=A.toBuffer(o,b.encode),t.commentLength=i.length,i.length>65535)throw A.Errors.COMMENT_TOO_LONG()},get name(){var o=b.decode(r);return n?o.substr(o.length-1).split("/").pop():o.split("/").pop()},get isDirectory(){return n},getCompressedData:function(){return h(!1,null)},getCompressedDataAsync:function(o){h(!0,o)},setData:function(o){c=A.toBuffer(o,A.decoder.encode),!n&&c.length?(t.size=c.length,t.method=A.Constants.DEFLATED,t.crc=A.crc32(o),t.changed=!0):t.method=A.Constants.STORED},getData:function(o){return t.changed?c:d(!1,null,o)},getDataAsync:function(o,u){t.changed?o(c):d(!0,o,u)},set attr(o){t.attr=o},get attr(){return t.attr},set header(o){t.loadFromBinary(o)},get header(){return t},packCentralHeader:function(){t.flags_efs=this.efs,t.extraLength=l.length;var o=t.centralHeaderToBinary(),u=A.Constants.CENHDR;return r.copy(o,u),u+=r.length,l.copy(o,u),u+=t.extraLength,i.copy(o,u),o},packLocalHeader:function(){let o=0;t.flags_efs=this.efs,t.extraLocalLength=v.length;let u=t.localHeaderToBinary(),g=Buffer.alloc(u.length+r.length+t.extraLocalLength);return u.copy(g,o),o+=u.length,r.copy(g,o),o+=r.length,v.copy(g,o),o+=v.length,g},toJSON:function(){let o=function(u){return"<"+(u&&u.length+" bytes buffer"||"null")+">"};return{entryName:this.entryName,name:this.name,comment:this.comment,isDirectory:this.isDirectory,header:t.toJSON(),compressedData:o(e),data:o(c)}},toString:function(){return JSON.stringify(this.toJSON(),null,"	")}}}});var Nt=K((Yr,Ct)=>{var xt=Ge(),vr=Ve(),J=me();Ct.exports=function(s,e){var t=[],r={},i=Buffer.alloc(0),n=new vr.MainHeader,c=!1,l=null;let v=new Set,y=e,{noSort:I,decoder:b}=y;s?d(y.readEntries):c=!0;function N(){let f=new Set;for(let m of Object.keys(r)){let p=m.split("/");if(p.pop(),!!p.length)for(let o=0;o<p.length;o++){let u=p.slice(0,o+1).join("/")+"/";f.add(u)}}for(let m of f)if(!(m in r)){let p=new xt(y);p.entryName=m,p.attr=16,p.temporary=!0,t.push(p),r[p.entryName]=p,v.add(p)}}function a(){if(c=!0,r={},n.diskEntries>(s.length-n.offset)/J.Constants.CENHDR)throw J.Errors.DISK_ENTRY_TOO_LARGE();t=new Array(n.diskEntries);for(var f=n.offset,m=0;m<t.length;m++){var p=f,o=new xt(y,s);o.header=s.slice(p,p+=J.Constants.CENHDR),o.entryName=s.slice(p,p+=o.header.fileNameLength),o.header.extraLength&&(o.extra=s.slice(p,p+=o.header.extraLength)),o.header.commentLength&&(o.comment=s.slice(p,p+o.header.commentLength)),f+=o.header.centralHeaderSize,t[m]=o,r[o.entryName]=o}v.clear(),N()}function d(f){var m=s.length-J.Constants.ENDHDR,p=Math.max(0,m-65535),o=p,u=s.length,g=-1,S=0;for((typeof y.trailingSpace=="boolean"?y.trailingSpace:!1)&&(p=0),m;m>=o;m--)if(s[m]===80){if(s.readUInt32LE(m)===J.Constants.ENDSIG){g=m,S=m,u=m+J.Constants.ENDHDR,o=m-J.Constants.END64HDR;continue}if(s.readUInt32LE(m)===J.Constants.END64SIG){o=p;continue}if(s.readUInt32LE(m)===J.Constants.ZIP64SIG){g=m,u=m+J.readBigUInt64LE(s,m+J.Constants.ZIP64SIZE)+J.Constants.ZIP64LEAD;break}}if(g==-1)throw J.Errors.INVALID_FORMAT();n.loadFromBinary(s.slice(g,u)),n.commentLength&&(i=s.slice(S+J.Constants.ENDHDR)),f&&a()}function h(){t.length>1&&!I&&t.sort((f,m)=>f.entryName.toLowerCase().localeCompare(m.entryName.toLowerCase()))}return{get entries(){return c||a(),t.filter(f=>!v.has(f))},get comment(){return b.decode(i)},set comment(f){i=J.toBuffer(f,b.encode),n.commentLength=i.length},getEntryCount:function(){return c?t.length:n.diskEntries},forEach:function(f){this.entries.forEach(f)},getEntry:function(f){return c||a(),r[f]||null},setEntry:function(f){c||a(),t.push(f),r[f.entryName]=f,n.totalEntries=t.length},deleteFile:function(f,m=!0){c||a();let p=r[f];this.getEntryChildren(p,m).map(u=>u.entryName).forEach(this.deleteEntry)},deleteEntry:function(f){c||a();let m=r[f],p=t.indexOf(m);p>=0&&(t.splice(p,1),delete r[f],n.totalEntries=t.length)},getEntryChildren:function(f,m=!0){if(c||a(),typeof f=="object")if(f.isDirectory&&m){let p=[],o=f.entryName;for(let u of t)u.entryName.startsWith(o)&&p.push(u);return p}else return[f];return[]},getChildCount:function(f){if(f&&f.isDirectory){let m=this.getEntryChildren(f);return m.includes(f)?m.length-1:m.length}return 0},compressToBuffer:function(){c||a(),h();let f=[],m=[],p=0,o=0;n.size=0,n.offset=0;let u=0;for(let E of this.entries){let C=E.getCompressedData();E.header.offset=o;let U=E.packLocalHeader(),V=U.length+C.length;o+=V,f.push(U),f.push(C);let P=E.packCentralHeader();m.push(P),n.size+=P.length,p+=V+P.length,u++}p+=n.mainHeaderSize,n.offset=o,n.totalEntries=u,o=0;let g=Buffer.alloc(p);for(let E of f)E.copy(g,o),o+=E.length;for(let E of m)E.copy(g,o),o+=E.length;let S=n.toBinary();return i&&i.copy(S,J.Constants.ENDHDR),S.copy(g,o),s=g,c=!1,g},toAsyncBuffer:function(f,m,p,o){try{c||a(),h();let u=[],g=[],S=0,E=0,C=0;n.size=0,n.offset=0;let U=function(V){if(V.length>0){let P=V.shift(),x=P.entryName+P.extra.toString();p&&p(x),P.getCompressedDataAsync(function(_){o&&o(x),P.header.offset=E;let j=P.packLocalHeader(),q=j.length+_.length;E+=q,u.push(j),u.push(_);let ee=P.packCentralHeader();g.push(ee),n.size+=ee.length,S+=q+ee.length,C++,U(V)})}else{S+=n.mainHeaderSize,n.offset=E,n.totalEntries=C,E=0;let P=Buffer.alloc(S);u.forEach(function(_){_.copy(P,E),E+=_.length}),g.forEach(function(_){_.copy(P,E),E+=_.length});let x=n.toBinary();i&&i.copy(x,J.Constants.ENDHDR),x.copy(P,E),s=P,c=!1,f(P)}};U(Array.from(this.entries))}catch(u){m(u)}}}}});var we=K((Qr,Ot)=>{var H=me(),B=require("path"),wr=Ge(),Er=Nt(),le=(...s)=>H.findLast(s,e=>typeof e=="boolean"),_t=(...s)=>H.findLast(s,e=>typeof e=="string"),br=(...s)=>H.findLast(s,e=>typeof e=="function"),Sr={noSort:!1,readEntries:!1,method:H.Constants.NONE,fs:null};Ot.exports=function(s,e){let t=null,r=Object.assign(Object.create(null),Sr);s&&typeof s=="object"&&(s instanceof Uint8Array||(Object.assign(r,s),s=r.input?r.input:void 0,r.input&&delete r.input),Buffer.isBuffer(s)&&(t=s,r.method=H.Constants.BUFFER,s=void 0)),Object.assign(r,e);let i=new H(r);if((typeof r.decoder!="object"||typeof r.decoder.encode!="function"||typeof r.decoder.decode!="function")&&(r.decoder=H.decoder),s&&typeof s=="string")if(i.fs.existsSync(s))r.method=H.Constants.FILE,r.filename=s,t=i.fs.readFileSync(s);else throw H.Errors.INVALID_FILENAME();let n=new Er(t,r),{canonical:c,sanitize:l,zipnamefix:v}=H;function y(a){if(a&&n){var d;if(typeof a=="string"&&(d=n.getEntry(B.posix.normalize(a))),typeof a=="object"&&typeof a.entryName<"u"&&typeof a.header<"u"&&(d=n.getEntry(a.entryName)),d)return d}return null}function I(a){let{join:d,normalize:h,sep:f}=B.posix;return d(".",h(f+a.split("\\").join(f)+f))}function b(a){return a instanceof RegExp?(function(d){return function(h){return d.test(h)}})(a):typeof a!="function"?()=>!0:a}let N=(a,d)=>{let h=d.slice(-1);return h=h===i.sep?i.sep:"",B.relative(a,d)+h};return{readFile:function(a,d){var h=y(a);return h&&h.getData(d)||null},childCount:function(a){let d=y(a);if(d)return n.getChildCount(d)},readFileAsync:function(a,d){var h=y(a);h?h.getDataAsync(d):d(null,"getEntry failed for:"+a)},readAsText:function(a,d){var h=y(a);if(h){var f=h.getData();if(f&&f.length)return f.toString(d||"utf8")}return""},readAsTextAsync:function(a,d,h){var f=y(a);f?f.getDataAsync(function(m,p){if(p){d(m,p);return}m&&m.length?d(m.toString(h||"utf8")):d("")}):d("")},deleteFile:function(a,d=!0){var h=y(a);h&&n.deleteFile(h.entryName,d)},deleteEntry:function(a){var d=y(a);d&&n.deleteEntry(d.entryName)},addZipComment:function(a){n.comment=a},getZipComment:function(){return n.comment||""},addZipEntryComment:function(a,d){var h=y(a);h&&(h.comment=d)},getZipEntryComment:function(a){var d=y(a);return d&&d.comment||""},updateFile:function(a,d){var h=y(a);h&&h.setData(d)},addLocalFile:function(a,d,h,f){if(i.fs.existsSync(a)){d=d?I(d):"";let m=B.win32.basename(B.win32.normalize(a));d+=h||m;let p=i.fs.statSync(a),o=p.isFile()?i.fs.readFileSync(a):Buffer.alloc(0);p.isDirectory()&&(d+=i.sep),this.addFile(d,o,f,p)}else throw H.Errors.FILE_NOT_FOUND(a)},addLocalFileAsync:function(a,d){a=typeof a=="object"?a:{localPath:a};let h=B.resolve(a.localPath),{comment:f}=a,{zipPath:m,zipName:p}=a,o=this;i.fs.stat(h,function(u,g){if(u)return d(u,!1);m=m?I(m):"";let S=B.win32.basename(B.win32.normalize(h));if(m+=p||S,g.isFile())i.fs.readFile(h,function(E,C){return E?d(E,!1):(o.addFile(m,C,f,g),setImmediate(d,void 0,!0))});else if(g.isDirectory())return m+=i.sep,o.addFile(m,Buffer.alloc(0),f,g),setImmediate(d,void 0,!0)})},addLocalFolder:function(a,d,h){if(h=b(h),d=d?I(d):"",a=B.normalize(a),i.fs.existsSync(a)){let f=i.findFiles(a),m=this;if(f.length)for(let p of f){let o=B.join(d,N(a,p));h(o)&&m.addLocalFile(p,B.dirname(o))}}else throw H.Errors.FILE_NOT_FOUND(a)},addLocalFolderAsync:function(a,d,h,f){f=b(f),h=h?I(h):"",a=B.normalize(a);var m=this;i.fs.open(a,"r",function(p){if(p&&p.code==="ENOENT")d(void 0,H.Errors.FILE_NOT_FOUND(a));else if(p)d(void 0,p);else{var o=i.findFiles(a),u=-1,g=function(){if(u+=1,u<o.length){var S=o[u],E=N(a,S).split("\\").join("/");E=E.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\x20-\x7E]/g,""),f(E)?i.fs.stat(S,function(C,U){C&&d(void 0,C),U.isFile()?i.fs.readFile(S,function(V,P){V?d(void 0,V):(m.addFile(h+E,P,"",U),g())}):(m.addFile(h+E+"/",Buffer.alloc(0),"",U),g())}):process.nextTick(()=>{g()})}else d(!0,void 0)};g()}})},addLocalFolderAsync2:function(a,d){let h=this;a=typeof a=="object"?a:{localPath:a},localPath=B.resolve(I(a.localPath));let{zipPath:f,filter:m,namefix:p}=a;m instanceof RegExp?m=(function(g){return function(S){return g.test(S)}})(m):typeof m!="function"&&(m=function(){return!0}),f=f?I(f):"",p=="latin1"&&(p=g=>g.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\x20-\x7E]/g,"")),typeof p!="function"&&(p=g=>g);let o=g=>B.join(f,p(N(localPath,g))),u=g=>B.win32.basename(B.win32.normalize(p(g)));i.fs.open(localPath,"r",function(g){g&&g.code==="ENOENT"?d(void 0,H.Errors.FILE_NOT_FOUND(localPath)):g?d(void 0,g):i.findFilesAsync(localPath,function(S,E){if(S)return d(S);E=E.filter(C=>m(o(C))),E.length||d(void 0,!1),setImmediate(E.reverse().reduce(function(C,U){return function(V,P){if(V||P===!1)return setImmediate(C,V,!1);h.addLocalFileAsync({localPath:U,zipPath:B.dirname(o(U)),zipName:u(U)},C)}},d))})})},addLocalFolderPromise:function(a,d){return new Promise((h,f)=>{this.addLocalFolderAsync2(Object.assign({localPath:a},d),(m,p)=>{m&&f(m),p&&h(this)})})},addFile:function(a,d,h,f){a=v(a);let m=y(a),p=m!=null;p||(m=new wr(r),m.entryName=a),m.comment=h||"";let o=typeof f=="object"&&f instanceof i.fs.Stats;o&&(m.header.time=f.mtime);var u=m.isDirectory?16:0;let g=m.isDirectory?16384:32768;return o?g|=4095&f.mode:typeof f=="number"?g|=4095&f:g|=m.isDirectory?493:420,u=(u|g<<16)>>>0,m.attr=u,m.setData(d),p||n.setEntry(m),m},getEntries:function(a){return n.password=a,n?n.entries:[]},getEntry:function(a){return y(a)},getEntryCount:function(){return n.getEntryCount()},forEach:function(a){return n.forEach(a)},extractEntryTo:function(a,d,h,f,m,p){f=le(!1,f),m=le(!1,m),h=le(!0,h),p=_t(m,p);var o=y(a);if(!o)throw H.Errors.NO_ENTRY();var u=c(o.entryName),g=l(d,p&&!o.isDirectory?p:h?u:B.basename(u));if(o.isDirectory){var S=n.getEntryChildren(o);return S.forEach(function(U){if(U.isDirectory)return;var V=U.getData();if(!V)throw H.Errors.CANT_EXTRACT_FILE();var P=c(U.entryName),x=l(d,h?P:B.basename(P));let _=m?U.header.fileAttr:void 0;i.writeFileTo(x,V,f,_)}),!0}var E=o.getData(n.password);if(!E)throw H.Errors.CANT_EXTRACT_FILE();if(i.fs.existsSync(g)&&!f)throw H.Errors.CANT_OVERRIDE();let C=m?a.header.fileAttr:void 0;return i.writeFileTo(g,E,f,C),!0},test:function(a){if(!n)return!1;for(var d in n.entries)try{if(d.isDirectory)continue;var h=n.entries[d].getData(a);if(!h)return!1}catch{return!1}return!0},extractAllTo:function(a,d,h,f){if(h=le(!1,h),f=_t(h,f),d=le(!1,d),!n)throw H.Errors.NO_ZIP();n.entries.forEach(function(m){var p=l(a,c(m.entryName));if(m.isDirectory){i.makeDir(p);return}var o=m.getData(f);if(!o)throw H.Errors.CANT_EXTRACT_FILE();let u=h?m.header.fileAttr:void 0;i.writeFileTo(p,o,d,u);try{i.fs.utimesSync(p,m.header.time,m.header.time)}catch{throw H.Errors.CANT_EXTRACT_FILE()}})},extractAllToAsync:function(a,d,h,f){if(f=br(d,h,f),h=le(!1,h),d=le(!1,d),!f)return new Promise((g,S)=>{this.extractAllToAsync(a,d,h,function(E){E?S(E):g(this)})});if(!n){f(H.Errors.NO_ZIP());return}a=B.resolve(a);let m=g=>l(a,B.normalize(c(g.entryName))),p=(g,S)=>new Error(g+': "'+S+'"'),o=[],u=[];n.entries.forEach(g=>{g.isDirectory?o.push(g):u.push(g)});for(let g of o){let S=m(g),E=h?g.header.fileAttr:void 0;try{i.makeDir(S),E&&i.fs.chmodSync(S,E),i.fs.utimesSync(S,g.header.time,g.header.time)}catch{f(p("Unable to create folder",S))}}u.reverse().reduce(function(g,S){return function(E){if(E)g(E);else{let C=B.normalize(c(S.entryName)),U=l(a,C);S.getDataAsync(function(V,P){if(P)g(P);else if(!V)g(H.Errors.CANT_EXTRACT_FILE());else{let x=h?S.header.fileAttr:void 0;i.writeFileToAsync(U,V,d,x,function(_){_||g(p("Unable to write file",U)),i.fs.utimes(U,S.header.time,S.header.time,function(j){j?g(p("Unable to set times",U)):g()})})}})}}},f)()},writeZip:function(a,d){if(arguments.length===1&&typeof a=="function"&&(d=a,a=""),!a&&r.filename&&(a=r.filename),!!a){var h=n.compressToBuffer();if(h){var f=i.writeFileTo(a,h,!0);typeof d=="function"&&d(f?null:new Error("failed"),"")}}},writeZipPromise:function(a,d){let{overwrite:h,perm:f}=Object.assign({overwrite:!0},d);return new Promise((m,p)=>{!a&&r.filename&&(a=r.filename),a||p("ADM-ZIP: ZIP File Name Missing"),this.toBufferPromise().then(o=>{let u=g=>g?m(g):p("ADM-ZIP: Wasn't able to write zip file");i.writeFileToAsync(a,o,h,f,u)},p)})},toBufferPromise:function(){return new Promise((a,d)=>{n.toAsyncBuffer(a,d)})},toBuffer:function(a,d,h,f){return typeof a=="function"?(n.toAsyncBuffer(a,d,h,f),null):n.compressToBuffer()}}}});var Fr={};rr(Fr,{getOverlayHandler:()=>Pe});module.exports=nr(Fr);var X=require("electron"),Xe=G(require("node:path"),1);var Ye=require("electron"),ye=G(require("path"),1),ce=G(require("fs"),1),ke=class{logsDir;launcherLogPath;gameLogPath;initialized=!1;MAX_LOG_DAYS=7;constructor(){this.logsDir="",this.launcherLogPath="",this.gameLogPath=""}init(){if(this.initialized)return;this.logsDir=ye.default.join(Ye.app.getPath("userData"),"logs"),ce.default.mkdirSync(this.logsDir,{recursive:!0});let e=this.getDateString();this.launcherLogPath=ye.default.join(this.logsDir,`launcher-${e}.log`),this.gameLogPath=ye.default.join(this.logsDir,`game-${e}.log`),this.rotateOldLogs(),this.interceptConsole(),this.initialized=!0,this.info("Logger","=== BlockyCRAFT Launcher Log Started ==="),this.info("Logger",`Log file: ${this.launcherLogPath}`)}getDateString(){return new Date().toISOString().split("T")[0]}getTimestamp(){return new Date().toISOString()}formatMessage(e,t,r){return`[${this.getTimestamp()}] [${e}] [${t}] ${r}`}writeToLauncherLog(e){if(this.initialized)try{ce.default.appendFileSync(this.launcherLogPath,e+`
`)}catch(t){process.stdout.write(`[LOG WRITE ERROR] ${t}
`)}}writeToGameLog(e){if(this.initialized)try{ce.default.appendFileSync(this.gameLogPath,`[${this.getTimestamp()}] ${e}
`)}catch(t){process.stdout.write(`[GAME LOG WRITE ERROR] ${t}
`)}}rotateOldLogs(){try{let e=ce.default.readdirSync(this.logsDir),t=Date.now(),r=this.MAX_LOG_DAYS*24*60*60*1e3;for(let i of e){if(!i.endsWith(".log"))continue;let n=ye.default.join(this.logsDir,i),c=ce.default.statSync(n);t-c.mtimeMs>r&&(ce.default.unlinkSync(n),process.stdout.write(`[Logger] Deleted old log: ${i}
`))}}catch(e){process.stdout.write(`[Logger] Error rotating logs: ${e}
`)}}interceptConsole(){let e=console.log,t=console.error,r=console.warn,i=this;console.log=function(...n){let c=n.map(l=>typeof l=="object"?JSON.stringify(l):String(l)).join(" ");i.writeToLauncherLog(i.formatMessage("INFO","Console",c)),e.apply(console,n)},console.error=function(...n){let c=n.map(l=>typeof l=="object"?JSON.stringify(l):String(l)).join(" ");i.writeToLauncherLog(i.formatMessage("ERROR","Console",c)),t.apply(console,n)},console.warn=function(...n){let c=n.map(l=>typeof l=="object"?JSON.stringify(l):String(l)).join(" ");i.writeToLauncherLog(i.formatMessage("WARN","Console",c)),r.apply(console,n)}}info(e,t){let r=this.formatMessage("INFO",e,t);this.writeToLauncherLog(r),process.stdout.write(r+`
`)}error(e,t){let r=this.formatMessage("ERROR",e,t);this.writeToLauncherLog(r),process.stderr.write(r+`
`)}warn(e,t){let r=this.formatMessage("WARN",e,t);this.writeToLauncherLog(r),process.stdout.write(r+`
`)}debug(e,t){let r=this.formatMessage("DEBUG",e,t);this.writeToLauncherLog(r)}game(e,t){let r=e==="stderr"?"[ERR]":"[OUT]";this.writeToGameLog(`${r} ${t}`)}getLogsDir(){return this.logsDir}},D=new ke;var Y=require("electron"),F=G(require("path"),1),L=G(require("fs"),1),Ae=require("child_process"),kt=require("util"),Fe=G(we(),1),$t=require("fs");var Ut=require("electron"),oe=G(require("path"),1),ne=G(require("fs"),1),Ft=require("fs"),jt=require("child_process"),Pt=require("util"),At=G(we(),1),We=(0,Pt.promisify)(jt.exec),Dr="https://api.adoptium.net/v3/binary/latest",Ir="17",Lr="hotspot",xr="eclipse",Oe=class{javaDir;markerFile;constructor(){this.javaDir=oe.default.join(Ut.app.getPath("userData"),"java"),this.markerFile=oe.default.join(this.javaDir,".java17_installed")}async ensureJava(e){let t=this.getLocalJavaPath();if(t&&ne.default.existsSync(t))return console.log("[JavaManager] Using locally installed Java:",t),t;let r=await this.detectSystemJava();return r?(console.log("[JavaManager] Using system Java:",r),r):(console.log("[JavaManager] No Java found, downloading..."),this.downloadAndInstallJava(e))}async detectSystemJava(){let e=this.getCommonJavaPaths();for(let t of e)if(await this.isValidJava17(t))return t;return null}getCommonJavaPaths(){let e=["java"],t=process.platform;if(t==="win32"){let r=process.env.ProgramFiles||"C:\\Program Files",i=process.env["ProgramFiles(x86)"]||"C:\\Program Files (x86)";e.push(oe.default.join(r,"Eclipse Adoptium","jdk-17*","bin","java.exe"),oe.default.join(r,"Java","jdk-17*","bin","java.exe"),oe.default.join(r,"Java","jre-17*","bin","java.exe"),oe.default.join(r,"Temurin","jdk-17*","bin","java.exe"),oe.default.join(i,"Java","jdk-17*","bin","java.exe"))}else t==="darwin"?e.push("/Library/Java/JavaVirtualMachines/temurin-17.jdk/Contents/Home/bin/java","/Library/Java/JavaVirtualMachines/adoptopenjdk-17.jdk/Contents/Home/bin/java","/usr/local/opt/openjdk@17/bin/java","/opt/homebrew/opt/openjdk@17/bin/java"):e.push("/usr/lib/jvm/temurin-17-jdk/bin/java","/usr/lib/jvm/java-17-openjdk/bin/java","/usr/lib/jvm/java-17-openjdk-amd64/bin/java","/usr/lib/jvm/java-17-temurin/bin/java","/opt/java/openjdk/bin/java");return e}async isValidJava17(e){try{let{stdout:t,stderr:r}=await We(`"${e}" -version`),n=(t+r).match(/version "(\d+)/);return n?parseInt(n[1],10)>=17:!1}catch{return!1}}getPlatformInfo(){let e=process.platform,t=process.arch,r,i,n;switch(e){case"win32":r="windows",i="zip",n="bin/java.exe";break;case"darwin":r="mac",i="tar.gz",n="Contents/Home/bin/java";break;default:r="linux",i="tar.gz",n="bin/java"}let c;switch(t){case"arm64":c="aarch64";break;case"x64":default:c="x64"}return{os:r,arch:c,extension:i,executablePath:n}}getDownloadUrl(){let e=this.getPlatformInfo(),t=`${Dr}/${Ir}/ga/${e.os}/${e.arch}/jre/${Lr}/normal/${xr}`,r=`temurin-17-jre.${e.extension}`;return{url:t,filename:r}}getLocalJavaPath(){if(!ne.default.existsSync(this.markerFile))return null;let e=this.getPlatformInfo();if(!ne.default.existsSync(this.javaDir))return null;let r=ne.default.readdirSync(this.javaDir).find(n=>n.startsWith("jdk-17")&&ne.default.statSync(oe.default.join(this.javaDir,n)).isDirectory());if(!r)return null;let i=oe.default.join(this.javaDir,r,e.executablePath);return ne.default.existsSync(i)?i:null}async downloadAndInstallJava(e){let{url:t,filename:r}=this.getDownloadUrl(),i=this.getPlatformInfo();ne.default.mkdirSync(this.javaDir,{recursive:!0});let n=oe.default.join(this.javaDir,r);this.sendProgress(e,"Baixando Java 17...",0),console.log("[JavaManager] Downloading from:",t);try{let l=await fetch(t,{redirect:"follow"});if(!l.ok)throw new Error(`Failed to download Java: ${l.status} ${l.statusText}`);let v=Number(l.headers.get("content-length"))||0,y=(0,Ft.createWriteStream)(n);if(!l.body)throw new Error("No response body");let I=l.body.getReader(),b=0;for(;;){let{done:N,value:a}=await I.read();if(N)break;if(y.write(Buffer.from(a)),b+=a.length,v>0){let d=Math.round(b/v*50);this.sendProgress(e,`Baixando Java 17... (${this.formatSize(b)}/${this.formatSize(v)})`,d)}}y.end(),await new Promise((N,a)=>{y.on("finish",N),y.on("error",a)}),console.log("[JavaManager] Download complete:",n)}catch(l){throw ne.default.existsSync(n)&&ne.default.unlinkSync(n),new Error(`Failed to download Java: ${l.message}`)}this.sendProgress(e,"Extraindo Java 17...",55),console.log("[JavaManager] Extracting...");try{i.extension==="zip"?new At.default(n).extractAllTo(this.javaDir,!0):await We(`tar -xzf "${n}" -C "${this.javaDir}"`),ne.default.writeFileSync(this.markerFile,new Date().toISOString()),ne.default.unlinkSync(n)}catch(l){throw new Error(`Failed to extract Java: ${l.message}`)}let c=this.getLocalJavaPath();if(!c)throw new Error("Java extraction failed: executable not found");return process.platform!=="win32"&&await We(`chmod +x "${c}"`),this.sendProgress(e,"Java 17 instalado!",60),console.log("[JavaManager] Java installed at:",c),c}sendProgress(e,t,r){e&&e.send("launch-progress",{status:t,progress:r})}formatSize(e){return e<1024?e+" B":e<1024*1024?(e/1024).toFixed(1)+" KB":(e/(1024*1024)).toFixed(1)+" MB"}};var Ze=require("electron"),R=G(require("path"),1),O=G(require("fs"),1),Rt=require("fs"),Tt=G(we(),1),Cr=["https://craft.blocky.com.br/launcher-assets/version.json"],Ue=class{dataPath;localVersionsPath;instanceDir;librariesDir;constructor(){this.dataPath=Ze.app.getPath("userData"),this.localVersionsPath=R.default.join(this.dataPath,"versions.json"),this.instanceDir=R.default.join(this.dataPath,"instances","default"),this.librariesDir=R.default.join(this.instanceDir,"libraries")}normalizeUrls(e){return Array.isArray(e)?e:[e]}getLocalVersions(){try{if(O.default.existsSync(this.localVersionsPath)){let e=O.default.readFileSync(this.localVersionsPath,"utf-8");return JSON.parse(e)}}catch(e){console.error("[UpdateManager] Failed to read local versions:",e)}return{instance:"0.0.0",libraries:"0.0.0",mods:"0.0.0",texturepacks:"0.0.0"}}saveLocalVersions(e){try{O.default.writeFileSync(this.localVersionsPath,JSON.stringify(e,null,2)),console.log("[UpdateManager] Saved local versions:",e)}catch(t){console.error("[UpdateManager] Failed to save local versions:",t)}}async fetchRemoteVersions(){for(let e of Cr)try{console.log("[UpdateManager] Trying to fetch versions from:",e);let t=await fetch(e,{signal:AbortSignal.timeout(1e4)});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);let r=await t.json();return console.log("[UpdateManager] Successfully fetched from:",e),console.log("[UpdateManager] Remote versions:",r),r}catch(t){console.warn(`[UpdateManager] Failed to fetch from ${e}:`,t)}return console.error("[UpdateManager] All version URLs failed"),null}isNewerVersion(e,t){let r=c=>c.split(".").map(l=>parseInt(l,10)||0),i=r(e),n=r(t);for(let c=0;c<Math.max(i.length,n.length);c++){let l=i[c]||0,v=n[c]||0;if(l>v)return!0;if(l<v)return!1}return!1}getLauncherDownloadUrl(){let e="https://github.com/zukrmn/BlockyCRAFT-Launcher/releases/latest/download";switch(process.platform){case"win32":return`${e}/BlockyCRAFT-Launcher-Setup.exe`;case"darwin":return`${e}/BlockyCRAFT-Launcher-arm64.dmg`;case"linux":default:return`${e}/BlockyCRAFT-Launcher.AppImage`}}async checkForUpdates(){let e=this.getLocalVersions(),t=await this.fetchRemoteVersions();if(!t)return{launcherUpdate:!1,launcherDownloadUrl:null,instanceUpdate:!1,librariesUpdate:!1,modsUpdate:!1,texturepacksUpdate:!1,remoteVersions:null,error:"Failed to fetch remote version info"};let r=Ze.app.getVersion(),i=this.isNewerVersion(t.launcher_version,r),n=i?this.getLauncherDownloadUrl():null;i&&console.log(`[UpdateManager] Launcher update available: ${r} \u2192 ${t.launcher_version}`);let c=t.instance.version!==e.instance,l=!1,v=t.mods?t.mods.version!==e.mods:!1,y=t.texturepacks?t.texturepacks.version!==e.texturepacks:!1;return console.log("[UpdateManager] Update check result:",{launcherUpdate:i,instanceUpdate:c,librariesUpdate:"DISABLED (Maven-based)",modsUpdate:v,texturepacksUpdate:y,local:{launcher:r,...e},remote:{launcher:t.launcher_version,instance:t.instance.version,libraries:t.libraries?.version??"N/A (Maven-based)",mods:t.mods?.version,texturepacks:t.texturepacks?.version}}),{launcherUpdate:i,launcherDownloadUrl:n,instanceUpdate:c,librariesUpdate:l,modsUpdate:v,texturepacksUpdate:y,remoteVersions:t}}async downloadFile(e,t,r){let i=R.default.basename(t);r?.(`Baixando ${i}...`,0);let n=this.normalizeUrls(e),c=null;for(let l=0;l<n.length;l++){let v=n[l];try{console.log(`[UpdateManager] Downloading from URL ${l+1}/${n.length}: ${v}`);let y=await fetch(v,{signal:AbortSignal.timeout(6e4)});if(!y.ok)throw new Error(`HTTP ${y.status}: ${y.statusText}`);let I=Number(y.headers.get("content-length"))||0;O.default.mkdirSync(R.default.dirname(t),{recursive:!0});let b=(0,Rt.createWriteStream)(t);if(!y.body)throw new Error("No response body");let N=y.body.getReader(),a=0;for(;;){let{done:d,value:h}=await N.read();if(d)break;if(b.write(Buffer.from(h)),a+=h.length,I>0){let f=Math.round(a/I*100);r?.(`Baixando ${i}...`,f)}}b.end(),await new Promise((d,h)=>{b.on("finish",d),b.on("error",h)}),console.log(`[UpdateManager] Downloaded ${i} (${this.formatSize(a)}) from ${v}`);return}catch(y){console.warn(`[UpdateManager] Failed to download from ${v}:`,y.message),c=y}}throw c||new Error(`Failed to download ${i} from all ${n.length} sources`)}extractZip(e,t){if(console.log(`[UpdateManager] Extracting ${e} to ${t}`),!O.default.existsSync(e))throw new Error(`ZIP file not found: ${e}`);let r=O.default.readFileSync(e);if(r.length<4||r[0]!==80||r[1]!==75)throw console.error(`[UpdateManager] Invalid ZIP file. First bytes: ${r.slice(0,20).toString("hex")}`),new Error(`Invalid ZIP file: ${e}. The download may have failed or returned an error page.`);O.default.mkdirSync(t,{recursive:!0}),new Tt.default(e).extractAllTo(t,!0),console.log("[UpdateManager] Extraction complete")}backupUserData(){let e=R.default.join(this.dataPath,"update_backup"),t=R.default.join(this.instanceDir,".minecraft");O.default.existsSync(e)&&O.default.rmSync(e,{recursive:!0,force:!0}),O.default.mkdirSync(e,{recursive:!0});let r=["options.txt","servers.dat","screenshots","stats","lastlogin","config"];console.log("[UpdateManager] Backing up user data...");for(let i of r){let n=R.default.join(t,i),c=R.default.join(e,i);if(O.default.existsSync(n))try{console.log(`[UpdateManager] Backing up: ${i}`),O.default.cpSync(n,c,{recursive:!0})}catch(l){console.warn(`[UpdateManager] Failed to backup ${i}:`,l)}}}restoreUserData(){let e=R.default.join(this.dataPath,"update_backup"),t=R.default.join(this.instanceDir,".minecraft");if(!O.default.existsSync(e))return;console.log("[UpdateManager] Restoring user data...");let r=O.default.readdirSync(e);for(let i of r){let n=R.default.join(e,i),c=R.default.join(t,i);try{console.log(`[UpdateManager] Restoring: ${i}`),O.default.existsSync(c)&&O.default.rmSync(c,{recursive:!0,force:!0}),O.default.cpSync(n,c,{recursive:!0})}catch(l){console.warn(`[UpdateManager] Failed to restore ${i}:`,l)}}try{O.default.rmSync(e,{recursive:!0,force:!0})}catch(i){console.warn("[UpdateManager] Failed to cleanup backup:",i)}}async updateInstance(e,t){let r=R.default.join(this.dataPath,"temp_instance.zip");try{await this.downloadFile(e.instance.url,r,t),t?.("Preparando atualiza\xE7\xE3o da inst\xE2ncia...",0),this.backupUserData(),O.default.existsSync(this.instanceDir),t?.("Extraindo inst\xE2ncia...",50),this.extractZip(r,this.instanceDir),this.restoreUserData();let i=this.getLocalVersions();i.instance=e.instance.version,this.saveLocalVersions(i),t?.("Inst\xE2ncia atualizada!",100)}finally{O.default.existsSync(r)&&O.default.unlinkSync(r)}}async updateLibraries(e,t){if(!e.libraries){console.log("[UpdateManager] Libraries update skipped - using Maven repos");return}let r=R.default.join(this.dataPath,"temp_libraries.zip");try{await this.downloadFile(e.libraries.url,r,t),t?.("Preparando atualiza\xE7\xE3o das bibliotecas...",0);let i=R.default.join(this.librariesDir,".bundled_extracted_v1");O.default.existsSync(i)&&O.default.unlinkSync(i),O.default.existsSync(this.librariesDir)&&O.default.rmSync(this.librariesDir,{recursive:!0,force:!0}),t?.("Extraindo bibliotecas...",50),this.extractZip(r,this.librariesDir),O.default.writeFileSync(R.default.join(this.librariesDir,".bundled_extracted_v2"),"extracted");let n=this.getLocalVersions();n.libraries=e.libraries.version,this.saveLocalVersions(n),t?.("Bibliotecas atualizadas!",100)}finally{O.default.existsSync(r)&&O.default.unlinkSync(r)}}async updateMods(e,t){if(!e.mods){console.log("[UpdateManager] No mods update available");return}let r=R.default.join(this.dataPath,"temp_mods.zip"),i=R.default.join(this.instanceDir,".minecraft","mods");try{await this.downloadFile(e.mods.url,r,t),t?.("Removendo mods antigos...",0),O.default.existsSync(i)&&O.default.rmSync(i,{recursive:!0,force:!0}),t?.("Instalando novos mods...",50),this.extractZip(r,R.default.join(this.instanceDir,".minecraft"));let n=this.getLocalVersions();n.mods=e.mods.version,this.saveLocalVersions(n),t?.("Mods atualizados!",100)}finally{O.default.existsSync(r)&&O.default.unlinkSync(r)}}async updateTexturepacks(e,t){if(!e.texturepacks){console.log("[UpdateManager] No texture pack update available");return}let r=R.default.join(this.instanceDir,".minecraft","texturepacks"),i=R.default.join(r,"betaoverhauled.zip");try{O.default.mkdirSync(r,{recursive:!0}),t?.("Baixando textura...",0);let n=R.default.join(this.dataPath,"temp_texturepack.zip");await this.downloadFile(e.texturepacks.url,n,t),O.default.existsSync(i)&&O.default.unlinkSync(i),O.default.renameSync(n,i);let c=this.getLocalVersions();c.texturepacks=e.texturepacks.version,this.saveLocalVersions(c),t?.("Textura atualizada!",100),console.log("[UpdateManager] Texture pack updated: betaoverhauled.zip")}catch(n){console.error("[UpdateManager] Failed to update texture pack:",n);let c=R.default.join(this.dataPath,"temp_texturepack.zip");throw O.default.existsSync(c)&&O.default.unlinkSync(c),n}}async performAllUpdates(e){try{e?.("Verificando atualiza\xE7\xF5es...",0);let t=await this.checkForUpdates();if(!t.remoteVersions)return console.log("[UpdateManager] Could not fetch remote versions, skipping updates"),{success:!0};let r=[t.instanceUpdate,t.librariesUpdate,t.modsUpdate,t.texturepacksUpdate].filter(Boolean).length;if(r===0)return console.log("[UpdateManager] All components are up to date"),e?.("Tudo atualizado!",100),{success:!0};let i=0;if(t.instanceUpdate){i++;let n=(i-1)/r*100,c=100/r;await this.updateInstance(t.remoteVersions,(l,v)=>{let y=n+v/100*c;e?.(l,Math.round(y))})}if(t.librariesUpdate){i++;let n=(i-1)/r*100,c=100/r;await this.updateLibraries(t.remoteVersions,(l,v)=>{let y=n+v/100*c;e?.(l,Math.round(y))})}if(t.modsUpdate){i++;let n=(i-1)/r*100,c=100/r;await this.updateMods(t.remoteVersions,(l,v)=>{let y=n+v/100*c;e?.(l,Math.round(y))})}if(t.texturepacksUpdate){i++;let n=(i-1)/r*100,c=100/r;await this.updateTexturepacks(t.remoteVersions,(l,v)=>{let y=n+v/100*c;e?.(l,Math.round(y))})}return e?.("Todas as atualiza\xE7\xF5es conclu\xEDdas!",100),{success:!0}}catch(t){return console.error("[UpdateManager] Update failed:",t),{success:!1,error:t.message}}}formatSize(e){return e<1024?e+" B":e<1024*1024?(e/1024).toFixed(1)+" KB":(e/(1024*1024)).toFixed(1)+" MB"}};var Ee=(0,kt.promisify)(Ae.exec);function be(s){if(!L.default.existsSync(s))return!1;let e=L.default.readFileSync(s);return e.length>=4&&e[0]===80&&e[1]===75}function Bt(s,e){if(!be(s)){let r=L.default.existsSync(s)?L.default.readFileSync(s):Buffer.alloc(0);throw console.error(`[GameHandler] Invalid ZIP file: ${s}. First bytes: ${r.slice(0,20).toString("hex")}`),new Error("Invalid ZIP file. The download may have failed.")}L.default.mkdirSync(e,{recursive:!0}),new Fe.default(s).extractAllTo(e,!0)}function Nr(s){return new Promise(e=>setTimeout(e,s))}async function Mt(s,e,t=3){let r=[500,1e3,2e3],i=null;for(let n=0;n<=t;n++)try{Bt(s,e);return}catch(c){if(i=c,n<t){let l=r[n]||2e3;console.warn(`[GameHandler] Extraction failed (attempt ${n+1}/${t+1}), retrying in ${l}ms...`),await Nr(l)}}throw i||new Error(`Failed to extract ${s} after ${t+1} attempts`)}var _r="https://piston-meta.mojang.com/mc/game/version_manifest_v2.json",Ht="b1.7.3",je=class{gamePath;javaPath;javaManager;updateManager;gameProcess=null;lastUpdateCheck=null;UPDATE_CACHE_TTL=6e4;MANIFEST_CACHE_TTL=1440*60*1e3;lastInstanceVersion=null;constructor(){this.gamePath=F.default.join(Y.app.getPath("userData"),"gamedata"),this.javaPath="java",this.javaManager=new Oe,this.updateManager=new Ue,this.loadLastInstanceVersion()}loadLastInstanceVersion(){try{let e=F.default.join(Y.app.getPath("userData"),"versions.json");if(L.default.existsSync(e)){let t=JSON.parse(L.default.readFileSync(e,"utf-8"));this.lastInstanceVersion=t.instance||null}}catch{}}init(){Y.ipcMain.handle("launch-game",async(e,t)=>this.handleLaunch(e,t)),Y.ipcMain.handle("kill-game",async()=>this.gameProcess?(console.log("Killing game process..."),this.gameProcess.kill(),this.gameProcess=null,{success:!0}):{success:!1,error:"No game running"}),Y.ipcMain.handle("check-custom-instance",async()=>{let e=F.default.resolve("instance.zip"),t=F.default.join(Y.app.getPath("userData"),"instances","default","instance.cfg");return L.default.existsSync(e)||L.default.existsSync(t)}),Y.ipcMain.handle("check-update-status",async()=>this.handleUpdateCheck()),Y.ipcMain.handle("perform-update",async e=>this.handlePerformUpdate(e))}sendProgress(e,t,r){e.send("launch-progress",{status:t,progress:r})}async getCachedVersionDetails(){let e=F.default.join(Y.app.getPath("userData"),"mojang_version_cache.json");if(L.default.existsSync(e))try{let l=JSON.parse(L.default.readFileSync(e,"utf-8"));if(Date.now()-l.timestamp<this.MANIFEST_CACHE_TTL)return console.log("[GameHandler] Using cached Mojang version details (TTL: 24h)"),l.data}catch(l){console.warn("[GameHandler] Failed to read version cache:",l)}console.log("[GameHandler] Fetching fresh Mojang version manifest...");let i=(await(await fetch(_r)).json()).versions.find(l=>l.id===Ht);if(!i)throw new Error(`Version ${Ht} not found`);let c=await(await fetch(i.url)).json();try{L.default.writeFileSync(e,JSON.stringify({timestamp:Date.now(),data:c})),console.log("[GameHandler] Saved version details to cache")}catch(l){console.warn("[GameHandler] Failed to save version cache:",l)}return c}async checkJava(e){try{return await Ee(`"${e}" -version`),!0}catch{return!1}}async applyBorderlessPostSpawn(){let{width:e,height:t}=Y.screen.getPrimaryDisplay().size;await new Promise(r=>setTimeout(r,4e3));try{if(process.platform==="win32"){let r=`
Add-Type @"
using System;
using System.Runtime.InteropServices;
public class Win32 {
    [DllImport("user32.dll")] public static extern IntPtr FindWindow(string lpClassName, string lpWindowName);
    [DllImport("user32.dll")] public static extern int SetWindowLong(IntPtr hWnd, int nIndex, int dwNewLong);
    [DllImport("user32.dll")] public static extern int GetWindowLong(IntPtr hWnd, int nIndex);
    [DllImport("user32.dll")] public static extern bool SetWindowPos(IntPtr hWnd, IntPtr hWndInsertAfter, int X, int Y, int cx, int cy, uint uFlags);
    [DllImport("user32.dll")] public static extern bool SetForegroundWindow(IntPtr hWnd);
}
"@
$titles = @("Minecraft", "Minecraft Beta 1.7.3")
$h = [IntPtr]::Zero
foreach ($t in $titles) {
    $h = [Win32]::FindWindow([NullString]::Value, $t)
    if ($h -ne [IntPtr]::Zero) { break }
}
if ($h -eq [IntPtr]::Zero) {
    Get-Process java* | ForEach-Object { 
        if ($_.MainWindowTitle -like "*Minecraft*") { $h = $_.MainWindowHandle }
    }
}
if ($h -ne [IntPtr]::Zero) {
    $style = [Win32]::GetWindowLong($h, -16)
    $newStyle = $style -band (-bnot 0x00C40000)
    [Win32]::SetWindowLong($h, -16, $newStyle)
    [Win32]::SetWindowPos($h, [IntPtr]::Zero, 0, 0, ${e}, ${t}, 0x0040)
    [Win32]::SetForegroundWindow($h)
}
`;await Ee(`powershell -ExecutionPolicy Bypass -Command "${r.replace(/"/g,'\\"').replace(/\n/g," ")}"`),D.info("GameHandler","Borderless mode applied via Win32 APIs")}else if(process.platform==="darwin"){let r=`
tell application "System Events"
    set javaProcesses to every process whose name contains "java"
    repeat with proc in javaProcesses
        try
            set frontmost of proc to true
            set position of window 1 of proc to {0, 0}
            set size of window 1 of proc to {${e}, ${t}}
        end try
    end repeat
end tell
`;await Ee(`osascript -e '${r.replace(/'/g,`'"'"'`)}'`),D.info("GameHandler","Borderless mode applied via AppleScript")}else if(process.platform==="linux")if((process.env.XDG_SESSION_TYPE||"x11")==="x11")try{await Ee('wmctrl -r "Minecraft" -b add,fullscreen'),D.info("GameHandler","Borderless mode applied via wmctrl")}catch{try{await Ee("wmctrl -r :ACTIVE: -b add,fullscreen"),D.info("GameHandler","Borderless mode applied via wmctrl (active window)")}catch{D.warn("GameHandler","wmctrl failed - is it installed? Run: sudo apt install wmctrl")}}else D.warn("GameHandler","Wayland detected - fullscreen borderless has limited support. Window may not cover top bar.")}catch(r){D.error("GameHandler",`Failed to apply borderless mode: ${r.message}`)}}async checkAndExtractInstance(){let e=F.default.join(Y.app.getPath("userData"),"instances","default"),t=Y.app.getPath("userData");if(L.default.existsSync(F.default.join(e,"instance.cfg")))return console.log("Instance already exists, skipping extraction."),e;let r=F.default.join(t,"instance.zip");if(!L.default.existsSync(r)){console.log("instance.zip not found. Attempting to download from VPS...");let i=["https://craft.blocky.com.br/launcher-assets/instance.zip"];for(let n of i)try{console.log(`Trying to download instance.zip from ${n}...`);let c=await fetch(n,{signal:AbortSignal.timeout(6e4)});if(c.ok){let l=await c.arrayBuffer(),v=Buffer.from(l);if(v.length>=4&&v[0]===80&&v[1]===75){L.default.writeFileSync(r,v),console.log("instance.zip downloaded successfully from",n);break}else console.warn(`Downloaded content from ${n} is not a valid ZIP (got ${v.length} bytes, first bytes: ${v.slice(0,20).toString("hex")})`)}}catch(c){console.warn(`Failed to download instance.zip from ${n}:`,c)}}return L.default.existsSync(r)&&be(r)?(console.log("Extracting instance.zip..."),Bt(r,e),e):null}async downloadFile(e,t,r,i){this.sendProgress(i,`Baixando ${r}...`,0),L.default.mkdirSync(t,{recursive:!0});let n=F.default.join(t,r);try{if(L.default.existsSync(n))return n;let c=await fetch(e);if(!c.ok)throw new Error(`Failed to download ${e}: ${c.statusText}`);let l=Number(c.headers.get("content-length"))||0,v=(0,$t.createWriteStream)(n);if(!c.body)throw new Error("No body");let y=c.body.getReader(),I=0;for(;;){let{done:N,value:a}=await y.read();if(N)break;v.write(Buffer.from(a)),I+=a.length,l>0&&this.sendProgress(i,`Baixando ${r}`,Math.round(I/l*100))}await new Promise((N,a)=>{v.on("finish",N),v.on("error",a),v.end()});let b=L.default.statSync(n);if(r.endsWith(".jar")&&b.size<100)throw L.default.unlinkSync(n),new Error(`Downloaded file ${r} is too small (${b.size} bytes). Likely invalid.`);if(r.endsWith(".zip")&&!be(n)){let a=L.default.readFileSync(n).slice(0,20).toString("hex");throw L.default.unlinkSync(n),new Error(`Downloaded file ${r} is not a valid ZIP (first bytes: ${a}). Server may have returned an error page.`)}return n}catch(c){if(L.default.existsSync(n))try{L.default.unlinkSync(n)}catch{}throw new Error(`Download failed: ${c}`)}}async handleLaunch(e,t){console.log("Requesting game launch...",t),this.sendProgress(e.sender,"Verificando atualiza\xE7\xF5es...",2);let r=Date.now();if(this.lastUpdateCheck&&r-this.lastUpdateCheck.timestamp<this.UPDATE_CACHE_TTL)console.log("[GameHandler] Using cached update check result (TTL: 60s)");else try{let a=await this.updateManager.performAllUpdates((d,h)=>{let f=2+h/100*13;this.sendProgress(e.sender,d,Math.round(f))});this.lastUpdateCheck={result:a,timestamp:r},a.success||console.warn("Update check failed, continuing anyway:",a.error)}catch(a){console.warn("Update check failed, continuing anyway:",a)}let i=await this.checkAndExtractInstance(),n=!!i,c=i||this.gamePath,l=n?F.default.join(c,".minecraft"):c;L.default.existsSync(l)||L.default.mkdirSync(l,{recursive:!0});let v=this.lastUpdateCheck?.result?.remoteVersions?.instance?.version,y=F.default.join(l,".fabric","remappedJars");v&&v!==this.lastInstanceVersion?(L.default.existsSync(y)&&(console.log("[GameHandler] Instance version changed, clearing remappedJars cache..."),L.default.rmSync(y,{recursive:!0,force:!0})),this.lastInstanceVersion=v):console.log("[GameHandler] Preserving remappedJars cache (same instance version)");let I=F.default.join(l,"bin"),b=F.default.join(c,"natives"),N=F.default.join(c,"libraries");try{if(!t.username)throw new Error("Username required");this.sendProgress(e.sender,"Verificando Java...",5);try{this.javaPath=t.javaPath||await this.javaManager.ensureJava(e.sender)}catch(x){throw new Error("Falha ao configurar Java: "+x.message)}this.sendProgress(e.sender,"Verificando vers\xE3o...",65);let a=await this.getCachedVersionDetails(),d=a.downloads.client.url,h=await this.downloadFile(d,I,"minecraft.jar",e.sender);if(!n){this.sendProgress(e.sender,"Baixando bibliotecas...",70);let x="natives-linux";process.platform==="win32"?x="natives-windows":process.platform==="darwin"&&(x="natives-osx");for(let j of a.libraries)if(j.downloads&&j.downloads.classifiers&&j.downloads.classifiers[x]){let q=j.downloads.classifiers[x],ee=await this.downloadFile(q.url,F.default.join(c,"temp_natives"),F.default.basename(q.path),e.sender);be(ee)?new Fe.default(ee).extractAllTo(b,!0):console.warn(`[GameHandler] Skipping invalid native file: ${ee}`)}let _=F.default.join(b,process.platform==="win32"?"OpenAL-amd64.dll":"libopenal.so");if(!L.default.existsSync(_)){console.log("[GameHandler] OpenAL not found, downloading from Legacy Fabric..."),this.sendProgress(e.sender,"Baixando OpenAL...",72);let j="natives-linux";process.platform==="win32"?j="natives-windows":process.platform==="darwin"&&(j="natives-osx");let q=`https://repo.legacyfabric.net/repository/legacyfabric/org/lwjgl/lwjgl/lwjgl-platform/2.9.4+legacyfabric.9/lwjgl-platform-2.9.4+legacyfabric.9-${j}.jar`;try{let ee=await this.downloadFile(q,F.default.join(c,"temp_natives"),`lwjgl-platform-${j}.jar`,e.sender);be(ee)&&(new Fe.default(ee).extractAllTo(b,!0),console.log("[GameHandler] OpenAL natives extracted successfully"))}catch(ee){console.warn("[GameHandler] Failed to download OpenAL natives:",ee)}}}let f=[h],m="net.minecraft.client.Minecraft",p="";if(n){let x=F.default.join(i,"mmc-pack.json");if(L.default.existsSync(x)&&JSON.parse(L.default.readFileSync(x,"utf-8")).components.find(q=>q.uid==="net.fabricmc.fabric-loader")){this.sendProgress(e.sender,"Configurando Fabric/StationAPI...",75);let q=[{name:"asm:9.7.1",group:"org.ow2.asm",artifact:"asm",version:"9.7.1"},{name:"asm-analysis:9.7.1",group:"org.ow2.asm",artifact:"asm-analysis",version:"9.7.1"},{name:"asm-commons:9.7.1",group:"org.ow2.asm",artifact:"asm-commons",version:"9.7.1"},{name:"asm-tree:9.7.1",group:"org.ow2.asm",artifact:"asm-tree",version:"9.7.1"},{name:"asm-util:9.7.1",group:"org.ow2.asm",artifact:"asm-util",version:"9.7.1"},{name:"sponge-mixin:0.15.3+mixin.0.8.7",group:"net.fabricmc",artifact:"sponge-mixin",version:"0.15.3+mixin.0.8.7"},{name:"mixinextras-fabric:0.4.1",group:"io.github.llamalad7",artifact:"mixinextras-fabric",version:"0.4.1"},{name:"commons-lang3:3.12.0",group:"org.apache.commons",artifact:"commons-lang3",version:"3.12.0"},{name:"commons-io:2.11.0",group:"commons-io",artifact:"commons-io",version:"2.11.0"},{name:"commons-codec:1.15",group:"commons-codec",artifact:"commons-codec",version:"1.15"},{name:"jutils:1.0.0",group:"net.java.jutils",artifact:"jutils",version:"1.0.0"},{name:"jinput:2.0.5",group:"net.java.jinput",artifact:"jinput",version:"2.0.5"},{name:"lwjgl:2.9.4+legacyfabric.9",group:"org.lwjgl.lwjgl",artifact:"lwjgl",version:"2.9.4+legacyfabric.9"},{name:"lwjgl_util:2.9.4+legacyfabric.9",group:"org.lwjgl.lwjgl",artifact:"lwjgl_util",version:"2.9.4+legacyfabric.9"},{name:"log4j-api:2.16.0",group:"org.apache.logging.log4j",artifact:"log4j-api",version:"2.16.0"},{name:"log4j-core:2.16.0",group:"org.apache.logging.log4j",artifact:"log4j-core",version:"2.16.0"},{name:"log4j-slf4j18-impl:2.16.0",group:"org.apache.logging.log4j",artifact:"log4j-slf4j18-impl",version:"2.16.0"},{name:"terminalconsoleappender:1.2.0",group:"net.minecrell",artifact:"terminalconsoleappender",version:"1.2.0"},{name:"slf4j-api:1.8.0-beta4",group:"org.slf4j",artifact:"slf4j-api",version:"1.8.0-beta4"},{name:"guava:31.0.1-jre",group:"com.google.guava",artifact:"guava",version:"31.0.1-jre"},{name:"failureaccess:1.0.1",group:"com.google.guava",artifact:"failureaccess",version:"1.0.1"},{name:"gson:2.8.9",group:"com.google.code.gson",artifact:"gson",version:"2.8.9"},{name:"log4j-config:1.0.0",group:"babric",artifact:"log4j-config",version:"1.0.0"}],ee="https://maven.fabricmc.net/",De="https://repo1.maven.org/maven2/",qe="https://repo.legacyfabric.net/repository/legacyfabric/",Zt="https://maven.glass-launcher.net/babric/";console.log("[GameHandler] Using Maven-based library downloads"),L.default.existsSync(N)||L.default.mkdirSync(N,{recursive:!0});for(let T of q){let de=`${T.group.replace(/\./g,"/")}/${T.artifact}/${T.version}/${T.artifact}-${T.version}.jar`,Z=F.default.join(N,`${T.artifact}-${T.version}.jar`);if(L.default.existsSync(Z)){f.push(Z);continue}let Q=ee+de;["org.apache","commons-io","commons-codec","net.java.jutils","net.java.jinput","org.ow2.asm","com.google.guava","com.google.code.gson","org.slf4j","io.github.llamalad7","net.minecrell"].some(Ie=>T.group.startsWith(Ie)||T.group===Ie)?Q=De+de:T.group.startsWith("org.lwjgl")?Q=qe+de:T.group==="babric"&&(Q=Zt+de);let he=await this.downloadFile(Q,N,`${T.artifact}-${T.version}.jar`,e.sender);f.push(he)}this.sendProgress(e.sender,"Baixando nativos...",78);let Jt=process.platform==="linux"?["liblwjgl-linux-amd64.so","libopenal-amd64.so","libjinput-linux64.so"]:process.platform==="win32"?["lwjgl64.dll","OpenAL64.dll"]:["liblwjgl.dylib","libopenal.dylib"];if(L.default.existsSync(b)&&Jt.every(T=>L.default.existsSync(F.default.join(b,T))))console.log("[GameHandler] Natives already present, skipping extraction");else{L.default.existsSync(b)&&(console.log("[GameHandler] Natives incomplete, clearing for fresh extraction..."),L.default.rmSync(b,{recursive:!0,force:!0})),L.default.mkdirSync(b,{recursive:!0});let T="natives-linux";process.platform==="win32"?T="natives-windows":process.platform==="darwin"&&(T="natives-osx");let de=[{group:"org.lwjgl.lwjgl",artifact:"lwjgl-platform",version:"2.9.4+legacyfabric.9",classifier:T},{group:"net.java.jinput",artifact:"jinput-platform",version:"2.0.5",classifier:T}];for(let Z of de){let Q=`${Z.artifact}-${Z.version}-${Z.classifier}.jar`,ue=`${Z.group.replace(/\./g,"/")}/${Z.artifact}/${Z.version}/${Q}`,ae=F.default.join(N,Q);if(L.default.existsSync(ae)){console.log(`[Cache] Found native library locally: ${Q}`),await Mt(ae,b);continue}let he=qe+ue;Z.group==="net.java.jinput"&&(he=De+ue);let Ie=await this.downloadFile(he,F.default.join(c,"temp_natives"),Q,e.sender);await Mt(Ie,b)}if(process.platform==="darwin")try{let Z=L.default.readdirSync(b);for(let Q of Z)if(Q.endsWith(".jnilib")){let ue=F.default.join(b,Q),ae=F.default.join(b,Q.replace(".jnilib",".dylib"));if(L.default.existsSync(ue)){console.log(`[GameHandler] Renaming ${Q} to .dylib`);try{L.default.existsSync(ae)&&L.default.unlinkSync(ae),L.default.renameSync(ue,ae)}catch(he){console.warn(`[GameHandler] Failed to rename ${Q}:`,he)}}}}catch(Z){console.warn("[GameHandler] Failed to process macOS natives:",Z)}try{let Z=L.default.readdirSync(b);console.log(`[GameHandler] Natives folder contents (${b}):`,Z)}catch(Z){console.error("[GameHandler] Failed to read natives folder:",Z)}}let Xt=await this.downloadFile("https://maven.fabricmc.net/net/fabricmc/fabric-loader/0.16.7/fabric-loader-0.16.7.jar",N,"fabric-loader-0.16.7.jar",e.sender),qt=await this.downloadFile("https://maven.glass-launcher.net/babric/babric/intermediary-upstream/b1.7.3/intermediary-upstream-b1.7.3.jar",N,"intermediary-upstream-b1.7.3.jar",e.sender);f.push(Xt),f.push(qt),m="net.fabricmc.loader.impl.launch.knot.KnotClient";let He=[];for(let T of f)T!==h&&He.push(T);He.push(h),f=He}}if(!n){for(let x of a.libraries)if(x.downloads&&x.downloads.artifact){let _=x.downloads.artifact;if(_.path.includes("lwjgl")||_.path.includes("jinput")){let j=await this.downloadFile(_.url,I,F.default.basename(_.path),e.sender);f.push(j)}}}this.sendProgress(e.sender,"Iniciando Jogo...",95);let o=t.settings?.minMemory||"512",u=t.settings?.maxMemory||"2048",g=t.settings?.javaArgs||"",S="";try{if(L.default.existsSync(b)){let x=L.default.readdirSync(b),_=process.platform==="win32"?["OpenAL64.dll","OpenAL32.dll","OpenAL-amd64.dll","OpenAL-i386.dll","OpenAL.dll"]:process.platform==="darwin"?["libopenal.dylib","openal.dylib"]:["libopenal.so","libopenal-amd64.so","libopenal-i386.so"];for(let j of _)if(x.includes(j)){S=F.default.join(b,j),console.log(`[GameHandler] Found OpenAL library: ${S}`);break}if(!S){let j=x.find(q=>q.toLowerCase().includes("openal")&&(q.endsWith(".dll")||q.endsWith(".so")||q.endsWith(".dylib")));j&&(S=F.default.join(b,j),console.log(`[GameHandler] Found OpenAL library (fallback): ${S}`))}}}catch(x){console.warn("[GameHandler] Failed to scan for OpenAL lib:",x)}let E=F.default.join(l,"resources"),C=[`-Xms${o}M`,`-Xmx${u}M`,"-Djava.library.path="+b,"-Dfabric.gameJarPath="+h,"-Dfabric.gameVersion=b1.7.3","-Dfabric.envType=client","-Dslf4j.internal.verbosity=ERROR","-Dminecraft.resources.index="+E,"-Dminecraft.applet.TargetDirectory="+l,"-Dminecraft.applet.BaseURL=file:///"];if(g.trim()){let x=g.trim().split(/\s+/).filter(_=>_.length>0);C.push(...x)}if(t.settings?.borderlessMode&&(console.log("[GameHandler] Borderless mode enabled - adding LWJGL undecorated flag"),C.push("-Dorg.lwjgl.opengl.Window.undecorated=true")),C.push("-cp",f.join(F.default.delimiter)),C.push(m),C.push("--username",t.username),C.push("--gameDir",l),C.push("--assetsDir",F.default.join(l,"resources")),n&&m.includes("KnotClient")&&C.push("--assetIndex","truly_legacy"),t.settings?.borderlessMode)try{let x=Y.screen.getPrimaryDisplay(),{width:_,height:j}=x.size;console.log(`[GameHandler] Borderless mode: setting window size to ${_}x${j}`),C.push("--width",_.toString()),C.push("--height",j.toString())}catch(x){console.warn("[GameHandler] Failed to get screen size for borderless mode:",x),C.push("--width","1920"),C.push("--height","1080")}C.push("--server","185.100.215.195"),C.push("--port","25565"),console.log("Spawning java:",this.javaPath),console.log("Args:",C);let U={...process.env};if(process.platform==="linux"&&(U.ALSOFT_CONF="period_size=2048",U.ALSOFT_DRIVERS="pulse,alsa,oss"),process.platform==="win32"){let x=Object.keys(U).find(_=>_.toLowerCase()==="path")||"Path";U[x]=b+F.default.delimiter+(U[x]||""),console.log("[GameHandler] Updated PATH with natives:",b)}this.gameProcess=(0,Ae.spawn)(this.javaPath,C,{cwd:l,env:U});let V=Pe();V&&V.setGameRunning(!0),t.settings?.borderlessMode&&this.applyBorderlessPostSpawn().catch(x=>{D.error("GameHandler",`Borderless post-spawn failed: ${x.message}`)});let P=["s3.amazonaws.com/MinecraftResources","Failed to add pack.mcmeta","Failed to add READ_ME_I_AM_VERY_IMPORTANT"];return this.gameProcess.stdout.on("data",x=>{let _=x.toString().trim();_&&(D.game("stdout",_),!P.some(j=>_.includes(j))&&(console.log(`[MC]: ${_}`),_.includes("Connecting to")&&e.sender.send("game-connected")))}),this.gameProcess.stderr.on("data",x=>{let _=x.toString().trim();_&&(D.game("stderr",_),!P.some(j=>_.includes(j))&&console.error(`[MC-Err]: ${_}`))}),this.gameProcess.on("close",x=>{D.info("GameHandler",`Minecraft exited with code ${x}`),console.log(`Minecraft exited with code ${x}`),this.sendProgress(e.sender,"Jogo fechado",100),this.gameProcess=null,e.sender.send("game-closed",x);let _=Pe();_&&_.setGameRunning(!1)}),{success:!0}}catch(a){return console.error("Launch failed:",a),this.sendProgress(e.sender,`Erro: ${a.message}`,0),{success:!1,error:a.message,stack:a.stack}}}async handleUpdateCheck(){try{let e=await this.updateManager.checkForUpdates();return e.remoteVersions?e.instanceUpdate||e.librariesUpdate||e.modsUpdate||e.launcherUpdate?{available:!0,launcherUpdate:e.launcherUpdate,launcherDownloadUrl:e.launcherDownloadUrl,instanceUpdate:e.instanceUpdate,librariesUpdate:e.librariesUpdate,modsUpdate:e.modsUpdate,notes:e.remoteVersions.mods?.notes||"Atualiza\xE7\xF5es dispon\xEDveis"}:{available:!1}:{available:!1,error:"Failed to fetch version info"}}catch(e){return console.error("Update check failed:",e),{available:!1,error:String(e)}}}async handlePerformUpdate(e){try{return await this.updateManager.performAllUpdates((r,i)=>{this.sendProgress(e.sender,r,i)})}catch(t){return console.error("Update failed:",t),this.sendProgress(e.sender,`Erro na atualiza\xE7\xE3o: ${t}`,0),{success:!1,error:String(t)}}}};var Se=require("electron"),te=G(require("fs"),1),re=G(require("path"),1),Vt=G(we(),1);var Re=class{userDataPath;activeModsDir="";constructor(){this.userDataPath=Se.app.getPath("userData")}init(){Se.ipcMain.handle("get-mods",async()=>(D.info("ModHandler","Fetching mods list..."),this.getMods())),Se.ipcMain.handle("toggle-mod",async(e,{fileName:t,enable:r})=>(D.info("ModHandler",`Toggling mod ${t} to ${r}`),this.toggleMod(t,r)))}async toggleMod(e,t){if(!this.activeModsDir){let i="Cannot toggle mod: No active mods directory found.";return D.error("ModHandler",i),{success:!1,error:i}}let r=re.default.join(this.activeModsDir,"disabled");if(!te.default.existsSync(r))try{await te.default.promises.mkdir(r,{recursive:!0})}catch(i){let n=`Failed to create disabled directory: ${i.message}`;return D.error("ModHandler",n),{success:!1,error:n}}try{if(t){let i=re.default.join(r,e),n=re.default.join(this.activeModsDir,e);if(te.default.existsSync(i)){if(te.default.existsSync(n)){let l=`Destination file already exists: ${n}`;return D.warn("ModHandler",l),{success:!1,error:l}}return await this.moveFile(i,n)?(D.info("ModHandler",`Enabled mod: Moved ${e} to active folder`),{success:!0}):{success:!1,error:"Move operation failed (check logs)"}}else{let c=`Cannot enable: File not found in disabled folder: ${i}`;return D.warn("ModHandler",c),{success:!1,error:c}}}else{let i=re.default.join(this.activeModsDir,e),n=re.default.join(r,e);if(te.default.existsSync(i))return await this.moveFile(i,n)?(D.info("ModHandler",`Disabled mod: Moved ${e} to disabled folder`),{success:!0}):{success:!1,error:"Move operation failed (check logs)"};{let c=`Cannot disable: File not found in active folder: ${i}`;return D.warn("ModHandler",c),{success:!1,error:c}}}}catch(i){return D.error("ModHandler",`Failed to toggle mod ${e}: ${i.message}`),{success:!1,error:i.message}}}async moveFile(e,t){try{return await te.default.promises.rename(e,t),!0}catch(r){D.warn("ModHandler",`Rename failed for ${re.default.basename(e)}, trying copy+unlink: ${r}`);try{return await te.default.promises.copyFile(e,t),await te.default.promises.unlink(e),!0}catch(i){return D.error("ModHandler",`Move failed completely for ${re.default.basename(e)}: ${i}`),!1}}}async getMods(){let e=[re.default.join(this.userDataPath,"instances","default",".minecraft","mods"),re.default.join(this.userDataPath,"instances","default","mods"),re.default.join(this.userDataPath,"gamedata","mods")],t="";for(let c of e)if(te.default.existsSync(c)){t=c,D.info("ModHandler",`Found mods directory at: ${t}`);break}if(!t)return D.warn("ModHandler","No valid mods directory found in standard locations."),[];this.activeModsDir=t;let r=re.default.join(t,"disabled"),i=[],n=async(c,l)=>{if(te.default.existsSync(c))try{let v=await te.default.promises.readdir(c);for(let y of v){if(!y.endsWith(".jar"))continue;let I=re.default.join(c,y);if((await te.default.promises.stat(I)).isDirectory())continue;let N={fileName:y,enabled:l,name:y,description:"",version:""};try{let d=new Vt.default(I).getEntries(),h=d.find(p=>p.entryName==="fabric.mod.json"),f=d.find(p=>p.entryName==="mod.json"),m=h||f;if(m){let p=m.getData().toString("utf8"),o=JSON.parse(p);o.name&&(N.name=o.name),o.description&&(N.description=o.description),o.version&&(N.version=o.version)}}catch(a){D.warn("ModHandler",`Could not read metadata for ${y}: ${a}`)}i.push(N)}}catch(v){D.error("ModHandler",`Error scanning directory ${c}: ${v}`)}};return await n(t,!0),await n(r,!1),i.sort((c,l)=>c.enabled===l.enabled?c.name.localeCompare(l.name):c.enabled?-1:1)}};var z=require("electron");var zt=G(require("path"),1),Te=G(require("fs"),1),Je=["F6","Shift+Tab","CommandOrControl+Tab"],Me=class{overlayWindow=null;browserView=null;isVisible=!1;isGameRunning=!1;hotkeyRegistered=!1;configPath="";OVERLAY_URL="https://craft.blocky.com.br";HEADER_HEIGHT=48;init(){D.info("OverlayHandler","Initializing overlay handler"),this.configPath=zt.default.join(z.app.getPath("userData"),"overlay-config.json"),this.registerHotkey(),this.setupIPC()}setupIPC(){z.ipcMain.on("overlay-go-back",()=>{this.browserView&&!this.browserView.webContents.isDestroyed()&&this.browserView.webContents.canGoBack()&&(this.browserView.webContents.goBack(),D.info("OverlayHandler","Navigated back"))}),z.ipcMain.on("overlay-go-home",()=>{this.browserView&&!this.browserView.webContents.isDestroyed()&&(this.browserView.webContents.loadURL(this.OVERLAY_URL),D.info("OverlayHandler","Navigated to home"))}),z.ipcMain.on("overlay-close",()=>{this.hideOverlay(),D.info("OverlayHandler","Closed via IPC")}),z.ipcMain.handle("get-overlay-hotkey",()=>this.getHotkey()),z.ipcMain.handle("set-overlay-hotkey",(e,t)=>this.setHotkey(t)),z.ipcMain.handle("get-available-hotkeys",()=>this.getAvailableHotkeys())}registeredHotkey=null;getDefaultHotkey(){return process.platform==="linux"?"F6":"Shift+Tab"}loadSavedHotkey(){try{if(Te.default.existsSync(this.configPath)){let e=JSON.parse(Te.default.readFileSync(this.configPath,"utf-8"));if(e.hotkey&&Je.includes(e.hotkey))return e.hotkey}}catch{D.warn("OverlayHandler","Failed to load hotkey config, using default")}return this.getDefaultHotkey()}saveHotkeyConfig(e){try{Te.default.writeFileSync(this.configPath,JSON.stringify({hotkey:e},null,2)),D.info("OverlayHandler",`Saved hotkey config: ${e}`)}catch{D.error("OverlayHandler","Failed to save hotkey config")}}registerHotkey(){let e=this.loadSavedHotkey();this.tryRegisterHotkey(e)}tryRegisterHotkey(e){try{return z.globalShortcut.isRegistered(e)?(D.warn("OverlayHandler",`Hotkey ${e} is already registered by another application`),!1):z.globalShortcut.register(e,()=>{D.info("OverlayHandler",`${e} pressed`),this.toggleOverlay()})?(this.registeredHotkey=e,this.hotkeyRegistered=!0,D.info("OverlayHandler",`Overlay hotkey registered: ${e}`),!0):(D.warn("OverlayHandler",`Failed to register hotkey: ${e}`),!1)}catch(t){return D.error("OverlayHandler",`Exception registering ${e}: ${t.message}`),!1}}getHotkey(){return this.registeredHotkey||this.getDefaultHotkey()}setHotkey(e){if(!Je.includes(e))return{success:!1,error:`Invalid hotkey: ${e}`};if(this.registeredHotkey&&this.hotkeyRegistered&&(z.globalShortcut.unregister(this.registeredHotkey),this.hotkeyRegistered=!1,this.registeredHotkey=null),this.tryRegisterHotkey(e))return this.saveHotkeyConfig(e),{success:!0};{let t=this.getDefaultHotkey();return t!==e&&this.tryRegisterHotkey(t),{success:!1,error:`Failed to register hotkey: ${e}. It may be in use by another application.`}}}getAvailableHotkeys(){return[...Je]}cleanup(){this.hotkeyRegistered&&this.registeredHotkey&&(z.globalShortcut.unregister(this.registeredHotkey),this.hotkeyRegistered=!1,this.registeredHotkey=null,D.info("OverlayHandler","Hotkey unregistered")),this.overlayWindow&&!this.overlayWindow.isDestroyed()&&(this.overlayWindow.setBrowserView(null),this.browserView&&!this.browserView.webContents.isDestroyed()&&this.browserView.webContents.destroy(),this.overlayWindow.destroy(),this.overlayWindow=null,this.browserView=null)}createOverlayWindow(){if(this.overlayWindow&&!this.overlayWindow.isDestroyed()){D.info("OverlayHandler","Overlay window already exists");return}let e=z.screen.getPrimaryDisplay(),{width:t,height:r}=e.size,i=Math.min(Math.floor(t*.85),1400),n=Math.min(Math.floor(r*.85),900),c=Math.floor((t-i)/2),l=Math.floor((r-n)/2);D.info("OverlayHandler",`Creating overlay: ${i}x${n} at (${c}, ${l})`),this.overlayWindow=new z.BrowserWindow({width:i,height:n,x:c,y:l,frame:!1,transparent:!1,alwaysOnTop:!0,skipTaskbar:!0,show:!1,resizable:!1,movable:!1,focusable:!0,hasShadow:!0,backgroundColor:"#1e1e1e",webPreferences:{nodeIntegration:!0,contextIsolation:!1,sandbox:!1}});let v=`
<!DOCTYPE html>
<html>
<head>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { margin: 0; overflow: hidden; background: #1e1e1e; font-family: 'Inter', system-ui, -apple-system, sans-serif; }
        #blockycraft-nav-bar {
            height: ${this.HEADER_HEIGHT}px;
            background: #1e1e1e;
            border-bottom: 1px solid #333333;
            display: flex;
            align-items: center;
            padding: 0 16px;
            gap: 8px;
            color: white;
            user-select: none;
        }
        #blockycraft-nav-bar button {
            background: #2a2a2a;
            border: 1px solid #333333;
            color: #ffffff;
            width: 36px;
            height: 36px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        #blockycraft-nav-bar button:hover {
            background: #333333;
            border-color: #444444;
        }
        #blockycraft-nav-bar button svg {
            width: 20px;
            height: 20px;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
            fill: none;
        }
        #blockycraft-nav-bar .nav-title {
            color: #a1a1aa;
            font-size: 13px;
            margin-left: auto;
            font-weight: 500;
        }
        #blockycraft-nav-bar .close-btn {
            background: transparent;
            border-color: transparent;
            color: #ffffff;
            margin-left: 8px;
        }
        #blockycraft-nav-bar .close-btn:hover {
            background: #ef4444;
            border-color: #ef4444;
            color: #ffffff;
        }
    </style>
</head>
<body>
    <div id="blockycraft-nav-bar">
        <button id="bc-back-btn" title="Voltar" onclick="window.overlayAPI.goBack()">
            <svg viewBox="0 0 24 24"><path d="m15 18-6-6 6-6"/></svg>
        </button>
        <button id="bc-home-btn" title="In\xEDcio" onclick="window.overlayAPI.goHome()">
            <svg viewBox="0 0 24 24"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        </button>
        <span class="nav-title">BlockyCRAFT Overlay</span>
        <button class="close-btn" id="bc-close-btn" title="Fechar (Shift+Tab)" onclick="window.overlayAPI.close()">
            <svg viewBox="0 0 24 24"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
        </button>
    </div>
    <script>
        const { ipcRenderer } = require('electron');
        window.overlayAPI = {
            goBack: () => ipcRenderer.send('overlay-go-back'),
            goHome: () => ipcRenderer.send('overlay-go-home'),
            close: () => ipcRenderer.send('overlay-close')
        };
    </script>
</body>
</html>`;this.overlayWindow.loadURL(`data:text/html;charset=utf-8,${encodeURIComponent(v)}`),this.browserView=new z.BrowserView({webPreferences:{nodeIntegration:!1,contextIsolation:!0,sandbox:process.platform!=="linux"}}),this.overlayWindow.setBrowserView(this.browserView),this.browserView.setBounds({x:0,y:this.HEADER_HEIGHT,width:i,height:n-this.HEADER_HEIGHT}),this.browserView.setAutoResize({width:!0,height:!0}),this.browserView.webContents.on("did-start-loading",()=>{D.info("OverlayHandler","Browser started loading")}),this.browserView.webContents.on("did-fail-load",(y,I,b)=>{D.error("OverlayHandler",`Failed to load: ${I} - ${b}`)}),this.browserView.webContents.setWindowOpenHandler(({url:y})=>(D.info("OverlayHandler",`Intercepted new window request: ${y}`),this.browserView&&!this.browserView.webContents.isDestroyed()&&this.browserView.webContents.loadURL(y),{action:"deny"})),this.browserView.webContents.on("before-input-event",(y,I)=>{I.key==="Escape"&&I.type==="keyDown"&&this.hideOverlay()}),this.overlayWindow.webContents.on("before-input-event",(y,I)=>{I.key==="Escape"&&I.type==="keyDown"&&this.hideOverlay()}),D.info("OverlayHandler",`Loading URL: ${this.OVERLAY_URL}`),this.browserView.webContents.loadURL(this.OVERLAY_URL),this.overlayWindow.on("close",y=>{this.overlayWindow&&!this.overlayWindow.isDestroyed()&&(y.preventDefault(),this.hideOverlay())}),D.info("OverlayHandler","Overlay window created with BrowserView")}toggleOverlay(){if(!this.isGameRunning){D.info("OverlayHandler","Game not running - overlay disabled");return}this.isVisible?this.hideOverlay():this.showOverlay()}showOverlay(){(!this.overlayWindow||this.overlayWindow.isDestroyed())&&(D.info("OverlayHandler","Creating overlay window on first use..."),this.createOverlayWindow()),this.overlayWindow&&(this.overlayWindow.show(),this.overlayWindow.focus(),this.overlayWindow.setAlwaysOnTop(!0,"screen-saver"),this.isVisible=!0,D.info("OverlayHandler","Overlay shown"))}hideOverlay(){this.overlayWindow&&!this.overlayWindow.isDestroyed()&&(this.overlayWindow.hide(),this.isVisible=!1,D.info("OverlayHandler","Overlay hidden"))}setGameRunning(e){this.isGameRunning=e,D.info("OverlayHandler",`Game running state: ${e}`),!e&&this.isVisible&&this.hideOverlay()}isGameActive(){return this.isGameRunning}isOverlayVisible(){return this.isVisible}};X.app.commandLine.appendSwitch("no-sandbox");X.app.commandLine.appendSwitch("ozone-platform-hint","auto");var Or=new je;Or.init();var Ur=new Re;Ur.init();var fe=null;function Pe(){return fe}console.log("=== BlockyCRAFT Launcher Starting ===");console.log("Electron version:",process.versions.electron);var ie=null,Gt=process.env.VITE_DEV_SERVER_URL;function Wt(){if(console.log("Creating main window..."),ie=new X.BrowserWindow({width:900,height:600,minWidth:800,minHeight:500,frame:!0,resizable:!0,webPreferences:{nodeIntegration:!1,contextIsolation:!0,preload:Xe.default.join(__dirname,"preload.cjs"),sandbox:!1},backgroundColor:"#0f0f0f",show:!0,autoHideMenuBar:!0}),ie.setMenu(null),X.ipcMain.handle("open-external",async(s,e)=>{console.log("Opening external URL:",e);try{let{shell:t}=await import("electron");await t.openExternal(e)}catch(t){console.error("Failed to open external URL:",t)}}),X.ipcMain.handle("fetch-url",async(s,e)=>{D.info("Main",`Proxying fetch request to: ${e}`);let{net:t}=await import("electron");try{let r=await t.fetch(e);if(!r.ok)throw new Error(`HTTP ${r.status} ${r.statusText}`);return{success:!0,data:await r.text()}}catch(r){return D.error("Main",`Fetch failed for ${e}: ${r.message}`),{success:!1,error:r.message}}}),console.log("Window created, loading content..."),Gt)ie.loadURL(Gt);else{let s=Xe.default.join(__dirname,"../dist/index.html");ie.loadFile(s)}ie.webContents.on("did-finish-load",()=>{console.log("Create Window: did-finish-load")}),ie.webContents.on("did-fail-load",(s,e,t,r)=>{console.error("Create Window: did-fail-load",e,t,r)}),ie.webContents.on("render-process-gone",(s,e)=>{console.error("Create Window: render-process-gone",e)}),ie.webContents.on("unresponsive",()=>{console.error("Create Window: unresponsive")}),ie.on("closed",()=>{fe&&fe.cleanup(),ie=null,X.app.quit()})}X.app.whenReady().then(()=>{D.init(),D.info("Main",`Electron version: ${process.versions.electron}`),D.info("Main",`Node version: ${process.versions.node}`),D.info("Main",`Platform: ${process.platform} ${process.arch}`),fe=new Me,fe.init(),Wt()});X.app.on("will-quit",()=>{fe&&fe.cleanup(),X.globalShortcut.unregisterAll()});X.app.on("window-all-closed",()=>{process.platform!=="darwin"&&X.app.quit()});X.app.on("activate",()=>{X.BrowserWindow.getAllWindows().length===0&&Wt()});0&&(module.exports={getOverlayHandler});
