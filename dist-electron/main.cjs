var qt=Object.create;var Se=Object.defineProperty;var Kt=Object.getOwnPropertyDescriptor;var Yt=Object.getOwnPropertyNames;var Qt=Object.getPrototypeOf,er=Object.prototype.hasOwnProperty;var J=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports),tr=(i,e)=>{for(var t in e)Se(i,t,{get:e[t],enumerable:!0})},Xe=(i,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Yt(e))!er.call(i,s)&&s!==t&&Se(i,s,{get:()=>e[s],enumerable:!(r=Kt(e,s))||r.enumerable});return i};var Z=(i,e,t)=>(t=i!=null?qt(Qt(i)):{},Xe(e||!i||!i.__esModule?Se(t,"default",{value:i,enumerable:!0}):t,i)),rr=i=>Xe(Se({},"__esModule",{value:!0}),i);var He=J((Tr,Ke)=>{Ke.exports={LOCHDR:30,LOCSIG:67324752,LOCVER:4,LOCFLG:6,LOCHOW:8,LOCTIM:10,LOCCRC:14,LOCSIZ:18,LOCLEN:22,LOCNAM:26,LOCEXT:28,EXTSIG:134695760,EXTHDR:16,EXTCRC:4,EXTSIZ:8,EXTLEN:12,CENHDR:46,CENSIG:33639248,CENVEM:4,CENVER:6,CENFLG:8,CENHOW:10,CENTIM:12,CENCRC:16,CENSIZ:20,CENLEN:24,CENNAM:28,CENEXT:30,CENCOM:32,CENDSK:34,CENATT:36,CENATX:38,CENOFF:42,ENDHDR:22,ENDSIG:101010256,ENDSUB:8,ENDTOT:10,ENDSIZ:12,ENDOFF:16,ENDCOM:20,END64HDR:20,END64SIG:117853008,END64START:4,END64OFF:8,END64NUMDISKS:16,ZIP64SIG:101075792,ZIP64HDR:56,ZIP64LEAD:12,ZIP64SIZE:4,ZIP64VEM:12,ZIP64VER:14,ZIP64DSK:16,ZIP64DSKDIR:20,ZIP64SUB:24,ZIP64TOT:32,ZIP64SIZB:40,ZIP64OFF:48,ZIP64EXTRA:56,STORED:0,SHRUNK:1,REDUCED1:2,REDUCED2:3,REDUCED3:4,REDUCED4:5,IMPLODED:6,DEFLATED:8,ENHANCED_DEFLATED:9,PKWARE:10,BZIP2:12,LZMA:14,IBM_TERSE:18,IBM_LZ77:19,AES_ENCRYPT:99,FLG_ENC:1,FLG_COMP1:2,FLG_COMP2:4,FLG_DESC:8,FLG_ENH:16,FLG_PATCH:32,FLG_STR:64,FLG_EFS:2048,FLG_MSK:4096,FILE:2,BUFFER:1,NONE:0,EF_ID:0,EF_SIZE:2,ID_ZIP64:1,ID_AVINFO:7,ID_PFS:8,ID_OS2:9,ID_NTFS:10,ID_OPENVMS:12,ID_UNIX:13,ID_FORK:14,ID_PATCH:15,ID_X509_PKCS7:20,ID_X509_CERTID_F:21,ID_X509_CERTID_C:22,ID_STRONGENC:23,ID_RECORD_MGT:24,ID_X509_PKCS7_RL:25,ID_IBM1:101,ID_IBM2:102,ID_POSZIP:18064,EF_ZIP64_OR_32:4294967295,EF_ZIP64_OR_16:65535,EF_ZIP64_SUNCOMP:0,EF_ZIP64_SCOMP:8,EF_ZIP64_RHO:16,EF_ZIP64_DSN:24}});var Ie=J(Qe=>{var Ye={INVALID_LOC:"Invalid LOC header (bad signature)",INVALID_CEN:"Invalid CEN header (bad signature)",INVALID_END:"Invalid END header (bad signature)",DESCRIPTOR_NOT_EXIST:"No descriptor present",DESCRIPTOR_UNKNOWN:"Unknown descriptor format",DESCRIPTOR_FAULTY:"Descriptor data is malformed",NO_DATA:"Nothing to decompress",BAD_CRC:"CRC32 checksum failed {0}",FILE_IN_THE_WAY:"There is a file in the way: {0}",UNKNOWN_METHOD:"Invalid/unsupported compression method",AVAIL_DATA:"inflate::Available inflate data did not terminate",INVALID_DISTANCE:"inflate::Invalid literal/length or distance code in fixed or dynamic block",TO_MANY_CODES:"inflate::Dynamic block code description: too many length or distance codes",INVALID_REPEAT_LEN:"inflate::Dynamic block code description: repeat more than specified lengths",INVALID_REPEAT_FIRST:"inflate::Dynamic block code description: repeat lengths with no first length",INCOMPLETE_CODES:"inflate::Dynamic block code description: code lengths codes incomplete",INVALID_DYN_DISTANCE:"inflate::Dynamic block code description: invalid distance code lengths",INVALID_CODES_LEN:"inflate::Dynamic block code description: invalid literal/length code lengths",INVALID_STORE_BLOCK:"inflate::Stored block length did not match one's complement",INVALID_BLOCK_TYPE:"inflate::Invalid block type (type == 3)",CANT_EXTRACT_FILE:"Could not extract the file",CANT_OVERRIDE:"Target file already exists",DISK_ENTRY_TOO_LARGE:"Number of disk entries is too large",NO_ZIP:"No zip file was loaded",NO_ENTRY:"Entry doesn't exist",DIRECTORY_CONTENT_ERROR:"A directory cannot have content",FILE_NOT_FOUND:'File not found: "{0}"',NOT_IMPLEMENTED:"Not implemented",INVALID_FILENAME:"Invalid filename",INVALID_FORMAT:"Invalid or unsupported zip format. No END header found",INVALID_PASS_PARAM:"Incompatible password parameter",WRONG_PASSWORD:"Wrong Password",COMMENT_TOO_LONG:"Comment is too long",EXTRA_FIELD_PARSE_ERROR:"Extra field parsing error"};function nr(i){return function(...e){return e.length&&(i=i.replace(/\{(\d)\}/g,(t,r)=>e[r]||"")),new Error("ADM-ZIP: "+i)}}for(let i of Object.keys(Ye))Qe[i]=nr(Ye[i])});var ot=J((Hr,nt)=>{var or=require("fs"),z=require("path"),et=He(),ir=Ie(),sr=typeof process=="object"&&process.platform==="win32",tt=i=>typeof i=="object"&&i!==null,rt=new Uint32Array(256).map((i,e)=>{for(let t=0;t<8;t++)(e&1)!==0?e=3988292384^e>>>1:e>>>=1;return e>>>0});function B(i){this.sep=z.sep,this.fs=or,tt(i)&&tt(i.fs)&&typeof i.fs.statSync=="function"&&(this.fs=i.fs)}nt.exports=B;B.prototype.makeDir=function(i){let e=this;function t(r){let s=r.split(e.sep)[0];r.split(e.sep).forEach(function(n){if(!(!n||n.substr(-1,1)===":")){s+=e.sep+n;var c;try{c=e.fs.statSync(s)}catch{e.fs.mkdirSync(s)}if(c&&c.isFile())throw ir.FILE_IN_THE_WAY(`"${s}"`)}})}t(i)};B.prototype.writeFileTo=function(i,e,t,r){let s=this;if(s.fs.existsSync(i)){if(!t)return!1;var n=s.fs.statSync(i);if(n.isDirectory())return!1}var c=z.dirname(i);s.fs.existsSync(c)||s.makeDir(c);var h;try{h=s.fs.openSync(i,"w",438)}catch{s.fs.chmodSync(i,438),h=s.fs.openSync(i,"w",438)}if(h)try{s.fs.writeSync(h,e,0,e.length,0)}finally{s.fs.closeSync(h)}return s.fs.chmodSync(i,r||438),!0};B.prototype.writeFileToAsync=function(i,e,t,r,s){typeof r=="function"&&(s=r,r=void 0);let n=this;n.fs.exists(i,function(c){if(c&&!t)return s(!1);n.fs.stat(i,function(h,v){if(c&&v.isDirectory())return s(!1);var p=z.dirname(i);n.fs.exists(p,function(D){D||n.makeDir(p),n.fs.open(i,"w",438,function(L,x){L?n.fs.chmod(i,438,function(){n.fs.open(i,"w",438,function(a,l){n.fs.write(l,e,0,e.length,0,function(){n.fs.close(l,function(){n.fs.chmod(i,r||438,function(){s(!0)})})})})}):x?n.fs.write(x,e,0,e.length,0,function(){n.fs.close(x,function(){n.fs.chmod(i,r||438,function(){s(!0)})})}):n.fs.chmod(i,r||438,function(){s(!0)})})})})})};B.prototype.findFiles=function(i){let e=this;function t(r,s,n){typeof s=="boolean"&&(n=s,s=void 0);let c=[];return e.fs.readdirSync(r).forEach(function(h){let v=z.join(r,h),p=e.fs.statSync(v);(!s||s.test(v))&&c.push(z.normalize(v)+(p.isDirectory()?e.sep:"")),p.isDirectory()&&n&&(c=c.concat(t(v,s,n)))}),c}return t(i,void 0,!0)};B.prototype.findFilesAsync=function(i,e){let t=this,r=[];t.fs.readdir(i,function(s,n){if(s)return e(s);let c=n.length;if(!c)return e(null,r);n.forEach(function(h){h=z.join(i,h),t.fs.stat(h,function(v,p){if(v)return e(v);p&&(r.push(z.normalize(h)+(p.isDirectory()?t.sep:"")),p.isDirectory()?t.findFilesAsync(h,function(D,L){if(D)return e(D);r=r.concat(L),--c||e(null,r)}):--c||e(null,r))})})})};B.prototype.getAttributes=function(){};B.prototype.setAttributes=function(){};B.crc32update=function(i,e){return rt[(i^e)&255]^i>>>8};B.crc32=function(i){typeof i=="string"&&(i=Buffer.from(i,"utf8"));let e=i.length,t=-1;for(let r=0;r<e;)t=B.crc32update(t,i[r++]);return~t>>>0};B.methodToString=function(i){switch(i){case et.STORED:return"STORED ("+i+")";case et.DEFLATED:return"DEFLATED ("+i+")";default:return"UNSUPPORTED ("+i+")"}};B.canonical=function(i){if(!i)return"";let e=z.posix.normalize("/"+i.split("\\").join("/"));return z.join(".",e)};B.zipnamefix=function(i){if(!i)return"";let e=z.posix.normalize("/"+i.split("\\").join("/"));return z.posix.join(".",e)};B.findLast=function(i,e){if(!Array.isArray(i))throw new TypeError("arr is not array");let t=i.length>>>0;for(let r=t-1;r>=0;r--)if(e(i[r],r,i))return i[r]};B.sanitize=function(i,e){i=z.resolve(z.normalize(i));for(var t=e.split("/"),r=0,s=t.length;r<s;r++){var n=z.normalize(z.join(i,t.slice(r,s).join(z.sep)));if(n.indexOf(i)===0)return n}return z.normalize(z.join(i,z.basename(e)))};B.toBuffer=function(e,t){return Buffer.isBuffer(e)?e:e instanceof Uint8Array?Buffer.from(e):typeof e=="string"?t(e):Buffer.alloc(0)};B.readBigUInt64LE=function(i,e){var t=Buffer.from(i.slice(e,e+8));return t.swap64(),parseInt(`0x${t.toString("hex")}`)};B.fromDOS2Date=function(i){return new Date((i>>25&127)+1980,Math.max((i>>21&15)-1,0),Math.max(i>>16&31,1),i>>11&31,i>>5&63,(i&31)<<1)};B.fromDate2DOS=function(i){let e=0,t=0;return i.getFullYear()>1979&&(e=(i.getFullYear()-1980&127)<<9|i.getMonth()+1<<5|i.getDate(),t=i.getHours()<<11|i.getMinutes()<<5|i.getSeconds()>>1),e<<16|t};B.isWin=sr;B.crcTable=rt});var st=J((Br,it)=>{var ar=require("path");it.exports=function(i,{fs:e}){var t=i||"",r=n(),s=null;function n(){return{directory:!1,readonly:!1,hidden:!1,executable:!1,mtime:0,atime:0}}return t&&e.existsSync(t)?(s=e.statSync(t),r.directory=s.isDirectory(),r.mtime=s.mtime,r.atime=s.atime,r.executable=(73&s.mode)!==0,r.readonly=(128&s.mode)===0,r.hidden=ar.basename(t)[0]==="."):console.warn("Invalid path: "+t),{get directory(){return r.directory},get readOnly(){return r.readonly},get hidden(){return r.hidden},get mtime(){return r.mtime},get atime(){return r.atime},get executable(){return r.executable},decodeAttributes:function(){},encodeAttributes:function(){},toJSON:function(){return{path:t,isDirectory:r.directory,isReadOnly:r.readonly,isHidden:r.hidden,isExecutable:r.executable,mTime:r.mtime,aTime:r.atime}},toString:function(){return JSON.stringify(this.toJSON(),null,"	")}}}});var ct=J(($r,at)=>{at.exports={efs:!0,encode:i=>Buffer.from(i,"utf8"),decode:i=>i.toString("utf8")}});var ge=J((kr,me)=>{me.exports=ot();me.exports.Constants=He();me.exports.Errors=Ie();me.exports.FileAttr=st();me.exports.decoder=ct()});var ft=J((Vr,lt)=>{var le=ge(),E=le.Constants;lt.exports=function(){var i=20,e=10,t=0,r=0,s=0,n=0,c=0,h=0,v=0,p=0,D=0,L=0,x=0,a=0,l=0;i|=le.isWin?2560:768,t|=E.FLG_EFS;let g={extraLen:0},d=o=>Math.max(0,o)>>>0,u=o=>Math.max(0,o)&65535,y=o=>Math.max(0,o)&255;return s=le.fromDate2DOS(new Date),{get made(){return i},set made(o){i=o},get version(){return e},set version(o){e=o},get flags(){return t},set flags(o){t=o},get flags_efs(){return(t&E.FLG_EFS)>0},set flags_efs(o){o?t|=E.FLG_EFS:t&=~E.FLG_EFS},get flags_desc(){return(t&E.FLG_DESC)>0},set flags_desc(o){o?t|=E.FLG_DESC:t&=~E.FLG_DESC},get method(){return r},set method(o){switch(o){case E.STORED:this.version=10;case E.DEFLATED:default:this.version=20}r=o},get time(){return le.fromDOS2Date(this.timeval)},set time(o){this.timeval=le.fromDate2DOS(o)},get timeval(){return s},set timeval(o){s=d(o)},get timeHighByte(){return y(s>>>8)},get crc(){return n},set crc(o){n=d(o)},get compressedSize(){return c},set compressedSize(o){c=d(o)},get size(){return h},set size(o){h=d(o)},get fileNameLength(){return v},set fileNameLength(o){v=o},get extraLength(){return p},set extraLength(o){p=o},get extraLocalLength(){return g.extraLen},set extraLocalLength(o){g.extraLen=o},get commentLength(){return D},set commentLength(o){D=o},get diskNumStart(){return L},set diskNumStart(o){L=d(o)},get inAttr(){return x},set inAttr(o){x=d(o)},get attr(){return a},set attr(o){a=d(o)},get fileAttr(){return(a||0)>>16&4095},get offset(){return l},set offset(o){l=d(o)},get encrypted(){return(t&E.FLG_ENC)===E.FLG_ENC},get centralHeaderSize(){return E.CENHDR+v+p+D},get realDataOffset(){return l+E.LOCHDR+g.fnameLen+g.extraLen},get localHeader(){return g},loadLocalHeaderFromBinary:function(o){var f=o.slice(l,l+E.LOCHDR);if(f.readUInt32LE(0)!==E.LOCSIG)throw le.Errors.INVALID_LOC();g.version=f.readUInt16LE(E.LOCVER),g.flags=f.readUInt16LE(E.LOCFLG),g.method=f.readUInt16LE(E.LOCHOW),g.time=f.readUInt32LE(E.LOCTIM),g.crc=f.readUInt32LE(E.LOCCRC),g.compressedSize=f.readUInt32LE(E.LOCSIZ),g.size=f.readUInt32LE(E.LOCLEN),g.fnameLen=f.readUInt16LE(E.LOCNAM),g.extraLen=f.readUInt16LE(E.LOCEXT);let m=l+E.LOCHDR+g.fnameLen,b=m+g.extraLen;return o.slice(m,b)},loadFromBinary:function(o){if(o.length!==E.CENHDR||o.readUInt32LE(0)!==E.CENSIG)throw le.Errors.INVALID_CEN();i=o.readUInt16LE(E.CENVEM),e=o.readUInt16LE(E.CENVER),t=o.readUInt16LE(E.CENFLG),r=o.readUInt16LE(E.CENHOW),s=o.readUInt32LE(E.CENTIM),n=o.readUInt32LE(E.CENCRC),c=o.readUInt32LE(E.CENSIZ),h=o.readUInt32LE(E.CENLEN),v=o.readUInt16LE(E.CENNAM),p=o.readUInt16LE(E.CENEXT),D=o.readUInt16LE(E.CENCOM),L=o.readUInt16LE(E.CENDSK),x=o.readUInt16LE(E.CENATT),a=o.readUInt32LE(E.CENATX),l=o.readUInt32LE(E.CENOFF)},localHeaderToBinary:function(){var o=Buffer.alloc(E.LOCHDR);return o.writeUInt32LE(E.LOCSIG,0),o.writeUInt16LE(e,E.LOCVER),o.writeUInt16LE(t,E.LOCFLG),o.writeUInt16LE(r,E.LOCHOW),o.writeUInt32LE(s,E.LOCTIM),o.writeUInt32LE(n,E.LOCCRC),o.writeUInt32LE(c,E.LOCSIZ),o.writeUInt32LE(h,E.LOCLEN),o.writeUInt16LE(v,E.LOCNAM),o.writeUInt16LE(g.extraLen,E.LOCEXT),o},centralHeaderToBinary:function(){var o=Buffer.alloc(E.CENHDR+v+p+D);return o.writeUInt32LE(E.CENSIG,0),o.writeUInt16LE(i,E.CENVEM),o.writeUInt16LE(e,E.CENVER),o.writeUInt16LE(t,E.CENFLG),o.writeUInt16LE(r,E.CENHOW),o.writeUInt32LE(s,E.CENTIM),o.writeUInt32LE(n,E.CENCRC),o.writeUInt32LE(c,E.CENSIZ),o.writeUInt32LE(h,E.CENLEN),o.writeUInt16LE(v,E.CENNAM),o.writeUInt16LE(p,E.CENEXT),o.writeUInt16LE(D,E.CENCOM),o.writeUInt16LE(L,E.CENDSK),o.writeUInt16LE(x,E.CENATT),o.writeUInt32LE(a,E.CENATX),o.writeUInt32LE(l,E.CENOFF),o},toJSON:function(){let o=function(f){return f+" bytes"};return{made:i,version:e,flags:t,method:le.methodToString(r),time:this.time,crc:"0x"+n.toString(16).toUpperCase(),compressedSize:o(c),size:o(h),fileNameLength:o(v),extraLength:o(p),commentLength:o(D),diskNumStart:L,inAttr:x,attr:a,offset:l,centralHeaderSize:o(E.CENHDR+v+p+D)}},toString:function(){return JSON.stringify(this.toJSON(),null,"	")}}}});var ut=J((zr,dt)=>{var he=ge(),M=he.Constants;dt.exports=function(){var i=0,e=0,t=0,r=0,s=0;return{get diskEntries(){return i},set diskEntries(n){i=e=n},get totalEntries(){return e},set totalEntries(n){e=i=n},get size(){return t},set size(n){t=n},get offset(){return r},set offset(n){r=n},get commentLength(){return s},set commentLength(n){s=n},get mainHeaderSize(){return M.ENDHDR+s},loadFromBinary:function(n){if((n.length!==M.ENDHDR||n.readUInt32LE(0)!==M.ENDSIG)&&(n.length<M.ZIP64HDR||n.readUInt32LE(0)!==M.ZIP64SIG))throw he.Errors.INVALID_END();n.readUInt32LE(0)===M.ENDSIG?(i=n.readUInt16LE(M.ENDSUB),e=n.readUInt16LE(M.ENDTOT),t=n.readUInt32LE(M.ENDSIZ),r=n.readUInt32LE(M.ENDOFF),s=n.readUInt16LE(M.ENDCOM)):(i=he.readBigUInt64LE(n,M.ZIP64SUB),e=he.readBigUInt64LE(n,M.ZIP64TOT),t=he.readBigUInt64LE(n,M.ZIP64SIZE),r=he.readBigUInt64LE(n,M.ZIP64OFF),s=0)},toBinary:function(){var n=Buffer.alloc(M.ENDHDR+s);return n.writeUInt32LE(M.ENDSIG,0),n.writeUInt32LE(0,4),n.writeUInt16LE(i,M.ENDSUB),n.writeUInt16LE(e,M.ENDTOT),n.writeUInt32LE(t,M.ENDSIZ),n.writeUInt32LE(r,M.ENDOFF),n.writeUInt16LE(s,M.ENDCOM),n.fill(" ",M.ENDHDR),n},toJSON:function(){let n=function(c,h){let v=c.toString(16).toUpperCase();for(;v.length<h;)v="0"+v;return"0x"+v};return{diskEntries:i,totalEntries:e,size:t+" bytes",offset:n(r,4),commentLength:s}},toString:function(){return JSON.stringify(this.toJSON(),null,"	")}}}});var $e=J(Be=>{Be.EntryHeader=ft();Be.MainHeader=ut()});var gt=J((Gr,mt)=>{mt.exports=function(i){var e=require("zlib"),t={chunkSize:(parseInt(i.length/1024)+1)*1024};return{deflate:function(){return e.deflateRawSync(i,t)},deflateAsync:function(r){var s=e.createDeflateRaw(t),n=[],c=0;s.on("data",function(h){n.push(h),c+=h.length}),s.on("end",function(){var h=Buffer.alloc(c),v=0;h.fill(0);for(var p=0;p<n.length;p++){var D=n[p];D.copy(h,v),v+=D.length}r&&r(h)}),s.end(i)}}}});var pt=J((Wr,ht)=>{var cr=+(process.versions?process.versions.node:"").split(".")[0]||0;ht.exports=function(i,e){var t=require("zlib");let r=cr>=15&&e>0?{maxOutputLength:e}:{};return{inflate:function(){return t.inflateRawSync(i,r)},inflateAsync:function(s){var n=t.createInflateRaw(r),c=[],h=0;n.on("data",function(v){c.push(v),h+=v.length}),n.on("end",function(){var v=Buffer.alloc(h),p=0;v.fill(0);for(var D=0;D<c.length;D++){var L=c[D];L.copy(v,p),p+=L.length}s&&s(v)}),n.end(i)}}}});var bt=J((Jr,wt)=>{"use strict";var{randomFillSync:yt}=require("crypto"),lr=Ie(),fr=new Uint32Array(256).map((i,e)=>{for(let t=0;t<8;t++)(e&1)!==0?e=e>>>1^3988292384:e>>>=1;return e>>>0}),Et=(i,e)=>Math.imul(i,e)>>>0,vt=(i,e)=>fr[(i^e)&255]^i>>>8,ve=()=>typeof yt=="function"?yt(Buffer.alloc(12)):ve.node();ve.node=()=>{let i=Buffer.alloc(12),e=i.length;for(let t=0;t<e;t++)i[t]=Math.random()*256&255;return i};var xe={genSalt:ve};function Ce(i){let e=Buffer.isBuffer(i)?i:Buffer.from(i);this.keys=new Uint32Array([305419896,591751049,878082192]);for(let t=0;t<e.length;t++)this.updateKeys(e[t])}Ce.prototype.updateKeys=function(i){let e=this.keys;return e[0]=vt(e[0],i),e[1]+=e[0]&255,e[1]=Et(e[1],134775813)+1,e[2]=vt(e[2],e[1]>>>24),i};Ce.prototype.next=function(){let i=(this.keys[2]|2)>>>0;return Et(i,i^1)>>8&255};function dr(i){let e=new Ce(i);return function(t){let r=Buffer.alloc(t.length),s=0;for(let n of t)r[s++]=e.updateKeys(n^e.next());return r}}function ur(i){let e=new Ce(i);return function(t,r,s=0){r||(r=Buffer.alloc(t.length));for(let n of t){let c=e.next();r[s++]=n^c,e.updateKeys(n)}return r}}function mr(i,e,t){if(!i||!Buffer.isBuffer(i)||i.length<12)return Buffer.alloc(0);let r=dr(t),s=r(i.slice(0,12)),n=(e.flags&8)===8?e.timeHighByte:e.crc>>>24;if(s[11]!==n)throw lr.WRONG_PASSWORD();return r(i.slice(12))}function gr(i){Buffer.isBuffer(i)&&i.length>=12?xe.genSalt=function(){return i.slice(0,12)}:i==="node"?xe.genSalt=ve.node:xe.genSalt=ve}function hr(i,e,t,r=!1){i==null&&(i=Buffer.alloc(0)),Buffer.isBuffer(i)||(i=Buffer.from(i.toString()));let s=ur(t),n=xe.genSalt();n[11]=e.crc>>>24&255,r&&(n[10]=e.crc>>>16&255);let c=Buffer.alloc(i.length+12);return s(n,c),s(i,c,12)}wt.exports={decrypt:mr,encrypt:hr,_salter:gr}});var Dt=J(Ne=>{Ne.Deflater=gt();Ne.Inflater=pt();Ne.ZipCrypto=bt()});var Ve=J((qr,Lt)=>{var P=ge(),pr=$e(),$=P.Constants,ke=Dt();Lt.exports=function(i,e){var t=new pr.EntryHeader,r=Buffer.alloc(0),s=Buffer.alloc(0),n=!1,c=null,h=Buffer.alloc(0),v=Buffer.alloc(0),p=!0;let D=i,L=typeof D.decoder=="object"?D.decoder:P.decoder;p=L.hasOwnProperty("efs")?L.efs:!1;function x(){return!e||!(e instanceof Uint8Array)?Buffer.alloc(0):(v=t.loadLocalHeaderFromBinary(e),e.slice(t.realDataOffset,t.realDataOffset+t.compressedSize))}function a(o){if(t.flags_desc){let f={},m=t.realDataOffset+t.compressedSize;if(e.readUInt32LE(m)==$.LOCSIG||e.readUInt32LE(m)==$.CENSIG)throw P.Errors.DESCRIPTOR_NOT_EXIST();if(e.readUInt32LE(m)==$.EXTSIG)f.crc=e.readUInt32LE(m+$.EXTCRC),f.compressedSize=e.readUInt32LE(m+$.EXTSIZ),f.size=e.readUInt32LE(m+$.EXTLEN);else if(e.readUInt16LE(m+12)===19280)f.crc=e.readUInt32LE(m+$.EXTCRC-4),f.compressedSize=e.readUInt32LE(m+$.EXTSIZ-4),f.size=e.readUInt32LE(m+$.EXTLEN-4);else throw P.Errors.DESCRIPTOR_UNKNOWN();if(f.compressedSize!==t.compressedSize||f.size!==t.size||f.crc!==t.crc)throw P.Errors.DESCRIPTOR_FAULTY();if(P.crc32(o)!==f.crc)return!1}else if(P.crc32(o)!==t.localHeader.crc)return!1;return!0}function l(o,f,m){if(typeof f>"u"&&typeof o=="string"&&(m=o,o=void 0),n)return o&&f&&f(Buffer.alloc(0),P.Errors.DIRECTORY_CONTENT_ERROR()),Buffer.alloc(0);var b=x();if(b.length===0)return o&&f&&f(b),b;if(t.encrypted){if(typeof m!="string"&&!Buffer.isBuffer(m))throw P.Errors.INVALID_PASS_PARAM();b=ke.ZipCrypto.decrypt(b,t,m)}var w=Buffer.alloc(t.size);switch(t.method){case P.Constants.STORED:if(b.copy(w),a(w))return o&&f&&f(w),w;throw o&&f&&f(w,P.Errors.BAD_CRC()),P.Errors.BAD_CRC();case P.Constants.DEFLATED:var N=new ke.Inflater(b,t.size);if(o)N.inflateAsync(function(j){j.copy(j,0),f&&(a(j)?f(j):f(j,P.Errors.BAD_CRC()))});else{if(N.inflate(w).copy(w,0),!a(w))throw P.Errors.BAD_CRC(`"${L.decode(r)}"`);return w}break;default:throw o&&f&&f(Buffer.alloc(0),P.Errors.UNKNOWN_METHOD()),P.Errors.UNKNOWN_METHOD()}}function g(o,f){if((!c||!c.length)&&Buffer.isBuffer(e))return o&&f&&f(x()),x();if(c.length&&!n){var m;switch(t.method){case P.Constants.STORED:return t.compressedSize=t.size,m=Buffer.alloc(c.length),c.copy(m),o&&f&&f(m),m;default:case P.Constants.DEFLATED:var b=new ke.Deflater(c);if(o)b.deflateAsync(function(N){m=Buffer.alloc(N.length),t.compressedSize=N.length,N.copy(m),f&&f(m)});else{var w=b.deflate();return t.compressedSize=w.length,w}b=null;break}}else if(o&&f)f(Buffer.alloc(0));else return Buffer.alloc(0)}function d(o,f){return(o.readUInt32LE(f+4)<<4)+o.readUInt32LE(f)}function u(o){try{for(var f=0,m,b,w;f+4<o.length;)m=o.readUInt16LE(f),f+=2,b=o.readUInt16LE(f),f+=2,w=o.slice(f,f+b),f+=b,$.ID_ZIP64===m&&y(w)}catch{throw P.Errors.EXTRA_FIELD_PARSE_ERROR()}}function y(o){var f,m,b,w;o.length>=$.EF_ZIP64_SCOMP&&(f=d(o,$.EF_ZIP64_SUNCOMP),t.size===$.EF_ZIP64_OR_32&&(t.size=f)),o.length>=$.EF_ZIP64_RHO&&(m=d(o,$.EF_ZIP64_SCOMP),t.compressedSize===$.EF_ZIP64_OR_32&&(t.compressedSize=m)),o.length>=$.EF_ZIP64_DSN&&(b=d(o,$.EF_ZIP64_RHO),t.offset===$.EF_ZIP64_OR_32&&(t.offset=b)),o.length>=$.EF_ZIP64_DSN+4&&(w=o.readUInt32LE($.EF_ZIP64_DSN),t.diskNumStart===$.EF_ZIP64_OR_16&&(t.diskNumStart=w))}return{get entryName(){return L.decode(r)},get rawEntryName(){return r},set entryName(o){r=P.toBuffer(o,L.encode);var f=r[r.length-1];n=f===47||f===92,t.fileNameLength=r.length},get efs(){return typeof p=="function"?p(this.entryName):p},get extra(){return h},set extra(o){h=o,t.extraLength=o.length,u(o)},get comment(){return L.decode(s)},set comment(o){if(s=P.toBuffer(o,L.encode),t.commentLength=s.length,s.length>65535)throw P.Errors.COMMENT_TOO_LONG()},get name(){var o=L.decode(r);return n?o.substr(o.length-1).split("/").pop():o.split("/").pop()},get isDirectory(){return n},getCompressedData:function(){return g(!1,null)},getCompressedDataAsync:function(o){g(!0,o)},setData:function(o){c=P.toBuffer(o,P.decoder.encode),!n&&c.length?(t.size=c.length,t.method=P.Constants.DEFLATED,t.crc=P.crc32(o),t.changed=!0):t.method=P.Constants.STORED},getData:function(o){return t.changed?c:l(!1,null,o)},getDataAsync:function(o,f){t.changed?o(c):l(!0,o,f)},set attr(o){t.attr=o},get attr(){return t.attr},set header(o){t.loadFromBinary(o)},get header(){return t},packCentralHeader:function(){t.flags_efs=this.efs,t.extraLength=h.length;var o=t.centralHeaderToBinary(),f=P.Constants.CENHDR;return r.copy(o,f),f+=r.length,h.copy(o,f),f+=t.extraLength,s.copy(o,f),o},packLocalHeader:function(){let o=0;t.flags_efs=this.efs,t.extraLocalLength=v.length;let f=t.localHeaderToBinary(),m=Buffer.alloc(f.length+r.length+t.extraLocalLength);return f.copy(m,o),o+=f.length,r.copy(m,o),o+=r.length,v.copy(m,o),o+=v.length,m},toJSON:function(){let o=function(f){return"<"+(f&&f.length+" bytes buffer"||"null")+">"};return{entryName:this.entryName,name:this.name,comment:this.comment,isDirectory:this.isDirectory,header:t.toJSON(),compressedData:o(e),data:o(c)}},toString:function(){return JSON.stringify(this.toJSON(),null,"	")}}}});var xt=J((Kr,It)=>{var St=Ve(),yr=$e(),G=ge();It.exports=function(i,e){var t=[],r={},s=Buffer.alloc(0),n=new yr.MainHeader,c=!1,h=null;let v=new Set,p=e,{noSort:D,decoder:L}=p;i?l(p.readEntries):c=!0;function x(){let d=new Set;for(let u of Object.keys(r)){let y=u.split("/");if(y.pop(),!!y.length)for(let o=0;o<y.length;o++){let f=y.slice(0,o+1).join("/")+"/";d.add(f)}}for(let u of d)if(!(u in r)){let y=new St(p);y.entryName=u,y.attr=16,y.temporary=!0,t.push(y),r[y.entryName]=y,v.add(y)}}function a(){if(c=!0,r={},n.diskEntries>(i.length-n.offset)/G.Constants.CENHDR)throw G.Errors.DISK_ENTRY_TOO_LARGE();t=new Array(n.diskEntries);for(var d=n.offset,u=0;u<t.length;u++){var y=d,o=new St(p,i);o.header=i.slice(y,y+=G.Constants.CENHDR),o.entryName=i.slice(y,y+=o.header.fileNameLength),o.header.extraLength&&(o.extra=i.slice(y,y+=o.header.extraLength)),o.header.commentLength&&(o.comment=i.slice(y,y+o.header.commentLength)),d+=o.header.centralHeaderSize,t[u]=o,r[o.entryName]=o}v.clear(),x()}function l(d){var u=i.length-G.Constants.ENDHDR,y=Math.max(0,u-65535),o=y,f=i.length,m=-1,b=0;for((typeof p.trailingSpace=="boolean"?p.trailingSpace:!1)&&(y=0),u;u>=o;u--)if(i[u]===80){if(i.readUInt32LE(u)===G.Constants.ENDSIG){m=u,b=u,f=u+G.Constants.ENDHDR,o=u-G.Constants.END64HDR;continue}if(i.readUInt32LE(u)===G.Constants.END64SIG){o=y;continue}if(i.readUInt32LE(u)===G.Constants.ZIP64SIG){m=u,f=u+G.readBigUInt64LE(i,u+G.Constants.ZIP64SIZE)+G.Constants.ZIP64LEAD;break}}if(m==-1)throw G.Errors.INVALID_FORMAT();n.loadFromBinary(i.slice(m,f)),n.commentLength&&(s=i.slice(b+G.Constants.ENDHDR)),d&&a()}function g(){t.length>1&&!D&&t.sort((d,u)=>d.entryName.toLowerCase().localeCompare(u.entryName.toLowerCase()))}return{get entries(){return c||a(),t.filter(d=>!v.has(d))},get comment(){return L.decode(s)},set comment(d){s=G.toBuffer(d,L.encode),n.commentLength=s.length},getEntryCount:function(){return c?t.length:n.diskEntries},forEach:function(d){this.entries.forEach(d)},getEntry:function(d){return c||a(),r[d]||null},setEntry:function(d){c||a(),t.push(d),r[d.entryName]=d,n.totalEntries=t.length},deleteFile:function(d,u=!0){c||a();let y=r[d];this.getEntryChildren(y,u).map(f=>f.entryName).forEach(this.deleteEntry)},deleteEntry:function(d){c||a();let u=r[d],y=t.indexOf(u);y>=0&&(t.splice(y,1),delete r[d],n.totalEntries=t.length)},getEntryChildren:function(d,u=!0){if(c||a(),typeof d=="object")if(d.isDirectory&&u){let y=[],o=d.entryName;for(let f of t)f.entryName.startsWith(o)&&y.push(f);return y}else return[d];return[]},getChildCount:function(d){if(d&&d.isDirectory){let u=this.getEntryChildren(d);return u.includes(d)?u.length-1:u.length}return 0},compressToBuffer:function(){c||a(),g();let d=[],u=[],y=0,o=0;n.size=0,n.offset=0;let f=0;for(let w of this.entries){let N=w.getCompressedData();w.header.offset=o;let j=w.packLocalHeader(),U=j.length+N.length;o+=U,d.push(j),d.push(N);let O=w.packCentralHeader();u.push(O),n.size+=O.length,y+=U+O.length,f++}y+=n.mainHeaderSize,n.offset=o,n.totalEntries=f,o=0;let m=Buffer.alloc(y);for(let w of d)w.copy(m,o),o+=w.length;for(let w of u)w.copy(m,o),o+=w.length;let b=n.toBinary();return s&&s.copy(b,G.Constants.ENDHDR),b.copy(m,o),i=m,c=!1,m},toAsyncBuffer:function(d,u,y,o){try{c||a(),g();let f=[],m=[],b=0,w=0,N=0;n.size=0,n.offset=0;let j=function(U){if(U.length>0){let O=U.shift(),te=O.entryName+O.extra.toString();y&&y(te),O.getCompressedDataAsync(function(X){o&&o(te),O.header.offset=w;let C=O.packLocalHeader(),F=C.length+X.length;w+=F,f.push(C),f.push(X);let T=O.packCentralHeader();m.push(T),n.size+=T.length,b+=F+T.length,N++,j(U)})}else{b+=n.mainHeaderSize,n.offset=w,n.totalEntries=N,w=0;let O=Buffer.alloc(b);f.forEach(function(X){X.copy(O,w),w+=X.length}),m.forEach(function(X){X.copy(O,w),w+=X.length});let te=n.toBinary();s&&s.copy(te,G.Constants.ENDHDR),te.copy(O,w),i=O,c=!1,d(O)}};j(Array.from(this.entries))}catch(f){u(f)}}}}});var Ee=J((Yr,Nt)=>{var H=ge(),k=require("path"),vr=Ve(),Er=xt(),de=(...i)=>H.findLast(i,e=>typeof e=="boolean"),Ct=(...i)=>H.findLast(i,e=>typeof e=="string"),wr=(...i)=>H.findLast(i,e=>typeof e=="function"),br={noSort:!1,readEntries:!1,method:H.Constants.NONE,fs:null};Nt.exports=function(i,e){let t=null,r=Object.assign(Object.create(null),br);i&&typeof i=="object"&&(i instanceof Uint8Array||(Object.assign(r,i),i=r.input?r.input:void 0,r.input&&delete r.input),Buffer.isBuffer(i)&&(t=i,r.method=H.Constants.BUFFER,i=void 0)),Object.assign(r,e);let s=new H(r);if((typeof r.decoder!="object"||typeof r.decoder.encode!="function"||typeof r.decoder.decode!="function")&&(r.decoder=H.decoder),i&&typeof i=="string")if(s.fs.existsSync(i))r.method=H.Constants.FILE,r.filename=i,t=s.fs.readFileSync(i);else throw H.Errors.INVALID_FILENAME();let n=new Er(t,r),{canonical:c,sanitize:h,zipnamefix:v}=H;function p(a){if(a&&n){var l;if(typeof a=="string"&&(l=n.getEntry(k.posix.normalize(a))),typeof a=="object"&&typeof a.entryName<"u"&&typeof a.header<"u"&&(l=n.getEntry(a.entryName)),l)return l}return null}function D(a){let{join:l,normalize:g,sep:d}=k.posix;return l(".",g(d+a.split("\\").join(d)+d))}function L(a){return a instanceof RegExp?(function(l){return function(g){return l.test(g)}})(a):typeof a!="function"?()=>!0:a}let x=(a,l)=>{let g=l.slice(-1);return g=g===s.sep?s.sep:"",k.relative(a,l)+g};return{readFile:function(a,l){var g=p(a);return g&&g.getData(l)||null},childCount:function(a){let l=p(a);if(l)return n.getChildCount(l)},readFileAsync:function(a,l){var g=p(a);g?g.getDataAsync(l):l(null,"getEntry failed for:"+a)},readAsText:function(a,l){var g=p(a);if(g){var d=g.getData();if(d&&d.length)return d.toString(l||"utf8")}return""},readAsTextAsync:function(a,l,g){var d=p(a);d?d.getDataAsync(function(u,y){if(y){l(u,y);return}u&&u.length?l(u.toString(g||"utf8")):l("")}):l("")},deleteFile:function(a,l=!0){var g=p(a);g&&n.deleteFile(g.entryName,l)},deleteEntry:function(a){var l=p(a);l&&n.deleteEntry(l.entryName)},addZipComment:function(a){n.comment=a},getZipComment:function(){return n.comment||""},addZipEntryComment:function(a,l){var g=p(a);g&&(g.comment=l)},getZipEntryComment:function(a){var l=p(a);return l&&l.comment||""},updateFile:function(a,l){var g=p(a);g&&g.setData(l)},addLocalFile:function(a,l,g,d){if(s.fs.existsSync(a)){l=l?D(l):"";let u=k.win32.basename(k.win32.normalize(a));l+=g||u;let y=s.fs.statSync(a),o=y.isFile()?s.fs.readFileSync(a):Buffer.alloc(0);y.isDirectory()&&(l+=s.sep),this.addFile(l,o,d,y)}else throw H.Errors.FILE_NOT_FOUND(a)},addLocalFileAsync:function(a,l){a=typeof a=="object"?a:{localPath:a};let g=k.resolve(a.localPath),{comment:d}=a,{zipPath:u,zipName:y}=a,o=this;s.fs.stat(g,function(f,m){if(f)return l(f,!1);u=u?D(u):"";let b=k.win32.basename(k.win32.normalize(g));if(u+=y||b,m.isFile())s.fs.readFile(g,function(w,N){return w?l(w,!1):(o.addFile(u,N,d,m),setImmediate(l,void 0,!0))});else if(m.isDirectory())return u+=s.sep,o.addFile(u,Buffer.alloc(0),d,m),setImmediate(l,void 0,!0)})},addLocalFolder:function(a,l,g){if(g=L(g),l=l?D(l):"",a=k.normalize(a),s.fs.existsSync(a)){let d=s.findFiles(a),u=this;if(d.length)for(let y of d){let o=k.join(l,x(a,y));g(o)&&u.addLocalFile(y,k.dirname(o))}}else throw H.Errors.FILE_NOT_FOUND(a)},addLocalFolderAsync:function(a,l,g,d){d=L(d),g=g?D(g):"",a=k.normalize(a);var u=this;s.fs.open(a,"r",function(y){if(y&&y.code==="ENOENT")l(void 0,H.Errors.FILE_NOT_FOUND(a));else if(y)l(void 0,y);else{var o=s.findFiles(a),f=-1,m=function(){if(f+=1,f<o.length){var b=o[f],w=x(a,b).split("\\").join("/");w=w.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\x20-\x7E]/g,""),d(w)?s.fs.stat(b,function(N,j){N&&l(void 0,N),j.isFile()?s.fs.readFile(b,function(U,O){U?l(void 0,U):(u.addFile(g+w,O,"",j),m())}):(u.addFile(g+w+"/",Buffer.alloc(0),"",j),m())}):process.nextTick(()=>{m()})}else l(!0,void 0)};m()}})},addLocalFolderAsync2:function(a,l){let g=this;a=typeof a=="object"?a:{localPath:a},localPath=k.resolve(D(a.localPath));let{zipPath:d,filter:u,namefix:y}=a;u instanceof RegExp?u=(function(m){return function(b){return m.test(b)}})(u):typeof u!="function"&&(u=function(){return!0}),d=d?D(d):"",y=="latin1"&&(y=m=>m.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\x20-\x7E]/g,"")),typeof y!="function"&&(y=m=>m);let o=m=>k.join(d,y(x(localPath,m))),f=m=>k.win32.basename(k.win32.normalize(y(m)));s.fs.open(localPath,"r",function(m){m&&m.code==="ENOENT"?l(void 0,H.Errors.FILE_NOT_FOUND(localPath)):m?l(void 0,m):s.findFilesAsync(localPath,function(b,w){if(b)return l(b);w=w.filter(N=>u(o(N))),w.length||l(void 0,!1),setImmediate(w.reverse().reduce(function(N,j){return function(U,O){if(U||O===!1)return setImmediate(N,U,!1);g.addLocalFileAsync({localPath:j,zipPath:k.dirname(o(j)),zipName:f(j)},N)}},l))})})},addLocalFolderPromise:function(a,l){return new Promise((g,d)=>{this.addLocalFolderAsync2(Object.assign({localPath:a},l),(u,y)=>{u&&d(u),y&&g(this)})})},addFile:function(a,l,g,d){a=v(a);let u=p(a),y=u!=null;y||(u=new vr(r),u.entryName=a),u.comment=g||"";let o=typeof d=="object"&&d instanceof s.fs.Stats;o&&(u.header.time=d.mtime);var f=u.isDirectory?16:0;let m=u.isDirectory?16384:32768;return o?m|=4095&d.mode:typeof d=="number"?m|=4095&d:m|=u.isDirectory?493:420,f=(f|m<<16)>>>0,u.attr=f,u.setData(l),y||n.setEntry(u),u},getEntries:function(a){return n.password=a,n?n.entries:[]},getEntry:function(a){return p(a)},getEntryCount:function(){return n.getEntryCount()},forEach:function(a){return n.forEach(a)},extractEntryTo:function(a,l,g,d,u,y){d=de(!1,d),u=de(!1,u),g=de(!0,g),y=Ct(u,y);var o=p(a);if(!o)throw H.Errors.NO_ENTRY();var f=c(o.entryName),m=h(l,y&&!o.isDirectory?y:g?f:k.basename(f));if(o.isDirectory){var b=n.getEntryChildren(o);return b.forEach(function(j){if(j.isDirectory)return;var U=j.getData();if(!U)throw H.Errors.CANT_EXTRACT_FILE();var O=c(j.entryName),te=h(l,g?O:k.basename(O));let X=u?j.header.fileAttr:void 0;s.writeFileTo(te,U,d,X)}),!0}var w=o.getData(n.password);if(!w)throw H.Errors.CANT_EXTRACT_FILE();if(s.fs.existsSync(m)&&!d)throw H.Errors.CANT_OVERRIDE();let N=u?a.header.fileAttr:void 0;return s.writeFileTo(m,w,d,N),!0},test:function(a){if(!n)return!1;for(var l in n.entries)try{if(l.isDirectory)continue;var g=n.entries[l].getData(a);if(!g)return!1}catch{return!1}return!0},extractAllTo:function(a,l,g,d){if(g=de(!1,g),d=Ct(g,d),l=de(!1,l),!n)throw H.Errors.NO_ZIP();n.entries.forEach(function(u){var y=h(a,c(u.entryName));if(u.isDirectory){s.makeDir(y);return}var o=u.getData(d);if(!o)throw H.Errors.CANT_EXTRACT_FILE();let f=g?u.header.fileAttr:void 0;s.writeFileTo(y,o,l,f);try{s.fs.utimesSync(y,u.header.time,u.header.time)}catch{throw H.Errors.CANT_EXTRACT_FILE()}})},extractAllToAsync:function(a,l,g,d){if(d=wr(l,g,d),g=de(!1,g),l=de(!1,l),!d)return new Promise((m,b)=>{this.extractAllToAsync(a,l,g,function(w){w?b(w):m(this)})});if(!n){d(H.Errors.NO_ZIP());return}a=k.resolve(a);let u=m=>h(a,k.normalize(c(m.entryName))),y=(m,b)=>new Error(m+': "'+b+'"'),o=[],f=[];n.entries.forEach(m=>{m.isDirectory?o.push(m):f.push(m)});for(let m of o){let b=u(m),w=g?m.header.fileAttr:void 0;try{s.makeDir(b),w&&s.fs.chmodSync(b,w),s.fs.utimesSync(b,m.header.time,m.header.time)}catch{d(y("Unable to create folder",b))}}f.reverse().reduce(function(m,b){return function(w){if(w)m(w);else{let N=k.normalize(c(b.entryName)),j=h(a,N);b.getDataAsync(function(U,O){if(O)m(O);else if(!U)m(H.Errors.CANT_EXTRACT_FILE());else{let te=g?b.header.fileAttr:void 0;s.writeFileToAsync(j,U,l,te,function(X){X||m(y("Unable to write file",j)),s.fs.utimes(j,b.header.time,b.header.time,function(C){C?m(y("Unable to set times",j)):m()})})}})}}},d)()},writeZip:function(a,l){if(arguments.length===1&&typeof a=="function"&&(l=a,a=""),!a&&r.filename&&(a=r.filename),!!a){var g=n.compressToBuffer();if(g){var d=s.writeFileTo(a,g,!0);typeof l=="function"&&l(d?null:new Error("failed"),"")}}},writeZipPromise:function(a,l){let{overwrite:g,perm:d}=Object.assign({overwrite:!0},l);return new Promise((u,y)=>{!a&&r.filename&&(a=r.filename),a||y("ADM-ZIP: ZIP File Name Missing"),this.toBufferPromise().then(o=>{let f=m=>m?u(m):y("ADM-ZIP: Wasn't able to write zip file");s.writeFileToAsync(a,o,g,d,f)},y)})},toBufferPromise:function(){return new Promise((a,l)=>{n.toAsyncBuffer(a,l)})},toBuffer:function(a,l,g,d){return typeof a=="function"?(n.toAsyncBuffer(a,l,g,d),null):n.compressToBuffer()}}}});var Rr={};tr(Rr,{getOverlayHandler:()=>Ue});module.exports=rr(Rr);var W=require("electron"),Ze=Z(require("node:path"),1);var qe=require("electron"),ye=Z(require("path"),1),fe=Z(require("fs"),1),Me=class{logsDir;launcherLogPath;gameLogPath;initialized=!1;MAX_LOG_DAYS=7;constructor(){this.logsDir="",this.launcherLogPath="",this.gameLogPath=""}init(){if(this.initialized)return;this.logsDir=ye.default.join(qe.app.getPath("userData"),"logs"),fe.default.mkdirSync(this.logsDir,{recursive:!0});let e=this.getDateString();this.launcherLogPath=ye.default.join(this.logsDir,`launcher-${e}.log`),this.gameLogPath=ye.default.join(this.logsDir,`game-${e}.log`),this.rotateOldLogs(),this.interceptConsole(),this.initialized=!0,this.info("Logger","=== BlockyCRAFT Launcher Log Started ==="),this.info("Logger",`Log file: ${this.launcherLogPath}`)}getDateString(){return new Date().toISOString().split("T")[0]}getTimestamp(){return new Date().toISOString()}formatMessage(e,t,r){return`[${this.getTimestamp()}] [${e}] [${t}] ${r}`}writeToLauncherLog(e){if(this.initialized)try{fe.default.appendFileSync(this.launcherLogPath,e+`
`)}catch(t){process.stdout.write(`[LOG WRITE ERROR] ${t}
`)}}writeToGameLog(e){if(this.initialized)try{fe.default.appendFileSync(this.gameLogPath,`[${this.getTimestamp()}] ${e}
`)}catch(t){process.stdout.write(`[GAME LOG WRITE ERROR] ${t}
`)}}rotateOldLogs(){try{let e=fe.default.readdirSync(this.logsDir),t=Date.now(),r=this.MAX_LOG_DAYS*24*60*60*1e3;for(let s of e){if(!s.endsWith(".log"))continue;let n=ye.default.join(this.logsDir,s),c=fe.default.statSync(n);t-c.mtimeMs>r&&(fe.default.unlinkSync(n),process.stdout.write(`[Logger] Deleted old log: ${s}
`))}}catch(e){process.stdout.write(`[Logger] Error rotating logs: ${e}
`)}}interceptConsole(){let e=console.log,t=console.error,r=console.warn,s=this;console.log=function(...n){let c=n.map(h=>typeof h=="object"?JSON.stringify(h):String(h)).join(" ");s.writeToLauncherLog(s.formatMessage("INFO","Console",c)),e.apply(console,n)},console.error=function(...n){let c=n.map(h=>typeof h=="object"?JSON.stringify(h):String(h)).join(" ");s.writeToLauncherLog(s.formatMessage("ERROR","Console",c)),t.apply(console,n)},console.warn=function(...n){let c=n.map(h=>typeof h=="object"?JSON.stringify(h):String(h)).join(" ");s.writeToLauncherLog(s.formatMessage("WARN","Console",c)),r.apply(console,n)}}info(e,t){let r=this.formatMessage("INFO",e,t);this.writeToLauncherLog(r),process.stdout.write(r+`
`)}error(e,t){let r=this.formatMessage("ERROR",e,t);this.writeToLauncherLog(r),process.stderr.write(r+`
`)}warn(e,t){let r=this.formatMessage("WARN",e,t);this.writeToLauncherLog(r),process.stdout.write(r+`
`)}debug(e,t){let r=this.formatMessage("DEBUG",e,t);this.writeToLauncherLog(r)}game(e,t){let r=e==="stderr"?"[ERR]":"[OUT]";this.writeToGameLog(`${r} ${t}`)}getLogsDir(){return this.logsDir}},S=new Me;var ie=require("electron"),A=Z(require("path"),1),I=Z(require("fs"),1),Fe=require("child_process"),Ht=require("util"),je=Z(Ee(),1),Bt=require("fs");var Ot=require("electron"),oe=Z(require("path"),1),re=Z(require("fs"),1),_t=require("fs"),jt=require("child_process"),Rt=require("util"),Ut=Z(Ee(),1),ze=(0,Rt.promisify)(jt.exec),Dr="https://api.adoptium.net/v3/binary/latest",Lr="17",Sr="hotspot",Ir="eclipse",Oe=class{javaDir;markerFile;constructor(){this.javaDir=oe.default.join(Ot.app.getPath("userData"),"java"),this.markerFile=oe.default.join(this.javaDir,".java17_installed")}async ensureJava(e){let t=this.getLocalJavaPath();if(t&&re.default.existsSync(t))return console.log("[JavaManager] Using locally installed Java:",t),t;let r=await this.detectSystemJava();return r?(console.log("[JavaManager] Using system Java:",r),r):(console.log("[JavaManager] No Java found, downloading..."),this.downloadAndInstallJava(e))}async detectSystemJava(){let e=this.getCommonJavaPaths();for(let t of e)if(await this.isValidJava17(t))return t;return null}getCommonJavaPaths(){let e=["java"],t=process.platform;if(t==="win32"){let r=process.env.ProgramFiles||"C:\\Program Files",s=process.env["ProgramFiles(x86)"]||"C:\\Program Files (x86)";e.push(oe.default.join(r,"Eclipse Adoptium","jdk-17*","bin","java.exe"),oe.default.join(r,"Java","jdk-17*","bin","java.exe"),oe.default.join(r,"Java","jre-17*","bin","java.exe"),oe.default.join(r,"Temurin","jdk-17*","bin","java.exe"),oe.default.join(s,"Java","jdk-17*","bin","java.exe"))}else t==="darwin"?e.push("/Library/Java/JavaVirtualMachines/temurin-17.jdk/Contents/Home/bin/java","/Library/Java/JavaVirtualMachines/adoptopenjdk-17.jdk/Contents/Home/bin/java","/usr/local/opt/openjdk@17/bin/java","/opt/homebrew/opt/openjdk@17/bin/java"):e.push("/usr/lib/jvm/temurin-17-jdk/bin/java","/usr/lib/jvm/java-17-openjdk/bin/java","/usr/lib/jvm/java-17-openjdk-amd64/bin/java","/usr/lib/jvm/java-17-temurin/bin/java","/opt/java/openjdk/bin/java");return e}async isValidJava17(e){try{let{stdout:t,stderr:r}=await ze(`"${e}" -version`),n=(t+r).match(/version "(\d+)/);return n?parseInt(n[1],10)>=17:!1}catch{return!1}}getPlatformInfo(){let e=process.platform,t=process.arch,r,s,n;switch(e){case"win32":r="windows",s="zip",n="bin/java.exe";break;case"darwin":r="mac",s="tar.gz",n="Contents/Home/bin/java";break;default:r="linux",s="tar.gz",n="bin/java"}let c;switch(t){case"arm64":c="aarch64";break;case"x64":default:c="x64"}return{os:r,arch:c,extension:s,executablePath:n}}getDownloadUrl(){let e=this.getPlatformInfo(),t=`${Dr}/${Lr}/ga/${e.os}/${e.arch}/jre/${Sr}/normal/${Ir}`,r=`temurin-17-jre.${e.extension}`;return{url:t,filename:r}}getLocalJavaPath(){if(!re.default.existsSync(this.markerFile))return null;let e=this.getPlatformInfo();if(!re.default.existsSync(this.javaDir))return null;let r=re.default.readdirSync(this.javaDir).find(n=>n.startsWith("jdk-17")&&re.default.statSync(oe.default.join(this.javaDir,n)).isDirectory());if(!r)return null;let s=oe.default.join(this.javaDir,r,e.executablePath);return re.default.existsSync(s)?s:null}async downloadAndInstallJava(e){let{url:t,filename:r}=this.getDownloadUrl(),s=this.getPlatformInfo();re.default.mkdirSync(this.javaDir,{recursive:!0});let n=oe.default.join(this.javaDir,r);this.sendProgress(e,"Baixando Java 17...",0),console.log("[JavaManager] Downloading from:",t);try{let h=await fetch(t,{redirect:"follow"});if(!h.ok)throw new Error(`Failed to download Java: ${h.status} ${h.statusText}`);let v=Number(h.headers.get("content-length"))||0,p=(0,_t.createWriteStream)(n);if(!h.body)throw new Error("No response body");let D=h.body.getReader(),L=0;for(;;){let{done:x,value:a}=await D.read();if(x)break;if(p.write(Buffer.from(a)),L+=a.length,v>0){let l=Math.round(L/v*50);this.sendProgress(e,`Baixando Java 17... (${this.formatSize(L)}/${this.formatSize(v)})`,l)}}p.end(),await new Promise((x,a)=>{p.on("finish",x),p.on("error",a)}),console.log("[JavaManager] Download complete:",n)}catch(h){throw re.default.existsSync(n)&&re.default.unlinkSync(n),new Error(`Failed to download Java: ${h.message}`)}this.sendProgress(e,"Extraindo Java 17...",55),console.log("[JavaManager] Extracting...");try{s.extension==="zip"?new Ut.default(n).extractAllTo(this.javaDir,!0):await ze(`tar -xzf "${n}" -C "${this.javaDir}"`),re.default.writeFileSync(this.markerFile,new Date().toISOString()),re.default.unlinkSync(n)}catch(h){throw new Error(`Failed to extract Java: ${h.message}`)}let c=this.getLocalJavaPath();if(!c)throw new Error("Java extraction failed: executable not found");return process.platform!=="win32"&&await ze(`chmod +x "${c}"`),this.sendProgress(e,"Java 17 instalado!",60),console.log("[JavaManager] Java installed at:",c),c}sendProgress(e,t,r){e&&e.send("launch-progress",{status:t,progress:r})}formatSize(e){return e<1024?e+" B":e<1024*1024?(e/1024).toFixed(1)+" KB":(e/(1024*1024)).toFixed(1)+" MB"}};var Ft=require("electron"),V=Z(require("path"),1),_=Z(require("fs"),1),At=require("fs"),Pt=Z(Ee(),1),xr=["https://craft.blocky.com.br/launcher-assets/version.json"],_e=class{dataPath;localVersionsPath;instanceDir;librariesDir;constructor(){this.dataPath=Ft.app.getPath("userData"),this.localVersionsPath=V.default.join(this.dataPath,"versions.json"),this.instanceDir=V.default.join(this.dataPath,"instances","default"),this.librariesDir=V.default.join(this.instanceDir,"libraries")}normalizeUrls(e){return Array.isArray(e)?e:[e]}getLocalVersions(){try{if(_.default.existsSync(this.localVersionsPath)){let e=_.default.readFileSync(this.localVersionsPath,"utf-8");return JSON.parse(e)}}catch(e){console.error("[UpdateManager] Failed to read local versions:",e)}return{instance:"0.0.0",libraries:"0.0.0",mods:"0.0.0"}}saveLocalVersions(e){try{_.default.writeFileSync(this.localVersionsPath,JSON.stringify(e,null,2)),console.log("[UpdateManager] Saved local versions:",e)}catch(t){console.error("[UpdateManager] Failed to save local versions:",t)}}async fetchRemoteVersions(){for(let e of xr)try{console.log("[UpdateManager] Trying to fetch versions from:",e);let t=await fetch(e,{signal:AbortSignal.timeout(1e4)});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);let r=await t.json();return console.log("[UpdateManager] Successfully fetched from:",e),console.log("[UpdateManager] Remote versions:",r),r}catch(t){console.warn(`[UpdateManager] Failed to fetch from ${e}:`,t)}return console.error("[UpdateManager] All version URLs failed"),null}async checkForUpdates(){let e=this.getLocalVersions(),t=await this.fetchRemoteVersions();if(!t)return{instanceUpdate:!1,librariesUpdate:!1,modsUpdate:!1,remoteVersions:null,error:"Failed to fetch remote version info"};let r=t.instance.version!==e.instance,s=!1,n=t.mods?t.mods.version!==e.mods:!1;return console.log("[UpdateManager] Update check result:",{instanceUpdate:r,librariesUpdate:"DISABLED (Maven-based)",modsUpdate:n,local:e,remote:{instance:t.instance.version,libraries:t.libraries?.version??"N/A (Maven-based)",mods:t.mods?.version}}),{instanceUpdate:r,librariesUpdate:s,modsUpdate:n,remoteVersions:t}}async downloadFile(e,t,r){let s=V.default.basename(t);r?.(`Baixando ${s}...`,0);let n=this.normalizeUrls(e),c=null;for(let h=0;h<n.length;h++){let v=n[h];try{console.log(`[UpdateManager] Downloading from URL ${h+1}/${n.length}: ${v}`);let p=await fetch(v,{signal:AbortSignal.timeout(6e4)});if(!p.ok)throw new Error(`HTTP ${p.status}: ${p.statusText}`);let D=Number(p.headers.get("content-length"))||0;_.default.mkdirSync(V.default.dirname(t),{recursive:!0});let L=(0,At.createWriteStream)(t);if(!p.body)throw new Error("No response body");let x=p.body.getReader(),a=0;for(;;){let{done:l,value:g}=await x.read();if(l)break;if(L.write(Buffer.from(g)),a+=g.length,D>0){let d=Math.round(a/D*100);r?.(`Baixando ${s}...`,d)}}L.end(),await new Promise((l,g)=>{L.on("finish",l),L.on("error",g)}),console.log(`[UpdateManager] Downloaded ${s} (${this.formatSize(a)}) from ${v}`);return}catch(p){console.warn(`[UpdateManager] Failed to download from ${v}:`,p.message),c=p}}throw c||new Error(`Failed to download ${s} from all ${n.length} sources`)}extractZip(e,t){if(console.log(`[UpdateManager] Extracting ${e} to ${t}`),!_.default.existsSync(e))throw new Error(`ZIP file not found: ${e}`);let r=_.default.readFileSync(e);if(r.length<4||r[0]!==80||r[1]!==75)throw console.error(`[UpdateManager] Invalid ZIP file. First bytes: ${r.slice(0,20).toString("hex")}`),new Error(`Invalid ZIP file: ${e}. The download may have failed or returned an error page.`);_.default.mkdirSync(t,{recursive:!0}),new Pt.default(e).extractAllTo(t,!0),console.log("[UpdateManager] Extraction complete")}backupUserData(){let e=V.default.join(this.dataPath,"update_backup"),t=V.default.join(this.instanceDir,".minecraft");_.default.existsSync(e)&&_.default.rmSync(e,{recursive:!0,force:!0}),_.default.mkdirSync(e,{recursive:!0});let r=["options.txt","servers.dat","screenshots","stats","lastlogin","config"];console.log("[UpdateManager] Backing up user data...");for(let s of r){let n=V.default.join(t,s),c=V.default.join(e,s);if(_.default.existsSync(n))try{console.log(`[UpdateManager] Backing up: ${s}`),_.default.cpSync(n,c,{recursive:!0})}catch(h){console.warn(`[UpdateManager] Failed to backup ${s}:`,h)}}}restoreUserData(){let e=V.default.join(this.dataPath,"update_backup"),t=V.default.join(this.instanceDir,".minecraft");if(!_.default.existsSync(e))return;console.log("[UpdateManager] Restoring user data...");let r=_.default.readdirSync(e);for(let s of r){let n=V.default.join(e,s),c=V.default.join(t,s);try{console.log(`[UpdateManager] Restoring: ${s}`),_.default.existsSync(c)&&_.default.rmSync(c,{recursive:!0,force:!0}),_.default.cpSync(n,c,{recursive:!0})}catch(h){console.warn(`[UpdateManager] Failed to restore ${s}:`,h)}}try{_.default.rmSync(e,{recursive:!0,force:!0})}catch(s){console.warn("[UpdateManager] Failed to cleanup backup:",s)}}async updateInstance(e,t){let r=V.default.join(this.dataPath,"temp_instance.zip");try{await this.downloadFile(e.instance.url,r,t),t?.("Preparando atualiza\xE7\xE3o da inst\xE2ncia...",0),this.backupUserData(),_.default.existsSync(this.instanceDir),t?.("Extraindo inst\xE2ncia...",50),this.extractZip(r,this.instanceDir),this.restoreUserData();let s=this.getLocalVersions();s.instance=e.instance.version,this.saveLocalVersions(s),t?.("Inst\xE2ncia atualizada!",100)}finally{_.default.existsSync(r)&&_.default.unlinkSync(r)}}async updateLibraries(e,t){if(!e.libraries){console.log("[UpdateManager] Libraries update skipped - using Maven repos");return}let r=V.default.join(this.dataPath,"temp_libraries.zip");try{await this.downloadFile(e.libraries.url,r,t),t?.("Preparando atualiza\xE7\xE3o das bibliotecas...",0);let s=V.default.join(this.librariesDir,".bundled_extracted_v1");_.default.existsSync(s)&&_.default.unlinkSync(s),_.default.existsSync(this.librariesDir)&&_.default.rmSync(this.librariesDir,{recursive:!0,force:!0}),t?.("Extraindo bibliotecas...",50),this.extractZip(r,this.librariesDir),_.default.writeFileSync(V.default.join(this.librariesDir,".bundled_extracted_v2"),"extracted");let n=this.getLocalVersions();n.libraries=e.libraries.version,this.saveLocalVersions(n),t?.("Bibliotecas atualizadas!",100)}finally{_.default.existsSync(r)&&_.default.unlinkSync(r)}}async updateMods(e,t){if(!e.mods){console.log("[UpdateManager] No mods update available");return}let r=V.default.join(this.dataPath,"temp_mods.zip"),s=V.default.join(this.instanceDir,".minecraft","mods");try{await this.downloadFile(e.mods.url,r,t),t?.("Removendo mods antigos...",0),_.default.existsSync(s)&&_.default.rmSync(s,{recursive:!0,force:!0}),t?.("Instalando novos mods...",50),this.extractZip(r,V.default.join(this.instanceDir,".minecraft"));let n=this.getLocalVersions();n.mods=e.mods.version,this.saveLocalVersions(n),t?.("Mods atualizados!",100)}finally{_.default.existsSync(r)&&_.default.unlinkSync(r)}}async performAllUpdates(e){try{e?.("Verificando atualiza\xE7\xF5es...",0);let t=await this.checkForUpdates();if(!t.remoteVersions)return console.log("[UpdateManager] Could not fetch remote versions, skipping updates"),{success:!0};let r=[t.instanceUpdate,t.librariesUpdate,t.modsUpdate].filter(Boolean).length;if(r===0)return console.log("[UpdateManager] All components are up to date"),e?.("Tudo atualizado!",100),{success:!0};let s=0;if(t.instanceUpdate){s++;let n=(s-1)/r*100,c=100/r;await this.updateInstance(t.remoteVersions,(h,v)=>{let p=n+v/100*c;e?.(h,Math.round(p))})}if(t.librariesUpdate){s++;let n=(s-1)/r*100,c=100/r;await this.updateLibraries(t.remoteVersions,(h,v)=>{let p=n+v/100*c;e?.(h,Math.round(p))})}if(t.modsUpdate){s++;let n=(s-1)/r*100,c=100/r;await this.updateMods(t.remoteVersions,(h,v)=>{let p=n+v/100*c;e?.(h,Math.round(p))})}return e?.("Todas as atualiza\xE7\xF5es conclu\xEDdas!",100),{success:!0}}catch(t){return console.error("[UpdateManager] Update failed:",t),{success:!1,error:t.message}}}formatSize(e){return e<1024?e+" B":e<1024*1024?(e/1024).toFixed(1)+" KB":(e/(1024*1024)).toFixed(1)+" MB"}};var Cr=(0,Ht.promisify)(Fe.exec);function we(i){if(!I.default.existsSync(i))return!1;let e=I.default.readFileSync(i);return e.length>=4&&e[0]===80&&e[1]===75}function $t(i,e){if(!we(i)){let r=I.default.existsSync(i)?I.default.readFileSync(i):Buffer.alloc(0);throw console.error(`[GameHandler] Invalid ZIP file: ${i}. First bytes: ${r.slice(0,20).toString("hex")}`),new Error("Invalid ZIP file. The download may have failed.")}I.default.mkdirSync(e,{recursive:!0}),new je.default(i).extractAllTo(e,!0)}function Nr(i){return new Promise(e=>setTimeout(e,i))}async function Tt(i,e,t=3){let r=[500,1e3,2e3],s=null;for(let n=0;n<=t;n++)try{$t(i,e);return}catch(c){if(s=c,n<t){let h=r[n]||2e3;console.warn(`[GameHandler] Extraction failed (attempt ${n+1}/${t+1}), retrying in ${h}ms...`),await Nr(h)}}throw s||new Error(`Failed to extract ${i} after ${t+1} attempts`)}var Or="https://piston-meta.mojang.com/mc/game/version_manifest_v2.json",Mt="b1.7.3",Re=class{gamePath;javaPath;javaManager;updateManager;gameProcess=null;constructor(){this.gamePath=A.default.join(ie.app.getPath("userData"),"gamedata"),this.javaPath="java",this.javaManager=new Oe,this.updateManager=new _e}init(){ie.ipcMain.handle("launch-game",async(e,t)=>this.handleLaunch(e,t)),ie.ipcMain.handle("kill-game",async()=>this.gameProcess?(console.log("Killing game process..."),this.gameProcess.kill(),this.gameProcess=null,{success:!0}):{success:!1,error:"No game running"}),ie.ipcMain.handle("check-custom-instance",async()=>{let e=A.default.resolve("instance.zip"),t=A.default.join(ie.app.getPath("userData"),"instances","default","instance.cfg");return I.default.existsSync(e)||I.default.existsSync(t)}),ie.ipcMain.handle("check-update-status",async()=>this.handleUpdateCheck()),ie.ipcMain.handle("perform-update",async e=>this.handlePerformUpdate(e))}sendProgress(e,t,r){e.send("launch-progress",{status:t,progress:r})}async checkJava(e){try{return await Cr(`"${e}" -version`),!0}catch{return!1}}async checkAndExtractInstance(){let e=A.default.join(ie.app.getPath("userData"),"instances","default"),t=ie.app.getPath("userData");if(I.default.existsSync(A.default.join(e,"instance.cfg")))return console.log("Instance already exists, skipping extraction."),e;let r=A.default.join(t,"instance.zip");if(!I.default.existsSync(r)){console.log("instance.zip not found. Attempting to download from VPS...");let s=["https://craft.blocky.com.br/launcher-assets/instance.zip"];for(let n of s)try{console.log(`Trying to download instance.zip from ${n}...`);let c=await fetch(n,{signal:AbortSignal.timeout(6e4)});if(c.ok){let h=await c.arrayBuffer(),v=Buffer.from(h);if(v.length>=4&&v[0]===80&&v[1]===75){I.default.writeFileSync(r,v),console.log("instance.zip downloaded successfully from",n);break}else console.warn(`Downloaded content from ${n} is not a valid ZIP (got ${v.length} bytes, first bytes: ${v.slice(0,20).toString("hex")})`)}}catch(c){console.warn(`Failed to download instance.zip from ${n}:`,c)}}return I.default.existsSync(r)&&we(r)?(console.log("Extracting instance.zip..."),$t(r,e),e):null}async downloadFile(e,t,r,s){this.sendProgress(s,`Baixando ${r}...`,0),I.default.mkdirSync(t,{recursive:!0});let n=A.default.join(t,r);try{if(I.default.existsSync(n))return n;let c=await fetch(e);if(!c.ok)throw new Error(`Failed to download ${e}: ${c.statusText}`);let h=Number(c.headers.get("content-length"))||0,v=(0,Bt.createWriteStream)(n);if(!c.body)throw new Error("No body");let p=c.body.getReader(),D=0;for(;;){let{done:x,value:a}=await p.read();if(x)break;v.write(Buffer.from(a)),D+=a.length,h>0&&this.sendProgress(s,`Baixando ${r}`,Math.round(D/h*100))}await new Promise((x,a)=>{v.on("finish",x),v.on("error",a),v.end()});let L=I.default.statSync(n);if(r.endsWith(".jar")&&L.size<100)throw I.default.unlinkSync(n),new Error(`Downloaded file ${r} is too small (${L.size} bytes). Likely invalid.`);if(r.endsWith(".zip")&&!we(n)){let a=I.default.readFileSync(n).slice(0,20).toString("hex");throw I.default.unlinkSync(n),new Error(`Downloaded file ${r} is not a valid ZIP (first bytes: ${a}). Server may have returned an error page.`)}return n}catch(c){if(I.default.existsSync(n))try{I.default.unlinkSync(n)}catch{}throw new Error(`Download failed: ${c}`)}}async handleLaunch(e,t){console.log("Requesting game launch...",t),this.sendProgress(e.sender,"Verificando atualiza\xE7\xF5es...",2);try{let L=await this.updateManager.performAllUpdates((x,a)=>{let l=2+a/100*13;this.sendProgress(e.sender,x,Math.round(l))});L.success||console.warn("Update check failed, continuing anyway:",L.error)}catch(L){console.warn("Update check failed, continuing anyway:",L)}let r=await this.checkAndExtractInstance(),s=!!r,n=r||this.gamePath,c=s?A.default.join(n,".minecraft"):n;I.default.existsSync(c)||I.default.mkdirSync(c,{recursive:!0});let h=A.default.join(c,".fabric","remappedJars");I.default.existsSync(h)&&(console.log("Clearing remappedJars cache to force fresh map..."),I.default.rmSync(h,{recursive:!0,force:!0}));let v=A.default.join(c,"bin"),p=A.default.join(n,"natives"),D=A.default.join(n,"libraries");try{if(!t.username)throw new Error("Username required");this.sendProgress(e.sender,"Verificando Java...",5);try{this.javaPath=t.javaPath||await this.javaManager.ensureJava(e.sender)}catch(C){throw new Error("Falha ao configurar Java: "+C.message)}this.sendProgress(e.sender,"Verificando vers\xE3o...",65);let a=(await(await fetch(Or)).json()).versions.find(C=>C.id===Mt);if(!a)throw new Error(`Version ${Mt} not found`);let g=await(await fetch(a.url)).json(),d=g.downloads.client.url,u=await this.downloadFile(d,v,"minecraft.jar",e.sender);if(!s){this.sendProgress(e.sender,"Baixando bibliotecas...",70);let C="natives-linux";process.platform==="win32"?C="natives-windows":process.platform==="darwin"&&(C="natives-osx");for(let T of g.libraries)if(T.downloads&&T.downloads.classifiers&&T.downloads.classifiers[C]){let Y=T.downloads.classifiers[C],se=await this.downloadFile(Y.url,A.default.join(n,"temp_natives"),A.default.basename(Y.path),e.sender);we(se)?new je.default(se).extractAllTo(p,!0):console.warn(`[GameHandler] Skipping invalid native file: ${se}`)}let F=A.default.join(p,process.platform==="win32"?"OpenAL-amd64.dll":"libopenal.so");if(!I.default.existsSync(F)){console.log("[GameHandler] OpenAL not found, downloading from Legacy Fabric..."),this.sendProgress(e.sender,"Baixando OpenAL...",72);let T="natives-linux";process.platform==="win32"?T="natives-windows":process.platform==="darwin"&&(T="natives-osx");let Y=`https://repo.legacyfabric.net/repository/legacyfabric/org/lwjgl/lwjgl/lwjgl-platform/2.9.4+legacyfabric.9/lwjgl-platform-2.9.4+legacyfabric.9-${T}.jar`;try{let se=await this.downloadFile(Y,A.default.join(n,"temp_natives"),`lwjgl-platform-${T}.jar`,e.sender);we(se)&&(new je.default(se).extractAllTo(p,!0),console.log("[GameHandler] OpenAL natives extracted successfully"))}catch(se){console.warn("[GameHandler] Failed to download OpenAL natives:",se)}}}let y=[u],o="net.minecraft.client.Minecraft",f="";if(s){let C=A.default.join(r,"mmc-pack.json");if(I.default.existsSync(C)&&JSON.parse(I.default.readFileSync(C,"utf-8")).components.find(Y=>Y.uid==="net.fabricmc.fabric-loader")){this.sendProgress(e.sender,"Configurando Fabric/StationAPI...",75);let Y=[{name:"asm:9.7.1",group:"org.ow2.asm",artifact:"asm",version:"9.7.1"},{name:"asm-analysis:9.7.1",group:"org.ow2.asm",artifact:"asm-analysis",version:"9.7.1"},{name:"asm-commons:9.7.1",group:"org.ow2.asm",artifact:"asm-commons",version:"9.7.1"},{name:"asm-tree:9.7.1",group:"org.ow2.asm",artifact:"asm-tree",version:"9.7.1"},{name:"asm-util:9.7.1",group:"org.ow2.asm",artifact:"asm-util",version:"9.7.1"},{name:"sponge-mixin:0.15.3+mixin.0.8.7",group:"net.fabricmc",artifact:"sponge-mixin",version:"0.15.3+mixin.0.8.7"},{name:"mixinextras-fabric:0.4.1",group:"io.github.llamalad7",artifact:"mixinextras-fabric",version:"0.4.1"},{name:"commons-lang3:3.12.0",group:"org.apache.commons",artifact:"commons-lang3",version:"3.12.0"},{name:"commons-io:2.11.0",group:"commons-io",artifact:"commons-io",version:"2.11.0"},{name:"commons-codec:1.15",group:"commons-codec",artifact:"commons-codec",version:"1.15"},{name:"jutils:1.0.0",group:"net.java.jutils",artifact:"jutils",version:"1.0.0"},{name:"jinput:2.0.5",group:"net.java.jinput",artifact:"jinput",version:"2.0.5"},{name:"lwjgl:2.9.4+legacyfabric.9",group:"org.lwjgl.lwjgl",artifact:"lwjgl",version:"2.9.4+legacyfabric.9"},{name:"lwjgl_util:2.9.4+legacyfabric.9",group:"org.lwjgl.lwjgl",artifact:"lwjgl_util",version:"2.9.4+legacyfabric.9"},{name:"log4j-api:2.16.0",group:"org.apache.logging.log4j",artifact:"log4j-api",version:"2.16.0"},{name:"log4j-core:2.16.0",group:"org.apache.logging.log4j",artifact:"log4j-core",version:"2.16.0"},{name:"log4j-slf4j18-impl:2.16.0",group:"org.apache.logging.log4j",artifact:"log4j-slf4j18-impl",version:"2.16.0"},{name:"terminalconsoleappender:1.2.0",group:"net.minecrell",artifact:"terminalconsoleappender",version:"1.2.0"},{name:"slf4j-api:1.8.0-beta4",group:"org.slf4j",artifact:"slf4j-api",version:"1.8.0-beta4"},{name:"guava:31.0.1-jre",group:"com.google.guava",artifact:"guava",version:"31.0.1-jre"},{name:"failureaccess:1.0.1",group:"com.google.guava",artifact:"failureaccess",version:"1.0.1"},{name:"gson:2.8.9",group:"com.google.code.gson",artifact:"gson",version:"2.8.9"},{name:"log4j-config:1.0.0",group:"babric",artifact:"log4j-config",version:"1.0.0"}],se="https://maven.fabricmc.net/",De="https://repo1.maven.org/maven2/",Ge="https://repo.legacyfabric.net/repository/legacyfabric/",Zt="https://maven.glass-launcher.net/babric/";console.log("[GameHandler] Using Maven-based library downloads"),I.default.existsSync(D)||I.default.mkdirSync(D,{recursive:!0});for(let R of Y){let q=`${R.group.replace(/\./g,"/")}/${R.artifact}/${R.version}/${R.artifact}-${R.version}.jar`,ce=A.default.join(D,`${R.artifact}-${R.version}.jar`);if(I.default.existsSync(ce)){y.push(ce);continue}let ne=se+q;["org.apache","commons-io","commons-codec","net.java.jutils","net.java.jinput","org.ow2.asm","com.google.guava","com.google.code.gson","org.slf4j","io.github.llamalad7","net.minecrell"].some(Je=>R.group.startsWith(Je)||R.group===Je)?ne=De+q:R.group.startsWith("org.lwjgl")?ne=Ge+q:R.group==="babric"&&(ne=Zt+q);let Xt=await this.downloadFile(ne,D,`${R.artifact}-${R.version}.jar`,e.sender);y.push(Xt)}this.sendProgress(e.sender,"Baixando nativos...",78),I.default.existsSync(p)&&(console.log("[GameHandler] Clearing natives folder for fresh extraction..."),I.default.rmSync(p,{recursive:!0,force:!0})),I.default.mkdirSync(p,{recursive:!0});let Le="natives-linux";process.platform==="win32"?Le="natives-windows":process.platform==="darwin"&&(Le="natives-osx");let Gt=[{group:"org.lwjgl.lwjgl",artifact:"lwjgl-platform",version:"2.9.4+legacyfabric.9",classifier:Le},{group:"net.java.jinput",artifact:"jinput-platform",version:"2.0.5",classifier:Le}];for(let R of Gt){let q=`${R.artifact}-${R.version}-${R.classifier}.jar`,ce=`${R.group.replace(/\./g,"/")}/${R.artifact}/${R.version}/${q}`,ne=A.default.join(D,q);if(I.default.existsSync(ne)){console.log(`[Cache] Found native library locally: ${q}`),await Tt(ne,p);continue}let pe=Ge+ce;R.group==="net.java.jinput"&&(pe=De+ce);let We=await this.downloadFile(pe,A.default.join(n,"temp_natives"),q,e.sender);await Tt(We,p)}if(process.platform==="darwin")try{let R=I.default.readdirSync(p);for(let q of R)if(q.endsWith(".jnilib")){let ce=A.default.join(p,q),ne=A.default.join(p,q.replace(".jnilib",".dylib"));if(I.default.existsSync(ce)){console.log(`[GameHandler] Renaming ${q} to .dylib`);try{I.default.existsSync(ne)&&I.default.unlinkSync(ne),I.default.renameSync(ce,ne)}catch(pe){console.warn(`[GameHandler] Failed to rename ${q}:`,pe)}}}}catch(R){console.warn("[GameHandler] Failed to process macOS natives:",R)}try{let R=I.default.readdirSync(p);console.log(`[GameHandler] Natives folder contents (${p}):`,R)}catch(R){console.error("[GameHandler] Failed to read natives folder:",R)}let Wt=await this.downloadFile("https://maven.fabricmc.net/net/fabricmc/fabric-loader/0.16.7/fabric-loader-0.16.7.jar",D,"fabric-loader-0.16.7.jar",e.sender),Jt=await this.downloadFile("https://maven.glass-launcher.net/babric/babric/intermediary-upstream/b1.7.3/intermediary-upstream-b1.7.3.jar",D,"intermediary-upstream-b1.7.3.jar",e.sender);y.push(Wt),y.push(Jt),o="net.fabricmc.loader.impl.launch.knot.KnotClient";let Te=[];for(let R of y)R!==u&&Te.push(R);Te.push(u),y=Te}}if(!s){for(let C of g.libraries)if(C.downloads&&C.downloads.artifact){let F=C.downloads.artifact;if(F.path.includes("lwjgl")||F.path.includes("jinput")){let T=await this.downloadFile(F.url,v,A.default.basename(F.path),e.sender);y.push(T)}}}this.sendProgress(e.sender,"Iniciando Jogo...",95);let m=t.settings?.minMemory||"512",b=t.settings?.maxMemory||"2048",w=t.settings?.javaArgs||"",N="";try{if(I.default.existsSync(p)){let C=I.default.readdirSync(p),F=process.platform==="win32"?["OpenAL64.dll","OpenAL32.dll","OpenAL-amd64.dll","OpenAL-i386.dll","OpenAL.dll"]:process.platform==="darwin"?["libopenal.dylib","openal.dylib"]:["libopenal.so","libopenal-amd64.so","libopenal-i386.so"];for(let T of F)if(C.includes(T)){N=A.default.join(p,T),console.log(`[GameHandler] Found OpenAL library: ${N}`);break}if(!N){let T=C.find(Y=>Y.toLowerCase().includes("openal")&&(Y.endsWith(".dll")||Y.endsWith(".so")||Y.endsWith(".dylib")));T&&(N=A.default.join(p,T),console.log(`[GameHandler] Found OpenAL library (fallback): ${N}`))}}}catch(C){console.warn("[GameHandler] Failed to scan for OpenAL lib:",C)}let j=A.default.join(c,"resources"),U=[`-Xms${m}M`,`-Xmx${b}M`,"-Djava.library.path="+p,"-Dfabric.gameJarPath="+u,"-Dfabric.gameVersion=b1.7.3","-Dfabric.envType=client","-Dslf4j.internal.verbosity=ERROR","-Dminecraft.resources.index="+j,"-Dminecraft.applet.TargetDirectory="+c,"-Dminecraft.applet.BaseURL=file:///"];if(w.trim()){let C=w.trim().split(/\s+/).filter(F=>F.length>0);U.push(...C)}U.push("-cp",y.join(A.default.delimiter)),U.push(o),U.push("--username",t.username),U.push("--gameDir",c),U.push("--assetsDir",A.default.join(c,"resources")),s&&o.includes("KnotClient")&&U.push("--assetIndex","truly_legacy"),U.push("--server","185.100.215.195"),U.push("--port","25565"),console.log("Spawning java:",this.javaPath),console.log("Args:",U);let O={...process.env};if(process.platform==="linux"&&(O.ALSOFT_CONF="period_size=2048",O.ALSOFT_DRIVERS="pulse,alsa,oss"),process.platform==="win32"){let C=Object.keys(O).find(F=>F.toLowerCase()==="path")||"Path";O[C]=p+A.default.delimiter+(O[C]||""),console.log("[GameHandler] Updated PATH with natives:",p)}this.gameProcess=(0,Fe.spawn)(this.javaPath,U,{cwd:c,env:O});let te=Ue();te&&te.setGameRunning(!0);let X=["s3.amazonaws.com/MinecraftResources","Failed to add pack.mcmeta","Failed to add READ_ME_I_AM_VERY_IMPORTANT"];return this.gameProcess.stdout.on("data",C=>{let F=C.toString().trim();F&&(S.game("stdout",F),!X.some(T=>F.includes(T))&&(console.log(`[MC]: ${F}`),F.includes("Connecting to")&&e.sender.send("game-connected")))}),this.gameProcess.stderr.on("data",C=>{let F=C.toString().trim();F&&(S.game("stderr",F),!X.some(T=>F.includes(T))&&console.error(`[MC-Err]: ${F}`))}),this.gameProcess.on("close",C=>{S.info("GameHandler",`Minecraft exited with code ${C}`),console.log(`Minecraft exited with code ${C}`),this.sendProgress(e.sender,"Jogo fechado",100),this.gameProcess=null,e.sender.send("game-closed",C);let F=Ue();F&&F.setGameRunning(!1)}),{success:!0}}catch(L){return console.error("Launch failed:",L),this.sendProgress(e.sender,`Erro: ${L.message}`,0),{success:!1,error:L.message,stack:L.stack}}}async handleUpdateCheck(){try{let e=await this.updateManager.checkForUpdates();return e.remoteVersions?e.instanceUpdate||e.librariesUpdate||e.modsUpdate?{available:!0,instanceUpdate:e.instanceUpdate,librariesUpdate:e.librariesUpdate,modsUpdate:e.modsUpdate,notes:e.remoteVersions.mods?.notes||"Atualiza\xE7\xF5es dispon\xEDveis"}:{available:!1}:{available:!1,error:"Failed to fetch version info"}}catch(e){return console.error("Update check failed:",e),{available:!1,error:String(e)}}}async handlePerformUpdate(e){try{return await this.updateManager.performAllUpdates((r,s)=>{this.sendProgress(e.sender,r,s)})}catch(t){return console.error("Update failed:",t),this.sendProgress(e.sender,`Erro na atualiza\xE7\xE3o: ${t}`,0),{success:!1,error:String(t)}}}};var be=require("electron"),Q=Z(require("fs"),1),ee=Z(require("path"),1),kt=Z(Ee(),1);var Ae=class{userDataPath;activeModsDir="";constructor(){this.userDataPath=be.app.getPath("userData")}init(){be.ipcMain.handle("get-mods",async()=>(S.info("ModHandler","Fetching mods list..."),this.getMods())),be.ipcMain.handle("toggle-mod",async(e,{fileName:t,enable:r})=>(S.info("ModHandler",`Toggling mod ${t} to ${r}`),this.toggleMod(t,r)))}async toggleMod(e,t){if(!this.activeModsDir){let s="Cannot toggle mod: No active mods directory found.";return S.error("ModHandler",s),{success:!1,error:s}}let r=ee.default.join(this.activeModsDir,"disabled");if(!Q.default.existsSync(r))try{await Q.default.promises.mkdir(r,{recursive:!0})}catch(s){let n=`Failed to create disabled directory: ${s.message}`;return S.error("ModHandler",n),{success:!1,error:n}}try{if(t){let s=ee.default.join(r,e),n=ee.default.join(this.activeModsDir,e);if(Q.default.existsSync(s)){if(Q.default.existsSync(n)){let h=`Destination file already exists: ${n}`;return S.warn("ModHandler",h),{success:!1,error:h}}return await this.moveFile(s,n)?(S.info("ModHandler",`Enabled mod: Moved ${e} to active folder`),{success:!0}):{success:!1,error:"Move operation failed (check logs)"}}else{let c=`Cannot enable: File not found in disabled folder: ${s}`;return S.warn("ModHandler",c),{success:!1,error:c}}}else{let s=ee.default.join(this.activeModsDir,e),n=ee.default.join(r,e);if(Q.default.existsSync(s))return await this.moveFile(s,n)?(S.info("ModHandler",`Disabled mod: Moved ${e} to disabled folder`),{success:!0}):{success:!1,error:"Move operation failed (check logs)"};{let c=`Cannot disable: File not found in active folder: ${s}`;return S.warn("ModHandler",c),{success:!1,error:c}}}}catch(s){return S.error("ModHandler",`Failed to toggle mod ${e}: ${s.message}`),{success:!1,error:s.message}}}async moveFile(e,t){try{return await Q.default.promises.rename(e,t),!0}catch(r){S.warn("ModHandler",`Rename failed for ${ee.default.basename(e)}, trying copy+unlink: ${r}`);try{return await Q.default.promises.copyFile(e,t),await Q.default.promises.unlink(e),!0}catch(s){return S.error("ModHandler",`Move failed completely for ${ee.default.basename(e)}: ${s}`),!1}}}async getMods(){let e=[ee.default.join(this.userDataPath,"instances","default",".minecraft","mods"),ee.default.join(this.userDataPath,"instances","default","mods"),ee.default.join(this.userDataPath,"gamedata","mods")],t="";for(let c of e)if(Q.default.existsSync(c)){t=c,S.info("ModHandler",`Found mods directory at: ${t}`);break}if(!t)return S.warn("ModHandler","No valid mods directory found in standard locations."),[];this.activeModsDir=t;let r=ee.default.join(t,"disabled"),s=[],n=async(c,h)=>{if(Q.default.existsSync(c))try{let v=await Q.default.promises.readdir(c);for(let p of v){if(!p.endsWith(".jar"))continue;let D=ee.default.join(c,p);if((await Q.default.promises.stat(D)).isDirectory())continue;let x={fileName:p,enabled:h,name:p,description:"",version:""};try{let l=new kt.default(D).getEntries(),g=l.find(y=>y.entryName==="fabric.mod.json"),d=l.find(y=>y.entryName==="mod.json"),u=g||d;if(u){let y=u.getData().toString("utf8"),o=JSON.parse(y);o.name&&(x.name=o.name),o.description&&(x.description=o.description),o.version&&(x.version=o.version)}}catch(a){S.warn("ModHandler",`Could not read metadata for ${p}: ${a}`)}s.push(x)}}catch(v){S.error("ModHandler",`Error scanning directory ${c}: ${v}`)}};return await n(t,!0),await n(r,!1),s.sort((c,h)=>c.enabled===h.enabled?c.name.localeCompare(h.name):c.enabled?-1:1)}};var K=require("electron");var Pe=class{overlayWindow=null;browserView=null;isVisible=!1;isGameRunning=!1;hotkeyRegistered=!1;OVERLAY_URL="https://craft.blocky.com.br";HEADER_HEIGHT=48;init(){S.info("OverlayHandler","Initializing overlay handler"),this.registerHotkey(),this.setupIPC()}setupIPC(){K.ipcMain.on("overlay-go-back",()=>{this.browserView&&!this.browserView.webContents.isDestroyed()&&this.browserView.webContents.canGoBack()&&(this.browserView.webContents.goBack(),S.info("OverlayHandler","Navigated back"))}),K.ipcMain.on("overlay-go-home",()=>{this.browserView&&!this.browserView.webContents.isDestroyed()&&(this.browserView.webContents.loadURL(this.OVERLAY_URL),S.info("OverlayHandler","Navigated to home"))}),K.ipcMain.on("overlay-close",()=>{this.hideOverlay(),S.info("OverlayHandler","Closed via IPC")})}registeredHotkey=null;HOTKEY_CANDIDATES=["Shift+Tab","F6","CommandOrControl+Tab"];registerHotkey(){for(let e of this.HOTKEY_CANDIDATES)try{if(K.globalShortcut.isRegistered(e)){S.info("OverlayHandler",`Hotkey ${e} is already registered by another application`);continue}if(K.globalShortcut.register(e,()=>{S.info("OverlayHandler",`${e} pressed`),this.toggleOverlay()})){this.registeredHotkey=e,this.hotkeyRegistered=!0,S.info("OverlayHandler",`Overlay hotkey registered successfully: ${e}`);return}else S.warn("OverlayHandler",`Failed to register hotkey user candidate: ${e}`)}catch(t){S.error("OverlayHandler",`Exception registering ${e}: ${t.message}`)}S.error("OverlayHandler","Failed to register ANY overlay hotkey. Overlay will not be accessible.")}cleanup(){this.hotkeyRegistered&&this.registeredHotkey&&(K.globalShortcut.unregister(this.registeredHotkey),this.hotkeyRegistered=!1,this.registeredHotkey=null,S.info("OverlayHandler","Hotkey unregistered")),this.overlayWindow&&!this.overlayWindow.isDestroyed()&&(this.overlayWindow.setBrowserView(null),this.browserView&&!this.browserView.webContents.isDestroyed()&&this.browserView.webContents.destroy(),this.overlayWindow.destroy(),this.overlayWindow=null,this.browserView=null)}createOverlayWindow(){if(this.overlayWindow&&!this.overlayWindow.isDestroyed()){S.info("OverlayHandler","Overlay window already exists");return}let e=K.screen.getPrimaryDisplay(),{width:t,height:r}=e.size,s=Math.min(Math.floor(t*.85),1400),n=Math.min(Math.floor(r*.85),900),c=Math.floor((t-s)/2),h=Math.floor((r-n)/2);S.info("OverlayHandler",`Creating overlay: ${s}x${n} at (${c}, ${h})`),this.overlayWindow=new K.BrowserWindow({width:s,height:n,x:c,y:h,frame:!1,transparent:!1,alwaysOnTop:!0,skipTaskbar:!0,show:!1,resizable:!1,movable:!1,focusable:!0,hasShadow:!0,backgroundColor:"#1e1e1e",webPreferences:{nodeIntegration:!0,contextIsolation:!1,sandbox:!1}});let v=`
<!DOCTYPE html>
<html>
<head>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { margin: 0; overflow: hidden; background: #1e1e1e; font-family: 'Inter', system-ui, -apple-system, sans-serif; }
        #blockycraft-nav-bar {
            height: ${this.HEADER_HEIGHT}px;
            background: #1e1e1e;
            border-bottom: 1px solid #333333;
            display: flex;
            align-items: center;
            padding: 0 16px;
            gap: 8px;
            color: white;
            user-select: none;
        }
        #blockycraft-nav-bar button {
            background: #2a2a2a;
            border: 1px solid #333333;
            color: #ffffff;
            width: 36px;
            height: 36px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        #blockycraft-nav-bar button:hover {
            background: #333333;
            border-color: #444444;
        }
        #blockycraft-nav-bar button svg {
            width: 20px;
            height: 20px;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
            fill: none;
        }
        #blockycraft-nav-bar .nav-title {
            color: #a1a1aa;
            font-size: 13px;
            margin-left: auto;
            font-weight: 500;
        }
        #blockycraft-nav-bar .close-btn {
            background: transparent;
            border-color: transparent;
            color: #ffffff;
            margin-left: 8px;
        }
        #blockycraft-nav-bar .close-btn:hover {
            background: #ef4444;
            border-color: #ef4444;
            color: #ffffff;
        }
    </style>
</head>
<body>
    <div id="blockycraft-nav-bar">
        <button id="bc-back-btn" title="Voltar" onclick="window.overlayAPI.goBack()">
            <svg viewBox="0 0 24 24"><path d="m15 18-6-6 6-6"/></svg>
        </button>
        <button id="bc-home-btn" title="In\xEDcio" onclick="window.overlayAPI.goHome()">
            <svg viewBox="0 0 24 24"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        </button>
        <span class="nav-title">BlockyCRAFT Overlay</span>
        <button class="close-btn" id="bc-close-btn" title="Fechar (Shift+Tab)" onclick="window.overlayAPI.close()">
            <svg viewBox="0 0 24 24"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
        </button>
    </div>
    <script>
        const { ipcRenderer } = require('electron');
        window.overlayAPI = {
            goBack: () => ipcRenderer.send('overlay-go-back'),
            goHome: () => ipcRenderer.send('overlay-go-home'),
            close: () => ipcRenderer.send('overlay-close')
        };
    </script>
</body>
</html>`;this.overlayWindow.loadURL(`data:text/html;charset=utf-8,${encodeURIComponent(v)}`),this.browserView=new K.BrowserView({webPreferences:{nodeIntegration:!1,contextIsolation:!0,sandbox:process.platform!=="linux"}}),this.overlayWindow.setBrowserView(this.browserView),this.browserView.setBounds({x:0,y:this.HEADER_HEIGHT,width:s,height:n-this.HEADER_HEIGHT}),this.browserView.setAutoResize({width:!0,height:!0}),this.browserView.webContents.on("did-start-loading",()=>{S.info("OverlayHandler","Browser started loading")}),this.browserView.webContents.on("did-fail-load",(p,D,L)=>{S.error("OverlayHandler",`Failed to load: ${D} - ${L}`)}),this.browserView.webContents.setWindowOpenHandler(({url:p})=>(S.info("OverlayHandler",`Intercepted new window request: ${p}`),this.browserView&&!this.browserView.webContents.isDestroyed()&&this.browserView.webContents.loadURL(p),{action:"deny"})),this.browserView.webContents.on("before-input-event",(p,D)=>{D.key==="Escape"&&D.type==="keyDown"&&this.hideOverlay()}),this.overlayWindow.webContents.on("before-input-event",(p,D)=>{D.key==="Escape"&&D.type==="keyDown"&&this.hideOverlay()}),S.info("OverlayHandler",`Loading URL: ${this.OVERLAY_URL}`),this.browserView.webContents.loadURL(this.OVERLAY_URL),this.overlayWindow.on("close",p=>{this.overlayWindow&&!this.overlayWindow.isDestroyed()&&(p.preventDefault(),this.hideOverlay())}),S.info("OverlayHandler","Overlay window created with BrowserView")}toggleOverlay(){if(!this.isGameRunning){S.info("OverlayHandler","Game not running - overlay disabled");return}this.isVisible?this.hideOverlay():this.showOverlay()}showOverlay(){(!this.overlayWindow||this.overlayWindow.isDestroyed())&&(S.info("OverlayHandler","Creating overlay window on first use..."),this.createOverlayWindow()),this.overlayWindow&&(this.overlayWindow.show(),this.overlayWindow.focus(),this.overlayWindow.setAlwaysOnTop(!0,"screen-saver"),this.isVisible=!0,S.info("OverlayHandler","Overlay shown"))}hideOverlay(){this.overlayWindow&&!this.overlayWindow.isDestroyed()&&(this.overlayWindow.hide(),this.isVisible=!1,S.info("OverlayHandler","Overlay hidden"))}setGameRunning(e){this.isGameRunning=e,S.info("OverlayHandler",`Game running state: ${e}`),!e&&this.isVisible&&this.hideOverlay()}isGameActive(){return this.isGameRunning}isOverlayVisible(){return this.isVisible}};W.app.commandLine.appendSwitch("no-sandbox");W.app.commandLine.appendSwitch("ozone-platform-hint","auto");var _r=new Re;_r.init();var jr=new Ae;jr.init();var ue=null;function Ue(){return ue}console.log("=== BlockyCRAFT Launcher Starting ===");console.log("Electron version:",process.versions.electron);var ae=null,Vt=process.env.VITE_DEV_SERVER_URL;function zt(){if(console.log("Creating main window..."),ae=new W.BrowserWindow({width:900,height:600,minWidth:800,minHeight:500,frame:!0,resizable:!0,webPreferences:{nodeIntegration:!1,contextIsolation:!0,preload:Ze.default.join(__dirname,"preload.cjs"),sandbox:!1},backgroundColor:"#0f0f0f",show:!0,autoHideMenuBar:!0}),ae.setMenu(null),W.ipcMain.handle("open-external",async(i,e)=>{console.log("Opening external URL:",e);try{let{shell:t}=await import("electron");await t.openExternal(e)}catch(t){console.error("Failed to open external URL:",t)}}),W.ipcMain.handle("fetch-url",async(i,e)=>{S.info("Main",`Proxying fetch request to: ${e}`);let{net:t}=await import("electron");try{let r=await t.fetch(e);if(!r.ok)throw new Error(`HTTP ${r.status} ${r.statusText}`);return{success:!0,data:await r.text()}}catch(r){return S.error("Main",`Fetch failed for ${e}: ${r.message}`),{success:!1,error:r.message}}}),console.log("Window created, loading content..."),Vt)ae.loadURL(Vt);else{let i=Ze.default.join(__dirname,"../dist/index.html");ae.loadFile(i)}ae.webContents.on("did-finish-load",()=>{console.log("Create Window: did-finish-load")}),ae.webContents.on("did-fail-load",(i,e,t,r)=>{console.error("Create Window: did-fail-load",e,t,r)}),ae.webContents.on("render-process-gone",(i,e)=>{console.error("Create Window: render-process-gone",e)}),ae.webContents.on("unresponsive",()=>{console.error("Create Window: unresponsive")}),ae.on("closed",()=>{ue&&ue.cleanup(),ae=null,W.app.quit()})}W.app.whenReady().then(()=>{S.init(),S.info("Main",`Electron version: ${process.versions.electron}`),S.info("Main",`Node version: ${process.versions.node}`),S.info("Main",`Platform: ${process.platform} ${process.arch}`),ue=new Pe,ue.init(),zt()});W.app.on("will-quit",()=>{ue&&ue.cleanup(),W.globalShortcut.unregisterAll()});W.app.on("window-all-closed",()=>{process.platform!=="darwin"&&W.app.quit()});W.app.on("activate",()=>{W.BrowserWindow.getAllWindows().length===0&&zt()});0&&(module.exports={getOverlayHandler});
