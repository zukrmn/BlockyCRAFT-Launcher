var rr=Object.create;var _e=Object.defineProperty;var nr=Object.getOwnPropertyDescriptor;var or=Object.getOwnPropertyNames;var ir=Object.getPrototypeOf,sr=Object.prototype.hasOwnProperty;var Y=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports),ar=(i,e)=>{for(var t in e)_e(i,t,{get:e[t],enumerable:!0})},lt=(i,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of or(e))!sr.call(i,s)&&s!==t&&_e(i,s,{get:()=>e[s],enumerable:!(r=nr(e,s))||r.enumerable});return i};var z=(i,e,t)=>(t=i!=null?rr(ir(i)):{},lt(e||!i||!i.__esModule?_e(t,"default",{value:i,enumerable:!0}):t,i)),lr=i=>lt(_e({},"__esModule",{value:!0}),i);var Ke=Y((kr,dt)=>{dt.exports={LOCHDR:30,LOCSIG:67324752,LOCVER:4,LOCFLG:6,LOCHOW:8,LOCTIM:10,LOCCRC:14,LOCSIZ:18,LOCLEN:22,LOCNAM:26,LOCEXT:28,EXTSIG:134695760,EXTHDR:16,EXTCRC:4,EXTSIZ:8,EXTLEN:12,CENHDR:46,CENSIG:33639248,CENVEM:4,CENVER:6,CENFLG:8,CENHOW:10,CENTIM:12,CENCRC:16,CENSIZ:20,CENLEN:24,CENNAM:28,CENEXT:30,CENCOM:32,CENDSK:34,CENATT:36,CENATX:38,CENOFF:42,ENDHDR:22,ENDSIG:101010256,ENDSUB:8,ENDTOT:10,ENDSIZ:12,ENDOFF:16,ENDCOM:20,END64HDR:20,END64SIG:117853008,END64START:4,END64OFF:8,END64NUMDISKS:16,ZIP64SIG:101075792,ZIP64HDR:56,ZIP64LEAD:12,ZIP64SIZE:4,ZIP64VEM:12,ZIP64VER:14,ZIP64DSK:16,ZIP64DSKDIR:20,ZIP64SUB:24,ZIP64TOT:32,ZIP64SIZB:40,ZIP64OFF:48,ZIP64EXTRA:56,STORED:0,SHRUNK:1,REDUCED1:2,REDUCED2:3,REDUCED3:4,REDUCED4:5,IMPLODED:6,DEFLATED:8,ENHANCED_DEFLATED:9,PKWARE:10,BZIP2:12,LZMA:14,IBM_TERSE:18,IBM_LZ77:19,AES_ENCRYPT:99,FLG_ENC:1,FLG_COMP1:2,FLG_COMP2:4,FLG_DESC:8,FLG_ENH:16,FLG_PATCH:32,FLG_STR:64,FLG_EFS:2048,FLG_MSK:4096,FILE:2,BUFFER:1,NONE:0,EF_ID:0,EF_SIZE:2,ID_ZIP64:1,ID_AVINFO:7,ID_PFS:8,ID_OS2:9,ID_NTFS:10,ID_OPENVMS:12,ID_UNIX:13,ID_FORK:14,ID_PATCH:15,ID_X509_PKCS7:20,ID_X509_CERTID_F:21,ID_X509_CERTID_C:22,ID_STRONGENC:23,ID_RECORD_MGT:24,ID_X509_PKCS7_RL:25,ID_IBM1:101,ID_IBM2:102,ID_POSZIP:18064,EF_ZIP64_OR_32:4294967295,EF_ZIP64_OR_16:65535,EF_ZIP64_SUNCOMP:0,EF_ZIP64_SCOMP:8,EF_ZIP64_RHO:16,EF_ZIP64_DSN:24}});var Pe=Y(ut=>{var ft={INVALID_LOC:"Invalid LOC header (bad signature)",INVALID_CEN:"Invalid CEN header (bad signature)",INVALID_END:"Invalid END header (bad signature)",DESCRIPTOR_NOT_EXIST:"No descriptor present",DESCRIPTOR_UNKNOWN:"Unknown descriptor format",DESCRIPTOR_FAULTY:"Descriptor data is malformed",NO_DATA:"Nothing to decompress",BAD_CRC:"CRC32 checksum failed {0}",FILE_IN_THE_WAY:"There is a file in the way: {0}",UNKNOWN_METHOD:"Invalid/unsupported compression method",AVAIL_DATA:"inflate::Available inflate data did not terminate",INVALID_DISTANCE:"inflate::Invalid literal/length or distance code in fixed or dynamic block",TO_MANY_CODES:"inflate::Dynamic block code description: too many length or distance codes",INVALID_REPEAT_LEN:"inflate::Dynamic block code description: repeat more than specified lengths",INVALID_REPEAT_FIRST:"inflate::Dynamic block code description: repeat lengths with no first length",INCOMPLETE_CODES:"inflate::Dynamic block code description: code lengths codes incomplete",INVALID_DYN_DISTANCE:"inflate::Dynamic block code description: invalid distance code lengths",INVALID_CODES_LEN:"inflate::Dynamic block code description: invalid literal/length code lengths",INVALID_STORE_BLOCK:"inflate::Stored block length did not match one's complement",INVALID_BLOCK_TYPE:"inflate::Invalid block type (type == 3)",CANT_EXTRACT_FILE:"Could not extract the file",CANT_OVERRIDE:"Target file already exists",DISK_ENTRY_TOO_LARGE:"Number of disk entries is too large",NO_ZIP:"No zip file was loaded",NO_ENTRY:"Entry doesn't exist",DIRECTORY_CONTENT_ERROR:"A directory cannot have content",FILE_NOT_FOUND:'File not found: "{0}"',NOT_IMPLEMENTED:"Not implemented",INVALID_FILENAME:"Invalid filename",INVALID_FORMAT:"Invalid or unsupported zip format. No END header found",INVALID_PASS_PARAM:"Incompatible password parameter",WRONG_PASSWORD:"Wrong Password",COMMENT_TOO_LONG:"Comment is too long",EXTRA_FIELD_PARSE_ERROR:"Extra field parsing error"};function cr(i){return function(...e){return e.length&&(i=i.replace(/\{(\d)\}/g,(t,r)=>e[r]||"")),new Error("ADM-ZIP: "+i)}}for(let i of Object.keys(ft))ut[i]=cr(ft[i])});var yt=Y((Br,pt)=>{var dr=require("fs"),J=require("path"),mt=Ke(),fr=Pe(),ur=typeof process=="object"&&process.platform==="win32",ht=i=>typeof i=="object"&&i!==null,gt=new Uint32Array(256).map((i,e)=>{for(let t=0;t<8;t++)(e&1)!==0?e=3988292384^e>>>1:e>>>=1;return e>>>0});function $(i){this.sep=J.sep,this.fs=dr,ht(i)&&ht(i.fs)&&typeof i.fs.statSync=="function"&&(this.fs=i.fs)}pt.exports=$;$.prototype.makeDir=function(i){let e=this;function t(r){let s=r.split(e.sep)[0];r.split(e.sep).forEach(function(n){if(!(!n||n.substr(-1,1)===":")){s+=e.sep+n;var a;try{a=e.fs.statSync(s)}catch{e.fs.mkdirSync(s)}if(a&&a.isFile())throw fr.FILE_IN_THE_WAY(`"${s}"`)}})}t(i)};$.prototype.writeFileTo=function(i,e,t,r){let s=this;if(s.fs.existsSync(i)){if(!t)return!1;var n=s.fs.statSync(i);if(n.isDirectory())return!1}var a=J.dirname(i);s.fs.existsSync(a)||s.makeDir(a);var c;try{c=s.fs.openSync(i,"w",438)}catch{s.fs.chmodSync(i,438),c=s.fs.openSync(i,"w",438)}if(c)try{s.fs.writeSync(c,e,0,e.length,0)}finally{s.fs.closeSync(c)}return s.fs.chmodSync(i,r||438),!0};$.prototype.writeFileToAsync=function(i,e,t,r,s){typeof r=="function"&&(s=r,r=void 0);let n=this;n.fs.exists(i,function(a){if(a&&!t)return s(!1);n.fs.stat(i,function(c,v){if(a&&v.isDirectory())return s(!1);var y=J.dirname(i);n.fs.exists(y,function(I){I||n.makeDir(y),n.fs.open(i,"w",438,function(w,O){w?n.fs.chmod(i,438,function(){n.fs.open(i,"w",438,function(l,f){n.fs.write(f,e,0,e.length,0,function(){n.fs.close(f,function(){n.fs.chmod(i,r||438,function(){s(!0)})})})})}):O?n.fs.write(O,e,0,e.length,0,function(){n.fs.close(O,function(){n.fs.chmod(i,r||438,function(){s(!0)})})}):n.fs.chmod(i,r||438,function(){s(!0)})})})})})};$.prototype.findFiles=function(i){let e=this;function t(r,s,n){typeof s=="boolean"&&(n=s,s=void 0);let a=[];return e.fs.readdirSync(r).forEach(function(c){let v=J.join(r,c),y=e.fs.statSync(v);(!s||s.test(v))&&a.push(J.normalize(v)+(y.isDirectory()?e.sep:"")),y.isDirectory()&&n&&(a=a.concat(t(v,s,n)))}),a}return t(i,void 0,!0)};$.prototype.findFilesAsync=function(i,e){let t=this,r=[];t.fs.readdir(i,function(s,n){if(s)return e(s);let a=n.length;if(!a)return e(null,r);n.forEach(function(c){c=J.join(i,c),t.fs.stat(c,function(v,y){if(v)return e(v);y&&(r.push(J.normalize(c)+(y.isDirectory()?t.sep:"")),y.isDirectory()?t.findFilesAsync(c,function(I,w){if(I)return e(I);r=r.concat(w),--a||e(null,r)}):--a||e(null,r))})})})};$.prototype.getAttributes=function(){};$.prototype.setAttributes=function(){};$.crc32update=function(i,e){return gt[(i^e)&255]^i>>>8};$.crc32=function(i){typeof i=="string"&&(i=Buffer.from(i,"utf8"));let e=i.length,t=-1;for(let r=0;r<e;)t=$.crc32update(t,i[r++]);return~t>>>0};$.methodToString=function(i){switch(i){case mt.STORED:return"STORED ("+i+")";case mt.DEFLATED:return"DEFLATED ("+i+")";default:return"UNSUPPORTED ("+i+")"}};$.canonical=function(i){if(!i)return"";let e=J.posix.normalize("/"+i.split("\\").join("/"));return J.join(".",e)};$.zipnamefix=function(i){if(!i)return"";let e=J.posix.normalize("/"+i.split("\\").join("/"));return J.posix.join(".",e)};$.findLast=function(i,e){if(!Array.isArray(i))throw new TypeError("arr is not array");let t=i.length>>>0;for(let r=t-1;r>=0;r--)if(e(i[r],r,i))return i[r]};$.sanitize=function(i,e){i=J.resolve(J.normalize(i));for(var t=e.split("/"),r=0,s=t.length;r<s;r++){var n=J.normalize(J.join(i,t.slice(r,s).join(J.sep)));if(n.indexOf(i)===0)return n}return J.normalize(J.join(i,J.basename(e)))};$.toBuffer=function(e,t){return Buffer.isBuffer(e)?e:e instanceof Uint8Array?Buffer.from(e):typeof e=="string"?t(e):Buffer.alloc(0)};$.readBigUInt64LE=function(i,e){var t=Buffer.from(i.slice(e,e+8));return t.swap64(),parseInt(`0x${t.toString("hex")}`)};$.fromDOS2Date=function(i){return new Date((i>>25&127)+1980,Math.max((i>>21&15)-1,0),Math.max(i>>16&31,1),i>>11&31,i>>5&63,(i&31)<<1)};$.fromDate2DOS=function(i){let e=0,t=0;return i.getFullYear()>1979&&(e=(i.getFullYear()-1980&127)<<9|i.getMonth()+1<<5|i.getDate(),t=i.getHours()<<11|i.getMinutes()<<5|i.getSeconds()>>1),e<<16|t};$.isWin=ur;$.crcTable=gt});var wt=Y((Vr,vt)=>{var mr=require("path");vt.exports=function(i,{fs:e}){var t=i||"",r=n(),s=null;function n(){return{directory:!1,readonly:!1,hidden:!1,executable:!1,mtime:0,atime:0}}return t&&e.existsSync(t)?(s=e.statSync(t),r.directory=s.isDirectory(),r.mtime=s.mtime,r.atime=s.atime,r.executable=(73&s.mode)!==0,r.readonly=(128&s.mode)===0,r.hidden=mr.basename(t)[0]==="."):console.warn("Invalid path: "+t),{get directory(){return r.directory},get readOnly(){return r.readonly},get hidden(){return r.hidden},get mtime(){return r.mtime},get atime(){return r.atime},get executable(){return r.executable},decodeAttributes:function(){},encodeAttributes:function(){},toJSON:function(){return{path:t,isDirectory:r.directory,isReadOnly:r.readonly,isHidden:r.hidden,isExecutable:r.executable,mTime:r.mtime,aTime:r.atime}},toString:function(){return JSON.stringify(this.toJSON(),null,"	")}}}});var bt=Y((zr,Et)=>{Et.exports={efs:!0,encode:i=>Buffer.from(i,"utf8"),decode:i=>i.toString("utf8")}});var pe=Y((Gr,ge)=>{ge.exports=yt();ge.exports.Constants=Ke();ge.exports.Errors=Pe();ge.exports.FileAttr=wt();ge.exports.decoder=bt()});var Dt=Y((Wr,St)=>{var ae=pe(),E=ae.Constants;St.exports=function(){var i=20,e=10,t=0,r=0,s=0,n=0,a=0,c=0,v=0,y=0,I=0,w=0,O=0,l=0,f=0;i|=ae.isWin?2560:768,t|=E.FLG_EFS;let m={extraLen:0},d=o=>Math.max(0,o)>>>0,g=o=>Math.max(0,o)&65535,p=o=>Math.max(0,o)&255;return s=ae.fromDate2DOS(new Date),{get made(){return i},set made(o){i=o},get version(){return e},set version(o){e=o},get flags(){return t},set flags(o){t=o},get flags_efs(){return(t&E.FLG_EFS)>0},set flags_efs(o){o?t|=E.FLG_EFS:t&=~E.FLG_EFS},get flags_desc(){return(t&E.FLG_DESC)>0},set flags_desc(o){o?t|=E.FLG_DESC:t&=~E.FLG_DESC},get method(){return r},set method(o){switch(o){case E.STORED:this.version=10;case E.DEFLATED:default:this.version=20}r=o},get time(){return ae.fromDOS2Date(this.timeval)},set time(o){this.timeval=ae.fromDate2DOS(o)},get timeval(){return s},set timeval(o){s=d(o)},get timeHighByte(){return p(s>>>8)},get crc(){return n},set crc(o){n=d(o)},get compressedSize(){return a},set compressedSize(o){a=d(o)},get size(){return c},set size(o){c=d(o)},get fileNameLength(){return v},set fileNameLength(o){v=o},get extraLength(){return y},set extraLength(o){y=o},get extraLocalLength(){return m.extraLen},set extraLocalLength(o){m.extraLen=o},get commentLength(){return I},set commentLength(o){I=o},get diskNumStart(){return w},set diskNumStart(o){w=d(o)},get inAttr(){return O},set inAttr(o){O=d(o)},get attr(){return l},set attr(o){l=d(o)},get fileAttr(){return(l||0)>>16&4095},get offset(){return f},set offset(o){f=d(o)},get encrypted(){return(t&E.FLG_ENC)===E.FLG_ENC},get centralHeaderSize(){return E.CENHDR+v+y+I},get realDataOffset(){return f+E.LOCHDR+m.fnameLen+m.extraLen},get localHeader(){return m},loadLocalHeaderFromBinary:function(o){var u=o.slice(f,f+E.LOCHDR);if(u.readUInt32LE(0)!==E.LOCSIG)throw ae.Errors.INVALID_LOC();m.version=u.readUInt16LE(E.LOCVER),m.flags=u.readUInt16LE(E.LOCFLG),m.method=u.readUInt16LE(E.LOCHOW),m.time=u.readUInt32LE(E.LOCTIM),m.crc=u.readUInt32LE(E.LOCCRC),m.compressedSize=u.readUInt32LE(E.LOCSIZ),m.size=u.readUInt32LE(E.LOCLEN),m.fnameLen=u.readUInt16LE(E.LOCNAM),m.extraLen=u.readUInt16LE(E.LOCEXT);let h=f+E.LOCHDR+m.fnameLen,b=h+m.extraLen;return o.slice(h,b)},loadFromBinary:function(o){if(o.length!==E.CENHDR||o.readUInt32LE(0)!==E.CENSIG)throw ae.Errors.INVALID_CEN();i=o.readUInt16LE(E.CENVEM),e=o.readUInt16LE(E.CENVER),t=o.readUInt16LE(E.CENFLG),r=o.readUInt16LE(E.CENHOW),s=o.readUInt32LE(E.CENTIM),n=o.readUInt32LE(E.CENCRC),a=o.readUInt32LE(E.CENSIZ),c=o.readUInt32LE(E.CENLEN),v=o.readUInt16LE(E.CENNAM),y=o.readUInt16LE(E.CENEXT),I=o.readUInt16LE(E.CENCOM),w=o.readUInt16LE(E.CENDSK),O=o.readUInt16LE(E.CENATT),l=o.readUInt32LE(E.CENATX),f=o.readUInt32LE(E.CENOFF)},localHeaderToBinary:function(){var o=Buffer.alloc(E.LOCHDR);return o.writeUInt32LE(E.LOCSIG,0),o.writeUInt16LE(e,E.LOCVER),o.writeUInt16LE(t,E.LOCFLG),o.writeUInt16LE(r,E.LOCHOW),o.writeUInt32LE(s,E.LOCTIM),o.writeUInt32LE(n,E.LOCCRC),o.writeUInt32LE(a,E.LOCSIZ),o.writeUInt32LE(c,E.LOCLEN),o.writeUInt16LE(v,E.LOCNAM),o.writeUInt16LE(m.extraLen,E.LOCEXT),o},centralHeaderToBinary:function(){var o=Buffer.alloc(E.CENHDR+v+y+I);return o.writeUInt32LE(E.CENSIG,0),o.writeUInt16LE(i,E.CENVEM),o.writeUInt16LE(e,E.CENVER),o.writeUInt16LE(t,E.CENFLG),o.writeUInt16LE(r,E.CENHOW),o.writeUInt32LE(s,E.CENTIM),o.writeUInt32LE(n,E.CENCRC),o.writeUInt32LE(a,E.CENSIZ),o.writeUInt32LE(c,E.CENLEN),o.writeUInt16LE(v,E.CENNAM),o.writeUInt16LE(y,E.CENEXT),o.writeUInt16LE(I,E.CENCOM),o.writeUInt16LE(w,E.CENDSK),o.writeUInt16LE(O,E.CENATT),o.writeUInt32LE(l,E.CENATX),o.writeUInt32LE(f,E.CENOFF),o},toJSON:function(){let o=function(u){return u+" bytes"};return{made:i,version:e,flags:t,method:ae.methodToString(r),time:this.time,crc:"0x"+n.toString(16).toUpperCase(),compressedSize:o(a),size:o(c),fileNameLength:o(v),extraLength:o(y),commentLength:o(I),diskNumStart:w,inAttr:O,attr:l,offset:f,centralHeaderSize:o(E.CENHDR+v+y+I)}},toString:function(){return JSON.stringify(this.toJSON(),null,"	")}}}});var Lt=Y((Zr,It)=>{var ye=pe(),M=ye.Constants;It.exports=function(){var i=0,e=0,t=0,r=0,s=0;return{get diskEntries(){return i},set diskEntries(n){i=e=n},get totalEntries(){return e},set totalEntries(n){e=i=n},get size(){return t},set size(n){t=n},get offset(){return r},set offset(n){r=n},get commentLength(){return s},set commentLength(n){s=n},get mainHeaderSize(){return M.ENDHDR+s},loadFromBinary:function(n){if((n.length!==M.ENDHDR||n.readUInt32LE(0)!==M.ENDSIG)&&(n.length<M.ZIP64HDR||n.readUInt32LE(0)!==M.ZIP64SIG))throw ye.Errors.INVALID_END();n.readUInt32LE(0)===M.ENDSIG?(i=n.readUInt16LE(M.ENDSUB),e=n.readUInt16LE(M.ENDTOT),t=n.readUInt32LE(M.ENDSIZ),r=n.readUInt32LE(M.ENDOFF),s=n.readUInt16LE(M.ENDCOM)):(i=ye.readBigUInt64LE(n,M.ZIP64SUB),e=ye.readBigUInt64LE(n,M.ZIP64TOT),t=ye.readBigUInt64LE(n,M.ZIP64SIZE),r=ye.readBigUInt64LE(n,M.ZIP64OFF),s=0)},toBinary:function(){var n=Buffer.alloc(M.ENDHDR+s);return n.writeUInt32LE(M.ENDSIG,0),n.writeUInt32LE(0,4),n.writeUInt16LE(i,M.ENDSUB),n.writeUInt16LE(e,M.ENDTOT),n.writeUInt32LE(t,M.ENDSIZ),n.writeUInt32LE(r,M.ENDOFF),n.writeUInt16LE(s,M.ENDCOM),n.fill(" ",M.ENDHDR),n},toJSON:function(){let n=function(a,c){let v=a.toString(16).toUpperCase();for(;v.length<c;)v="0"+v;return"0x"+v};return{diskEntries:i,totalEntries:e,size:t+" bytes",offset:n(r,4),commentLength:s}},toString:function(){return JSON.stringify(this.toJSON(),null,"	")}}}});var Qe=Y(Ye=>{Ye.EntryHeader=Dt();Ye.MainHeader=Lt()});var Ct=Y((Xr,xt)=>{xt.exports=function(i){var e=require("zlib"),t={chunkSize:(parseInt(i.length/1024)+1)*1024};return{deflate:function(){return e.deflateRawSync(i,t)},deflateAsync:function(r){var s=e.createDeflateRaw(t),n=[],a=0;s.on("data",function(c){n.push(c),a+=c.length}),s.on("end",function(){var c=Buffer.alloc(a),v=0;c.fill(0);for(var y=0;y<n.length;y++){var I=n[y];I.copy(c,v),v+=I.length}r&&r(c)}),s.end(i)}}}});var Ot=Y((qr,Nt)=>{var hr=+(process.versions?process.versions.node:"").split(".")[0]||0;Nt.exports=function(i,e){var t=require("zlib");let r=hr>=15&&e>0?{maxOutputLength:e}:{};return{inflate:function(){return t.inflateRawSync(i,r)},inflateAsync:function(s){var n=t.createInflateRaw(r),a=[],c=0;n.on("data",function(v){a.push(v),c+=v.length}),n.on("end",function(){var v=Buffer.alloc(c),y=0;v.fill(0);for(var I=0;I<a.length;I++){var w=a[I];w.copy(v,y),y+=w.length}s&&s(v)}),n.end(i)}}}});var Rt=Y((Kr,Ft)=>{"use strict";var{randomFillSync:_t}=require("crypto"),gr=Pe(),pr=new Uint32Array(256).map((i,e)=>{for(let t=0;t<8;t++)(e&1)!==0?e=e>>>1^3988292384:e>>>=1;return e>>>0}),Ut=(i,e)=>Math.imul(i,e)>>>0,Pt=(i,e)=>pr[(i^e)&255]^i>>>8,Ee=()=>typeof _t=="function"?_t(Buffer.alloc(12)):Ee.node();Ee.node=()=>{let i=Buffer.alloc(12),e=i.length;for(let t=0;t<e;t++)i[t]=Math.random()*256&255;return i};var Ue={genSalt:Ee};function Fe(i){let e=Buffer.isBuffer(i)?i:Buffer.from(i);this.keys=new Uint32Array([305419896,591751049,878082192]);for(let t=0;t<e.length;t++)this.updateKeys(e[t])}Fe.prototype.updateKeys=function(i){let e=this.keys;return e[0]=Pt(e[0],i),e[1]+=e[0]&255,e[1]=Ut(e[1],134775813)+1,e[2]=Pt(e[2],e[1]>>>24),i};Fe.prototype.next=function(){let i=(this.keys[2]|2)>>>0;return Ut(i,i^1)>>8&255};function yr(i){let e=new Fe(i);return function(t){let r=Buffer.alloc(t.length),s=0;for(let n of t)r[s++]=e.updateKeys(n^e.next());return r}}function vr(i){let e=new Fe(i);return function(t,r,s=0){r||(r=Buffer.alloc(t.length));for(let n of t){let a=e.next();r[s++]=n^a,e.updateKeys(n)}return r}}function wr(i,e,t){if(!i||!Buffer.isBuffer(i)||i.length<12)return Buffer.alloc(0);let r=yr(t),s=r(i.slice(0,12)),n=(e.flags&8)===8?e.timeHighByte:e.crc>>>24;if(s[11]!==n)throw gr.WRONG_PASSWORD();return r(i.slice(12))}function Er(i){Buffer.isBuffer(i)&&i.length>=12?Ue.genSalt=function(){return i.slice(0,12)}:i==="node"?Ue.genSalt=Ee.node:Ue.genSalt=Ee}function br(i,e,t,r=!1){i==null&&(i=Buffer.alloc(0)),Buffer.isBuffer(i)||(i=Buffer.from(i.toString()));let s=vr(t),n=Ue.genSalt();n[11]=e.crc>>>24&255,r&&(n[10]=e.crc>>>16&255);let a=Buffer.alloc(i.length+12);return s(n,a),s(i,a,12)}Ft.exports={decrypt:wr,encrypt:br,_salter:Er}});var jt=Y(Re=>{Re.Deflater=Ct();Re.Inflater=Ot();Re.ZipCrypto=Rt()});var tt=Y((Qr,Tt)=>{var j=pe(),Sr=Qe(),B=j.Constants,et=jt();Tt.exports=function(i,e){var t=new Sr.EntryHeader,r=Buffer.alloc(0),s=Buffer.alloc(0),n=!1,a=null,c=Buffer.alloc(0),v=Buffer.alloc(0),y=!0;let I=i,w=typeof I.decoder=="object"?I.decoder:j.decoder;y=w.hasOwnProperty("efs")?w.efs:!1;function O(){return!e||!(e instanceof Uint8Array)?Buffer.alloc(0):(v=t.loadLocalHeaderFromBinary(e),e.slice(t.realDataOffset,t.realDataOffset+t.compressedSize))}function l(o){if(t.flags_desc){let u={},h=t.realDataOffset+t.compressedSize;if(e.readUInt32LE(h)==B.LOCSIG||e.readUInt32LE(h)==B.CENSIG)throw j.Errors.DESCRIPTOR_NOT_EXIST();if(e.readUInt32LE(h)==B.EXTSIG)u.crc=e.readUInt32LE(h+B.EXTCRC),u.compressedSize=e.readUInt32LE(h+B.EXTSIZ),u.size=e.readUInt32LE(h+B.EXTLEN);else if(e.readUInt16LE(h+12)===19280)u.crc=e.readUInt32LE(h+B.EXTCRC-4),u.compressedSize=e.readUInt32LE(h+B.EXTSIZ-4),u.size=e.readUInt32LE(h+B.EXTLEN-4);else throw j.Errors.DESCRIPTOR_UNKNOWN();if(u.compressedSize!==t.compressedSize||u.size!==t.size||u.crc!==t.crc)throw j.Errors.DESCRIPTOR_FAULTY();if(j.crc32(o)!==u.crc)return!1}else if(j.crc32(o)!==t.localHeader.crc)return!1;return!0}function f(o,u,h){if(typeof u>"u"&&typeof o=="string"&&(h=o,o=void 0),n)return o&&u&&u(Buffer.alloc(0),j.Errors.DIRECTORY_CONTENT_ERROR()),Buffer.alloc(0);var b=O();if(b.length===0)return o&&u&&u(b),b;if(t.encrypted){if(typeof h!="string"&&!Buffer.isBuffer(h))throw j.Errors.INVALID_PASS_PARAM();b=et.ZipCrypto.decrypt(b,t,h)}var S=Buffer.alloc(t.size);switch(t.method){case j.Constants.STORED:if(b.copy(S),l(S))return o&&u&&u(S),S;throw o&&u&&u(S,j.Errors.BAD_CRC()),j.Errors.BAD_CRC();case j.Constants.DEFLATED:var N=new et.Inflater(b,t.size);if(o)N.inflateAsync(function(_){_.copy(_,0),u&&(l(_)?u(_):u(_,j.Errors.BAD_CRC()))});else{if(N.inflate(S).copy(S,0),!l(S))throw j.Errors.BAD_CRC(`"${w.decode(r)}"`);return S}break;default:throw o&&u&&u(Buffer.alloc(0),j.Errors.UNKNOWN_METHOD()),j.Errors.UNKNOWN_METHOD()}}function m(o,u){if((!a||!a.length)&&Buffer.isBuffer(e))return o&&u&&u(O()),O();if(a.length&&!n){var h;switch(t.method){case j.Constants.STORED:return t.compressedSize=t.size,h=Buffer.alloc(a.length),a.copy(h),o&&u&&u(h),h;default:case j.Constants.DEFLATED:var b=new et.Deflater(a);if(o)b.deflateAsync(function(N){h=Buffer.alloc(N.length),t.compressedSize=N.length,N.copy(h),u&&u(h)});else{var S=b.deflate();return t.compressedSize=S.length,S}b=null;break}}else if(o&&u)u(Buffer.alloc(0));else return Buffer.alloc(0)}function d(o,u){return(o.readUInt32LE(u+4)<<4)+o.readUInt32LE(u)}function g(o){try{for(var u=0,h,b,S;u+4<o.length;)h=o.readUInt16LE(u),u+=2,b=o.readUInt16LE(u),u+=2,S=o.slice(u,u+b),u+=b,B.ID_ZIP64===h&&p(S)}catch{throw j.Errors.EXTRA_FIELD_PARSE_ERROR()}}function p(o){var u,h,b,S;o.length>=B.EF_ZIP64_SCOMP&&(u=d(o,B.EF_ZIP64_SUNCOMP),t.size===B.EF_ZIP64_OR_32&&(t.size=u)),o.length>=B.EF_ZIP64_RHO&&(h=d(o,B.EF_ZIP64_SCOMP),t.compressedSize===B.EF_ZIP64_OR_32&&(t.compressedSize=h)),o.length>=B.EF_ZIP64_DSN&&(b=d(o,B.EF_ZIP64_RHO),t.offset===B.EF_ZIP64_OR_32&&(t.offset=b)),o.length>=B.EF_ZIP64_DSN+4&&(S=o.readUInt32LE(B.EF_ZIP64_DSN),t.diskNumStart===B.EF_ZIP64_OR_16&&(t.diskNumStart=S))}return{get entryName(){return w.decode(r)},get rawEntryName(){return r},set entryName(o){r=j.toBuffer(o,w.encode);var u=r[r.length-1];n=u===47||u===92,t.fileNameLength=r.length},get efs(){return typeof y=="function"?y(this.entryName):y},get extra(){return c},set extra(o){c=o,t.extraLength=o.length,g(o)},get comment(){return w.decode(s)},set comment(o){if(s=j.toBuffer(o,w.encode),t.commentLength=s.length,s.length>65535)throw j.Errors.COMMENT_TOO_LONG()},get name(){var o=w.decode(r);return n?o.substr(o.length-1).split("/").pop():o.split("/").pop()},get isDirectory(){return n},getCompressedData:function(){return m(!1,null)},getCompressedDataAsync:function(o){m(!0,o)},setData:function(o){a=j.toBuffer(o,j.decoder.encode),!n&&a.length?(t.size=a.length,t.method=j.Constants.DEFLATED,t.crc=j.crc32(o),t.changed=!0):t.method=j.Constants.STORED},getData:function(o){return t.changed?a:f(!1,null,o)},getDataAsync:function(o,u){t.changed?o(a):f(!0,o,u)},set attr(o){t.attr=o},get attr(){return t.attr},set header(o){t.loadFromBinary(o)},get header(){return t},packCentralHeader:function(){t.flags_efs=this.efs,t.extraLength=c.length;var o=t.centralHeaderToBinary(),u=j.Constants.CENHDR;return r.copy(o,u),u+=r.length,c.copy(o,u),u+=t.extraLength,s.copy(o,u),o},packLocalHeader:function(){let o=0;t.flags_efs=this.efs,t.extraLocalLength=v.length;let u=t.localHeaderToBinary(),h=Buffer.alloc(u.length+r.length+t.extraLocalLength);return u.copy(h,o),o+=u.length,r.copy(h,o),o+=r.length,v.copy(h,o),o+=v.length,h},toJSON:function(){let o=function(u){return"<"+(u&&u.length+" bytes buffer"||"null")+">"};return{entryName:this.entryName,name:this.name,comment:this.comment,isDirectory:this.isDirectory,header:t.toJSON(),compressedData:o(e),data:o(a)}},toString:function(){return JSON.stringify(this.toJSON(),null,"	")}}}});var Ht=Y((en,Mt)=>{var At=tt(),Dr=Qe(),q=pe();Mt.exports=function(i,e){var t=[],r={},s=Buffer.alloc(0),n=new Dr.MainHeader,a=!1,c=null;let v=new Set,y=e,{noSort:I,decoder:w}=y;i?f(y.readEntries):a=!0;function O(){let d=new Set;for(let g of Object.keys(r)){let p=g.split("/");if(p.pop(),!!p.length)for(let o=0;o<p.length;o++){let u=p.slice(0,o+1).join("/")+"/";d.add(u)}}for(let g of d)if(!(g in r)){let p=new At(y);p.entryName=g,p.attr=16,p.temporary=!0,t.push(p),r[p.entryName]=p,v.add(p)}}function l(){if(a=!0,r={},n.diskEntries>(i.length-n.offset)/q.Constants.CENHDR)throw q.Errors.DISK_ENTRY_TOO_LARGE();t=new Array(n.diskEntries);for(var d=n.offset,g=0;g<t.length;g++){var p=d,o=new At(y,i);o.header=i.slice(p,p+=q.Constants.CENHDR),o.entryName=i.slice(p,p+=o.header.fileNameLength),o.header.extraLength&&(o.extra=i.slice(p,p+=o.header.extraLength)),o.header.commentLength&&(o.comment=i.slice(p,p+o.header.commentLength)),d+=o.header.centralHeaderSize,t[g]=o,r[o.entryName]=o}v.clear(),O()}function f(d){var g=i.length-q.Constants.ENDHDR,p=Math.max(0,g-65535),o=p,u=i.length,h=-1,b=0;for((typeof y.trailingSpace=="boolean"?y.trailingSpace:!1)&&(p=0),g;g>=o;g--)if(i[g]===80){if(i.readUInt32LE(g)===q.Constants.ENDSIG){h=g,b=g,u=g+q.Constants.ENDHDR,o=g-q.Constants.END64HDR;continue}if(i.readUInt32LE(g)===q.Constants.END64SIG){o=p;continue}if(i.readUInt32LE(g)===q.Constants.ZIP64SIG){h=g,u=g+q.readBigUInt64LE(i,g+q.Constants.ZIP64SIZE)+q.Constants.ZIP64LEAD;break}}if(h==-1)throw q.Errors.INVALID_FORMAT();n.loadFromBinary(i.slice(h,u)),n.commentLength&&(s=i.slice(b+q.Constants.ENDHDR)),d&&l()}function m(){t.length>1&&!I&&t.sort((d,g)=>d.entryName.toLowerCase().localeCompare(g.entryName.toLowerCase()))}return{get entries(){return a||l(),t.filter(d=>!v.has(d))},get comment(){return w.decode(s)},set comment(d){s=q.toBuffer(d,w.encode),n.commentLength=s.length},getEntryCount:function(){return a?t.length:n.diskEntries},forEach:function(d){this.entries.forEach(d)},getEntry:function(d){return a||l(),r[d]||null},setEntry:function(d){a||l(),t.push(d),r[d.entryName]=d,n.totalEntries=t.length},deleteFile:function(d,g=!0){a||l();let p=r[d];this.getEntryChildren(p,g).map(u=>u.entryName).forEach(this.deleteEntry)},deleteEntry:function(d){a||l();let g=r[d],p=t.indexOf(g);p>=0&&(t.splice(p,1),delete r[d],n.totalEntries=t.length)},getEntryChildren:function(d,g=!0){if(a||l(),typeof d=="object")if(d.isDirectory&&g){let p=[],o=d.entryName;for(let u of t)u.entryName.startsWith(o)&&p.push(u);return p}else return[d];return[]},getChildCount:function(d){if(d&&d.isDirectory){let g=this.getEntryChildren(d);return g.includes(d)?g.length-1:g.length}return 0},compressToBuffer:function(){a||l(),m();let d=[],g=[],p=0,o=0;n.size=0,n.offset=0;let u=0;for(let S of this.entries){let N=S.getCompressedData();S.header.offset=o;let _=S.packLocalHeader(),T=_.length+N.length;o+=T,d.push(_),d.push(N);let R=S.packCentralHeader();g.push(R),n.size+=R.length,p+=T+R.length,u++}p+=n.mainHeaderSize,n.offset=o,n.totalEntries=u,o=0;let h=Buffer.alloc(p);for(let S of d)S.copy(h,o),o+=S.length;for(let S of g)S.copy(h,o),o+=S.length;let b=n.toBinary();return s&&s.copy(b,q.Constants.ENDHDR),b.copy(h,o),i=h,a=!1,h},toAsyncBuffer:function(d,g,p,o){try{a||l(),m();let u=[],h=[],b=0,S=0,N=0;n.size=0,n.offset=0;let _=function(T){if(T.length>0){let R=T.shift(),x=R.entryName+R.extra.toString();p&&p(x),R.getCompressedDataAsync(function(L){o&&o(x),R.header.offset=S;let U=R.packLocalHeader(),W=U.length+L.length;S+=W,u.push(U),u.push(L);let Z=R.packCentralHeader();h.push(Z),n.size+=Z.length,b+=W+Z.length,N++,_(T)})}else{b+=n.mainHeaderSize,n.offset=S,n.totalEntries=N,S=0;let R=Buffer.alloc(b);u.forEach(function(L){L.copy(R,S),S+=L.length}),h.forEach(function(L){L.copy(R,S),S+=L.length});let x=n.toBinary();s&&s.copy(x,q.Constants.ENDHDR),x.copy(R,S),i=R,a=!1,d(R)}};_(Array.from(this.entries))}catch(u){g(u)}}}}});var be=Y((tn,$t)=>{var H=pe(),V=require("path"),Ir=tt(),Lr=Ht(),de=(...i)=>H.findLast(i,e=>typeof e=="boolean"),kt=(...i)=>H.findLast(i,e=>typeof e=="string"),xr=(...i)=>H.findLast(i,e=>typeof e=="function"),Cr={noSort:!1,readEntries:!1,method:H.Constants.NONE,fs:null};$t.exports=function(i,e){let t=null,r=Object.assign(Object.create(null),Cr);i&&typeof i=="object"&&(i instanceof Uint8Array||(Object.assign(r,i),i=r.input?r.input:void 0,r.input&&delete r.input),Buffer.isBuffer(i)&&(t=i,r.method=H.Constants.BUFFER,i=void 0)),Object.assign(r,e);let s=new H(r);if((typeof r.decoder!="object"||typeof r.decoder.encode!="function"||typeof r.decoder.decode!="function")&&(r.decoder=H.decoder),i&&typeof i=="string")if(s.fs.existsSync(i))r.method=H.Constants.FILE,r.filename=i,t=s.fs.readFileSync(i);else throw H.Errors.INVALID_FILENAME();let n=new Lr(t,r),{canonical:a,sanitize:c,zipnamefix:v}=H;function y(l){if(l&&n){var f;if(typeof l=="string"&&(f=n.getEntry(V.posix.normalize(l))),typeof l=="object"&&typeof l.entryName<"u"&&typeof l.header<"u"&&(f=n.getEntry(l.entryName)),f)return f}return null}function I(l){let{join:f,normalize:m,sep:d}=V.posix;return f(".",m(d+l.split("\\").join(d)+d))}function w(l){return l instanceof RegExp?(function(f){return function(m){return f.test(m)}})(l):typeof l!="function"?()=>!0:l}let O=(l,f)=>{let m=f.slice(-1);return m=m===s.sep?s.sep:"",V.relative(l,f)+m};return{readFile:function(l,f){var m=y(l);return m&&m.getData(f)||null},childCount:function(l){let f=y(l);if(f)return n.getChildCount(f)},readFileAsync:function(l,f){var m=y(l);m?m.getDataAsync(f):f(null,"getEntry failed for:"+l)},readAsText:function(l,f){var m=y(l);if(m){var d=m.getData();if(d&&d.length)return d.toString(f||"utf8")}return""},readAsTextAsync:function(l,f,m){var d=y(l);d?d.getDataAsync(function(g,p){if(p){f(g,p);return}g&&g.length?f(g.toString(m||"utf8")):f("")}):f("")},deleteFile:function(l,f=!0){var m=y(l);m&&n.deleteFile(m.entryName,f)},deleteEntry:function(l){var f=y(l);f&&n.deleteEntry(f.entryName)},addZipComment:function(l){n.comment=l},getZipComment:function(){return n.comment||""},addZipEntryComment:function(l,f){var m=y(l);m&&(m.comment=f)},getZipEntryComment:function(l){var f=y(l);return f&&f.comment||""},updateFile:function(l,f){var m=y(l);m&&m.setData(f)},addLocalFile:function(l,f,m,d){if(s.fs.existsSync(l)){f=f?I(f):"";let g=V.win32.basename(V.win32.normalize(l));f+=m||g;let p=s.fs.statSync(l),o=p.isFile()?s.fs.readFileSync(l):Buffer.alloc(0);p.isDirectory()&&(f+=s.sep),this.addFile(f,o,d,p)}else throw H.Errors.FILE_NOT_FOUND(l)},addLocalFileAsync:function(l,f){l=typeof l=="object"?l:{localPath:l};let m=V.resolve(l.localPath),{comment:d}=l,{zipPath:g,zipName:p}=l,o=this;s.fs.stat(m,function(u,h){if(u)return f(u,!1);g=g?I(g):"";let b=V.win32.basename(V.win32.normalize(m));if(g+=p||b,h.isFile())s.fs.readFile(m,function(S,N){return S?f(S,!1):(o.addFile(g,N,d,h),setImmediate(f,void 0,!0))});else if(h.isDirectory())return g+=s.sep,o.addFile(g,Buffer.alloc(0),d,h),setImmediate(f,void 0,!0)})},addLocalFolder:function(l,f,m){if(m=w(m),f=f?I(f):"",l=V.normalize(l),s.fs.existsSync(l)){let d=s.findFiles(l),g=this;if(d.length)for(let p of d){let o=V.join(f,O(l,p));m(o)&&g.addLocalFile(p,V.dirname(o))}}else throw H.Errors.FILE_NOT_FOUND(l)},addLocalFolderAsync:function(l,f,m,d){d=w(d),m=m?I(m):"",l=V.normalize(l);var g=this;s.fs.open(l,"r",function(p){if(p&&p.code==="ENOENT")f(void 0,H.Errors.FILE_NOT_FOUND(l));else if(p)f(void 0,p);else{var o=s.findFiles(l),u=-1,h=function(){if(u+=1,u<o.length){var b=o[u],S=O(l,b).split("\\").join("/");S=S.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\x20-\x7E]/g,""),d(S)?s.fs.stat(b,function(N,_){N&&f(void 0,N),_.isFile()?s.fs.readFile(b,function(T,R){T?f(void 0,T):(g.addFile(m+S,R,"",_),h())}):(g.addFile(m+S+"/",Buffer.alloc(0),"",_),h())}):process.nextTick(()=>{h()})}else f(!0,void 0)};h()}})},addLocalFolderAsync2:function(l,f){let m=this;l=typeof l=="object"?l:{localPath:l},localPath=V.resolve(I(l.localPath));let{zipPath:d,filter:g,namefix:p}=l;g instanceof RegExp?g=(function(h){return function(b){return h.test(b)}})(g):typeof g!="function"&&(g=function(){return!0}),d=d?I(d):"",p=="latin1"&&(p=h=>h.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\x20-\x7E]/g,"")),typeof p!="function"&&(p=h=>h);let o=h=>V.join(d,p(O(localPath,h))),u=h=>V.win32.basename(V.win32.normalize(p(h)));s.fs.open(localPath,"r",function(h){h&&h.code==="ENOENT"?f(void 0,H.Errors.FILE_NOT_FOUND(localPath)):h?f(void 0,h):s.findFilesAsync(localPath,function(b,S){if(b)return f(b);S=S.filter(N=>g(o(N))),S.length||f(void 0,!1),setImmediate(S.reverse().reduce(function(N,_){return function(T,R){if(T||R===!1)return setImmediate(N,T,!1);m.addLocalFileAsync({localPath:_,zipPath:V.dirname(o(_)),zipName:u(_)},N)}},f))})})},addLocalFolderPromise:function(l,f){return new Promise((m,d)=>{this.addLocalFolderAsync2(Object.assign({localPath:l},f),(g,p)=>{g&&d(g),p&&m(this)})})},addFile:function(l,f,m,d){l=v(l);let g=y(l),p=g!=null;p||(g=new Ir(r),g.entryName=l),g.comment=m||"";let o=typeof d=="object"&&d instanceof s.fs.Stats;o&&(g.header.time=d.mtime);var u=g.isDirectory?16:0;let h=g.isDirectory?16384:32768;return o?h|=4095&d.mode:typeof d=="number"?h|=4095&d:h|=g.isDirectory?493:420,u=(u|h<<16)>>>0,g.attr=u,g.setData(f),p||n.setEntry(g),g},getEntries:function(l){return n.password=l,n?n.entries:[]},getEntry:function(l){return y(l)},getEntryCount:function(){return n.getEntryCount()},forEach:function(l){return n.forEach(l)},extractEntryTo:function(l,f,m,d,g,p){d=de(!1,d),g=de(!1,g),m=de(!0,m),p=kt(g,p);var o=y(l);if(!o)throw H.Errors.NO_ENTRY();var u=a(o.entryName),h=c(f,p&&!o.isDirectory?p:m?u:V.basename(u));if(o.isDirectory){var b=n.getEntryChildren(o);return b.forEach(function(_){if(_.isDirectory)return;var T=_.getData();if(!T)throw H.Errors.CANT_EXTRACT_FILE();var R=a(_.entryName),x=c(f,m?R:V.basename(R));let L=g?_.header.fileAttr:void 0;s.writeFileTo(x,T,d,L)}),!0}var S=o.getData(n.password);if(!S)throw H.Errors.CANT_EXTRACT_FILE();if(s.fs.existsSync(h)&&!d)throw H.Errors.CANT_OVERRIDE();let N=g?l.header.fileAttr:void 0;return s.writeFileTo(h,S,d,N),!0},test:function(l){if(!n)return!1;for(var f in n.entries)try{if(f.isDirectory)continue;var m=n.entries[f].getData(l);if(!m)return!1}catch{return!1}return!0},extractAllTo:function(l,f,m,d){if(m=de(!1,m),d=kt(m,d),f=de(!1,f),!n)throw H.Errors.NO_ZIP();n.entries.forEach(function(g){var p=c(l,a(g.entryName));if(g.isDirectory){s.makeDir(p);return}var o=g.getData(d);if(!o)throw H.Errors.CANT_EXTRACT_FILE();let u=m?g.header.fileAttr:void 0;s.writeFileTo(p,o,f,u);try{s.fs.utimesSync(p,g.header.time,g.header.time)}catch{throw H.Errors.CANT_EXTRACT_FILE()}})},extractAllToAsync:function(l,f,m,d){if(d=xr(f,m,d),m=de(!1,m),f=de(!1,f),!d)return new Promise((h,b)=>{this.extractAllToAsync(l,f,m,function(S){S?b(S):h(this)})});if(!n){d(H.Errors.NO_ZIP());return}l=V.resolve(l);let g=h=>c(l,V.normalize(a(h.entryName))),p=(h,b)=>new Error(h+': "'+b+'"'),o=[],u=[];n.entries.forEach(h=>{h.isDirectory?o.push(h):u.push(h)});for(let h of o){let b=g(h),S=m?h.header.fileAttr:void 0;try{s.makeDir(b),S&&s.fs.chmodSync(b,S),s.fs.utimesSync(b,h.header.time,h.header.time)}catch{d(p("Unable to create folder",b))}}u.reverse().reduce(function(h,b){return function(S){if(S)h(S);else{let N=V.normalize(a(b.entryName)),_=c(l,N);b.getDataAsync(function(T,R){if(R)h(R);else if(!T)h(H.Errors.CANT_EXTRACT_FILE());else{let x=m?b.header.fileAttr:void 0;s.writeFileToAsync(_,T,f,x,function(L){L||h(p("Unable to write file",_)),s.fs.utimes(_,b.header.time,b.header.time,function(U){U?h(p("Unable to set times",_)):h()})})}})}}},d)()},writeZip:function(l,f){if(arguments.length===1&&typeof l=="function"&&(f=l,l=""),!l&&r.filename&&(l=r.filename),!!l){var m=n.compressToBuffer();if(m){var d=s.writeFileTo(l,m,!0);typeof f=="function"&&f(d?null:new Error("failed"),"")}}},writeZipPromise:function(l,f){let{overwrite:m,perm:d}=Object.assign({overwrite:!0},f);return new Promise((g,p)=>{!l&&r.filename&&(l=r.filename),l||p("ADM-ZIP: ZIP File Name Missing"),this.toBufferPromise().then(o=>{let u=h=>h?g(h):p("ADM-ZIP: Wasn't able to write zip file");s.writeFileToAsync(l,o,m,d,u)},p)})},toBufferPromise:function(){return new Promise((l,f)=>{n.toAsyncBuffer(l,f)})},toBuffer:function(l,f,m,d){return typeof l=="function"?(n.toAsyncBuffer(l,f,m,d),null):n.compressToBuffer()}}}});var Ar={};ar(Ar,{getOverlayHandler:()=>ke});module.exports=lr(Ar);var K=require("electron"),st=z(require("node:path"),1);var ct=require("electron"),we=z(require("path"),1),ce=z(require("fs"),1),qe=class{logsDir;launcherLogPath;gameLogPath;initialized=!1;MAX_LOG_DAYS=7;constructor(){this.logsDir="",this.launcherLogPath="",this.gameLogPath=""}init(){if(this.initialized)return;this.logsDir=we.default.join(ct.app.getPath("userData"),"logs"),ce.default.mkdirSync(this.logsDir,{recursive:!0});let e=this.getDateString();this.launcherLogPath=we.default.join(this.logsDir,`launcher-${e}.log`),this.gameLogPath=we.default.join(this.logsDir,`game-${e}.log`),this.rotateOldLogs(),this.interceptConsole(),this.initialized=!0,this.info("Logger","=== BlockyCRAFT Launcher Log Started ==="),this.info("Logger",`Log file: ${this.launcherLogPath}`)}getDateString(){return new Date().toISOString().split("T")[0]}getTimestamp(){return new Date().toISOString()}formatMessage(e,t,r){return`[${this.getTimestamp()}] [${e}] [${t}] ${r}`}writeToLauncherLog(e){if(this.initialized)try{ce.default.appendFileSync(this.launcherLogPath,e+`
`)}catch(t){process.stdout.write(`[LOG WRITE ERROR] ${t}
`)}}writeToGameLog(e){if(this.initialized)try{ce.default.appendFileSync(this.gameLogPath,`[${this.getTimestamp()}] ${e}
`)}catch(t){process.stdout.write(`[GAME LOG WRITE ERROR] ${t}
`)}}rotateOldLogs(){try{let e=ce.default.readdirSync(this.logsDir),t=Date.now(),r=this.MAX_LOG_DAYS*24*60*60*1e3;for(let s of e){if(!s.endsWith(".log"))continue;let n=we.default.join(this.logsDir,s),a=ce.default.statSync(n);t-a.mtimeMs>r&&(ce.default.unlinkSync(n),process.stdout.write(`[Logger] Deleted old log: ${s}
`))}}catch(e){process.stdout.write(`[Logger] Error rotating logs: ${e}
`)}}interceptConsole(){let e=console.log,t=console.error,r=console.warn,s=this;console.log=function(...n){let a=n.map(c=>typeof c=="object"?JSON.stringify(c):String(c)).join(" ");s.writeToLauncherLog(s.formatMessage("INFO","Console",a)),e.apply(console,n)},console.error=function(...n){let a=n.map(c=>typeof c=="object"?JSON.stringify(c):String(c)).join(" ");s.writeToLauncherLog(s.formatMessage("ERROR","Console",a)),t.apply(console,n)},console.warn=function(...n){let a=n.map(c=>typeof c=="object"?JSON.stringify(c):String(c)).join(" ");s.writeToLauncherLog(s.formatMessage("WARN","Console",a)),r.apply(console,n)}}info(e,t){let r=this.formatMessage("INFO",e,t);this.writeToLauncherLog(r),process.stdout.write(r+`
`)}error(e,t){let r=this.formatMessage("ERROR",e,t);this.writeToLauncherLog(r),process.stderr.write(r+`
`)}warn(e,t){let r=this.formatMessage("WARN",e,t);this.writeToLauncherLog(r),process.stdout.write(r+`
`)}debug(e,t){let r=this.formatMessage("DEBUG",e,t);this.writeToLauncherLog(r)}game(e,t){let r=e==="stderr"?"[ERR]":"[OUT]";this.writeToGameLog(`${r} ${t}`)}getLogsDir(){return this.logsDir}},D=new qe;var Q=require("electron"),F=z(require("path"),1),C=z(require("fs"),1),$e=require("child_process"),qt=require("util"),Me=z(be(),1);var Bt=require("electron"),oe=z(require("path"),1),ne=z(require("fs"),1),Vt=require("fs"),zt=require("child_process"),Gt=require("util"),Wt=z(be(),1),rt=(0,Gt.promisify)(zt.exec),Nr="https://api.adoptium.net/v3/binary/latest",Or="17",_r="hotspot",Pr="eclipse",je=class{javaDir;markerFile;constructor(){this.javaDir=oe.default.join(Bt.app.getPath("userData"),"java"),this.markerFile=oe.default.join(this.javaDir,".java17_installed")}async ensureJava(e){let t=this.getLocalJavaPath();if(t&&ne.default.existsSync(t))return console.log("[JavaManager] Using locally installed Java:",t),t;let r=await this.detectSystemJava();return r?(console.log("[JavaManager] Using system Java:",r),r):(console.log("[JavaManager] No Java found, downloading..."),this.downloadAndInstallJava(e))}async detectSystemJava(){let e=this.getCommonJavaPaths();for(let t of e)if(await this.isValidJava17(t))return t;return null}getCommonJavaPaths(){let e=["java"],t=process.platform;if(t==="win32"){let r=process.env.ProgramFiles||"C:\\Program Files",s=process.env["ProgramFiles(x86)"]||"C:\\Program Files (x86)";e.push(oe.default.join(r,"Eclipse Adoptium","jdk-17*","bin","java.exe"),oe.default.join(r,"Java","jdk-17*","bin","java.exe"),oe.default.join(r,"Java","jre-17*","bin","java.exe"),oe.default.join(r,"Temurin","jdk-17*","bin","java.exe"),oe.default.join(s,"Java","jdk-17*","bin","java.exe"))}else t==="darwin"?e.push("/Library/Java/JavaVirtualMachines/temurin-17.jdk/Contents/Home/bin/java","/Library/Java/JavaVirtualMachines/adoptopenjdk-17.jdk/Contents/Home/bin/java","/usr/local/opt/openjdk@17/bin/java","/opt/homebrew/opt/openjdk@17/bin/java"):e.push("/usr/lib/jvm/temurin-17-jdk/bin/java","/usr/lib/jvm/java-17-openjdk/bin/java","/usr/lib/jvm/java-17-openjdk-amd64/bin/java","/usr/lib/jvm/java-17-temurin/bin/java","/opt/java/openjdk/bin/java");return e}async isValidJava17(e){try{let{stdout:t,stderr:r}=await rt(`"${e}" -version`),n=(t+r).match(/version "(\d+)/);return n?parseInt(n[1],10)>=17:!1}catch{return!1}}getPlatformInfo(){let e=process.platform,t=process.arch,r,s,n;switch(e){case"win32":r="windows",s="zip",n="bin/java.exe";break;case"darwin":r="mac",s="tar.gz",n="Contents/Home/bin/java";break;default:r="linux",s="tar.gz",n="bin/java"}let a;switch(t){case"arm64":a="aarch64";break;case"x64":default:a="x64"}return{os:r,arch:a,extension:s,executablePath:n}}getDownloadUrl(){let e=this.getPlatformInfo(),t=`${Nr}/${Or}/ga/${e.os}/${e.arch}/jre/${_r}/normal/${Pr}`,r=`temurin-17-jre.${e.extension}`;return{url:t,filename:r}}getLocalJavaPath(){if(!ne.default.existsSync(this.markerFile))return null;let e=this.getPlatformInfo();if(!ne.default.existsSync(this.javaDir))return null;let r=ne.default.readdirSync(this.javaDir).find(n=>n.startsWith("jdk-17")&&ne.default.statSync(oe.default.join(this.javaDir,n)).isDirectory());if(!r)return null;let s=oe.default.join(this.javaDir,r,e.executablePath);return ne.default.existsSync(s)?s:null}async downloadAndInstallJava(e){let{url:t,filename:r}=this.getDownloadUrl(),s=this.getPlatformInfo();ne.default.mkdirSync(this.javaDir,{recursive:!0});let n=oe.default.join(this.javaDir,r);this.sendProgress(e,"Baixando Java 17...",0),console.log("[JavaManager] Downloading from:",t);try{let c=await fetch(t,{redirect:"follow"});if(!c.ok)throw new Error(`Failed to download Java: ${c.status} ${c.statusText}`);let v=Number(c.headers.get("content-length"))||0,y=(0,Vt.createWriteStream)(n);if(!c.body)throw new Error("No response body");let I=c.body.getReader(),w=0;for(;;){let{done:O,value:l}=await I.read();if(O)break;if(y.write(Buffer.from(l)),w+=l.length,v>0){let f=Math.round(w/v*50);this.sendProgress(e,`Baixando Java 17... (${this.formatSize(w)}/${this.formatSize(v)})`,f)}}y.end(),await new Promise((O,l)=>{y.on("finish",O),y.on("error",l)}),console.log("[JavaManager] Download complete:",n)}catch(c){throw ne.default.existsSync(n)&&ne.default.unlinkSync(n),new Error(`Failed to download Java: ${c.message}`)}this.sendProgress(e,"Extraindo Java 17...",55),console.log("[JavaManager] Extracting...");try{s.extension==="zip"?new Wt.default(n).extractAllTo(this.javaDir,!0):await rt(`tar -xzf "${n}" -C "${this.javaDir}"`),ne.default.writeFileSync(this.markerFile,new Date().toISOString()),ne.default.unlinkSync(n)}catch(c){throw new Error(`Failed to extract Java: ${c.message}`)}let a=this.getLocalJavaPath();if(!a)throw new Error("Java extraction failed: executable not found");return process.platform!=="win32"&&await rt(`chmod +x "${a}"`),this.sendProgress(e,"Java 17 instalado!",60),console.log("[JavaManager] Java installed at:",a),a}sendProgress(e,t,r){e&&e.send("launch-progress",{status:t,progress:r})}formatSize(e){return e<1024?e+" B":e<1024*1024?(e/1024).toFixed(1)+" KB":(e/(1024*1024)).toFixed(1)+" MB"}};var ot=require("electron"),k=z(require("path"),1),P=z(require("fs"),1),Zt=z(be(),1);var Se=z(require("fs"),1),nt=z(require("path"),1);async function De(i){let{urls:e,destPath:t,progressCallback:r,maxRetries:s=10,timeoutMs:n=2e4}=i,a=nt.default.basename(t);r?.(`Baixando ${a}...`,0),Se.default.mkdirSync(nt.default.dirname(t),{recursive:!0});let c=null;for(let v=0;v<e.length;v++){let y=e[v];console.log(`[DownloadUtil] Downloading from URL ${v+1}/${e.length}: ${y}`);let I=0,w=0;for(Se.default.existsSync(t)&&(w=Se.default.statSync(t).size,w>0&&console.log(`[DownloadUtil] Found existing file ${t} with ${w} bytes. Attempting to resume.`));I<s;)try{let O={};w>0&&(O.Range=`bytes=${w}-`);let l=new AbortController,f=setTimeout(()=>{l.abort(new Error("Inactivity timeout"))},n),m=await fetch(y,{headers:O,signal:l.signal});if(!m.ok){if(m.status===416||w>0&&m.status!==206){console.warn(`[DownloadUtil] Server does not support resume or range is invalid (Status ${m.status}). Restarting from 0.`),w=0,clearTimeout(f);continue}throw new Error(`HTTP ${m.status}: ${m.statusText}`)}let d=m.status===206;w>0&&!d&&(console.warn("[DownloadUtil] Requested partial but got 200 OK. Resuming not supported. Restarting from 0."),w=0);let g=m.headers.get("content-length"),p=Number(g)||0,o=p>0?w+p:0,u=m.headers.get("content-range");if(u){let L=u.match(/\/(\d+)$/);L&&(o=Number(L[1]))}if(!m.body)throw new Error("No response body");let h=w>0&&d?"a":"w",b=Se.default.createWriteStream(t,{flags:h}),S=m.body.getReader(),N=Date.now(),_=0,T,R=!1,x=async()=>{try{return await S.read()}catch(L){throw L}};for(;;){clearTimeout(f);let L=setTimeout(()=>{l.abort(new Error("Stream inactivity timeout"))},n);T=x();try{let{done:U,value:W}=await T;if(clearTimeout(L),U){R=!0;break}if(b.write(Buffer.from(W)),w+=W.length,o>0){let Z=Math.round(w/o*100),se=Date.now();if(se-_>250||w===o){_=se;let Ce=Math.max(.1,(se-N)/1e3),Ge=w/Ce,We=Math.max(0,o-w),ve=Math.round(We/Ge),Ne="";if(ve>=60){let at=Math.floor(ve/60),Je=ve%60;Ne=`${at}m ${Je}s`}else Ne=`${ve}s`;let Ze=`Baixando ${a} ${Te(w)}/${Te(o)} ${Ne}`;r?.(Ze,Z)}}else{let Z=Date.now();Z-_>250&&(_=Z,r?.(`Baixando ${a} (${Te(w)})...`,0))}}catch(U){throw clearTimeout(L),b.close(),l.signal.reason?.message==="Stream inactivity timeout"||U.name==="AbortError"?new Error("Stream inactivity timeout during read"):U}}if(b.end(),await new Promise((L,U)=>{b.on("finish",L),b.on("error",U)}),R){if(o>0&&w<o)throw new Error(`Connection closed prematurely. Downloaded ${w}/${o} bytes.`);console.log(`[DownloadUtil] Downloaded ${a} (${Te(w)}) successfully.`);return}}catch(O){console.warn(`[DownloadUtil] Attempt ${I+1}/${s} failed:`,O.message),c=O,I++,I<s&&(r?.(`Conex\xE3o inst\xE1vel... Retentando (${I}/${s})`,Math.round(w)),console.log("[DownloadUtil] Waiting 2000ms before retrying..."),await new Promise(f=>setTimeout(f,2e3)))}}throw c||new Error(`Failed to download ${a} after multiple attempts and fallbacks`)}function Te(i){return i<1024?i+" B":i<1024*1024?(i/1024).toFixed(1)+" KB":(i/(1024*1024)).toFixed(1)+" MB"}var Ur=["https://craft.blocky.com.br/launcher-assets/version.json"],Ae=class{dataPath;localVersionsPath;instanceDir;librariesDir;constructor(){this.dataPath=ot.app.getPath("userData"),this.localVersionsPath=k.default.join(this.dataPath,"versions.json"),this.instanceDir=k.default.join(this.dataPath,"instances","default"),this.librariesDir=k.default.join(this.instanceDir,"libraries")}normalizeUrls(e){return Array.isArray(e)?e:[e]}getLocalVersions(){try{if(P.default.existsSync(this.localVersionsPath)){let e=P.default.readFileSync(this.localVersionsPath,"utf-8");return JSON.parse(e)}}catch(e){console.error("[UpdateManager] Failed to read local versions:",e)}return{instance:"0.0.0",libraries:"0.0.0",mods:"0.0.0",texturepacks:"0.0.0"}}saveLocalVersions(e){try{P.default.writeFileSync(this.localVersionsPath,JSON.stringify(e,null,2)),console.log("[UpdateManager] Saved local versions:",e)}catch(t){console.error("[UpdateManager] Failed to save local versions:",t)}}async fetchRemoteVersions(){for(let e of Ur)try{console.log("[UpdateManager] Trying to fetch versions from:",e);let t=await fetch(e,{signal:AbortSignal.timeout(1e4)});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);let r=await t.json();return console.log("[UpdateManager] Successfully fetched from:",e),console.log("[UpdateManager] Remote versions:",r),r}catch(t){console.warn(`[UpdateManager] Failed to fetch from ${e}:`,t)}return console.error("[UpdateManager] All version URLs failed"),null}isNewerVersion(e,t){let r=a=>a.split(".").map(c=>parseInt(c,10)||0),s=r(e),n=r(t);for(let a=0;a<Math.max(s.length,n.length);a++){let c=s[a]||0,v=n[a]||0;if(c>v)return!0;if(c<v)return!1}return!1}getLauncherDownloadUrl(){let e="https://github.com/zukrmn/BlockyCRAFT-Launcher/releases/latest/download";switch(process.platform){case"win32":return`${e}/BlockyCRAFT-Launcher-Setup.exe`;case"darwin":return`${e}/BlockyCRAFT-Launcher-arm64.dmg`;case"linux":default:return`${e}/BlockyCRAFT-Launcher.AppImage`}}async checkForUpdates(){let e=this.getLocalVersions(),t=await this.fetchRemoteVersions();if(!t)return{launcherUpdate:!1,launcherDownloadUrl:null,instanceUpdate:!1,librariesUpdate:!1,modsUpdate:!1,texturepacksUpdate:!1,remoteVersions:null,error:"Failed to fetch remote version info"};let r=ot.app.getVersion(),s=this.isNewerVersion(t.launcher_version,r),n=s?this.getLauncherDownloadUrl():null;s&&console.log(`[UpdateManager] Launcher update available: ${r} \u2192 ${t.launcher_version}`);let a=t.instance.version!==e.instance,c=!1,v=t.mods?t.mods.version!==e.mods:!1,y=t.texturepacks?t.texturepacks.version!==e.texturepacks:!1;return console.log("[UpdateManager] Update check result:",{launcherUpdate:s,instanceUpdate:a,librariesUpdate:"DISABLED (Maven-based)",modsUpdate:v,texturepacksUpdate:y,local:{launcher:r,...e},remote:{launcher:t.launcher_version,instance:t.instance.version,libraries:t.libraries?.version??"N/A (Maven-based)",mods:t.mods?.version,texturepacks:t.texturepacks?.version}}),{launcherUpdate:s,launcherDownloadUrl:n,instanceUpdate:a,librariesUpdate:c,modsUpdate:v,texturepacksUpdate:y,remoteVersions:t}}async downloadFile(e,t,r){let s=this.normalizeUrls(e);await De({urls:s,destPath:t,progressCallback:r,maxRetries:7,timeoutMs:2e4})}extractZip(e,t){if(console.log(`[UpdateManager] Extracting ${e} to ${t}`),!P.default.existsSync(e))throw new Error(`ZIP file not found: ${e}`);let r=P.default.readFileSync(e);if(r.length<4||r[0]!==80||r[1]!==75)throw console.error(`[UpdateManager] Invalid ZIP file. First bytes: ${r.slice(0,20).toString("hex")}`),new Error(`Invalid ZIP file: ${e}. The download may have failed or returned an error page.`);P.default.mkdirSync(t,{recursive:!0}),new Zt.default(e).extractAllTo(t,!0),console.log("[UpdateManager] Extraction complete")}backupUserData(){let e=k.default.join(this.dataPath,"update_backup"),t=k.default.join(this.instanceDir,".minecraft");P.default.existsSync(e)&&P.default.rmSync(e,{recursive:!0,force:!0}),P.default.mkdirSync(e,{recursive:!0});let r=["options.txt","servers.dat","screenshots","stats","lastlogin","config"];console.log("[UpdateManager] Backing up user data...");for(let s of r){let n=k.default.join(t,s),a=k.default.join(e,s);if(P.default.existsSync(n))try{console.log(`[UpdateManager] Backing up: ${s}`),P.default.cpSync(n,a,{recursive:!0})}catch(c){console.warn(`[UpdateManager] Failed to backup ${s}:`,c)}}}restoreUserData(){let e=k.default.join(this.dataPath,"update_backup"),t=k.default.join(this.instanceDir,".minecraft");if(!P.default.existsSync(e))return;console.log("[UpdateManager] Restoring user data...");let r=P.default.readdirSync(e);for(let s of r){let n=k.default.join(e,s),a=k.default.join(t,s);try{console.log(`[UpdateManager] Restoring: ${s}`),P.default.existsSync(a)&&P.default.rmSync(a,{recursive:!0,force:!0}),P.default.cpSync(n,a,{recursive:!0})}catch(c){console.warn(`[UpdateManager] Failed to restore ${s}:`,c)}}try{P.default.rmSync(e,{recursive:!0,force:!0})}catch(s){console.warn("[UpdateManager] Failed to cleanup backup:",s)}}async updateInstance(e,t){let r=k.default.join(this.dataPath,"temp_instance.zip");try{await this.downloadFile(e.instance.url,r,t),t?.("Preparando atualiza\xE7\xE3o da inst\xE2ncia...",0),this.backupUserData(),P.default.existsSync(this.instanceDir),t?.("Extraindo inst\xE2ncia...",50),this.extractZip(r,this.instanceDir),this.restoreUserData();let s=this.getLocalVersions();s.instance=e.instance.version,this.saveLocalVersions(s),t?.("Inst\xE2ncia atualizada!",100)}finally{P.default.existsSync(r)&&P.default.unlinkSync(r)}}async updateLibraries(e,t){if(!e.libraries){console.log("[UpdateManager] Libraries update skipped - using Maven repos");return}let r=k.default.join(this.dataPath,"temp_libraries.zip");try{await this.downloadFile(e.libraries.url,r,t),t?.("Preparando atualiza\xE7\xE3o das bibliotecas...",0);let s=k.default.join(this.librariesDir,".bundled_extracted_v1");P.default.existsSync(s)&&P.default.unlinkSync(s),P.default.existsSync(this.librariesDir)&&P.default.rmSync(this.librariesDir,{recursive:!0,force:!0}),t?.("Extraindo bibliotecas...",50),this.extractZip(r,this.librariesDir),P.default.writeFileSync(k.default.join(this.librariesDir,".bundled_extracted_v2"),"extracted");let n=this.getLocalVersions();n.libraries=e.libraries.version,this.saveLocalVersions(n),t?.("Bibliotecas atualizadas!",100)}finally{P.default.existsSync(r)&&P.default.unlinkSync(r)}}async updateMods(e,t){if(!e.mods){console.log("[UpdateManager] No mods update available");return}let r=k.default.join(this.dataPath,"temp_mods.zip"),s=k.default.join(this.instanceDir,".minecraft","mods");try{await this.downloadFile(e.mods.url,r,t),t?.("Removendo mods antigos...",0),P.default.existsSync(s)&&P.default.rmSync(s,{recursive:!0,force:!0}),t?.("Instalando novos mods...",50),this.extractZip(r,k.default.join(this.instanceDir,".minecraft"));let n=this.getLocalVersions();n.mods=e.mods.version,this.saveLocalVersions(n),t?.("Mods atualizados!",100)}finally{P.default.existsSync(r)&&P.default.unlinkSync(r)}}async updateTexturepacks(e,t){if(!e.texturepacks){console.log("[UpdateManager] No texture pack update available");return}let r=k.default.join(this.instanceDir,".minecraft","texturepacks"),s=k.default.join(r,"betaoverhauled.zip");try{P.default.mkdirSync(r,{recursive:!0}),t?.("Baixando textura...",0);let n=k.default.join(this.dataPath,"temp_texturepack.zip");await this.downloadFile(e.texturepacks.url,n,t),P.default.existsSync(s)&&P.default.unlinkSync(s),P.default.renameSync(n,s);let a=this.getLocalVersions();a.texturepacks=e.texturepacks.version,this.saveLocalVersions(a),t?.("Textura atualizada!",100),console.log("[UpdateManager] Texture pack updated: betaoverhauled.zip")}catch(n){console.error("[UpdateManager] Failed to update texture pack:",n);let a=k.default.join(this.dataPath,"temp_texturepack.zip");throw P.default.existsSync(a)&&P.default.unlinkSync(a),n}}async performAllUpdates(e){try{e?.("Verificando atualiza\xE7\xF5es...",0);let t=await this.checkForUpdates();if(!t.remoteVersions)return console.log("[UpdateManager] Could not fetch remote versions, skipping updates"),{success:!0};let r=[t.instanceUpdate,t.librariesUpdate,t.modsUpdate,t.texturepacksUpdate].filter(Boolean).length;if(r===0)return console.log("[UpdateManager] All components are up to date"),e?.("Tudo atualizado!",100),{success:!0};let s=0;if(t.instanceUpdate){s++;let n=(s-1)/r*100,a=100/r;await this.updateInstance(t.remoteVersions,(c,v)=>{let y=n+v/100*a;e?.(c,Math.round(y))})}if(t.librariesUpdate){s++;let n=(s-1)/r*100,a=100/r;await this.updateLibraries(t.remoteVersions,(c,v)=>{let y=n+v/100*a;e?.(c,Math.round(y))})}if(t.modsUpdate){s++;let n=(s-1)/r*100,a=100/r;await this.updateMods(t.remoteVersions,(c,v)=>{let y=n+v/100*a;e?.(c,Math.round(y))})}if(t.texturepacksUpdate){s++;let n=(s-1)/r*100,a=100/r;await this.updateTexturepacks(t.remoteVersions,(c,v)=>{let y=n+v/100*a;e?.(c,Math.round(y))})}return e?.("Todas as atualiza\xE7\xF5es conclu\xEDdas!",100),{success:!0}}catch(t){return console.error("[UpdateManager] Update failed:",t),{success:!1,error:t.message}}}formatSize(e){return e<1024?e+" B":e<1024*1024?(e/1024).toFixed(1)+" KB":(e/(1024*1024)).toFixed(1)+" MB"}};var Ie=(0,qt.promisify)($e.exec);function Le(i){if(!C.default.existsSync(i))return!1;let e=C.default.readFileSync(i);return e.length>=4&&e[0]===80&&e[1]===75}function Kt(i,e){if(!Le(i)){let r=C.default.existsSync(i)?C.default.readFileSync(i):Buffer.alloc(0);throw console.error(`[GameHandler] Invalid ZIP file: ${i}. First bytes: ${r.slice(0,20).toString("hex")}`),new Error("Invalid ZIP file. The download may have failed.")}C.default.mkdirSync(e,{recursive:!0}),new Me.default(i).extractAllTo(e,!0)}function Fr(i){return new Promise(e=>setTimeout(e,i))}async function Jt(i,e,t=3){let r=[500,1e3,2e3],s=null;for(let n=0;n<=t;n++)try{Kt(i,e);return}catch(a){if(s=a,n<t){let c=r[n]||2e3;console.warn(`[GameHandler] Extraction failed (attempt ${n+1}/${t+1}), retrying in ${c}ms...`),await Fr(c)}}throw s||new Error(`Failed to extract ${i} after ${t+1} attempts`)}var Rr="https://piston-meta.mojang.com/mc/game/version_manifest_v2.json",Xt="b1.7.3",He=class{gamePath;javaPath;javaManager;updateManager;gameProcess=null;lastUpdateCheck=null;UPDATE_CACHE_TTL=6e4;MANIFEST_CACHE_TTL=1440*60*1e3;lastInstanceVersion=null;constructor(){this.gamePath=F.default.join(Q.app.getPath("userData"),"gamedata"),this.javaPath="java",this.javaManager=new je,this.updateManager=new Ae,this.loadLastInstanceVersion()}loadLastInstanceVersion(){try{let e=F.default.join(Q.app.getPath("userData"),"versions.json");if(C.default.existsSync(e)){let t=JSON.parse(C.default.readFileSync(e,"utf-8"));this.lastInstanceVersion=t.instance||null}}catch{}}init(){Q.ipcMain.handle("launch-game",async(e,t)=>this.handleLaunch(e,t)),Q.ipcMain.handle("kill-game",async()=>this.gameProcess?(console.log("Killing game process..."),this.gameProcess.kill(),this.gameProcess=null,{success:!0}):{success:!1,error:"No game running"}),Q.ipcMain.handle("check-custom-instance",async()=>{let e=F.default.resolve("instance.zip"),t=F.default.join(Q.app.getPath("userData"),"instances","default","instance.cfg");return C.default.existsSync(e)||C.default.existsSync(t)}),Q.ipcMain.handle("check-update-status",async()=>this.handleUpdateCheck()),Q.ipcMain.handle("perform-update",async e=>this.handlePerformUpdate(e))}sendProgress(e,t,r){e.send("launch-progress",{status:t,progress:r})}async getCachedVersionDetails(){let e=F.default.join(Q.app.getPath("userData"),"mojang_version_cache.json");if(C.default.existsSync(e))try{let c=JSON.parse(C.default.readFileSync(e,"utf-8"));if(Date.now()-c.timestamp<this.MANIFEST_CACHE_TTL)return console.log("[GameHandler] Using cached Mojang version details (TTL: 24h)"),c.data}catch(c){console.warn("[GameHandler] Failed to read version cache:",c)}console.log("[GameHandler] Fetching fresh Mojang version manifest...");let s=(await(await fetch(Rr)).json()).versions.find(c=>c.id===Xt);if(!s)throw new Error(`Version ${Xt} not found`);let a=await(await fetch(s.url)).json();try{C.default.writeFileSync(e,JSON.stringify({timestamp:Date.now(),data:a})),console.log("[GameHandler] Saved version details to cache")}catch(c){console.warn("[GameHandler] Failed to save version cache:",c)}return a}async checkJava(e){try{return await Ie(`"${e}" -version`),!0}catch{return!1}}async applyBorderlessPostSpawn(){let{width:e,height:t}=Q.screen.getPrimaryDisplay().size;await new Promise(r=>setTimeout(r,4e3));try{if(process.platform==="win32"){let r=`
Add-Type @"
using System;
using System.Runtime.InteropServices;
public class Win32 {
    [DllImport("user32.dll")] public static extern IntPtr FindWindow(string lpClassName, string lpWindowName);
    [DllImport("user32.dll")] public static extern int SetWindowLong(IntPtr hWnd, int nIndex, int dwNewLong);
    [DllImport("user32.dll")] public static extern int GetWindowLong(IntPtr hWnd, int nIndex);
    [DllImport("user32.dll")] public static extern bool SetWindowPos(IntPtr hWnd, IntPtr hWndInsertAfter, int X, int Y, int cx, int cy, uint uFlags);
    [DllImport("user32.dll")] public static extern bool SetForegroundWindow(IntPtr hWnd);
}
"@
$titles = @("Minecraft", "Minecraft Beta 1.7.3")
$h = [IntPtr]::Zero
foreach ($t in $titles) {
    $h = [Win32]::FindWindow([NullString]::Value, $t)
    if ($h -ne [IntPtr]::Zero) { break }
}
if ($h -eq [IntPtr]::Zero) {
    Get-Process java* | ForEach-Object { 
        if ($_.MainWindowTitle -like "*Minecraft*") { $h = $_.MainWindowHandle }
    }
}
if ($h -ne [IntPtr]::Zero) {
    $style = [Win32]::GetWindowLong($h, -16)
    $newStyle = $style -band (-bnot 0x00C40000)
    [Win32]::SetWindowLong($h, -16, $newStyle)
    [Win32]::SetWindowPos($h, [IntPtr]::Zero, 0, 0, ${e}, ${t}, 0x0040)
    [Win32]::SetForegroundWindow($h)
}
`;await Ie(`powershell -ExecutionPolicy Bypass -Command "${r.replace(/"/g,'\\"').replace(/\n/g," ")}"`),D.info("GameHandler","Borderless mode applied via Win32 APIs")}else if(process.platform==="darwin"){let r=`
tell application "System Events"
    set javaProcesses to every process whose name contains "java"
    repeat with proc in javaProcesses
        try
            set frontmost of proc to true
            set position of window 1 of proc to {0, 0}
            set size of window 1 of proc to {${e}, ${t}}
        end try
    end repeat
end tell
`;await Ie(`osascript -e '${r.replace(/'/g,`'"'"'`)}'`),D.info("GameHandler","Borderless mode applied via AppleScript")}else if(process.platform==="linux")if((process.env.XDG_SESSION_TYPE||"x11")==="x11")try{await Ie('wmctrl -r "Minecraft" -b add,fullscreen'),D.info("GameHandler","Borderless mode applied via wmctrl")}catch{try{await Ie("wmctrl -r :ACTIVE: -b add,fullscreen"),D.info("GameHandler","Borderless mode applied via wmctrl (active window)")}catch{D.warn("GameHandler","wmctrl failed - is it installed? Run: sudo apt install wmctrl")}}else D.warn("GameHandler","Wayland detected - fullscreen borderless has limited support. Window may not cover top bar.")}catch(r){D.error("GameHandler",`Failed to apply borderless mode: ${r.message}`)}}async checkAndExtractInstance(){let e=F.default.join(Q.app.getPath("userData"),"instances","default"),t=Q.app.getPath("userData");if(C.default.existsSync(F.default.join(e,"instance.cfg")))return console.log("Instance already exists, skipping extraction."),e;let r=F.default.join(t,"instance.zip");if(!C.default.existsSync(r)){console.log("instance.zip not found. Attempting to download from VPS...");let s=["https://craft.blocky.com.br/launcher-assets/instance.zip"];try{await De({urls:s,destPath:r,progressCallback:(n,a)=>{console.log(`[GameHandler] instance.zip: ${n} (${a}%)`)},maxRetries:10,timeoutMs:25e3}),console.log("instance.zip downloaded successfully from VPS")}catch(n){console.warn("Failed to download instance.zip from VPS:",n)}}return C.default.existsSync(r)&&Le(r)?(console.log("Extracting instance.zip..."),Kt(r,e),e):null}async downloadFile(e,t,r,s){let n=F.default.join(t,r);try{if(C.default.existsSync(n)){let c=C.default.statSync(n);if(!(r.endsWith(".jar")&&c.size<100))return n}await De({urls:[e],destPath:n,progressCallback:(c,v)=>{this.sendProgress(s,c,v)},maxRetries:5,timeoutMs:2e4});let a=C.default.statSync(n);if(r.endsWith(".jar")&&a.size<100)throw C.default.unlinkSync(n),new Error(`Downloaded file ${r} is too small (${a.size} bytes). Likely invalid.`);if(r.endsWith(".zip")&&!Le(n)){let v=C.default.readFileSync(n).slice(0,20).toString("hex");throw C.default.unlinkSync(n),new Error(`Downloaded file ${r} is not a valid ZIP (first bytes: ${v}). Server may have returned an error page.`)}return n}catch(a){if(C.default.existsSync(n))try{C.default.unlinkSync(n)}catch{}throw new Error(`Download failed: ${a}`)}}async handleLaunch(e,t){console.log("Requesting game launch...",t),this.sendProgress(e.sender,"Verificando atualiza\xE7\xF5es...",2);let r=Date.now();if(this.lastUpdateCheck&&r-this.lastUpdateCheck.timestamp<this.UPDATE_CACHE_TTL)console.log("[GameHandler] Using cached update check result (TTL: 60s)");else try{let l=await this.updateManager.performAllUpdates((f,m)=>{let d=2+m/100*13;this.sendProgress(e.sender,f,Math.round(d))});this.lastUpdateCheck={result:l,timestamp:r},l.success||console.warn("Update check failed, continuing anyway:",l.error)}catch(l){console.warn("Update check failed, continuing anyway:",l)}let s=await this.checkAndExtractInstance(),n=!!s,a=s||this.gamePath,c=n?F.default.join(a,".minecraft"):a;C.default.existsSync(c)||C.default.mkdirSync(c,{recursive:!0});let v=this.lastUpdateCheck?.result?.remoteVersions?.instance?.version,y=F.default.join(c,".fabric","remappedJars");v&&v!==this.lastInstanceVersion?(C.default.existsSync(y)&&(console.log("[GameHandler] Instance version changed, clearing remappedJars cache..."),C.default.rmSync(y,{recursive:!0,force:!0})),this.lastInstanceVersion=v):console.log("[GameHandler] Preserving remappedJars cache (same instance version)");let I=F.default.join(c,"bin"),w=F.default.join(a,"natives"),O=F.default.join(a,"libraries");try{if(!t.username)throw new Error("Username required");this.sendProgress(e.sender,"Verificando Java...",5);try{this.javaPath=t.javaPath||await this.javaManager.ensureJava(e.sender)}catch(x){throw new Error("Falha ao configurar Java: "+x.message)}this.sendProgress(e.sender,"Verificando vers\xE3o...",65);let l=await this.getCachedVersionDetails(),f=l.downloads.client.url,m=await this.downloadFile(f,I,"minecraft.jar",e.sender);if(!n){this.sendProgress(e.sender,"Baixando bibliotecas...",70);let x="natives-linux";process.platform==="win32"?x="natives-windows":process.platform==="darwin"&&(x="natives-osx");for(let U of l.libraries)if(U.downloads&&U.downloads.classifiers&&U.downloads.classifiers[x]){let W=U.downloads.classifiers[x],Z=await this.downloadFile(W.url,F.default.join(a,"temp_natives"),F.default.basename(W.path),e.sender);Le(Z)?new Me.default(Z).extractAllTo(w,!0):console.warn(`[GameHandler] Skipping invalid native file: ${Z}`)}let L=F.default.join(w,process.platform==="win32"?"OpenAL-amd64.dll":"libopenal.so");if(!C.default.existsSync(L)){console.log("[GameHandler] OpenAL not found, downloading from Legacy Fabric..."),this.sendProgress(e.sender,"Baixando OpenAL...",72);let U="natives-linux";process.platform==="win32"?U="natives-windows":process.platform==="darwin"&&(U="natives-osx");let W=`https://repo.legacyfabric.net/repository/legacyfabric/org/lwjgl/lwjgl/lwjgl-platform/2.9.4+legacyfabric.9/lwjgl-platform-2.9.4+legacyfabric.9-${U}.jar`;try{let Z=await this.downloadFile(W,F.default.join(a,"temp_natives"),`lwjgl-platform-${U}.jar`,e.sender);Le(Z)&&(new Me.default(Z).extractAllTo(w,!0),console.log("[GameHandler] OpenAL natives extracted successfully"))}catch(Z){console.warn("[GameHandler] Failed to download OpenAL natives:",Z)}}}let d=[m],g="net.minecraft.client.Minecraft",p="";if(n){let x=F.default.join(s,"mmc-pack.json");if(C.default.existsSync(x)&&JSON.parse(C.default.readFileSync(x,"utf-8")).components.find(W=>W.uid==="net.fabricmc.fabric-loader")){this.sendProgress(e.sender,"Configurando Fabric/StationAPI...",75);let W=[{name:"asm:9.7.1",group:"org.ow2.asm",artifact:"asm",version:"9.7.1"},{name:"asm-analysis:9.7.1",group:"org.ow2.asm",artifact:"asm-analysis",version:"9.7.1"},{name:"asm-commons:9.7.1",group:"org.ow2.asm",artifact:"asm-commons",version:"9.7.1"},{name:"asm-tree:9.7.1",group:"org.ow2.asm",artifact:"asm-tree",version:"9.7.1"},{name:"asm-util:9.7.1",group:"org.ow2.asm",artifact:"asm-util",version:"9.7.1"},{name:"sponge-mixin:0.15.3+mixin.0.8.7",group:"net.fabricmc",artifact:"sponge-mixin",version:"0.15.3+mixin.0.8.7"},{name:"mixinextras-fabric:0.4.1",group:"io.github.llamalad7",artifact:"mixinextras-fabric",version:"0.4.1"},{name:"commons-lang3:3.12.0",group:"org.apache.commons",artifact:"commons-lang3",version:"3.12.0"},{name:"commons-io:2.11.0",group:"commons-io",artifact:"commons-io",version:"2.11.0"},{name:"commons-codec:1.15",group:"commons-codec",artifact:"commons-codec",version:"1.15"},{name:"jutils:1.0.0",group:"net.java.jutils",artifact:"jutils",version:"1.0.0"},{name:"jinput:2.0.5",group:"net.java.jinput",artifact:"jinput",version:"2.0.5"},{name:"lwjgl:2.9.4+legacyfabric.9",group:"org.lwjgl.lwjgl",artifact:"lwjgl",version:"2.9.4+legacyfabric.9"},{name:"lwjgl_util:2.9.4+legacyfabric.9",group:"org.lwjgl.lwjgl",artifact:"lwjgl_util",version:"2.9.4+legacyfabric.9"},{name:"log4j-api:2.16.0",group:"org.apache.logging.log4j",artifact:"log4j-api",version:"2.16.0"},{name:"log4j-core:2.16.0",group:"org.apache.logging.log4j",artifact:"log4j-core",version:"2.16.0"},{name:"log4j-slf4j18-impl:2.16.0",group:"org.apache.logging.log4j",artifact:"log4j-slf4j18-impl",version:"2.16.0"},{name:"terminalconsoleappender:1.2.0",group:"net.minecrell",artifact:"terminalconsoleappender",version:"1.2.0"},{name:"slf4j-api:1.8.0-beta4",group:"org.slf4j",artifact:"slf4j-api",version:"1.8.0-beta4"},{name:"guava:31.0.1-jre",group:"com.google.guava",artifact:"guava",version:"31.0.1-jre"},{name:"failureaccess:1.0.1",group:"com.google.guava",artifact:"failureaccess",version:"1.0.1"},{name:"gson:2.8.9",group:"com.google.code.gson",artifact:"gson",version:"2.8.9"},{name:"log4j-config:1.0.0",group:"babric",artifact:"log4j-config",version:"1.0.0"}],Z="https://maven.fabricmc.net/",se="https://repo1.maven.org/maven2/",Ce="https://repo.legacyfabric.net/repository/legacyfabric/",Ge="https://maven.glass-launcher.net/babric/";console.log("[GameHandler] Using Maven-based library downloads"),C.default.existsSync(O)||C.default.mkdirSync(O,{recursive:!0});for(let A of W){let ue=`${A.group.replace(/\./g,"/")}/${A.artifact}/${A.version}/${A.artifact}-${A.version}.jar`,X=F.default.join(O,`${A.artifact}-${A.version}.jar`);if(C.default.existsSync(X)){d.push(X);continue}let ee=Z+ue;["org.apache","commons-io","commons-codec","net.java.jutils","net.java.jinput","org.ow2.asm","com.google.guava","com.google.code.gson","org.slf4j","io.github.llamalad7","net.minecrell"].some(Oe=>A.group.startsWith(Oe)||A.group===Oe)?ee=se+ue:A.group.startsWith("org.lwjgl")?ee=Ce+ue:A.group==="babric"&&(ee=Ge+ue);let he=await this.downloadFile(ee,O,`${A.artifact}-${A.version}.jar`,e.sender);d.push(he)}this.sendProgress(e.sender,"Baixando nativos...",78);let We=process.platform==="linux"?["liblwjgl-linux-amd64.so","libopenal-amd64.so","libjinput-linux64.so"]:process.platform==="win32"?["lwjgl64.dll","OpenAL64.dll"]:["liblwjgl.dylib","libopenal.dylib"];if(C.default.existsSync(w)&&We.every(A=>C.default.existsSync(F.default.join(w,A))))console.log("[GameHandler] Natives already present, skipping extraction");else{C.default.existsSync(w)&&(console.log("[GameHandler] Natives incomplete, clearing for fresh extraction..."),C.default.rmSync(w,{recursive:!0,force:!0})),C.default.mkdirSync(w,{recursive:!0});let A="natives-linux";process.platform==="win32"?A="natives-windows":process.platform==="darwin"&&(A="natives-osx");let ue=[{group:"org.lwjgl.lwjgl",artifact:"lwjgl-platform",version:"2.9.4+legacyfabric.9",classifier:A},{group:"net.java.jinput",artifact:"jinput-platform",version:"2.0.5",classifier:A}];for(let X of ue){let ee=`${X.artifact}-${X.version}-${X.classifier}.jar`,me=`${X.group.replace(/\./g,"/")}/${X.artifact}/${X.version}/${ee}`,le=F.default.join(O,ee);if(C.default.existsSync(le)){console.log(`[Cache] Found native library locally: ${ee}`),await Jt(le,w);continue}let he=Ce+me;X.group==="net.java.jinput"&&(he=se+me);let Oe=await this.downloadFile(he,F.default.join(a,"temp_natives"),ee,e.sender);await Jt(Oe,w)}if(process.platform==="darwin")try{let X=C.default.readdirSync(w);for(let ee of X)if(ee.endsWith(".jnilib")){let me=F.default.join(w,ee),le=F.default.join(w,ee.replace(".jnilib",".dylib"));if(C.default.existsSync(me)){console.log(`[GameHandler] Renaming ${ee} to .dylib`);try{C.default.existsSync(le)&&C.default.unlinkSync(le),C.default.renameSync(me,le)}catch(he){console.warn(`[GameHandler] Failed to rename ${ee}:`,he)}}}}catch(X){console.warn("[GameHandler] Failed to process macOS natives:",X)}try{let X=C.default.readdirSync(w);console.log(`[GameHandler] Natives folder contents (${w}):`,X)}catch(X){console.error("[GameHandler] Failed to read natives folder:",X)}}let Ze=await this.downloadFile("https://maven.fabricmc.net/net/fabricmc/fabric-loader/0.16.7/fabric-loader-0.16.7.jar",O,"fabric-loader-0.16.7.jar",e.sender),Je=await this.downloadFile("https://maven.glass-launcher.net/babric/babric/intermediary-upstream/b1.7.3/intermediary-upstream-b1.7.3.jar",O,"intermediary-upstream-b1.7.3.jar",e.sender);d.push(Ze),d.push(Je),g="net.fabricmc.loader.impl.launch.knot.KnotClient";let Xe=[];for(let A of d)A!==m&&Xe.push(A);Xe.push(m),d=Xe}}if(!n){for(let x of l.libraries)if(x.downloads&&x.downloads.artifact){let L=x.downloads.artifact;if(L.path.includes("lwjgl")||L.path.includes("jinput")){let U=await this.downloadFile(L.url,I,F.default.basename(L.path),e.sender);d.push(U)}}}this.sendProgress(e.sender,"Iniciando Jogo...",95);let o=t.settings?.minMemory||"512",u=t.settings?.maxMemory||"2048",h=t.settings?.javaArgs||"",b="";try{if(C.default.existsSync(w)){let x=C.default.readdirSync(w),L=process.platform==="win32"?["OpenAL64.dll","OpenAL32.dll","OpenAL-amd64.dll","OpenAL-i386.dll","OpenAL.dll"]:process.platform==="darwin"?["libopenal.dylib","openal.dylib"]:["libopenal.so","libopenal-amd64.so","libopenal-i386.so"];for(let U of L)if(x.includes(U)){b=F.default.join(w,U),console.log(`[GameHandler] Found OpenAL library: ${b}`);break}if(!b){let U=x.find(W=>W.toLowerCase().includes("openal")&&(W.endsWith(".dll")||W.endsWith(".so")||W.endsWith(".dylib")));U&&(b=F.default.join(w,U),console.log(`[GameHandler] Found OpenAL library (fallback): ${b}`))}}}catch(x){console.warn("[GameHandler] Failed to scan for OpenAL lib:",x)}let S=F.default.join(c,"resources"),N=[`-Xms${o}M`,`-Xmx${u}M`,"-Djava.library.path="+w,"-Dfabric.gameJarPath="+m,"-Dfabric.gameVersion=b1.7.3","-Dfabric.envType=client","-Dslf4j.internal.verbosity=ERROR","-Dminecraft.resources.index="+S,"-Dminecraft.applet.TargetDirectory="+c,"-Dminecraft.applet.BaseURL=file:///"];if(h.trim()){let x=h.trim().split(/\s+/).filter(L=>L.length>0);N.push(...x)}if(t.settings?.borderlessMode&&(console.log("[GameHandler] Borderless mode enabled - adding LWJGL undecorated flag"),N.push("-Dorg.lwjgl.opengl.Window.undecorated=true")),N.push("-cp",d.join(F.default.delimiter)),N.push(g),N.push("--username",t.username),N.push("--gameDir",c),N.push("--assetsDir",F.default.join(c,"resources")),n&&g.includes("KnotClient")&&N.push("--assetIndex","truly_legacy"),t.settings?.borderlessMode)try{let x=Q.screen.getPrimaryDisplay(),{width:L,height:U}=x.size;console.log(`[GameHandler] Borderless mode: setting window size to ${L}x${U}`),N.push("--width",L.toString()),N.push("--height",U.toString())}catch(x){console.warn("[GameHandler] Failed to get screen size for borderless mode:",x),N.push("--width","1920"),N.push("--height","1080")}N.push("--server","185.100.215.195"),N.push("--port","25565"),console.log("Spawning java:",this.javaPath),console.log("Args:",N);let _={...process.env};if(process.platform==="linux"&&(_.ALSOFT_CONF="period_size=2048",_.ALSOFT_DRIVERS="pulse,alsa,oss"),process.platform==="win32"){let x=Object.keys(_).find(L=>L.toLowerCase()==="path")||"Path";_[x]=w+F.default.delimiter+(_[x]||""),console.log("[GameHandler] Updated PATH with natives:",w)}this.gameProcess=(0,$e.spawn)(this.javaPath,N,{cwd:c,env:_});let T=ke();T&&T.setGameRunning(!0),t.settings?.borderlessMode&&this.applyBorderlessPostSpawn().catch(x=>{D.error("GameHandler",`Borderless post-spawn failed: ${x.message}`)});let R=["s3.amazonaws.com/MinecraftResources","Failed to add pack.mcmeta","Failed to add READ_ME_I_AM_VERY_IMPORTANT"];return this.gameProcess.stdout.on("data",x=>{let L=x.toString().trim();L&&(D.game("stdout",L),!R.some(U=>L.includes(U))&&(console.log(`[MC]: ${L}`),L.includes("Connecting to")&&e.sender.send("game-connected")))}),this.gameProcess.stderr.on("data",x=>{let L=x.toString().trim();L&&(D.game("stderr",L),!R.some(U=>L.includes(U))&&console.error(`[MC-Err]: ${L}`))}),this.gameProcess.on("close",x=>{D.info("GameHandler",`Minecraft exited with code ${x}`),console.log(`Minecraft exited with code ${x}`),this.sendProgress(e.sender,"Jogo fechado",100),this.gameProcess=null,e.sender.send("game-closed",x);let L=ke();L&&L.setGameRunning(!1)}),{success:!0}}catch(l){return console.error("Launch failed:",l),this.sendProgress(e.sender,`Erro: ${l.message}`,0),{success:!1,error:l.message,stack:l.stack}}}async handleUpdateCheck(){try{let e=await this.updateManager.checkForUpdates();return e.remoteVersions?e.instanceUpdate||e.librariesUpdate||e.modsUpdate||e.launcherUpdate?{available:!0,launcherUpdate:e.launcherUpdate,launcherDownloadUrl:e.launcherDownloadUrl,instanceUpdate:e.instanceUpdate,librariesUpdate:e.librariesUpdate,modsUpdate:e.modsUpdate,notes:e.remoteVersions.mods?.notes||"Atualiza\xE7\xF5es dispon\xEDveis"}:{available:!1}:{available:!1,error:"Failed to fetch version info"}}catch(e){return console.error("Update check failed:",e),{available:!1,error:String(e)}}}async handlePerformUpdate(e){try{return await this.updateManager.performAllUpdates((r,s)=>{this.sendProgress(e.sender,r,s)})}catch(t){return console.error("Update failed:",t),this.sendProgress(e.sender,`Erro na atualiza\xE7\xE3o: ${t}`,0),{success:!1,error:String(t)}}}};var xe=require("electron"),te=z(require("fs"),1),re=z(require("path"),1),Yt=z(be(),1);var Be=class{userDataPath;activeModsDir="";constructor(){this.userDataPath=xe.app.getPath("userData")}init(){xe.ipcMain.handle("get-mods",async()=>(D.info("ModHandler","Fetching mods list..."),this.getMods())),xe.ipcMain.handle("toggle-mod",async(e,{fileName:t,enable:r})=>(D.info("ModHandler",`Toggling mod ${t} to ${r}`),this.toggleMod(t,r)))}async toggleMod(e,t){if(!this.activeModsDir){let s="Cannot toggle mod: No active mods directory found.";return D.error("ModHandler",s),{success:!1,error:s}}let r=re.default.join(this.activeModsDir,"disabled");if(!te.default.existsSync(r))try{await te.default.promises.mkdir(r,{recursive:!0})}catch(s){let n=`Failed to create disabled directory: ${s.message}`;return D.error("ModHandler",n),{success:!1,error:n}}try{if(t){let s=re.default.join(r,e),n=re.default.join(this.activeModsDir,e);if(te.default.existsSync(s)){if(te.default.existsSync(n)){let c=`Destination file already exists: ${n}`;return D.warn("ModHandler",c),{success:!1,error:c}}return await this.moveFile(s,n)?(D.info("ModHandler",`Enabled mod: Moved ${e} to active folder`),{success:!0}):{success:!1,error:"Move operation failed (check logs)"}}else{let a=`Cannot enable: File not found in disabled folder: ${s}`;return D.warn("ModHandler",a),{success:!1,error:a}}}else{let s=re.default.join(this.activeModsDir,e),n=re.default.join(r,e);if(te.default.existsSync(s))return await this.moveFile(s,n)?(D.info("ModHandler",`Disabled mod: Moved ${e} to disabled folder`),{success:!0}):{success:!1,error:"Move operation failed (check logs)"};{let a=`Cannot disable: File not found in active folder: ${s}`;return D.warn("ModHandler",a),{success:!1,error:a}}}}catch(s){return D.error("ModHandler",`Failed to toggle mod ${e}: ${s.message}`),{success:!1,error:s.message}}}async moveFile(e,t){try{return await te.default.promises.rename(e,t),!0}catch(r){D.warn("ModHandler",`Rename failed for ${re.default.basename(e)}, trying copy+unlink: ${r}`);try{return await te.default.promises.copyFile(e,t),await te.default.promises.unlink(e),!0}catch(s){return D.error("ModHandler",`Move failed completely for ${re.default.basename(e)}: ${s}`),!1}}}async getMods(){let e=[re.default.join(this.userDataPath,"instances","default",".minecraft","mods"),re.default.join(this.userDataPath,"instances","default","mods"),re.default.join(this.userDataPath,"gamedata","mods")],t="";for(let a of e)if(te.default.existsSync(a)){t=a,D.info("ModHandler",`Found mods directory at: ${t}`);break}if(!t)return D.warn("ModHandler","No valid mods directory found in standard locations."),[];this.activeModsDir=t;let r=re.default.join(t,"disabled"),s=[],n=async(a,c)=>{if(te.default.existsSync(a))try{let v=await te.default.promises.readdir(a);for(let y of v){if(!y.endsWith(".jar"))continue;let I=re.default.join(a,y);if((await te.default.promises.stat(I)).isDirectory())continue;let O={fileName:y,enabled:c,name:y,description:"",version:""};try{let f=new Yt.default(I).getEntries(),m=f.find(p=>p.entryName==="fabric.mod.json"),d=f.find(p=>p.entryName==="mod.json"),g=m||d;if(g){let p=g.getData().toString("utf8"),o=JSON.parse(p);o.name&&(O.name=o.name),o.description&&(O.description=o.description),o.version&&(O.version=o.version)}}catch(l){D.warn("ModHandler",`Could not read metadata for ${y}: ${l}`)}s.push(O)}}catch(v){D.error("ModHandler",`Error scanning directory ${a}: ${v}`)}};return await n(t,!0),await n(r,!1),s.sort((a,c)=>a.enabled===c.enabled?a.name.localeCompare(c.name):a.enabled?-1:1)}};var G=require("electron");var Qt=z(require("path"),1),Ve=z(require("fs"),1),it=["F6","Shift+Tab","CommandOrControl+Tab"],ze=class{overlayWindow=null;browserView=null;isVisible=!1;isGameRunning=!1;hotkeyRegistered=!1;configPath="";OVERLAY_URL="https://craft.blocky.com.br";HEADER_HEIGHT=48;init(){D.info("OverlayHandler","Initializing overlay handler"),this.configPath=Qt.default.join(G.app.getPath("userData"),"overlay-config.json"),this.registerHotkey(),this.setupIPC()}setupIPC(){G.ipcMain.on("overlay-go-back",()=>{this.browserView&&!this.browserView.webContents.isDestroyed()&&this.browserView.webContents.canGoBack()&&(this.browserView.webContents.goBack(),D.info("OverlayHandler","Navigated back"))}),G.ipcMain.on("overlay-go-home",()=>{this.browserView&&!this.browserView.webContents.isDestroyed()&&(this.browserView.webContents.loadURL(this.OVERLAY_URL),D.info("OverlayHandler","Navigated to home"))}),G.ipcMain.on("overlay-close",()=>{this.hideOverlay(),D.info("OverlayHandler","Closed via IPC")}),G.ipcMain.handle("get-overlay-hotkey",()=>this.getHotkey()),G.ipcMain.handle("set-overlay-hotkey",(e,t)=>this.setHotkey(t)),G.ipcMain.handle("get-available-hotkeys",()=>this.getAvailableHotkeys())}registeredHotkey=null;getDefaultHotkey(){return process.platform==="linux"?"F6":"Shift+Tab"}loadSavedHotkey(){try{if(Ve.default.existsSync(this.configPath)){let e=JSON.parse(Ve.default.readFileSync(this.configPath,"utf-8"));if(e.hotkey&&it.includes(e.hotkey))return e.hotkey}}catch{D.warn("OverlayHandler","Failed to load hotkey config, using default")}return this.getDefaultHotkey()}saveHotkeyConfig(e){try{Ve.default.writeFileSync(this.configPath,JSON.stringify({hotkey:e},null,2)),D.info("OverlayHandler",`Saved hotkey config: ${e}`)}catch{D.error("OverlayHandler","Failed to save hotkey config")}}registerHotkey(){let e=this.loadSavedHotkey();this.tryRegisterHotkey(e)}tryRegisterHotkey(e){try{return G.globalShortcut.isRegistered(e)?(D.warn("OverlayHandler",`Hotkey ${e} is already registered by another application`),!1):G.globalShortcut.register(e,()=>{D.info("OverlayHandler",`${e} pressed`),this.toggleOverlay()})?(this.registeredHotkey=e,this.hotkeyRegistered=!0,D.info("OverlayHandler",`Overlay hotkey registered: ${e}`),!0):(D.warn("OverlayHandler",`Failed to register hotkey: ${e}`),!1)}catch(t){return D.error("OverlayHandler",`Exception registering ${e}: ${t.message}`),!1}}getHotkey(){return this.registeredHotkey||this.getDefaultHotkey()}setHotkey(e){if(!it.includes(e))return{success:!1,error:`Invalid hotkey: ${e}`};if(this.registeredHotkey&&this.hotkeyRegistered&&(G.globalShortcut.unregister(this.registeredHotkey),this.hotkeyRegistered=!1,this.registeredHotkey=null),this.tryRegisterHotkey(e))return this.saveHotkeyConfig(e),{success:!0};{let t=this.getDefaultHotkey();return t!==e&&this.tryRegisterHotkey(t),{success:!1,error:`Failed to register hotkey: ${e}. It may be in use by another application.`}}}getAvailableHotkeys(){return[...it]}cleanup(){this.hotkeyRegistered&&this.registeredHotkey&&(G.globalShortcut.unregister(this.registeredHotkey),this.hotkeyRegistered=!1,this.registeredHotkey=null,D.info("OverlayHandler","Hotkey unregistered")),this.overlayWindow&&!this.overlayWindow.isDestroyed()&&(this.overlayWindow.setBrowserView(null),this.browserView&&!this.browserView.webContents.isDestroyed()&&this.browserView.webContents.destroy(),this.overlayWindow.destroy(),this.overlayWindow=null,this.browserView=null)}createOverlayWindow(){if(this.overlayWindow&&!this.overlayWindow.isDestroyed()){D.info("OverlayHandler","Overlay window already exists");return}let e=G.screen.getPrimaryDisplay(),{width:t,height:r}=e.size,s=Math.min(Math.floor(t*.85),1400),n=Math.min(Math.floor(r*.85),900),a=Math.floor((t-s)/2),c=Math.floor((r-n)/2);D.info("OverlayHandler",`Creating overlay: ${s}x${n} at (${a}, ${c})`),this.overlayWindow=new G.BrowserWindow({width:s,height:n,x:a,y:c,frame:!1,transparent:!1,alwaysOnTop:!0,skipTaskbar:!0,show:!1,resizable:!1,movable:!1,focusable:!0,hasShadow:!0,backgroundColor:"#1e1e1e",webPreferences:{nodeIntegration:!0,contextIsolation:!1,sandbox:!1}});let v=`
<!DOCTYPE html>
<html>
<head>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { margin: 0; overflow: hidden; background: #1e1e1e; font-family: 'Inter', system-ui, -apple-system, sans-serif; }
        #blockycraft-nav-bar {
            height: ${this.HEADER_HEIGHT}px;
            background: #1e1e1e;
            border-bottom: 1px solid #333333;
            display: flex;
            align-items: center;
            padding: 0 16px;
            gap: 8px;
            color: white;
            user-select: none;
        }
        #blockycraft-nav-bar button {
            background: #2a2a2a;
            border: 1px solid #333333;
            color: #ffffff;
            width: 36px;
            height: 36px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        #blockycraft-nav-bar button:hover {
            background: #333333;
            border-color: #444444;
        }
        #blockycraft-nav-bar button svg {
            width: 20px;
            height: 20px;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
            fill: none;
        }
        #blockycraft-nav-bar .nav-title {
            color: #a1a1aa;
            font-size: 13px;
            margin-left: auto;
            font-weight: 500;
        }
        #blockycraft-nav-bar .close-btn {
            background: transparent;
            border-color: transparent;
            color: #ffffff;
            margin-left: 8px;
        }
        #blockycraft-nav-bar .close-btn:hover {
            background: #ef4444;
            border-color: #ef4444;
            color: #ffffff;
        }
    </style>
</head>
<body>
    <div id="blockycraft-nav-bar">
        <button id="bc-back-btn" title="Voltar" onclick="window.overlayAPI.goBack()">
            <svg viewBox="0 0 24 24"><path d="m15 18-6-6 6-6"/></svg>
        </button>
        <button id="bc-home-btn" title="In\xEDcio" onclick="window.overlayAPI.goHome()">
            <svg viewBox="0 0 24 24"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        </button>
        <span class="nav-title">BlockyCRAFT Overlay</span>
        <button class="close-btn" id="bc-close-btn" title="Fechar (Shift+Tab)" onclick="window.overlayAPI.close()">
            <svg viewBox="0 0 24 24"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
        </button>
    </div>
    <script>
        const { ipcRenderer } = require('electron');
        window.overlayAPI = {
            goBack: () => ipcRenderer.send('overlay-go-back'),
            goHome: () => ipcRenderer.send('overlay-go-home'),
            close: () => ipcRenderer.send('overlay-close')
        };
    </script>
</body>
</html>`;this.overlayWindow.loadURL(`data:text/html;charset=utf-8,${encodeURIComponent(v)}`),this.browserView=new G.BrowserView({webPreferences:{nodeIntegration:!1,contextIsolation:!0,sandbox:process.platform!=="linux"}}),this.overlayWindow.setBrowserView(this.browserView),this.browserView.setBounds({x:0,y:this.HEADER_HEIGHT,width:s,height:n-this.HEADER_HEIGHT}),this.browserView.setAutoResize({width:!0,height:!0}),this.browserView.webContents.on("did-start-loading",()=>{D.info("OverlayHandler","Browser started loading")}),this.browserView.webContents.on("did-fail-load",(y,I,w)=>{D.error("OverlayHandler",`Failed to load: ${I} - ${w}`)}),this.browserView.webContents.setWindowOpenHandler(({url:y})=>(D.info("OverlayHandler",`Intercepted new window request: ${y}`),this.browserView&&!this.browserView.webContents.isDestroyed()&&this.browserView.webContents.loadURL(y),{action:"deny"})),this.browserView.webContents.on("before-input-event",(y,I)=>{I.key==="Escape"&&I.type==="keyDown"&&this.hideOverlay()}),this.overlayWindow.webContents.on("before-input-event",(y,I)=>{I.key==="Escape"&&I.type==="keyDown"&&this.hideOverlay()}),D.info("OverlayHandler",`Loading URL: ${this.OVERLAY_URL}`),this.browserView.webContents.loadURL(this.OVERLAY_URL),this.overlayWindow.on("close",y=>{this.overlayWindow&&!this.overlayWindow.isDestroyed()&&(y.preventDefault(),this.hideOverlay())}),D.info("OverlayHandler","Overlay window created with BrowserView")}toggleOverlay(){if(!this.isGameRunning){D.info("OverlayHandler","Game not running - overlay disabled");return}this.isVisible?this.hideOverlay():this.showOverlay()}showOverlay(){(!this.overlayWindow||this.overlayWindow.isDestroyed())&&(D.info("OverlayHandler","Creating overlay window on first use..."),this.createOverlayWindow()),this.overlayWindow&&(this.overlayWindow.show(),this.overlayWindow.focus(),this.overlayWindow.setAlwaysOnTop(!0,"screen-saver"),this.isVisible=!0,D.info("OverlayHandler","Overlay shown"))}hideOverlay(){this.overlayWindow&&!this.overlayWindow.isDestroyed()&&(this.overlayWindow.hide(),this.isVisible=!1,D.info("OverlayHandler","Overlay hidden"))}setGameRunning(e){this.isGameRunning=e,D.info("OverlayHandler",`Game running state: ${e}`),!e&&this.isVisible&&this.hideOverlay()}isGameActive(){return this.isGameRunning}isOverlayVisible(){return this.isVisible}};K.app.commandLine.appendSwitch("no-sandbox");K.app.commandLine.appendSwitch("ozone-platform-hint","auto");var jr=new He;jr.init();var Tr=new Be;Tr.init();var fe=null;function ke(){return fe}console.log("=== BlockyCRAFT Launcher Starting ===");console.log("Electron version:",process.versions.electron);var ie=null,er=process.env.VITE_DEV_SERVER_URL;function tr(){if(console.log("Creating main window..."),ie=new K.BrowserWindow({width:900,height:600,minWidth:800,minHeight:500,frame:!0,resizable:!0,webPreferences:{nodeIntegration:!1,contextIsolation:!0,preload:st.default.join(__dirname,"preload.cjs"),sandbox:!1},backgroundColor:"#0f0f0f",show:!0,autoHideMenuBar:!0}),ie.setMenu(null),K.ipcMain.handle("open-external",async(i,e)=>{console.log("Opening external URL:",e);try{let{shell:t}=await import("electron");await t.openExternal(e)}catch(t){console.error("Failed to open external URL:",t)}}),K.ipcMain.handle("fetch-url",async(i,e)=>{D.info("Main",`Proxying fetch request to: ${e}`);let{net:t}=await import("electron");try{let r=await t.fetch(e);if(!r.ok)throw new Error(`HTTP ${r.status} ${r.statusText}`);return{success:!0,data:await r.text()}}catch(r){return D.error("Main",`Fetch failed for ${e}: ${r.message}`),{success:!1,error:r.message}}}),console.log("Window created, loading content..."),er)ie.loadURL(er);else{let i=st.default.join(__dirname,"../dist/index.html");ie.loadFile(i)}ie.webContents.on("did-finish-load",()=>{console.log("Create Window: did-finish-load")}),ie.webContents.on("did-fail-load",(i,e,t,r)=>{console.error("Create Window: did-fail-load",e,t,r)}),ie.webContents.on("render-process-gone",(i,e)=>{console.error("Create Window: render-process-gone",e)}),ie.webContents.on("unresponsive",()=>{console.error("Create Window: unresponsive")}),ie.on("closed",()=>{fe&&fe.cleanup(),ie=null,K.app.quit()})}K.app.whenReady().then(()=>{D.init(),D.info("Main",`Electron version: ${process.versions.electron}`),D.info("Main",`Node version: ${process.versions.node}`),D.info("Main",`Platform: ${process.platform} ${process.arch}`),fe=new ze,fe.init(),tr()});K.app.on("will-quit",()=>{fe&&fe.cleanup(),K.globalShortcut.unregisterAll()});K.app.on("window-all-closed",()=>{process.platform!=="darwin"&&K.app.quit()});K.app.on("activate",()=>{K.BrowserWindow.getAllWindows().length===0&&tr()});0&&(module.exports={getOverlayHandler});
