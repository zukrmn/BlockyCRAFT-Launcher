var Kt=Object.create;var Le=Object.defineProperty;var Yt=Object.getOwnPropertyDescriptor;var Qt=Object.getOwnPropertyNames;var er=Object.getPrototypeOf,tr=Object.prototype.hasOwnProperty;var K=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports),rr=(i,e)=>{for(var t in e)Le(i,t,{get:e[t],enumerable:!0})},qe=(i,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Qt(e))!tr.call(i,s)&&s!==t&&Le(i,s,{get:()=>e[s],enumerable:!(r=Yt(e,s))||r.enumerable});return i};var G=(i,e,t)=>(t=i!=null?Kt(er(i)):{},qe(e||!i||!i.__esModule?Le(t,"default",{value:i,enumerable:!0}):t,i)),nr=i=>qe(Le({},"__esModule",{value:!0}),i);var $e=K((Mr,Ye)=>{Ye.exports={LOCHDR:30,LOCSIG:67324752,LOCVER:4,LOCFLG:6,LOCHOW:8,LOCTIM:10,LOCCRC:14,LOCSIZ:18,LOCLEN:22,LOCNAM:26,LOCEXT:28,EXTSIG:134695760,EXTHDR:16,EXTCRC:4,EXTSIZ:8,EXTLEN:12,CENHDR:46,CENSIG:33639248,CENVEM:4,CENVER:6,CENFLG:8,CENHOW:10,CENTIM:12,CENCRC:16,CENSIZ:20,CENLEN:24,CENNAM:28,CENEXT:30,CENCOM:32,CENDSK:34,CENATT:36,CENATX:38,CENOFF:42,ENDHDR:22,ENDSIG:101010256,ENDSUB:8,ENDTOT:10,ENDSIZ:12,ENDOFF:16,ENDCOM:20,END64HDR:20,END64SIG:117853008,END64START:4,END64OFF:8,END64NUMDISKS:16,ZIP64SIG:101075792,ZIP64HDR:56,ZIP64LEAD:12,ZIP64SIZE:4,ZIP64VEM:12,ZIP64VER:14,ZIP64DSK:16,ZIP64DSKDIR:20,ZIP64SUB:24,ZIP64TOT:32,ZIP64SIZB:40,ZIP64OFF:48,ZIP64EXTRA:56,STORED:0,SHRUNK:1,REDUCED1:2,REDUCED2:3,REDUCED3:4,REDUCED4:5,IMPLODED:6,DEFLATED:8,ENHANCED_DEFLATED:9,PKWARE:10,BZIP2:12,LZMA:14,IBM_TERSE:18,IBM_LZ77:19,AES_ENCRYPT:99,FLG_ENC:1,FLG_COMP1:2,FLG_COMP2:4,FLG_DESC:8,FLG_ENH:16,FLG_PATCH:32,FLG_STR:64,FLG_EFS:2048,FLG_MSK:4096,FILE:2,BUFFER:1,NONE:0,EF_ID:0,EF_SIZE:2,ID_ZIP64:1,ID_AVINFO:7,ID_PFS:8,ID_OS2:9,ID_NTFS:10,ID_OPENVMS:12,ID_UNIX:13,ID_FORK:14,ID_PATCH:15,ID_X509_PKCS7:20,ID_X509_CERTID_F:21,ID_X509_CERTID_C:22,ID_STRONGENC:23,ID_RECORD_MGT:24,ID_X509_PKCS7_RL:25,ID_IBM1:101,ID_IBM2:102,ID_POSZIP:18064,EF_ZIP64_OR_32:4294967295,EF_ZIP64_OR_16:65535,EF_ZIP64_SUNCOMP:0,EF_ZIP64_SCOMP:8,EF_ZIP64_RHO:16,EF_ZIP64_DSN:24}});var xe=K(et=>{var Qe={INVALID_LOC:"Invalid LOC header (bad signature)",INVALID_CEN:"Invalid CEN header (bad signature)",INVALID_END:"Invalid END header (bad signature)",DESCRIPTOR_NOT_EXIST:"No descriptor present",DESCRIPTOR_UNKNOWN:"Unknown descriptor format",DESCRIPTOR_FAULTY:"Descriptor data is malformed",NO_DATA:"Nothing to decompress",BAD_CRC:"CRC32 checksum failed {0}",FILE_IN_THE_WAY:"There is a file in the way: {0}",UNKNOWN_METHOD:"Invalid/unsupported compression method",AVAIL_DATA:"inflate::Available inflate data did not terminate",INVALID_DISTANCE:"inflate::Invalid literal/length or distance code in fixed or dynamic block",TO_MANY_CODES:"inflate::Dynamic block code description: too many length or distance codes",INVALID_REPEAT_LEN:"inflate::Dynamic block code description: repeat more than specified lengths",INVALID_REPEAT_FIRST:"inflate::Dynamic block code description: repeat lengths with no first length",INCOMPLETE_CODES:"inflate::Dynamic block code description: code lengths codes incomplete",INVALID_DYN_DISTANCE:"inflate::Dynamic block code description: invalid distance code lengths",INVALID_CODES_LEN:"inflate::Dynamic block code description: invalid literal/length code lengths",INVALID_STORE_BLOCK:"inflate::Stored block length did not match one's complement",INVALID_BLOCK_TYPE:"inflate::Invalid block type (type == 3)",CANT_EXTRACT_FILE:"Could not extract the file",CANT_OVERRIDE:"Target file already exists",DISK_ENTRY_TOO_LARGE:"Number of disk entries is too large",NO_ZIP:"No zip file was loaded",NO_ENTRY:"Entry doesn't exist",DIRECTORY_CONTENT_ERROR:"A directory cannot have content",FILE_NOT_FOUND:'File not found: "{0}"',NOT_IMPLEMENTED:"Not implemented",INVALID_FILENAME:"Invalid filename",INVALID_FORMAT:"Invalid or unsupported zip format. No END header found",INVALID_PASS_PARAM:"Incompatible password parameter",WRONG_PASSWORD:"Wrong Password",COMMENT_TOO_LONG:"Comment is too long",EXTRA_FIELD_PARSE_ERROR:"Extra field parsing error"};function or(i){return function(...e){return e.length&&(i=i.replace(/\{(\d)\}/g,(t,r)=>e[r]||"")),new Error("ADM-ZIP: "+i)}}for(let i of Object.keys(Qe))et[i]=or(Qe[i])});var it=K((kr,ot)=>{var ir=require("fs"),W=require("path"),tt=$e(),sr=xe(),ar=typeof process=="object"&&process.platform==="win32",rt=i=>typeof i=="object"&&i!==null,nt=new Uint32Array(256).map((i,e)=>{for(let t=0;t<8;t++)(e&1)!==0?e=3988292384^e>>>1:e>>>=1;return e>>>0});function k(i){this.sep=W.sep,this.fs=ir,rt(i)&&rt(i.fs)&&typeof i.fs.statSync=="function"&&(this.fs=i.fs)}ot.exports=k;k.prototype.makeDir=function(i){let e=this;function t(r){let s=r.split(e.sep)[0];r.split(e.sep).forEach(function(n){if(!(!n||n.substr(-1,1)===":")){s+=e.sep+n;var c;try{c=e.fs.statSync(s)}catch{e.fs.mkdirSync(s)}if(c&&c.isFile())throw sr.FILE_IN_THE_WAY(`"${s}"`)}})}t(i)};k.prototype.writeFileTo=function(i,e,t,r){let s=this;if(s.fs.existsSync(i)){if(!t)return!1;var n=s.fs.statSync(i);if(n.isDirectory())return!1}var c=W.dirname(i);s.fs.existsSync(c)||s.makeDir(c);var d;try{d=s.fs.openSync(i,"w",438)}catch{s.fs.chmodSync(i,438),d=s.fs.openSync(i,"w",438)}if(d)try{s.fs.writeSync(d,e,0,e.length,0)}finally{s.fs.closeSync(d)}return s.fs.chmodSync(i,r||438),!0};k.prototype.writeFileToAsync=function(i,e,t,r,s){typeof r=="function"&&(s=r,r=void 0);let n=this;n.fs.exists(i,function(c){if(c&&!t)return s(!1);n.fs.stat(i,function(d,v){if(c&&v.isDirectory())return s(!1);var y=W.dirname(i);n.fs.exists(y,function(I){I||n.makeDir(y),n.fs.open(i,"w",438,function(b,N){b?n.fs.chmod(i,438,function(){n.fs.open(i,"w",438,function(a,f){n.fs.write(f,e,0,e.length,0,function(){n.fs.close(f,function(){n.fs.chmod(i,r||438,function(){s(!0)})})})})}):N?n.fs.write(N,e,0,e.length,0,function(){n.fs.close(N,function(){n.fs.chmod(i,r||438,function(){s(!0)})})}):n.fs.chmod(i,r||438,function(){s(!0)})})})})})};k.prototype.findFiles=function(i){let e=this;function t(r,s,n){typeof s=="boolean"&&(n=s,s=void 0);let c=[];return e.fs.readdirSync(r).forEach(function(d){let v=W.join(r,d),y=e.fs.statSync(v);(!s||s.test(v))&&c.push(W.normalize(v)+(y.isDirectory()?e.sep:"")),y.isDirectory()&&n&&(c=c.concat(t(v,s,n)))}),c}return t(i,void 0,!0)};k.prototype.findFilesAsync=function(i,e){let t=this,r=[];t.fs.readdir(i,function(s,n){if(s)return e(s);let c=n.length;if(!c)return e(null,r);n.forEach(function(d){d=W.join(i,d),t.fs.stat(d,function(v,y){if(v)return e(v);y&&(r.push(W.normalize(d)+(y.isDirectory()?t.sep:"")),y.isDirectory()?t.findFilesAsync(d,function(I,b){if(I)return e(I);r=r.concat(b),--c||e(null,r)}):--c||e(null,r))})})})};k.prototype.getAttributes=function(){};k.prototype.setAttributes=function(){};k.crc32update=function(i,e){return nt[(i^e)&255]^i>>>8};k.crc32=function(i){typeof i=="string"&&(i=Buffer.from(i,"utf8"));let e=i.length,t=-1;for(let r=0;r<e;)t=k.crc32update(t,i[r++]);return~t>>>0};k.methodToString=function(i){switch(i){case tt.STORED:return"STORED ("+i+")";case tt.DEFLATED:return"DEFLATED ("+i+")";default:return"UNSUPPORTED ("+i+")"}};k.canonical=function(i){if(!i)return"";let e=W.posix.normalize("/"+i.split("\\").join("/"));return W.join(".",e)};k.zipnamefix=function(i){if(!i)return"";let e=W.posix.normalize("/"+i.split("\\").join("/"));return W.posix.join(".",e)};k.findLast=function(i,e){if(!Array.isArray(i))throw new TypeError("arr is not array");let t=i.length>>>0;for(let r=t-1;r>=0;r--)if(e(i[r],r,i))return i[r]};k.sanitize=function(i,e){i=W.resolve(W.normalize(i));for(var t=e.split("/"),r=0,s=t.length;r<s;r++){var n=W.normalize(W.join(i,t.slice(r,s).join(W.sep)));if(n.indexOf(i)===0)return n}return W.normalize(W.join(i,W.basename(e)))};k.toBuffer=function(e,t){return Buffer.isBuffer(e)?e:e instanceof Uint8Array?Buffer.from(e):typeof e=="string"?t(e):Buffer.alloc(0)};k.readBigUInt64LE=function(i,e){var t=Buffer.from(i.slice(e,e+8));return t.swap64(),parseInt(`0x${t.toString("hex")}`)};k.fromDOS2Date=function(i){return new Date((i>>25&127)+1980,Math.max((i>>21&15)-1,0),Math.max(i>>16&31,1),i>>11&31,i>>5&63,(i&31)<<1)};k.fromDate2DOS=function(i){let e=0,t=0;return i.getFullYear()>1979&&(e=(i.getFullYear()-1980&127)<<9|i.getMonth()+1<<5|i.getDate(),t=i.getHours()<<11|i.getMinutes()<<5|i.getSeconds()>>1),e<<16|t};k.isWin=ar;k.crcTable=nt});var at=K(($r,st)=>{var cr=require("path");st.exports=function(i,{fs:e}){var t=i||"",r=n(),s=null;function n(){return{directory:!1,readonly:!1,hidden:!1,executable:!1,mtime:0,atime:0}}return t&&e.existsSync(t)?(s=e.statSync(t),r.directory=s.isDirectory(),r.mtime=s.mtime,r.atime=s.atime,r.executable=(73&s.mode)!==0,r.readonly=(128&s.mode)===0,r.hidden=cr.basename(t)[0]==="."):console.warn("Invalid path: "+t),{get directory(){return r.directory},get readOnly(){return r.readonly},get hidden(){return r.hidden},get mtime(){return r.mtime},get atime(){return r.atime},get executable(){return r.executable},decodeAttributes:function(){},encodeAttributes:function(){},toJSON:function(){return{path:t,isDirectory:r.directory,isReadOnly:r.readonly,isHidden:r.hidden,isExecutable:r.executable,mTime:r.mtime,aTime:r.atime}},toString:function(){return JSON.stringify(this.toJSON(),null,"	")}}}});var lt=K((Br,ct)=>{ct.exports={efs:!0,encode:i=>Buffer.from(i,"utf8"),decode:i=>i.toString("utf8")}});var ge=K((Vr,me)=>{me.exports=it();me.exports.Constants=$e();me.exports.Errors=xe();me.exports.FileAttr=at();me.exports.decoder=lt()});var dt=K((zr,ft)=>{var se=ge(),w=se.Constants;ft.exports=function(){var i=20,e=10,t=0,r=0,s=0,n=0,c=0,d=0,v=0,y=0,I=0,b=0,N=0,a=0,f=0;i|=se.isWin?2560:768,t|=w.FLG_EFS;let h={extraLen:0},l=o=>Math.max(0,o)>>>0,g=o=>Math.max(0,o)&65535,p=o=>Math.max(0,o)&255;return s=se.fromDate2DOS(new Date),{get made(){return i},set made(o){i=o},get version(){return e},set version(o){e=o},get flags(){return t},set flags(o){t=o},get flags_efs(){return(t&w.FLG_EFS)>0},set flags_efs(o){o?t|=w.FLG_EFS:t&=~w.FLG_EFS},get flags_desc(){return(t&w.FLG_DESC)>0},set flags_desc(o){o?t|=w.FLG_DESC:t&=~w.FLG_DESC},get method(){return r},set method(o){switch(o){case w.STORED:this.version=10;case w.DEFLATED:default:this.version=20}r=o},get time(){return se.fromDOS2Date(this.timeval)},set time(o){this.timeval=se.fromDate2DOS(o)},get timeval(){return s},set timeval(o){s=l(o)},get timeHighByte(){return p(s>>>8)},get crc(){return n},set crc(o){n=l(o)},get compressedSize(){return c},set compressedSize(o){c=l(o)},get size(){return d},set size(o){d=l(o)},get fileNameLength(){return v},set fileNameLength(o){v=o},get extraLength(){return y},set extraLength(o){y=o},get extraLocalLength(){return h.extraLen},set extraLocalLength(o){h.extraLen=o},get commentLength(){return I},set commentLength(o){I=o},get diskNumStart(){return b},set diskNumStart(o){b=l(o)},get inAttr(){return N},set inAttr(o){N=l(o)},get attr(){return a},set attr(o){a=l(o)},get fileAttr(){return(a||0)>>16&4095},get offset(){return f},set offset(o){f=l(o)},get encrypted(){return(t&w.FLG_ENC)===w.FLG_ENC},get centralHeaderSize(){return w.CENHDR+v+y+I},get realDataOffset(){return f+w.LOCHDR+h.fnameLen+h.extraLen},get localHeader(){return h},loadLocalHeaderFromBinary:function(o){var u=o.slice(f,f+w.LOCHDR);if(u.readUInt32LE(0)!==w.LOCSIG)throw se.Errors.INVALID_LOC();h.version=u.readUInt16LE(w.LOCVER),h.flags=u.readUInt16LE(w.LOCFLG),h.method=u.readUInt16LE(w.LOCHOW),h.time=u.readUInt32LE(w.LOCTIM),h.crc=u.readUInt32LE(w.LOCCRC),h.compressedSize=u.readUInt32LE(w.LOCSIZ),h.size=u.readUInt32LE(w.LOCLEN),h.fnameLen=u.readUInt16LE(w.LOCNAM),h.extraLen=u.readUInt16LE(w.LOCEXT);let m=f+w.LOCHDR+h.fnameLen,S=m+h.extraLen;return o.slice(m,S)},loadFromBinary:function(o){if(o.length!==w.CENHDR||o.readUInt32LE(0)!==w.CENSIG)throw se.Errors.INVALID_CEN();i=o.readUInt16LE(w.CENVEM),e=o.readUInt16LE(w.CENVER),t=o.readUInt16LE(w.CENFLG),r=o.readUInt16LE(w.CENHOW),s=o.readUInt32LE(w.CENTIM),n=o.readUInt32LE(w.CENCRC),c=o.readUInt32LE(w.CENSIZ),d=o.readUInt32LE(w.CENLEN),v=o.readUInt16LE(w.CENNAM),y=o.readUInt16LE(w.CENEXT),I=o.readUInt16LE(w.CENCOM),b=o.readUInt16LE(w.CENDSK),N=o.readUInt16LE(w.CENATT),a=o.readUInt32LE(w.CENATX),f=o.readUInt32LE(w.CENOFF)},localHeaderToBinary:function(){var o=Buffer.alloc(w.LOCHDR);return o.writeUInt32LE(w.LOCSIG,0),o.writeUInt16LE(e,w.LOCVER),o.writeUInt16LE(t,w.LOCFLG),o.writeUInt16LE(r,w.LOCHOW),o.writeUInt32LE(s,w.LOCTIM),o.writeUInt32LE(n,w.LOCCRC),o.writeUInt32LE(c,w.LOCSIZ),o.writeUInt32LE(d,w.LOCLEN),o.writeUInt16LE(v,w.LOCNAM),o.writeUInt16LE(h.extraLen,w.LOCEXT),o},centralHeaderToBinary:function(){var o=Buffer.alloc(w.CENHDR+v+y+I);return o.writeUInt32LE(w.CENSIG,0),o.writeUInt16LE(i,w.CENVEM),o.writeUInt16LE(e,w.CENVER),o.writeUInt16LE(t,w.CENFLG),o.writeUInt16LE(r,w.CENHOW),o.writeUInt32LE(s,w.CENTIM),o.writeUInt32LE(n,w.CENCRC),o.writeUInt32LE(c,w.CENSIZ),o.writeUInt32LE(d,w.CENLEN),o.writeUInt16LE(v,w.CENNAM),o.writeUInt16LE(y,w.CENEXT),o.writeUInt16LE(I,w.CENCOM),o.writeUInt16LE(b,w.CENDSK),o.writeUInt16LE(N,w.CENATT),o.writeUInt32LE(a,w.CENATX),o.writeUInt32LE(f,w.CENOFF),o},toJSON:function(){let o=function(u){return u+" bytes"};return{made:i,version:e,flags:t,method:se.methodToString(r),time:this.time,crc:"0x"+n.toString(16).toUpperCase(),compressedSize:o(c),size:o(d),fileNameLength:o(v),extraLength:o(y),commentLength:o(I),diskNumStart:b,inAttr:N,attr:a,offset:f,centralHeaderSize:o(w.CENHDR+v+y+I)}},toString:function(){return JSON.stringify(this.toJSON(),null,"	")}}}});var ht=K((Gr,ut)=>{var pe=ge(),M=pe.Constants;ut.exports=function(){var i=0,e=0,t=0,r=0,s=0;return{get diskEntries(){return i},set diskEntries(n){i=e=n},get totalEntries(){return e},set totalEntries(n){e=i=n},get size(){return t},set size(n){t=n},get offset(){return r},set offset(n){r=n},get commentLength(){return s},set commentLength(n){s=n},get mainHeaderSize(){return M.ENDHDR+s},loadFromBinary:function(n){if((n.length!==M.ENDHDR||n.readUInt32LE(0)!==M.ENDSIG)&&(n.length<M.ZIP64HDR||n.readUInt32LE(0)!==M.ZIP64SIG))throw pe.Errors.INVALID_END();n.readUInt32LE(0)===M.ENDSIG?(i=n.readUInt16LE(M.ENDSUB),e=n.readUInt16LE(M.ENDTOT),t=n.readUInt32LE(M.ENDSIZ),r=n.readUInt32LE(M.ENDOFF),s=n.readUInt16LE(M.ENDCOM)):(i=pe.readBigUInt64LE(n,M.ZIP64SUB),e=pe.readBigUInt64LE(n,M.ZIP64TOT),t=pe.readBigUInt64LE(n,M.ZIP64SIZE),r=pe.readBigUInt64LE(n,M.ZIP64OFF),s=0)},toBinary:function(){var n=Buffer.alloc(M.ENDHDR+s);return n.writeUInt32LE(M.ENDSIG,0),n.writeUInt32LE(0,4),n.writeUInt16LE(i,M.ENDSUB),n.writeUInt16LE(e,M.ENDTOT),n.writeUInt32LE(t,M.ENDSIZ),n.writeUInt32LE(r,M.ENDOFF),n.writeUInt16LE(s,M.ENDCOM),n.fill(" ",M.ENDHDR),n},toJSON:function(){let n=function(c,d){let v=c.toString(16).toUpperCase();for(;v.length<d;)v="0"+v;return"0x"+v};return{diskEntries:i,totalEntries:e,size:t+" bytes",offset:n(r,4),commentLength:s}},toString:function(){return JSON.stringify(this.toJSON(),null,"	")}}}});var Ve=K(Be=>{Be.EntryHeader=dt();Be.MainHeader=ht()});var gt=K((Zr,mt)=>{mt.exports=function(i){var e=require("zlib"),t={chunkSize:(parseInt(i.length/1024)+1)*1024};return{deflate:function(){return e.deflateRawSync(i,t)},deflateAsync:function(r){var s=e.createDeflateRaw(t),n=[],c=0;s.on("data",function(d){n.push(d),c+=d.length}),s.on("end",function(){var d=Buffer.alloc(c),v=0;d.fill(0);for(var y=0;y<n.length;y++){var I=n[y];I.copy(d,v),v+=I.length}r&&r(d)}),s.end(i)}}}});var yt=K((Jr,pt)=>{var lr=+(process.versions?process.versions.node:"").split(".")[0]||0;pt.exports=function(i,e){var t=require("zlib");let r=lr>=15&&e>0?{maxOutputLength:e}:{};return{inflate:function(){return t.inflateRawSync(i,r)},inflateAsync:function(s){var n=t.createInflateRaw(r),c=[],d=0;n.on("data",function(v){c.push(v),d+=v.length}),n.on("end",function(){var v=Buffer.alloc(d),y=0;v.fill(0);for(var I=0;I<c.length;I++){var b=c[I];b.copy(v,y),y+=b.length}s&&s(v)}),n.end(i)}}}});var St=K((Xr,bt)=>{"use strict";var{randomFillSync:vt}=require("crypto"),fr=xe(),dr=new Uint32Array(256).map((i,e)=>{for(let t=0;t<8;t++)(e&1)!==0?e=e>>>1^3988292384:e>>>=1;return e>>>0}),Et=(i,e)=>Math.imul(i,e)>>>0,wt=(i,e)=>dr[(i^e)&255]^i>>>8,ve=()=>typeof vt=="function"?vt(Buffer.alloc(12)):ve.node();ve.node=()=>{let i=Buffer.alloc(12),e=i.length;for(let t=0;t<e;t++)i[t]=Math.random()*256&255;return i};var Ce={genSalt:ve};function Ne(i){let e=Buffer.isBuffer(i)?i:Buffer.from(i);this.keys=new Uint32Array([305419896,591751049,878082192]);for(let t=0;t<e.length;t++)this.updateKeys(e[t])}Ne.prototype.updateKeys=function(i){let e=this.keys;return e[0]=wt(e[0],i),e[1]+=e[0]&255,e[1]=Et(e[1],134775813)+1,e[2]=wt(e[2],e[1]>>>24),i};Ne.prototype.next=function(){let i=(this.keys[2]|2)>>>0;return Et(i,i^1)>>8&255};function ur(i){let e=new Ne(i);return function(t){let r=Buffer.alloc(t.length),s=0;for(let n of t)r[s++]=e.updateKeys(n^e.next());return r}}function hr(i){let e=new Ne(i);return function(t,r,s=0){r||(r=Buffer.alloc(t.length));for(let n of t){let c=e.next();r[s++]=n^c,e.updateKeys(n)}return r}}function mr(i,e,t){if(!i||!Buffer.isBuffer(i)||i.length<12)return Buffer.alloc(0);let r=ur(t),s=r(i.slice(0,12)),n=(e.flags&8)===8?e.timeHighByte:e.crc>>>24;if(s[11]!==n)throw fr.WRONG_PASSWORD();return r(i.slice(12))}function gr(i){Buffer.isBuffer(i)&&i.length>=12?Ce.genSalt=function(){return i.slice(0,12)}:i==="node"?Ce.genSalt=ve.node:Ce.genSalt=ve}function pr(i,e,t,r=!1){i==null&&(i=Buffer.alloc(0)),Buffer.isBuffer(i)||(i=Buffer.from(i.toString()));let s=hr(t),n=Ce.genSalt();n[11]=e.crc>>>24&255,r&&(n[10]=e.crc>>>16&255);let c=Buffer.alloc(i.length+12);return s(n,c),s(i,c,12)}bt.exports={decrypt:mr,encrypt:pr,_salter:gr}});var Dt=K(Oe=>{Oe.Deflater=gt();Oe.Inflater=yt();Oe.ZipCrypto=St()});var Ge=K((Kr,It)=>{var A=ge(),yr=Ve(),$=A.Constants,ze=Dt();It.exports=function(i,e){var t=new yr.EntryHeader,r=Buffer.alloc(0),s=Buffer.alloc(0),n=!1,c=null,d=Buffer.alloc(0),v=Buffer.alloc(0),y=!0;let I=i,b=typeof I.decoder=="object"?I.decoder:A.decoder;y=b.hasOwnProperty("efs")?b.efs:!1;function N(){return!e||!(e instanceof Uint8Array)?Buffer.alloc(0):(v=t.loadLocalHeaderFromBinary(e),e.slice(t.realDataOffset,t.realDataOffset+t.compressedSize))}function a(o){if(t.flags_desc){let u={},m=t.realDataOffset+t.compressedSize;if(e.readUInt32LE(m)==$.LOCSIG||e.readUInt32LE(m)==$.CENSIG)throw A.Errors.DESCRIPTOR_NOT_EXIST();if(e.readUInt32LE(m)==$.EXTSIG)u.crc=e.readUInt32LE(m+$.EXTCRC),u.compressedSize=e.readUInt32LE(m+$.EXTSIZ),u.size=e.readUInt32LE(m+$.EXTLEN);else if(e.readUInt16LE(m+12)===19280)u.crc=e.readUInt32LE(m+$.EXTCRC-4),u.compressedSize=e.readUInt32LE(m+$.EXTSIZ-4),u.size=e.readUInt32LE(m+$.EXTLEN-4);else throw A.Errors.DESCRIPTOR_UNKNOWN();if(u.compressedSize!==t.compressedSize||u.size!==t.size||u.crc!==t.crc)throw A.Errors.DESCRIPTOR_FAULTY();if(A.crc32(o)!==u.crc)return!1}else if(A.crc32(o)!==t.localHeader.crc)return!1;return!0}function f(o,u,m){if(typeof u>"u"&&typeof o=="string"&&(m=o,o=void 0),n)return o&&u&&u(Buffer.alloc(0),A.Errors.DIRECTORY_CONTENT_ERROR()),Buffer.alloc(0);var S=N();if(S.length===0)return o&&u&&u(S),S;if(t.encrypted){if(typeof m!="string"&&!Buffer.isBuffer(m))throw A.Errors.INVALID_PASS_PARAM();S=ze.ZipCrypto.decrypt(S,t,m)}var E=Buffer.alloc(t.size);switch(t.method){case A.Constants.STORED:if(S.copy(E),a(E))return o&&u&&u(E),E;throw o&&u&&u(E,A.Errors.BAD_CRC()),A.Errors.BAD_CRC();case A.Constants.DEFLATED:var C=new ze.Inflater(S,t.size);if(o)C.inflateAsync(function(j){j.copy(j,0),u&&(a(j)?u(j):u(j,A.Errors.BAD_CRC()))});else{if(C.inflate(E).copy(E,0),!a(E))throw A.Errors.BAD_CRC(`"${b.decode(r)}"`);return E}break;default:throw o&&u&&u(Buffer.alloc(0),A.Errors.UNKNOWN_METHOD()),A.Errors.UNKNOWN_METHOD()}}function h(o,u){if((!c||!c.length)&&Buffer.isBuffer(e))return o&&u&&u(N()),N();if(c.length&&!n){var m;switch(t.method){case A.Constants.STORED:return t.compressedSize=t.size,m=Buffer.alloc(c.length),c.copy(m),o&&u&&u(m),m;default:case A.Constants.DEFLATED:var S=new ze.Deflater(c);if(o)S.deflateAsync(function(C){m=Buffer.alloc(C.length),t.compressedSize=C.length,C.copy(m),u&&u(m)});else{var E=S.deflate();return t.compressedSize=E.length,E}S=null;break}}else if(o&&u)u(Buffer.alloc(0));else return Buffer.alloc(0)}function l(o,u){return(o.readUInt32LE(u+4)<<4)+o.readUInt32LE(u)}function g(o){try{for(var u=0,m,S,E;u+4<o.length;)m=o.readUInt16LE(u),u+=2,S=o.readUInt16LE(u),u+=2,E=o.slice(u,u+S),u+=S,$.ID_ZIP64===m&&p(E)}catch{throw A.Errors.EXTRA_FIELD_PARSE_ERROR()}}function p(o){var u,m,S,E;o.length>=$.EF_ZIP64_SCOMP&&(u=l(o,$.EF_ZIP64_SUNCOMP),t.size===$.EF_ZIP64_OR_32&&(t.size=u)),o.length>=$.EF_ZIP64_RHO&&(m=l(o,$.EF_ZIP64_SCOMP),t.compressedSize===$.EF_ZIP64_OR_32&&(t.compressedSize=m)),o.length>=$.EF_ZIP64_DSN&&(S=l(o,$.EF_ZIP64_RHO),t.offset===$.EF_ZIP64_OR_32&&(t.offset=S)),o.length>=$.EF_ZIP64_DSN+4&&(E=o.readUInt32LE($.EF_ZIP64_DSN),t.diskNumStart===$.EF_ZIP64_OR_16&&(t.diskNumStart=E))}return{get entryName(){return b.decode(r)},get rawEntryName(){return r},set entryName(o){r=A.toBuffer(o,b.encode);var u=r[r.length-1];n=u===47||u===92,t.fileNameLength=r.length},get efs(){return typeof y=="function"?y(this.entryName):y},get extra(){return d},set extra(o){d=o,t.extraLength=o.length,g(o)},get comment(){return b.decode(s)},set comment(o){if(s=A.toBuffer(o,b.encode),t.commentLength=s.length,s.length>65535)throw A.Errors.COMMENT_TOO_LONG()},get name(){var o=b.decode(r);return n?o.substr(o.length-1).split("/").pop():o.split("/").pop()},get isDirectory(){return n},getCompressedData:function(){return h(!1,null)},getCompressedDataAsync:function(o){h(!0,o)},setData:function(o){c=A.toBuffer(o,A.decoder.encode),!n&&c.length?(t.size=c.length,t.method=A.Constants.DEFLATED,t.crc=A.crc32(o),t.changed=!0):t.method=A.Constants.STORED},getData:function(o){return t.changed?c:f(!1,null,o)},getDataAsync:function(o,u){t.changed?o(c):f(!0,o,u)},set attr(o){t.attr=o},get attr(){return t.attr},set header(o){t.loadFromBinary(o)},get header(){return t},packCentralHeader:function(){t.flags_efs=this.efs,t.extraLength=d.length;var o=t.centralHeaderToBinary(),u=A.Constants.CENHDR;return r.copy(o,u),u+=r.length,d.copy(o,u),u+=t.extraLength,s.copy(o,u),o},packLocalHeader:function(){let o=0;t.flags_efs=this.efs,t.extraLocalLength=v.length;let u=t.localHeaderToBinary(),m=Buffer.alloc(u.length+r.length+t.extraLocalLength);return u.copy(m,o),o+=u.length,r.copy(m,o),o+=r.length,v.copy(m,o),o+=v.length,m},toJSON:function(){let o=function(u){return"<"+(u&&u.length+" bytes buffer"||"null")+">"};return{entryName:this.entryName,name:this.name,comment:this.comment,isDirectory:this.isDirectory,header:t.toJSON(),compressedData:o(e),data:o(c)}},toString:function(){return JSON.stringify(this.toJSON(),null,"	")}}}});var Ct=K((Yr,xt)=>{var Lt=Ge(),vr=Ve(),J=ge();xt.exports=function(i,e){var t=[],r={},s=Buffer.alloc(0),n=new vr.MainHeader,c=!1,d=null;let v=new Set,y=e,{noSort:I,decoder:b}=y;i?f(y.readEntries):c=!0;function N(){let l=new Set;for(let g of Object.keys(r)){let p=g.split("/");if(p.pop(),!!p.length)for(let o=0;o<p.length;o++){let u=p.slice(0,o+1).join("/")+"/";l.add(u)}}for(let g of l)if(!(g in r)){let p=new Lt(y);p.entryName=g,p.attr=16,p.temporary=!0,t.push(p),r[p.entryName]=p,v.add(p)}}function a(){if(c=!0,r={},n.diskEntries>(i.length-n.offset)/J.Constants.CENHDR)throw J.Errors.DISK_ENTRY_TOO_LARGE();t=new Array(n.diskEntries);for(var l=n.offset,g=0;g<t.length;g++){var p=l,o=new Lt(y,i);o.header=i.slice(p,p+=J.Constants.CENHDR),o.entryName=i.slice(p,p+=o.header.fileNameLength),o.header.extraLength&&(o.extra=i.slice(p,p+=o.header.extraLength)),o.header.commentLength&&(o.comment=i.slice(p,p+o.header.commentLength)),l+=o.header.centralHeaderSize,t[g]=o,r[o.entryName]=o}v.clear(),N()}function f(l){var g=i.length-J.Constants.ENDHDR,p=Math.max(0,g-65535),o=p,u=i.length,m=-1,S=0;for((typeof y.trailingSpace=="boolean"?y.trailingSpace:!1)&&(p=0),g;g>=o;g--)if(i[g]===80){if(i.readUInt32LE(g)===J.Constants.ENDSIG){m=g,S=g,u=g+J.Constants.ENDHDR,o=g-J.Constants.END64HDR;continue}if(i.readUInt32LE(g)===J.Constants.END64SIG){o=p;continue}if(i.readUInt32LE(g)===J.Constants.ZIP64SIG){m=g,u=g+J.readBigUInt64LE(i,g+J.Constants.ZIP64SIZE)+J.Constants.ZIP64LEAD;break}}if(m==-1)throw J.Errors.INVALID_FORMAT();n.loadFromBinary(i.slice(m,u)),n.commentLength&&(s=i.slice(S+J.Constants.ENDHDR)),l&&a()}function h(){t.length>1&&!I&&t.sort((l,g)=>l.entryName.toLowerCase().localeCompare(g.entryName.toLowerCase()))}return{get entries(){return c||a(),t.filter(l=>!v.has(l))},get comment(){return b.decode(s)},set comment(l){s=J.toBuffer(l,b.encode),n.commentLength=s.length},getEntryCount:function(){return c?t.length:n.diskEntries},forEach:function(l){this.entries.forEach(l)},getEntry:function(l){return c||a(),r[l]||null},setEntry:function(l){c||a(),t.push(l),r[l.entryName]=l,n.totalEntries=t.length},deleteFile:function(l,g=!0){c||a();let p=r[l];this.getEntryChildren(p,g).map(u=>u.entryName).forEach(this.deleteEntry)},deleteEntry:function(l){c||a();let g=r[l],p=t.indexOf(g);p>=0&&(t.splice(p,1),delete r[l],n.totalEntries=t.length)},getEntryChildren:function(l,g=!0){if(c||a(),typeof l=="object")if(l.isDirectory&&g){let p=[],o=l.entryName;for(let u of t)u.entryName.startsWith(o)&&p.push(u);return p}else return[l];return[]},getChildCount:function(l){if(l&&l.isDirectory){let g=this.getEntryChildren(l);return g.includes(l)?g.length-1:g.length}return 0},compressToBuffer:function(){c||a(),h();let l=[],g=[],p=0,o=0;n.size=0,n.offset=0;let u=0;for(let E of this.entries){let C=E.getCompressedData();E.header.offset=o;let j=E.packLocalHeader(),V=j.length+C.length;o+=V,l.push(j),l.push(C);let U=E.packCentralHeader();g.push(U),n.size+=U.length,p+=V+U.length,u++}p+=n.mainHeaderSize,n.offset=o,n.totalEntries=u,o=0;let m=Buffer.alloc(p);for(let E of l)E.copy(m,o),o+=E.length;for(let E of g)E.copy(m,o),o+=E.length;let S=n.toBinary();return s&&s.copy(S,J.Constants.ENDHDR),S.copy(m,o),i=m,c=!1,m},toAsyncBuffer:function(l,g,p,o){try{c||a(),h();let u=[],m=[],S=0,E=0,C=0;n.size=0,n.offset=0;let j=function(V){if(V.length>0){let U=V.shift(),x=U.entryName+U.extra.toString();p&&p(x),U.getCompressedDataAsync(function(O){o&&o(x),U.header.offset=E;let F=U.packLocalHeader(),q=F.length+O.length;E+=q,u.push(F),u.push(O);let ee=U.packCentralHeader();m.push(ee),n.size+=ee.length,S+=q+ee.length,C++,j(V)})}else{S+=n.mainHeaderSize,n.offset=E,n.totalEntries=C,E=0;let U=Buffer.alloc(S);u.forEach(function(O){O.copy(U,E),E+=O.length}),m.forEach(function(O){O.copy(U,E),E+=O.length});let x=n.toBinary();s&&s.copy(x,J.Constants.ENDHDR),x.copy(U,E),i=U,c=!1,l(U)}};j(Array.from(this.entries))}catch(u){g(u)}}}}});var we=K((Qr,Ot)=>{var H=ge(),B=require("path"),wr=Ge(),Er=Ct(),le=(...i)=>H.findLast(i,e=>typeof e=="boolean"),Nt=(...i)=>H.findLast(i,e=>typeof e=="string"),br=(...i)=>H.findLast(i,e=>typeof e=="function"),Sr={noSort:!1,readEntries:!1,method:H.Constants.NONE,fs:null};Ot.exports=function(i,e){let t=null,r=Object.assign(Object.create(null),Sr);i&&typeof i=="object"&&(i instanceof Uint8Array||(Object.assign(r,i),i=r.input?r.input:void 0,r.input&&delete r.input),Buffer.isBuffer(i)&&(t=i,r.method=H.Constants.BUFFER,i=void 0)),Object.assign(r,e);let s=new H(r);if((typeof r.decoder!="object"||typeof r.decoder.encode!="function"||typeof r.decoder.decode!="function")&&(r.decoder=H.decoder),i&&typeof i=="string")if(s.fs.existsSync(i))r.method=H.Constants.FILE,r.filename=i,t=s.fs.readFileSync(i);else throw H.Errors.INVALID_FILENAME();let n=new Er(t,r),{canonical:c,sanitize:d,zipnamefix:v}=H;function y(a){if(a&&n){var f;if(typeof a=="string"&&(f=n.getEntry(B.posix.normalize(a))),typeof a=="object"&&typeof a.entryName<"u"&&typeof a.header<"u"&&(f=n.getEntry(a.entryName)),f)return f}return null}function I(a){let{join:f,normalize:h,sep:l}=B.posix;return f(".",h(l+a.split("\\").join(l)+l))}function b(a){return a instanceof RegExp?(function(f){return function(h){return f.test(h)}})(a):typeof a!="function"?()=>!0:a}let N=(a,f)=>{let h=f.slice(-1);return h=h===s.sep?s.sep:"",B.relative(a,f)+h};return{readFile:function(a,f){var h=y(a);return h&&h.getData(f)||null},childCount:function(a){let f=y(a);if(f)return n.getChildCount(f)},readFileAsync:function(a,f){var h=y(a);h?h.getDataAsync(f):f(null,"getEntry failed for:"+a)},readAsText:function(a,f){var h=y(a);if(h){var l=h.getData();if(l&&l.length)return l.toString(f||"utf8")}return""},readAsTextAsync:function(a,f,h){var l=y(a);l?l.getDataAsync(function(g,p){if(p){f(g,p);return}g&&g.length?f(g.toString(h||"utf8")):f("")}):f("")},deleteFile:function(a,f=!0){var h=y(a);h&&n.deleteFile(h.entryName,f)},deleteEntry:function(a){var f=y(a);f&&n.deleteEntry(f.entryName)},addZipComment:function(a){n.comment=a},getZipComment:function(){return n.comment||""},addZipEntryComment:function(a,f){var h=y(a);h&&(h.comment=f)},getZipEntryComment:function(a){var f=y(a);return f&&f.comment||""},updateFile:function(a,f){var h=y(a);h&&h.setData(f)},addLocalFile:function(a,f,h,l){if(s.fs.existsSync(a)){f=f?I(f):"";let g=B.win32.basename(B.win32.normalize(a));f+=h||g;let p=s.fs.statSync(a),o=p.isFile()?s.fs.readFileSync(a):Buffer.alloc(0);p.isDirectory()&&(f+=s.sep),this.addFile(f,o,l,p)}else throw H.Errors.FILE_NOT_FOUND(a)},addLocalFileAsync:function(a,f){a=typeof a=="object"?a:{localPath:a};let h=B.resolve(a.localPath),{comment:l}=a,{zipPath:g,zipName:p}=a,o=this;s.fs.stat(h,function(u,m){if(u)return f(u,!1);g=g?I(g):"";let S=B.win32.basename(B.win32.normalize(h));if(g+=p||S,m.isFile())s.fs.readFile(h,function(E,C){return E?f(E,!1):(o.addFile(g,C,l,m),setImmediate(f,void 0,!0))});else if(m.isDirectory())return g+=s.sep,o.addFile(g,Buffer.alloc(0),l,m),setImmediate(f,void 0,!0)})},addLocalFolder:function(a,f,h){if(h=b(h),f=f?I(f):"",a=B.normalize(a),s.fs.existsSync(a)){let l=s.findFiles(a),g=this;if(l.length)for(let p of l){let o=B.join(f,N(a,p));h(o)&&g.addLocalFile(p,B.dirname(o))}}else throw H.Errors.FILE_NOT_FOUND(a)},addLocalFolderAsync:function(a,f,h,l){l=b(l),h=h?I(h):"",a=B.normalize(a);var g=this;s.fs.open(a,"r",function(p){if(p&&p.code==="ENOENT")f(void 0,H.Errors.FILE_NOT_FOUND(a));else if(p)f(void 0,p);else{var o=s.findFiles(a),u=-1,m=function(){if(u+=1,u<o.length){var S=o[u],E=N(a,S).split("\\").join("/");E=E.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\x20-\x7E]/g,""),l(E)?s.fs.stat(S,function(C,j){C&&f(void 0,C),j.isFile()?s.fs.readFile(S,function(V,U){V?f(void 0,V):(g.addFile(h+E,U,"",j),m())}):(g.addFile(h+E+"/",Buffer.alloc(0),"",j),m())}):process.nextTick(()=>{m()})}else f(!0,void 0)};m()}})},addLocalFolderAsync2:function(a,f){let h=this;a=typeof a=="object"?a:{localPath:a},localPath=B.resolve(I(a.localPath));let{zipPath:l,filter:g,namefix:p}=a;g instanceof RegExp?g=(function(m){return function(S){return m.test(S)}})(g):typeof g!="function"&&(g=function(){return!0}),l=l?I(l):"",p=="latin1"&&(p=m=>m.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\x20-\x7E]/g,"")),typeof p!="function"&&(p=m=>m);let o=m=>B.join(l,p(N(localPath,m))),u=m=>B.win32.basename(B.win32.normalize(p(m)));s.fs.open(localPath,"r",function(m){m&&m.code==="ENOENT"?f(void 0,H.Errors.FILE_NOT_FOUND(localPath)):m?f(void 0,m):s.findFilesAsync(localPath,function(S,E){if(S)return f(S);E=E.filter(C=>g(o(C))),E.length||f(void 0,!1),setImmediate(E.reverse().reduce(function(C,j){return function(V,U){if(V||U===!1)return setImmediate(C,V,!1);h.addLocalFileAsync({localPath:j,zipPath:B.dirname(o(j)),zipName:u(j)},C)}},f))})})},addLocalFolderPromise:function(a,f){return new Promise((h,l)=>{this.addLocalFolderAsync2(Object.assign({localPath:a},f),(g,p)=>{g&&l(g),p&&h(this)})})},addFile:function(a,f,h,l){a=v(a);let g=y(a),p=g!=null;p||(g=new wr(r),g.entryName=a),g.comment=h||"";let o=typeof l=="object"&&l instanceof s.fs.Stats;o&&(g.header.time=l.mtime);var u=g.isDirectory?16:0;let m=g.isDirectory?16384:32768;return o?m|=4095&l.mode:typeof l=="number"?m|=4095&l:m|=g.isDirectory?493:420,u=(u|m<<16)>>>0,g.attr=u,g.setData(f),p||n.setEntry(g),g},getEntries:function(a){return n.password=a,n?n.entries:[]},getEntry:function(a){return y(a)},getEntryCount:function(){return n.getEntryCount()},forEach:function(a){return n.forEach(a)},extractEntryTo:function(a,f,h,l,g,p){l=le(!1,l),g=le(!1,g),h=le(!0,h),p=Nt(g,p);var o=y(a);if(!o)throw H.Errors.NO_ENTRY();var u=c(o.entryName),m=d(f,p&&!o.isDirectory?p:h?u:B.basename(u));if(o.isDirectory){var S=n.getEntryChildren(o);return S.forEach(function(j){if(j.isDirectory)return;var V=j.getData();if(!V)throw H.Errors.CANT_EXTRACT_FILE();var U=c(j.entryName),x=d(f,h?U:B.basename(U));let O=g?j.header.fileAttr:void 0;s.writeFileTo(x,V,l,O)}),!0}var E=o.getData(n.password);if(!E)throw H.Errors.CANT_EXTRACT_FILE();if(s.fs.existsSync(m)&&!l)throw H.Errors.CANT_OVERRIDE();let C=g?a.header.fileAttr:void 0;return s.writeFileTo(m,E,l,C),!0},test:function(a){if(!n)return!1;for(var f in n.entries)try{if(f.isDirectory)continue;var h=n.entries[f].getData(a);if(!h)return!1}catch{return!1}return!0},extractAllTo:function(a,f,h,l){if(h=le(!1,h),l=Nt(h,l),f=le(!1,f),!n)throw H.Errors.NO_ZIP();n.entries.forEach(function(g){var p=d(a,c(g.entryName));if(g.isDirectory){s.makeDir(p);return}var o=g.getData(l);if(!o)throw H.Errors.CANT_EXTRACT_FILE();let u=h?g.header.fileAttr:void 0;s.writeFileTo(p,o,f,u);try{s.fs.utimesSync(p,g.header.time,g.header.time)}catch{throw H.Errors.CANT_EXTRACT_FILE()}})},extractAllToAsync:function(a,f,h,l){if(l=br(f,h,l),h=le(!1,h),f=le(!1,f),!l)return new Promise((m,S)=>{this.extractAllToAsync(a,f,h,function(E){E?S(E):m(this)})});if(!n){l(H.Errors.NO_ZIP());return}a=B.resolve(a);let g=m=>d(a,B.normalize(c(m.entryName))),p=(m,S)=>new Error(m+': "'+S+'"'),o=[],u=[];n.entries.forEach(m=>{m.isDirectory?o.push(m):u.push(m)});for(let m of o){let S=g(m),E=h?m.header.fileAttr:void 0;try{s.makeDir(S),E&&s.fs.chmodSync(S,E),s.fs.utimesSync(S,m.header.time,m.header.time)}catch{l(p("Unable to create folder",S))}}u.reverse().reduce(function(m,S){return function(E){if(E)m(E);else{let C=B.normalize(c(S.entryName)),j=d(a,C);S.getDataAsync(function(V,U){if(U)m(U);else if(!V)m(H.Errors.CANT_EXTRACT_FILE());else{let x=h?S.header.fileAttr:void 0;s.writeFileToAsync(j,V,f,x,function(O){O||m(p("Unable to write file",j)),s.fs.utimes(j,S.header.time,S.header.time,function(F){F?m(p("Unable to set times",j)):m()})})}})}}},l)()},writeZip:function(a,f){if(arguments.length===1&&typeof a=="function"&&(f=a,a=""),!a&&r.filename&&(a=r.filename),!!a){var h=n.compressToBuffer();if(h){var l=s.writeFileTo(a,h,!0);typeof f=="function"&&f(l?null:new Error("failed"),"")}}},writeZipPromise:function(a,f){let{overwrite:h,perm:l}=Object.assign({overwrite:!0},f);return new Promise((g,p)=>{!a&&r.filename&&(a=r.filename),a||p("ADM-ZIP: ZIP File Name Missing"),this.toBufferPromise().then(o=>{let u=m=>m?g(m):p("ADM-ZIP: Wasn't able to write zip file");s.writeFileToAsync(a,o,h,l,u)},p)})},toBufferPromise:function(){return new Promise((a,f)=>{n.toAsyncBuffer(a,f)})},toBuffer:function(a,f,h,l){return typeof a=="function"?(n.toAsyncBuffer(a,f,h,l),null):n.compressToBuffer()}}}});var Pr={};rr(Pr,{getOverlayHandler:()=>Ue});module.exports=nr(Pr);var X=require("electron"),Je=G(require("node:path"),1);var Ke=require("electron"),ye=G(require("path"),1),ce=G(require("fs"),1),ke=class{logsDir;launcherLogPath;gameLogPath;initialized=!1;MAX_LOG_DAYS=7;constructor(){this.logsDir="",this.launcherLogPath="",this.gameLogPath=""}init(){if(this.initialized)return;this.logsDir=ye.default.join(Ke.app.getPath("userData"),"logs"),ce.default.mkdirSync(this.logsDir,{recursive:!0});let e=this.getDateString();this.launcherLogPath=ye.default.join(this.logsDir,`launcher-${e}.log`),this.gameLogPath=ye.default.join(this.logsDir,`game-${e}.log`),this.rotateOldLogs(),this.interceptConsole(),this.initialized=!0,this.info("Logger","=== BlockyCRAFT Launcher Log Started ==="),this.info("Logger",`Log file: ${this.launcherLogPath}`)}getDateString(){return new Date().toISOString().split("T")[0]}getTimestamp(){return new Date().toISOString()}formatMessage(e,t,r){return`[${this.getTimestamp()}] [${e}] [${t}] ${r}`}writeToLauncherLog(e){if(this.initialized)try{ce.default.appendFileSync(this.launcherLogPath,e+`
`)}catch(t){process.stdout.write(`[LOG WRITE ERROR] ${t}
`)}}writeToGameLog(e){if(this.initialized)try{ce.default.appendFileSync(this.gameLogPath,`[${this.getTimestamp()}] ${e}
`)}catch(t){process.stdout.write(`[GAME LOG WRITE ERROR] ${t}
`)}}rotateOldLogs(){try{let e=ce.default.readdirSync(this.logsDir),t=Date.now(),r=this.MAX_LOG_DAYS*24*60*60*1e3;for(let s of e){if(!s.endsWith(".log"))continue;let n=ye.default.join(this.logsDir,s),c=ce.default.statSync(n);t-c.mtimeMs>r&&(ce.default.unlinkSync(n),process.stdout.write(`[Logger] Deleted old log: ${s}
`))}}catch(e){process.stdout.write(`[Logger] Error rotating logs: ${e}
`)}}interceptConsole(){let e=console.log,t=console.error,r=console.warn,s=this;console.log=function(...n){let c=n.map(d=>typeof d=="object"?JSON.stringify(d):String(d)).join(" ");s.writeToLauncherLog(s.formatMessage("INFO","Console",c)),e.apply(console,n)},console.error=function(...n){let c=n.map(d=>typeof d=="object"?JSON.stringify(d):String(d)).join(" ");s.writeToLauncherLog(s.formatMessage("ERROR","Console",c)),t.apply(console,n)},console.warn=function(...n){let c=n.map(d=>typeof d=="object"?JSON.stringify(d):String(d)).join(" ");s.writeToLauncherLog(s.formatMessage("WARN","Console",c)),r.apply(console,n)}}info(e,t){let r=this.formatMessage("INFO",e,t);this.writeToLauncherLog(r),process.stdout.write(r+`
`)}error(e,t){let r=this.formatMessage("ERROR",e,t);this.writeToLauncherLog(r),process.stderr.write(r+`
`)}warn(e,t){let r=this.formatMessage("WARN",e,t);this.writeToLauncherLog(r),process.stdout.write(r+`
`)}debug(e,t){let r=this.formatMessage("DEBUG",e,t);this.writeToLauncherLog(r)}game(e,t){let r=e==="stderr"?"[ERR]":"[OUT]";this.writeToGameLog(`${r} ${t}`)}getLogsDir(){return this.logsDir}},D=new ke;var Y=require("electron"),P=G(require("path"),1),L=G(require("fs"),1),Ae=require("child_process"),kt=require("util"),Pe=G(we(),1),$t=require("fs");var _t=require("electron"),oe=G(require("path"),1),ne=G(require("fs"),1),jt=require("fs"),Pt=require("child_process"),Ft=require("util"),Ut=G(we(),1),We=(0,Ft.promisify)(Pt.exec),Dr="https://api.adoptium.net/v3/binary/latest",Ir="17",Lr="hotspot",xr="eclipse",_e=class{javaDir;markerFile;constructor(){this.javaDir=oe.default.join(_t.app.getPath("userData"),"java"),this.markerFile=oe.default.join(this.javaDir,".java17_installed")}async ensureJava(e){let t=this.getLocalJavaPath();if(t&&ne.default.existsSync(t))return console.log("[JavaManager] Using locally installed Java:",t),t;let r=await this.detectSystemJava();return r?(console.log("[JavaManager] Using system Java:",r),r):(console.log("[JavaManager] No Java found, downloading..."),this.downloadAndInstallJava(e))}async detectSystemJava(){let e=this.getCommonJavaPaths();for(let t of e)if(await this.isValidJava17(t))return t;return null}getCommonJavaPaths(){let e=["java"],t=process.platform;if(t==="win32"){let r=process.env.ProgramFiles||"C:\\Program Files",s=process.env["ProgramFiles(x86)"]||"C:\\Program Files (x86)";e.push(oe.default.join(r,"Eclipse Adoptium","jdk-17*","bin","java.exe"),oe.default.join(r,"Java","jdk-17*","bin","java.exe"),oe.default.join(r,"Java","jre-17*","bin","java.exe"),oe.default.join(r,"Temurin","jdk-17*","bin","java.exe"),oe.default.join(s,"Java","jdk-17*","bin","java.exe"))}else t==="darwin"?e.push("/Library/Java/JavaVirtualMachines/temurin-17.jdk/Contents/Home/bin/java","/Library/Java/JavaVirtualMachines/adoptopenjdk-17.jdk/Contents/Home/bin/java","/usr/local/opt/openjdk@17/bin/java","/opt/homebrew/opt/openjdk@17/bin/java"):e.push("/usr/lib/jvm/temurin-17-jdk/bin/java","/usr/lib/jvm/java-17-openjdk/bin/java","/usr/lib/jvm/java-17-openjdk-amd64/bin/java","/usr/lib/jvm/java-17-temurin/bin/java","/opt/java/openjdk/bin/java");return e}async isValidJava17(e){try{let{stdout:t,stderr:r}=await We(`"${e}" -version`),n=(t+r).match(/version "(\d+)/);return n?parseInt(n[1],10)>=17:!1}catch{return!1}}getPlatformInfo(){let e=process.platform,t=process.arch,r,s,n;switch(e){case"win32":r="windows",s="zip",n="bin/java.exe";break;case"darwin":r="mac",s="tar.gz",n="Contents/Home/bin/java";break;default:r="linux",s="tar.gz",n="bin/java"}let c;switch(t){case"arm64":c="aarch64";break;case"x64":default:c="x64"}return{os:r,arch:c,extension:s,executablePath:n}}getDownloadUrl(){let e=this.getPlatformInfo(),t=`${Dr}/${Ir}/ga/${e.os}/${e.arch}/jre/${Lr}/normal/${xr}`,r=`temurin-17-jre.${e.extension}`;return{url:t,filename:r}}getLocalJavaPath(){if(!ne.default.existsSync(this.markerFile))return null;let e=this.getPlatformInfo();if(!ne.default.existsSync(this.javaDir))return null;let r=ne.default.readdirSync(this.javaDir).find(n=>n.startsWith("jdk-17")&&ne.default.statSync(oe.default.join(this.javaDir,n)).isDirectory());if(!r)return null;let s=oe.default.join(this.javaDir,r,e.executablePath);return ne.default.existsSync(s)?s:null}async downloadAndInstallJava(e){let{url:t,filename:r}=this.getDownloadUrl(),s=this.getPlatformInfo();ne.default.mkdirSync(this.javaDir,{recursive:!0});let n=oe.default.join(this.javaDir,r);this.sendProgress(e,"Baixando Java 17...",0),console.log("[JavaManager] Downloading from:",t);try{let d=await fetch(t,{redirect:"follow"});if(!d.ok)throw new Error(`Failed to download Java: ${d.status} ${d.statusText}`);let v=Number(d.headers.get("content-length"))||0,y=(0,jt.createWriteStream)(n);if(!d.body)throw new Error("No response body");let I=d.body.getReader(),b=0;for(;;){let{done:N,value:a}=await I.read();if(N)break;if(y.write(Buffer.from(a)),b+=a.length,v>0){let f=Math.round(b/v*50);this.sendProgress(e,`Baixando Java 17... (${this.formatSize(b)}/${this.formatSize(v)})`,f)}}y.end(),await new Promise((N,a)=>{y.on("finish",N),y.on("error",a)}),console.log("[JavaManager] Download complete:",n)}catch(d){throw ne.default.existsSync(n)&&ne.default.unlinkSync(n),new Error(`Failed to download Java: ${d.message}`)}this.sendProgress(e,"Extraindo Java 17...",55),console.log("[JavaManager] Extracting...");try{s.extension==="zip"?new Ut.default(n).extractAllTo(this.javaDir,!0):await We(`tar -xzf "${n}" -C "${this.javaDir}"`),ne.default.writeFileSync(this.markerFile,new Date().toISOString()),ne.default.unlinkSync(n)}catch(d){throw new Error(`Failed to extract Java: ${d.message}`)}let c=this.getLocalJavaPath();if(!c)throw new Error("Java extraction failed: executable not found");return process.platform!=="win32"&&await We(`chmod +x "${c}"`),this.sendProgress(e,"Java 17 instalado!",60),console.log("[JavaManager] Java installed at:",c),c}sendProgress(e,t,r){e&&e.send("launch-progress",{status:t,progress:r})}formatSize(e){return e<1024?e+" B":e<1024*1024?(e/1024).toFixed(1)+" KB":(e/(1024*1024)).toFixed(1)+" MB"}};var At=require("electron"),R=G(require("path"),1),_=G(require("fs"),1),Rt=require("fs"),Tt=G(we(),1),Cr=["https://craft.blocky.com.br/launcher-assets/version.json"],je=class{dataPath;localVersionsPath;instanceDir;librariesDir;constructor(){this.dataPath=At.app.getPath("userData"),this.localVersionsPath=R.default.join(this.dataPath,"versions.json"),this.instanceDir=R.default.join(this.dataPath,"instances","default"),this.librariesDir=R.default.join(this.instanceDir,"libraries")}normalizeUrls(e){return Array.isArray(e)?e:[e]}getLocalVersions(){try{if(_.default.existsSync(this.localVersionsPath)){let e=_.default.readFileSync(this.localVersionsPath,"utf-8");return JSON.parse(e)}}catch(e){console.error("[UpdateManager] Failed to read local versions:",e)}return{instance:"0.0.0",libraries:"0.0.0",mods:"0.0.0",texturepacks:"0.0.0"}}saveLocalVersions(e){try{_.default.writeFileSync(this.localVersionsPath,JSON.stringify(e,null,2)),console.log("[UpdateManager] Saved local versions:",e)}catch(t){console.error("[UpdateManager] Failed to save local versions:",t)}}async fetchRemoteVersions(){for(let e of Cr)try{console.log("[UpdateManager] Trying to fetch versions from:",e);let t=await fetch(e,{signal:AbortSignal.timeout(1e4)});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);let r=await t.json();return console.log("[UpdateManager] Successfully fetched from:",e),console.log("[UpdateManager] Remote versions:",r),r}catch(t){console.warn(`[UpdateManager] Failed to fetch from ${e}:`,t)}return console.error("[UpdateManager] All version URLs failed"),null}async checkForUpdates(){let e=this.getLocalVersions(),t=await this.fetchRemoteVersions();if(!t)return{instanceUpdate:!1,librariesUpdate:!1,modsUpdate:!1,texturepacksUpdate:!1,remoteVersions:null,error:"Failed to fetch remote version info"};let r=t.instance.version!==e.instance,s=!1,n=t.mods?t.mods.version!==e.mods:!1,c=t.texturepacks?t.texturepacks.version!==e.texturepacks:!1;return console.log("[UpdateManager] Update check result:",{instanceUpdate:r,librariesUpdate:"DISABLED (Maven-based)",modsUpdate:n,texturepacksUpdate:c,local:e,remote:{instance:t.instance.version,libraries:t.libraries?.version??"N/A (Maven-based)",mods:t.mods?.version,texturepacks:t.texturepacks?.version}}),{instanceUpdate:r,librariesUpdate:s,modsUpdate:n,texturepacksUpdate:c,remoteVersions:t}}async downloadFile(e,t,r){let s=R.default.basename(t);r?.(`Baixando ${s}...`,0);let n=this.normalizeUrls(e),c=null;for(let d=0;d<n.length;d++){let v=n[d];try{console.log(`[UpdateManager] Downloading from URL ${d+1}/${n.length}: ${v}`);let y=await fetch(v,{signal:AbortSignal.timeout(6e4)});if(!y.ok)throw new Error(`HTTP ${y.status}: ${y.statusText}`);let I=Number(y.headers.get("content-length"))||0;_.default.mkdirSync(R.default.dirname(t),{recursive:!0});let b=(0,Rt.createWriteStream)(t);if(!y.body)throw new Error("No response body");let N=y.body.getReader(),a=0;for(;;){let{done:f,value:h}=await N.read();if(f)break;if(b.write(Buffer.from(h)),a+=h.length,I>0){let l=Math.round(a/I*100);r?.(`Baixando ${s}...`,l)}}b.end(),await new Promise((f,h)=>{b.on("finish",f),b.on("error",h)}),console.log(`[UpdateManager] Downloaded ${s} (${this.formatSize(a)}) from ${v}`);return}catch(y){console.warn(`[UpdateManager] Failed to download from ${v}:`,y.message),c=y}}throw c||new Error(`Failed to download ${s} from all ${n.length} sources`)}extractZip(e,t){if(console.log(`[UpdateManager] Extracting ${e} to ${t}`),!_.default.existsSync(e))throw new Error(`ZIP file not found: ${e}`);let r=_.default.readFileSync(e);if(r.length<4||r[0]!==80||r[1]!==75)throw console.error(`[UpdateManager] Invalid ZIP file. First bytes: ${r.slice(0,20).toString("hex")}`),new Error(`Invalid ZIP file: ${e}. The download may have failed or returned an error page.`);_.default.mkdirSync(t,{recursive:!0}),new Tt.default(e).extractAllTo(t,!0),console.log("[UpdateManager] Extraction complete")}backupUserData(){let e=R.default.join(this.dataPath,"update_backup"),t=R.default.join(this.instanceDir,".minecraft");_.default.existsSync(e)&&_.default.rmSync(e,{recursive:!0,force:!0}),_.default.mkdirSync(e,{recursive:!0});let r=["options.txt","servers.dat","screenshots","stats","lastlogin","config"];console.log("[UpdateManager] Backing up user data...");for(let s of r){let n=R.default.join(t,s),c=R.default.join(e,s);if(_.default.existsSync(n))try{console.log(`[UpdateManager] Backing up: ${s}`),_.default.cpSync(n,c,{recursive:!0})}catch(d){console.warn(`[UpdateManager] Failed to backup ${s}:`,d)}}}restoreUserData(){let e=R.default.join(this.dataPath,"update_backup"),t=R.default.join(this.instanceDir,".minecraft");if(!_.default.existsSync(e))return;console.log("[UpdateManager] Restoring user data...");let r=_.default.readdirSync(e);for(let s of r){let n=R.default.join(e,s),c=R.default.join(t,s);try{console.log(`[UpdateManager] Restoring: ${s}`),_.default.existsSync(c)&&_.default.rmSync(c,{recursive:!0,force:!0}),_.default.cpSync(n,c,{recursive:!0})}catch(d){console.warn(`[UpdateManager] Failed to restore ${s}:`,d)}}try{_.default.rmSync(e,{recursive:!0,force:!0})}catch(s){console.warn("[UpdateManager] Failed to cleanup backup:",s)}}async updateInstance(e,t){let r=R.default.join(this.dataPath,"temp_instance.zip");try{await this.downloadFile(e.instance.url,r,t),t?.("Preparando atualiza\xE7\xE3o da inst\xE2ncia...",0),this.backupUserData(),_.default.existsSync(this.instanceDir),t?.("Extraindo inst\xE2ncia...",50),this.extractZip(r,this.instanceDir),this.restoreUserData();let s=this.getLocalVersions();s.instance=e.instance.version,this.saveLocalVersions(s),t?.("Inst\xE2ncia atualizada!",100)}finally{_.default.existsSync(r)&&_.default.unlinkSync(r)}}async updateLibraries(e,t){if(!e.libraries){console.log("[UpdateManager] Libraries update skipped - using Maven repos");return}let r=R.default.join(this.dataPath,"temp_libraries.zip");try{await this.downloadFile(e.libraries.url,r,t),t?.("Preparando atualiza\xE7\xE3o das bibliotecas...",0);let s=R.default.join(this.librariesDir,".bundled_extracted_v1");_.default.existsSync(s)&&_.default.unlinkSync(s),_.default.existsSync(this.librariesDir)&&_.default.rmSync(this.librariesDir,{recursive:!0,force:!0}),t?.("Extraindo bibliotecas...",50),this.extractZip(r,this.librariesDir),_.default.writeFileSync(R.default.join(this.librariesDir,".bundled_extracted_v2"),"extracted");let n=this.getLocalVersions();n.libraries=e.libraries.version,this.saveLocalVersions(n),t?.("Bibliotecas atualizadas!",100)}finally{_.default.existsSync(r)&&_.default.unlinkSync(r)}}async updateMods(e,t){if(!e.mods){console.log("[UpdateManager] No mods update available");return}let r=R.default.join(this.dataPath,"temp_mods.zip"),s=R.default.join(this.instanceDir,".minecraft","mods");try{await this.downloadFile(e.mods.url,r,t),t?.("Removendo mods antigos...",0),_.default.existsSync(s)&&_.default.rmSync(s,{recursive:!0,force:!0}),t?.("Instalando novos mods...",50),this.extractZip(r,R.default.join(this.instanceDir,".minecraft"));let n=this.getLocalVersions();n.mods=e.mods.version,this.saveLocalVersions(n),t?.("Mods atualizados!",100)}finally{_.default.existsSync(r)&&_.default.unlinkSync(r)}}async updateTexturepacks(e,t){if(!e.texturepacks){console.log("[UpdateManager] No texture pack update available");return}let r=R.default.join(this.instanceDir,".minecraft","texturepacks"),s=R.default.join(r,"betaoverhauled.zip");try{_.default.mkdirSync(r,{recursive:!0}),t?.("Baixando textura...",0);let n=R.default.join(this.dataPath,"temp_texturepack.zip");await this.downloadFile(e.texturepacks.url,n,t),_.default.existsSync(s)&&_.default.unlinkSync(s),_.default.renameSync(n,s);let c=this.getLocalVersions();c.texturepacks=e.texturepacks.version,this.saveLocalVersions(c),t?.("Textura atualizada!",100),console.log("[UpdateManager] Texture pack updated: betaoverhauled.zip")}catch(n){console.error("[UpdateManager] Failed to update texture pack:",n);let c=R.default.join(this.dataPath,"temp_texturepack.zip");throw _.default.existsSync(c)&&_.default.unlinkSync(c),n}}async performAllUpdates(e){try{e?.("Verificando atualiza\xE7\xF5es...",0);let t=await this.checkForUpdates();if(!t.remoteVersions)return console.log("[UpdateManager] Could not fetch remote versions, skipping updates"),{success:!0};let r=[t.instanceUpdate,t.librariesUpdate,t.modsUpdate,t.texturepacksUpdate].filter(Boolean).length;if(r===0)return console.log("[UpdateManager] All components are up to date"),e?.("Tudo atualizado!",100),{success:!0};let s=0;if(t.instanceUpdate){s++;let n=(s-1)/r*100,c=100/r;await this.updateInstance(t.remoteVersions,(d,v)=>{let y=n+v/100*c;e?.(d,Math.round(y))})}if(t.librariesUpdate){s++;let n=(s-1)/r*100,c=100/r;await this.updateLibraries(t.remoteVersions,(d,v)=>{let y=n+v/100*c;e?.(d,Math.round(y))})}if(t.modsUpdate){s++;let n=(s-1)/r*100,c=100/r;await this.updateMods(t.remoteVersions,(d,v)=>{let y=n+v/100*c;e?.(d,Math.round(y))})}if(t.texturepacksUpdate){s++;let n=(s-1)/r*100,c=100/r;await this.updateTexturepacks(t.remoteVersions,(d,v)=>{let y=n+v/100*c;e?.(d,Math.round(y))})}return e?.("Todas as atualiza\xE7\xF5es conclu\xEDdas!",100),{success:!0}}catch(t){return console.error("[UpdateManager] Update failed:",t),{success:!1,error:t.message}}}formatSize(e){return e<1024?e+" B":e<1024*1024?(e/1024).toFixed(1)+" KB":(e/(1024*1024)).toFixed(1)+" MB"}};var Ee=(0,kt.promisify)(Ae.exec);function be(i){if(!L.default.existsSync(i))return!1;let e=L.default.readFileSync(i);return e.length>=4&&e[0]===80&&e[1]===75}function Bt(i,e){if(!be(i)){let r=L.default.existsSync(i)?L.default.readFileSync(i):Buffer.alloc(0);throw console.error(`[GameHandler] Invalid ZIP file: ${i}. First bytes: ${r.slice(0,20).toString("hex")}`),new Error("Invalid ZIP file. The download may have failed.")}L.default.mkdirSync(e,{recursive:!0}),new Pe.default(i).extractAllTo(e,!0)}function Nr(i){return new Promise(e=>setTimeout(e,i))}async function Mt(i,e,t=3){let r=[500,1e3,2e3],s=null;for(let n=0;n<=t;n++)try{Bt(i,e);return}catch(c){if(s=c,n<t){let d=r[n]||2e3;console.warn(`[GameHandler] Extraction failed (attempt ${n+1}/${t+1}), retrying in ${d}ms...`),await Nr(d)}}throw s||new Error(`Failed to extract ${i} after ${t+1} attempts`)}var Or="https://piston-meta.mojang.com/mc/game/version_manifest_v2.json",Ht="b1.7.3",Fe=class{gamePath;javaPath;javaManager;updateManager;gameProcess=null;lastUpdateCheck=null;UPDATE_CACHE_TTL=6e4;MANIFEST_CACHE_TTL=1440*60*1e3;lastInstanceVersion=null;constructor(){this.gamePath=P.default.join(Y.app.getPath("userData"),"gamedata"),this.javaPath="java",this.javaManager=new _e,this.updateManager=new je,this.loadLastInstanceVersion()}loadLastInstanceVersion(){try{let e=P.default.join(Y.app.getPath("userData"),"versions.json");if(L.default.existsSync(e)){let t=JSON.parse(L.default.readFileSync(e,"utf-8"));this.lastInstanceVersion=t.instance||null}}catch{}}init(){Y.ipcMain.handle("launch-game",async(e,t)=>this.handleLaunch(e,t)),Y.ipcMain.handle("kill-game",async()=>this.gameProcess?(console.log("Killing game process..."),this.gameProcess.kill(),this.gameProcess=null,{success:!0}):{success:!1,error:"No game running"}),Y.ipcMain.handle("check-custom-instance",async()=>{let e=P.default.resolve("instance.zip"),t=P.default.join(Y.app.getPath("userData"),"instances","default","instance.cfg");return L.default.existsSync(e)||L.default.existsSync(t)}),Y.ipcMain.handle("check-update-status",async()=>this.handleUpdateCheck()),Y.ipcMain.handle("perform-update",async e=>this.handlePerformUpdate(e))}sendProgress(e,t,r){e.send("launch-progress",{status:t,progress:r})}async getCachedVersionDetails(){let e=P.default.join(Y.app.getPath("userData"),"mojang_version_cache.json");if(L.default.existsSync(e))try{let d=JSON.parse(L.default.readFileSync(e,"utf-8"));if(Date.now()-d.timestamp<this.MANIFEST_CACHE_TTL)return console.log("[GameHandler] Using cached Mojang version details (TTL: 24h)"),d.data}catch(d){console.warn("[GameHandler] Failed to read version cache:",d)}console.log("[GameHandler] Fetching fresh Mojang version manifest...");let s=(await(await fetch(Or)).json()).versions.find(d=>d.id===Ht);if(!s)throw new Error(`Version ${Ht} not found`);let c=await(await fetch(s.url)).json();try{L.default.writeFileSync(e,JSON.stringify({timestamp:Date.now(),data:c})),console.log("[GameHandler] Saved version details to cache")}catch(d){console.warn("[GameHandler] Failed to save version cache:",d)}return c}async checkJava(e){try{return await Ee(`"${e}" -version`),!0}catch{return!1}}async applyBorderlessPostSpawn(){let{width:e,height:t}=Y.screen.getPrimaryDisplay().size;await new Promise(r=>setTimeout(r,4e3));try{if(process.platform==="win32"){let r=`
Add-Type @"
using System;
using System.Runtime.InteropServices;
public class Win32 {
    [DllImport("user32.dll")] public static extern IntPtr FindWindow(string lpClassName, string lpWindowName);
    [DllImport("user32.dll")] public static extern int SetWindowLong(IntPtr hWnd, int nIndex, int dwNewLong);
    [DllImport("user32.dll")] public static extern int GetWindowLong(IntPtr hWnd, int nIndex);
    [DllImport("user32.dll")] public static extern bool SetWindowPos(IntPtr hWnd, IntPtr hWndInsertAfter, int X, int Y, int cx, int cy, uint uFlags);
    [DllImport("user32.dll")] public static extern bool SetForegroundWindow(IntPtr hWnd);
}
"@
$titles = @("Minecraft", "Minecraft Beta 1.7.3")
$h = [IntPtr]::Zero
foreach ($t in $titles) {
    $h = [Win32]::FindWindow([NullString]::Value, $t)
    if ($h -ne [IntPtr]::Zero) { break }
}
if ($h -eq [IntPtr]::Zero) {
    Get-Process java* | ForEach-Object { 
        if ($_.MainWindowTitle -like "*Minecraft*") { $h = $_.MainWindowHandle }
    }
}
if ($h -ne [IntPtr]::Zero) {
    $style = [Win32]::GetWindowLong($h, -16)
    $newStyle = $style -band (-bnot 0x00C40000)
    [Win32]::SetWindowLong($h, -16, $newStyle)
    [Win32]::SetWindowPos($h, [IntPtr]::Zero, 0, 0, ${e}, ${t}, 0x0040)
    [Win32]::SetForegroundWindow($h)
}
`;await Ee(`powershell -ExecutionPolicy Bypass -Command "${r.replace(/"/g,'\\"').replace(/\n/g," ")}"`),D.info("GameHandler","Borderless mode applied via Win32 APIs")}else if(process.platform==="darwin"){let r=`
tell application "System Events"
    set javaProcesses to every process whose name contains "java"
    repeat with proc in javaProcesses
        try
            set frontmost of proc to true
            set position of window 1 of proc to {0, 0}
            set size of window 1 of proc to {${e}, ${t}}
        end try
    end repeat
end tell
`;await Ee(`osascript -e '${r.replace(/'/g,`'"'"'`)}'`),D.info("GameHandler","Borderless mode applied via AppleScript")}else if(process.platform==="linux")if((process.env.XDG_SESSION_TYPE||"x11")==="x11")try{await Ee('wmctrl -r "Minecraft" -b add,fullscreen'),D.info("GameHandler","Borderless mode applied via wmctrl")}catch{try{await Ee("wmctrl -r :ACTIVE: -b add,fullscreen"),D.info("GameHandler","Borderless mode applied via wmctrl (active window)")}catch{D.warn("GameHandler","wmctrl failed - is it installed? Run: sudo apt install wmctrl")}}else D.warn("GameHandler","Wayland detected - fullscreen borderless has limited support. Window may not cover top bar.")}catch(r){D.error("GameHandler",`Failed to apply borderless mode: ${r.message}`)}}async checkAndExtractInstance(){let e=P.default.join(Y.app.getPath("userData"),"instances","default"),t=Y.app.getPath("userData");if(L.default.existsSync(P.default.join(e,"instance.cfg")))return console.log("Instance already exists, skipping extraction."),e;let r=P.default.join(t,"instance.zip");if(!L.default.existsSync(r)){console.log("instance.zip not found. Attempting to download from VPS...");let s=["https://craft.blocky.com.br/launcher-assets/instance.zip"];for(let n of s)try{console.log(`Trying to download instance.zip from ${n}...`);let c=await fetch(n,{signal:AbortSignal.timeout(6e4)});if(c.ok){let d=await c.arrayBuffer(),v=Buffer.from(d);if(v.length>=4&&v[0]===80&&v[1]===75){L.default.writeFileSync(r,v),console.log("instance.zip downloaded successfully from",n);break}else console.warn(`Downloaded content from ${n} is not a valid ZIP (got ${v.length} bytes, first bytes: ${v.slice(0,20).toString("hex")})`)}}catch(c){console.warn(`Failed to download instance.zip from ${n}:`,c)}}return L.default.existsSync(r)&&be(r)?(console.log("Extracting instance.zip..."),Bt(r,e),e):null}async downloadFile(e,t,r,s){this.sendProgress(s,`Baixando ${r}...`,0),L.default.mkdirSync(t,{recursive:!0});let n=P.default.join(t,r);try{if(L.default.existsSync(n))return n;let c=await fetch(e);if(!c.ok)throw new Error(`Failed to download ${e}: ${c.statusText}`);let d=Number(c.headers.get("content-length"))||0,v=(0,$t.createWriteStream)(n);if(!c.body)throw new Error("No body");let y=c.body.getReader(),I=0;for(;;){let{done:N,value:a}=await y.read();if(N)break;v.write(Buffer.from(a)),I+=a.length,d>0&&this.sendProgress(s,`Baixando ${r}`,Math.round(I/d*100))}await new Promise((N,a)=>{v.on("finish",N),v.on("error",a),v.end()});let b=L.default.statSync(n);if(r.endsWith(".jar")&&b.size<100)throw L.default.unlinkSync(n),new Error(`Downloaded file ${r} is too small (${b.size} bytes). Likely invalid.`);if(r.endsWith(".zip")&&!be(n)){let a=L.default.readFileSync(n).slice(0,20).toString("hex");throw L.default.unlinkSync(n),new Error(`Downloaded file ${r} is not a valid ZIP (first bytes: ${a}). Server may have returned an error page.`)}return n}catch(c){if(L.default.existsSync(n))try{L.default.unlinkSync(n)}catch{}throw new Error(`Download failed: ${c}`)}}async handleLaunch(e,t){console.log("Requesting game launch...",t),this.sendProgress(e.sender,"Verificando atualiza\xE7\xF5es...",2);let r=Date.now();if(this.lastUpdateCheck&&r-this.lastUpdateCheck.timestamp<this.UPDATE_CACHE_TTL)console.log("[GameHandler] Using cached update check result (TTL: 60s)");else try{let a=await this.updateManager.performAllUpdates((f,h)=>{let l=2+h/100*13;this.sendProgress(e.sender,f,Math.round(l))});this.lastUpdateCheck={result:a,timestamp:r},a.success||console.warn("Update check failed, continuing anyway:",a.error)}catch(a){console.warn("Update check failed, continuing anyway:",a)}let s=await this.checkAndExtractInstance(),n=!!s,c=s||this.gamePath,d=n?P.default.join(c,".minecraft"):c;L.default.existsSync(d)||L.default.mkdirSync(d,{recursive:!0});let v=this.lastUpdateCheck?.result?.remoteVersions?.instance?.version,y=P.default.join(d,".fabric","remappedJars");v&&v!==this.lastInstanceVersion?(L.default.existsSync(y)&&(console.log("[GameHandler] Instance version changed, clearing remappedJars cache..."),L.default.rmSync(y,{recursive:!0,force:!0})),this.lastInstanceVersion=v):console.log("[GameHandler] Preserving remappedJars cache (same instance version)");let I=P.default.join(d,"bin"),b=P.default.join(c,"natives"),N=P.default.join(c,"libraries");try{if(!t.username)throw new Error("Username required");this.sendProgress(e.sender,"Verificando Java...",5);try{this.javaPath=t.javaPath||await this.javaManager.ensureJava(e.sender)}catch(x){throw new Error("Falha ao configurar Java: "+x.message)}this.sendProgress(e.sender,"Verificando vers\xE3o...",65);let a=await this.getCachedVersionDetails(),f=a.downloads.client.url,h=await this.downloadFile(f,I,"minecraft.jar",e.sender);if(!n){this.sendProgress(e.sender,"Baixando bibliotecas...",70);let x="natives-linux";process.platform==="win32"?x="natives-windows":process.platform==="darwin"&&(x="natives-osx");for(let F of a.libraries)if(F.downloads&&F.downloads.classifiers&&F.downloads.classifiers[x]){let q=F.downloads.classifiers[x],ee=await this.downloadFile(q.url,P.default.join(c,"temp_natives"),P.default.basename(q.path),e.sender);be(ee)?new Pe.default(ee).extractAllTo(b,!0):console.warn(`[GameHandler] Skipping invalid native file: ${ee}`)}let O=P.default.join(b,process.platform==="win32"?"OpenAL-amd64.dll":"libopenal.so");if(!L.default.existsSync(O)){console.log("[GameHandler] OpenAL not found, downloading from Legacy Fabric..."),this.sendProgress(e.sender,"Baixando OpenAL...",72);let F="natives-linux";process.platform==="win32"?F="natives-windows":process.platform==="darwin"&&(F="natives-osx");let q=`https://repo.legacyfabric.net/repository/legacyfabric/org/lwjgl/lwjgl/lwjgl-platform/2.9.4+legacyfabric.9/lwjgl-platform-2.9.4+legacyfabric.9-${F}.jar`;try{let ee=await this.downloadFile(q,P.default.join(c,"temp_natives"),`lwjgl-platform-${F}.jar`,e.sender);be(ee)&&(new Pe.default(ee).extractAllTo(b,!0),console.log("[GameHandler] OpenAL natives extracted successfully"))}catch(ee){console.warn("[GameHandler] Failed to download OpenAL natives:",ee)}}}let l=[h],g="net.minecraft.client.Minecraft",p="";if(n){let x=P.default.join(s,"mmc-pack.json");if(L.default.existsSync(x)&&JSON.parse(L.default.readFileSync(x,"utf-8")).components.find(q=>q.uid==="net.fabricmc.fabric-loader")){this.sendProgress(e.sender,"Configurando Fabric/StationAPI...",75);let q=[{name:"asm:9.7.1",group:"org.ow2.asm",artifact:"asm",version:"9.7.1"},{name:"asm-analysis:9.7.1",group:"org.ow2.asm",artifact:"asm-analysis",version:"9.7.1"},{name:"asm-commons:9.7.1",group:"org.ow2.asm",artifact:"asm-commons",version:"9.7.1"},{name:"asm-tree:9.7.1",group:"org.ow2.asm",artifact:"asm-tree",version:"9.7.1"},{name:"asm-util:9.7.1",group:"org.ow2.asm",artifact:"asm-util",version:"9.7.1"},{name:"sponge-mixin:0.15.3+mixin.0.8.7",group:"net.fabricmc",artifact:"sponge-mixin",version:"0.15.3+mixin.0.8.7"},{name:"mixinextras-fabric:0.4.1",group:"io.github.llamalad7",artifact:"mixinextras-fabric",version:"0.4.1"},{name:"commons-lang3:3.12.0",group:"org.apache.commons",artifact:"commons-lang3",version:"3.12.0"},{name:"commons-io:2.11.0",group:"commons-io",artifact:"commons-io",version:"2.11.0"},{name:"commons-codec:1.15",group:"commons-codec",artifact:"commons-codec",version:"1.15"},{name:"jutils:1.0.0",group:"net.java.jutils",artifact:"jutils",version:"1.0.0"},{name:"jinput:2.0.5",group:"net.java.jinput",artifact:"jinput",version:"2.0.5"},{name:"lwjgl:2.9.4+legacyfabric.9",group:"org.lwjgl.lwjgl",artifact:"lwjgl",version:"2.9.4+legacyfabric.9"},{name:"lwjgl_util:2.9.4+legacyfabric.9",group:"org.lwjgl.lwjgl",artifact:"lwjgl_util",version:"2.9.4+legacyfabric.9"},{name:"log4j-api:2.16.0",group:"org.apache.logging.log4j",artifact:"log4j-api",version:"2.16.0"},{name:"log4j-core:2.16.0",group:"org.apache.logging.log4j",artifact:"log4j-core",version:"2.16.0"},{name:"log4j-slf4j18-impl:2.16.0",group:"org.apache.logging.log4j",artifact:"log4j-slf4j18-impl",version:"2.16.0"},{name:"terminalconsoleappender:1.2.0",group:"net.minecrell",artifact:"terminalconsoleappender",version:"1.2.0"},{name:"slf4j-api:1.8.0-beta4",group:"org.slf4j",artifact:"slf4j-api",version:"1.8.0-beta4"},{name:"guava:31.0.1-jre",group:"com.google.guava",artifact:"guava",version:"31.0.1-jre"},{name:"failureaccess:1.0.1",group:"com.google.guava",artifact:"failureaccess",version:"1.0.1"},{name:"gson:2.8.9",group:"com.google.code.gson",artifact:"gson",version:"2.8.9"},{name:"log4j-config:1.0.0",group:"babric",artifact:"log4j-config",version:"1.0.0"}],ee="https://maven.fabricmc.net/",De="https://repo1.maven.org/maven2/",Xe="https://repo.legacyfabric.net/repository/legacyfabric/",Zt="https://maven.glass-launcher.net/babric/";console.log("[GameHandler] Using Maven-based library downloads"),L.default.existsSync(N)||L.default.mkdirSync(N,{recursive:!0});for(let T of q){let de=`${T.group.replace(/\./g,"/")}/${T.artifact}/${T.version}/${T.artifact}-${T.version}.jar`,Z=P.default.join(N,`${T.artifact}-${T.version}.jar`);if(L.default.existsSync(Z)){l.push(Z);continue}let Q=ee+de;["org.apache","commons-io","commons-codec","net.java.jutils","net.java.jinput","org.ow2.asm","com.google.guava","com.google.code.gson","org.slf4j","io.github.llamalad7","net.minecrell"].some(Ie=>T.group.startsWith(Ie)||T.group===Ie)?Q=De+de:T.group.startsWith("org.lwjgl")?Q=Xe+de:T.group==="babric"&&(Q=Zt+de);let he=await this.downloadFile(Q,N,`${T.artifact}-${T.version}.jar`,e.sender);l.push(he)}this.sendProgress(e.sender,"Baixando nativos...",78);let Jt=process.platform==="linux"?["liblwjgl-linux-amd64.so","libopenal-amd64.so","libjinput-linux64.so"]:process.platform==="win32"?["lwjgl64.dll","OpenAL64.dll"]:["liblwjgl.dylib","libopenal.dylib"];if(L.default.existsSync(b)&&Jt.every(T=>L.default.existsSync(P.default.join(b,T))))console.log("[GameHandler] Natives already present, skipping extraction");else{L.default.existsSync(b)&&(console.log("[GameHandler] Natives incomplete, clearing for fresh extraction..."),L.default.rmSync(b,{recursive:!0,force:!0})),L.default.mkdirSync(b,{recursive:!0});let T="natives-linux";process.platform==="win32"?T="natives-windows":process.platform==="darwin"&&(T="natives-osx");let de=[{group:"org.lwjgl.lwjgl",artifact:"lwjgl-platform",version:"2.9.4+legacyfabric.9",classifier:T},{group:"net.java.jinput",artifact:"jinput-platform",version:"2.0.5",classifier:T}];for(let Z of de){let Q=`${Z.artifact}-${Z.version}-${Z.classifier}.jar`,ue=`${Z.group.replace(/\./g,"/")}/${Z.artifact}/${Z.version}/${Q}`,ae=P.default.join(N,Q);if(L.default.existsSync(ae)){console.log(`[Cache] Found native library locally: ${Q}`),await Mt(ae,b);continue}let he=Xe+ue;Z.group==="net.java.jinput"&&(he=De+ue);let Ie=await this.downloadFile(he,P.default.join(c,"temp_natives"),Q,e.sender);await Mt(Ie,b)}if(process.platform==="darwin")try{let Z=L.default.readdirSync(b);for(let Q of Z)if(Q.endsWith(".jnilib")){let ue=P.default.join(b,Q),ae=P.default.join(b,Q.replace(".jnilib",".dylib"));if(L.default.existsSync(ue)){console.log(`[GameHandler] Renaming ${Q} to .dylib`);try{L.default.existsSync(ae)&&L.default.unlinkSync(ae),L.default.renameSync(ue,ae)}catch(he){console.warn(`[GameHandler] Failed to rename ${Q}:`,he)}}}}catch(Z){console.warn("[GameHandler] Failed to process macOS natives:",Z)}try{let Z=L.default.readdirSync(b);console.log(`[GameHandler] Natives folder contents (${b}):`,Z)}catch(Z){console.error("[GameHandler] Failed to read natives folder:",Z)}}let Xt=await this.downloadFile("https://maven.fabricmc.net/net/fabricmc/fabric-loader/0.16.7/fabric-loader-0.16.7.jar",N,"fabric-loader-0.16.7.jar",e.sender),qt=await this.downloadFile("https://maven.glass-launcher.net/babric/babric/intermediary-upstream/b1.7.3/intermediary-upstream-b1.7.3.jar",N,"intermediary-upstream-b1.7.3.jar",e.sender);l.push(Xt),l.push(qt),g="net.fabricmc.loader.impl.launch.knot.KnotClient";let He=[];for(let T of l)T!==h&&He.push(T);He.push(h),l=He}}if(!n){for(let x of a.libraries)if(x.downloads&&x.downloads.artifact){let O=x.downloads.artifact;if(O.path.includes("lwjgl")||O.path.includes("jinput")){let F=await this.downloadFile(O.url,I,P.default.basename(O.path),e.sender);l.push(F)}}}this.sendProgress(e.sender,"Iniciando Jogo...",95);let o=t.settings?.minMemory||"512",u=t.settings?.maxMemory||"2048",m=t.settings?.javaArgs||"",S="";try{if(L.default.existsSync(b)){let x=L.default.readdirSync(b),O=process.platform==="win32"?["OpenAL64.dll","OpenAL32.dll","OpenAL-amd64.dll","OpenAL-i386.dll","OpenAL.dll"]:process.platform==="darwin"?["libopenal.dylib","openal.dylib"]:["libopenal.so","libopenal-amd64.so","libopenal-i386.so"];for(let F of O)if(x.includes(F)){S=P.default.join(b,F),console.log(`[GameHandler] Found OpenAL library: ${S}`);break}if(!S){let F=x.find(q=>q.toLowerCase().includes("openal")&&(q.endsWith(".dll")||q.endsWith(".so")||q.endsWith(".dylib")));F&&(S=P.default.join(b,F),console.log(`[GameHandler] Found OpenAL library (fallback): ${S}`))}}}catch(x){console.warn("[GameHandler] Failed to scan for OpenAL lib:",x)}let E=P.default.join(d,"resources"),C=[`-Xms${o}M`,`-Xmx${u}M`,"-Djava.library.path="+b,"-Dfabric.gameJarPath="+h,"-Dfabric.gameVersion=b1.7.3","-Dfabric.envType=client","-Dslf4j.internal.verbosity=ERROR","-Dminecraft.resources.index="+E,"-Dminecraft.applet.TargetDirectory="+d,"-Dminecraft.applet.BaseURL=file:///"];if(m.trim()){let x=m.trim().split(/\s+/).filter(O=>O.length>0);C.push(...x)}if(t.settings?.borderlessMode&&(console.log("[GameHandler] Borderless mode enabled - adding LWJGL undecorated flag"),C.push("-Dorg.lwjgl.opengl.Window.undecorated=true")),C.push("-cp",l.join(P.default.delimiter)),C.push(g),C.push("--username",t.username),C.push("--gameDir",d),C.push("--assetsDir",P.default.join(d,"resources")),n&&g.includes("KnotClient")&&C.push("--assetIndex","truly_legacy"),t.settings?.borderlessMode)try{let x=Y.screen.getPrimaryDisplay(),{width:O,height:F}=x.size;console.log(`[GameHandler] Borderless mode: setting window size to ${O}x${F}`),C.push("--width",O.toString()),C.push("--height",F.toString())}catch(x){console.warn("[GameHandler] Failed to get screen size for borderless mode:",x),C.push("--width","1920"),C.push("--height","1080")}C.push("--server","185.100.215.195"),C.push("--port","25565"),console.log("Spawning java:",this.javaPath),console.log("Args:",C);let j={...process.env};if(process.platform==="linux"&&(j.ALSOFT_CONF="period_size=2048",j.ALSOFT_DRIVERS="pulse,alsa,oss"),process.platform==="win32"){let x=Object.keys(j).find(O=>O.toLowerCase()==="path")||"Path";j[x]=b+P.default.delimiter+(j[x]||""),console.log("[GameHandler] Updated PATH with natives:",b)}this.gameProcess=(0,Ae.spawn)(this.javaPath,C,{cwd:d,env:j});let V=Ue();V&&V.setGameRunning(!0),t.settings?.borderlessMode&&this.applyBorderlessPostSpawn().catch(x=>{D.error("GameHandler",`Borderless post-spawn failed: ${x.message}`)});let U=["s3.amazonaws.com/MinecraftResources","Failed to add pack.mcmeta","Failed to add READ_ME_I_AM_VERY_IMPORTANT"];return this.gameProcess.stdout.on("data",x=>{let O=x.toString().trim();O&&(D.game("stdout",O),!U.some(F=>O.includes(F))&&(console.log(`[MC]: ${O}`),O.includes("Connecting to")&&e.sender.send("game-connected")))}),this.gameProcess.stderr.on("data",x=>{let O=x.toString().trim();O&&(D.game("stderr",O),!U.some(F=>O.includes(F))&&console.error(`[MC-Err]: ${O}`))}),this.gameProcess.on("close",x=>{D.info("GameHandler",`Minecraft exited with code ${x}`),console.log(`Minecraft exited with code ${x}`),this.sendProgress(e.sender,"Jogo fechado",100),this.gameProcess=null,e.sender.send("game-closed",x);let O=Ue();O&&O.setGameRunning(!1)}),{success:!0}}catch(a){return console.error("Launch failed:",a),this.sendProgress(e.sender,`Erro: ${a.message}`,0),{success:!1,error:a.message,stack:a.stack}}}async handleUpdateCheck(){try{let e=await this.updateManager.checkForUpdates();return e.remoteVersions?e.instanceUpdate||e.librariesUpdate||e.modsUpdate?{available:!0,instanceUpdate:e.instanceUpdate,librariesUpdate:e.librariesUpdate,modsUpdate:e.modsUpdate,notes:e.remoteVersions.mods?.notes||"Atualiza\xE7\xF5es dispon\xEDveis"}:{available:!1}:{available:!1,error:"Failed to fetch version info"}}catch(e){return console.error("Update check failed:",e),{available:!1,error:String(e)}}}async handlePerformUpdate(e){try{return await this.updateManager.performAllUpdates((r,s)=>{this.sendProgress(e.sender,r,s)})}catch(t){return console.error("Update failed:",t),this.sendProgress(e.sender,`Erro na atualiza\xE7\xE3o: ${t}`,0),{success:!1,error:String(t)}}}};var Se=require("electron"),te=G(require("fs"),1),re=G(require("path"),1),Vt=G(we(),1);var Re=class{userDataPath;activeModsDir="";constructor(){this.userDataPath=Se.app.getPath("userData")}init(){Se.ipcMain.handle("get-mods",async()=>(D.info("ModHandler","Fetching mods list..."),this.getMods())),Se.ipcMain.handle("toggle-mod",async(e,{fileName:t,enable:r})=>(D.info("ModHandler",`Toggling mod ${t} to ${r}`),this.toggleMod(t,r)))}async toggleMod(e,t){if(!this.activeModsDir){let s="Cannot toggle mod: No active mods directory found.";return D.error("ModHandler",s),{success:!1,error:s}}let r=re.default.join(this.activeModsDir,"disabled");if(!te.default.existsSync(r))try{await te.default.promises.mkdir(r,{recursive:!0})}catch(s){let n=`Failed to create disabled directory: ${s.message}`;return D.error("ModHandler",n),{success:!1,error:n}}try{if(t){let s=re.default.join(r,e),n=re.default.join(this.activeModsDir,e);if(te.default.existsSync(s)){if(te.default.existsSync(n)){let d=`Destination file already exists: ${n}`;return D.warn("ModHandler",d),{success:!1,error:d}}return await this.moveFile(s,n)?(D.info("ModHandler",`Enabled mod: Moved ${e} to active folder`),{success:!0}):{success:!1,error:"Move operation failed (check logs)"}}else{let c=`Cannot enable: File not found in disabled folder: ${s}`;return D.warn("ModHandler",c),{success:!1,error:c}}}else{let s=re.default.join(this.activeModsDir,e),n=re.default.join(r,e);if(te.default.existsSync(s))return await this.moveFile(s,n)?(D.info("ModHandler",`Disabled mod: Moved ${e} to disabled folder`),{success:!0}):{success:!1,error:"Move operation failed (check logs)"};{let c=`Cannot disable: File not found in active folder: ${s}`;return D.warn("ModHandler",c),{success:!1,error:c}}}}catch(s){return D.error("ModHandler",`Failed to toggle mod ${e}: ${s.message}`),{success:!1,error:s.message}}}async moveFile(e,t){try{return await te.default.promises.rename(e,t),!0}catch(r){D.warn("ModHandler",`Rename failed for ${re.default.basename(e)}, trying copy+unlink: ${r}`);try{return await te.default.promises.copyFile(e,t),await te.default.promises.unlink(e),!0}catch(s){return D.error("ModHandler",`Move failed completely for ${re.default.basename(e)}: ${s}`),!1}}}async getMods(){let e=[re.default.join(this.userDataPath,"instances","default",".minecraft","mods"),re.default.join(this.userDataPath,"instances","default","mods"),re.default.join(this.userDataPath,"gamedata","mods")],t="";for(let c of e)if(te.default.existsSync(c)){t=c,D.info("ModHandler",`Found mods directory at: ${t}`);break}if(!t)return D.warn("ModHandler","No valid mods directory found in standard locations."),[];this.activeModsDir=t;let r=re.default.join(t,"disabled"),s=[],n=async(c,d)=>{if(te.default.existsSync(c))try{let v=await te.default.promises.readdir(c);for(let y of v){if(!y.endsWith(".jar"))continue;let I=re.default.join(c,y);if((await te.default.promises.stat(I)).isDirectory())continue;let N={fileName:y,enabled:d,name:y,description:"",version:""};try{let f=new Vt.default(I).getEntries(),h=f.find(p=>p.entryName==="fabric.mod.json"),l=f.find(p=>p.entryName==="mod.json"),g=h||l;if(g){let p=g.getData().toString("utf8"),o=JSON.parse(p);o.name&&(N.name=o.name),o.description&&(N.description=o.description),o.version&&(N.version=o.version)}}catch(a){D.warn("ModHandler",`Could not read metadata for ${y}: ${a}`)}s.push(N)}}catch(v){D.error("ModHandler",`Error scanning directory ${c}: ${v}`)}};return await n(t,!0),await n(r,!1),s.sort((c,d)=>c.enabled===d.enabled?c.name.localeCompare(d.name):c.enabled?-1:1)}};var z=require("electron");var zt=G(require("path"),1),Te=G(require("fs"),1),Ze=["F6","Shift+Tab","CommandOrControl+Tab"],Me=class{overlayWindow=null;browserView=null;isVisible=!1;isGameRunning=!1;hotkeyRegistered=!1;configPath="";OVERLAY_URL="https://craft.blocky.com.br";HEADER_HEIGHT=48;init(){D.info("OverlayHandler","Initializing overlay handler"),this.configPath=zt.default.join(z.app.getPath("userData"),"overlay-config.json"),this.registerHotkey(),this.setupIPC()}setupIPC(){z.ipcMain.on("overlay-go-back",()=>{this.browserView&&!this.browserView.webContents.isDestroyed()&&this.browserView.webContents.canGoBack()&&(this.browserView.webContents.goBack(),D.info("OverlayHandler","Navigated back"))}),z.ipcMain.on("overlay-go-home",()=>{this.browserView&&!this.browserView.webContents.isDestroyed()&&(this.browserView.webContents.loadURL(this.OVERLAY_URL),D.info("OverlayHandler","Navigated to home"))}),z.ipcMain.on("overlay-close",()=>{this.hideOverlay(),D.info("OverlayHandler","Closed via IPC")}),z.ipcMain.handle("get-overlay-hotkey",()=>this.getHotkey()),z.ipcMain.handle("set-overlay-hotkey",(e,t)=>this.setHotkey(t)),z.ipcMain.handle("get-available-hotkeys",()=>this.getAvailableHotkeys())}registeredHotkey=null;getDefaultHotkey(){return process.platform==="linux"?"F6":"Shift+Tab"}loadSavedHotkey(){try{if(Te.default.existsSync(this.configPath)){let e=JSON.parse(Te.default.readFileSync(this.configPath,"utf-8"));if(e.hotkey&&Ze.includes(e.hotkey))return e.hotkey}}catch{D.warn("OverlayHandler","Failed to load hotkey config, using default")}return this.getDefaultHotkey()}saveHotkeyConfig(e){try{Te.default.writeFileSync(this.configPath,JSON.stringify({hotkey:e},null,2)),D.info("OverlayHandler",`Saved hotkey config: ${e}`)}catch{D.error("OverlayHandler","Failed to save hotkey config")}}registerHotkey(){let e=this.loadSavedHotkey();this.tryRegisterHotkey(e)}tryRegisterHotkey(e){try{return z.globalShortcut.isRegistered(e)?(D.warn("OverlayHandler",`Hotkey ${e} is already registered by another application`),!1):z.globalShortcut.register(e,()=>{D.info("OverlayHandler",`${e} pressed`),this.toggleOverlay()})?(this.registeredHotkey=e,this.hotkeyRegistered=!0,D.info("OverlayHandler",`Overlay hotkey registered: ${e}`),!0):(D.warn("OverlayHandler",`Failed to register hotkey: ${e}`),!1)}catch(t){return D.error("OverlayHandler",`Exception registering ${e}: ${t.message}`),!1}}getHotkey(){return this.registeredHotkey||this.getDefaultHotkey()}setHotkey(e){if(!Ze.includes(e))return{success:!1,error:`Invalid hotkey: ${e}`};if(this.registeredHotkey&&this.hotkeyRegistered&&(z.globalShortcut.unregister(this.registeredHotkey),this.hotkeyRegistered=!1,this.registeredHotkey=null),this.tryRegisterHotkey(e))return this.saveHotkeyConfig(e),{success:!0};{let t=this.getDefaultHotkey();return t!==e&&this.tryRegisterHotkey(t),{success:!1,error:`Failed to register hotkey: ${e}. It may be in use by another application.`}}}getAvailableHotkeys(){return[...Ze]}cleanup(){this.hotkeyRegistered&&this.registeredHotkey&&(z.globalShortcut.unregister(this.registeredHotkey),this.hotkeyRegistered=!1,this.registeredHotkey=null,D.info("OverlayHandler","Hotkey unregistered")),this.overlayWindow&&!this.overlayWindow.isDestroyed()&&(this.overlayWindow.setBrowserView(null),this.browserView&&!this.browserView.webContents.isDestroyed()&&this.browserView.webContents.destroy(),this.overlayWindow.destroy(),this.overlayWindow=null,this.browserView=null)}createOverlayWindow(){if(this.overlayWindow&&!this.overlayWindow.isDestroyed()){D.info("OverlayHandler","Overlay window already exists");return}let e=z.screen.getPrimaryDisplay(),{width:t,height:r}=e.size,s=Math.min(Math.floor(t*.85),1400),n=Math.min(Math.floor(r*.85),900),c=Math.floor((t-s)/2),d=Math.floor((r-n)/2);D.info("OverlayHandler",`Creating overlay: ${s}x${n} at (${c}, ${d})`),this.overlayWindow=new z.BrowserWindow({width:s,height:n,x:c,y:d,frame:!1,transparent:!1,alwaysOnTop:!0,skipTaskbar:!0,show:!1,resizable:!1,movable:!1,focusable:!0,hasShadow:!0,backgroundColor:"#1e1e1e",webPreferences:{nodeIntegration:!0,contextIsolation:!1,sandbox:!1}});let v=`
<!DOCTYPE html>
<html>
<head>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { margin: 0; overflow: hidden; background: #1e1e1e; font-family: 'Inter', system-ui, -apple-system, sans-serif; }
        #blockycraft-nav-bar {
            height: ${this.HEADER_HEIGHT}px;
            background: #1e1e1e;
            border-bottom: 1px solid #333333;
            display: flex;
            align-items: center;
            padding: 0 16px;
            gap: 8px;
            color: white;
            user-select: none;
        }
        #blockycraft-nav-bar button {
            background: #2a2a2a;
            border: 1px solid #333333;
            color: #ffffff;
            width: 36px;
            height: 36px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        #blockycraft-nav-bar button:hover {
            background: #333333;
            border-color: #444444;
        }
        #blockycraft-nav-bar button svg {
            width: 20px;
            height: 20px;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
            fill: none;
        }
        #blockycraft-nav-bar .nav-title {
            color: #a1a1aa;
            font-size: 13px;
            margin-left: auto;
            font-weight: 500;
        }
        #blockycraft-nav-bar .close-btn {
            background: transparent;
            border-color: transparent;
            color: #ffffff;
            margin-left: 8px;
        }
        #blockycraft-nav-bar .close-btn:hover {
            background: #ef4444;
            border-color: #ef4444;
            color: #ffffff;
        }
    </style>
</head>
<body>
    <div id="blockycraft-nav-bar">
        <button id="bc-back-btn" title="Voltar" onclick="window.overlayAPI.goBack()">
            <svg viewBox="0 0 24 24"><path d="m15 18-6-6 6-6"/></svg>
        </button>
        <button id="bc-home-btn" title="In\xEDcio" onclick="window.overlayAPI.goHome()">
            <svg viewBox="0 0 24 24"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
        </button>
        <span class="nav-title">BlockyCRAFT Overlay</span>
        <button class="close-btn" id="bc-close-btn" title="Fechar (Shift+Tab)" onclick="window.overlayAPI.close()">
            <svg viewBox="0 0 24 24"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
        </button>
    </div>
    <script>
        const { ipcRenderer } = require('electron');
        window.overlayAPI = {
            goBack: () => ipcRenderer.send('overlay-go-back'),
            goHome: () => ipcRenderer.send('overlay-go-home'),
            close: () => ipcRenderer.send('overlay-close')
        };
    </script>
</body>
</html>`;this.overlayWindow.loadURL(`data:text/html;charset=utf-8,${encodeURIComponent(v)}`),this.browserView=new z.BrowserView({webPreferences:{nodeIntegration:!1,contextIsolation:!0,sandbox:process.platform!=="linux"}}),this.overlayWindow.setBrowserView(this.browserView),this.browserView.setBounds({x:0,y:this.HEADER_HEIGHT,width:s,height:n-this.HEADER_HEIGHT}),this.browserView.setAutoResize({width:!0,height:!0}),this.browserView.webContents.on("did-start-loading",()=>{D.info("OverlayHandler","Browser started loading")}),this.browserView.webContents.on("did-fail-load",(y,I,b)=>{D.error("OverlayHandler",`Failed to load: ${I} - ${b}`)}),this.browserView.webContents.setWindowOpenHandler(({url:y})=>(D.info("OverlayHandler",`Intercepted new window request: ${y}`),this.browserView&&!this.browserView.webContents.isDestroyed()&&this.browserView.webContents.loadURL(y),{action:"deny"})),this.browserView.webContents.on("before-input-event",(y,I)=>{I.key==="Escape"&&I.type==="keyDown"&&this.hideOverlay()}),this.overlayWindow.webContents.on("before-input-event",(y,I)=>{I.key==="Escape"&&I.type==="keyDown"&&this.hideOverlay()}),D.info("OverlayHandler",`Loading URL: ${this.OVERLAY_URL}`),this.browserView.webContents.loadURL(this.OVERLAY_URL),this.overlayWindow.on("close",y=>{this.overlayWindow&&!this.overlayWindow.isDestroyed()&&(y.preventDefault(),this.hideOverlay())}),D.info("OverlayHandler","Overlay window created with BrowserView")}toggleOverlay(){if(!this.isGameRunning){D.info("OverlayHandler","Game not running - overlay disabled");return}this.isVisible?this.hideOverlay():this.showOverlay()}showOverlay(){(!this.overlayWindow||this.overlayWindow.isDestroyed())&&(D.info("OverlayHandler","Creating overlay window on first use..."),this.createOverlayWindow()),this.overlayWindow&&(this.overlayWindow.show(),this.overlayWindow.focus(),this.overlayWindow.setAlwaysOnTop(!0,"screen-saver"),this.isVisible=!0,D.info("OverlayHandler","Overlay shown"))}hideOverlay(){this.overlayWindow&&!this.overlayWindow.isDestroyed()&&(this.overlayWindow.hide(),this.isVisible=!1,D.info("OverlayHandler","Overlay hidden"))}setGameRunning(e){this.isGameRunning=e,D.info("OverlayHandler",`Game running state: ${e}`),!e&&this.isVisible&&this.hideOverlay()}isGameActive(){return this.isGameRunning}isOverlayVisible(){return this.isVisible}};X.app.commandLine.appendSwitch("no-sandbox");X.app.commandLine.appendSwitch("ozone-platform-hint","auto");var _r=new Fe;_r.init();var jr=new Re;jr.init();var fe=null;function Ue(){return fe}console.log("=== BlockyCRAFT Launcher Starting ===");console.log("Electron version:",process.versions.electron);var ie=null,Gt=process.env.VITE_DEV_SERVER_URL;function Wt(){if(console.log("Creating main window..."),ie=new X.BrowserWindow({width:900,height:600,minWidth:800,minHeight:500,frame:!0,resizable:!0,webPreferences:{nodeIntegration:!1,contextIsolation:!0,preload:Je.default.join(__dirname,"preload.cjs"),sandbox:!1},backgroundColor:"#0f0f0f",show:!0,autoHideMenuBar:!0}),ie.setMenu(null),X.ipcMain.handle("open-external",async(i,e)=>{console.log("Opening external URL:",e);try{let{shell:t}=await import("electron");await t.openExternal(e)}catch(t){console.error("Failed to open external URL:",t)}}),X.ipcMain.handle("fetch-url",async(i,e)=>{D.info("Main",`Proxying fetch request to: ${e}`);let{net:t}=await import("electron");try{let r=await t.fetch(e);if(!r.ok)throw new Error(`HTTP ${r.status} ${r.statusText}`);return{success:!0,data:await r.text()}}catch(r){return D.error("Main",`Fetch failed for ${e}: ${r.message}`),{success:!1,error:r.message}}}),console.log("Window created, loading content..."),Gt)ie.loadURL(Gt);else{let i=Je.default.join(__dirname,"../dist/index.html");ie.loadFile(i)}ie.webContents.on("did-finish-load",()=>{console.log("Create Window: did-finish-load")}),ie.webContents.on("did-fail-load",(i,e,t,r)=>{console.error("Create Window: did-fail-load",e,t,r)}),ie.webContents.on("render-process-gone",(i,e)=>{console.error("Create Window: render-process-gone",e)}),ie.webContents.on("unresponsive",()=>{console.error("Create Window: unresponsive")}),ie.on("closed",()=>{fe&&fe.cleanup(),ie=null,X.app.quit()})}X.app.whenReady().then(()=>{D.init(),D.info("Main",`Electron version: ${process.versions.electron}`),D.info("Main",`Node version: ${process.versions.node}`),D.info("Main",`Platform: ${process.platform} ${process.arch}`),fe=new Me,fe.init(),Wt()});X.app.on("will-quit",()=>{fe&&fe.cleanup(),X.globalShortcut.unregisterAll()});X.app.on("window-all-closed",()=>{process.platform!=="darwin"&&X.app.quit()});X.app.on("activate",()=>{X.BrowserWindow.getAllWindows().length===0&&Wt()});0&&(module.exports={getOverlayHandler});
